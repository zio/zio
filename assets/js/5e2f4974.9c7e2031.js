"use strict";(self.webpackChunkzio_site=self.webpackChunkzio_site||[]).push([[4965],{15680:(e,n,o)=>{o.d(n,{xA:()=>c,yg:()=>m});var a=o(96540);function t(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function i(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?i(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function r(e,n){if(null==e)return{};var o,a,t=function(e,n){if(null==e)return{};var o,a,t={},i=Object.keys(e);for(a=0;a<i.length;a++)o=i[a],n.indexOf(o)>=0||(t[o]=e[o]);return t}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)o=i[a],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var l=a.createContext({}),p=function(e){var n=a.useContext(l),o=n;return e&&(o="function"==typeof e?e(n):s(s({},n),e)),o},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var o=e.components,t=e.mdxType,i=e.originalType,l=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),d=p(o),u=t,m=d["".concat(l,".").concat(u)]||d[u]||g[u]||i;return o?a.createElement(m,s(s({ref:n},c),{},{components:o})):a.createElement(m,s({ref:n},c))}));function m(e,n){var o=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var i=o.length,s=new Array(i);s[0]=u;var r={};for(var l in n)hasOwnProperty.call(n,l)&&(r[l]=n[l]);r.originalType=e,r[d]="string"==typeof e?e:t,s[1]=r;for(var p=2;p<i;p++)s[p]=o[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,o)}u.displayName="MDXCreateElement"},76165:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>i,metadata:()=>r,toc:()=>p});var a=o(58168),t=(o(96540),o(15680));const i={id:"cookies",title:"Cookies"},s=void 0,r={unversionedId:"zio-http/dsl/cookies",id:"zio-http/dsl/cookies",title:"Cookies",description:"Cookies are small pieces of data that websites store on a user's browser. They are sent between the client (browser) and server in HTTP requests and responses. Cookies serve various purposes, including session management, user authentication, personalization, and tracking.",source:"@site/docs/zio-http/dsl/cookies.md",sourceDirName:"zio-http/dsl",slug:"/zio-http/dsl/cookies",permalink:"/zio-http/dsl/cookies",draft:!1,editUrl:"https://github.com/zio/zio/edit/series/2.x/docs/zio-http/dsl/cookies.md",tags:[],version:"current",frontMatter:{id:"cookies",title:"Cookies"},sidebar:"ecosystem-sidebar",previous:{title:"Form",permalink:"/zio-http/dsl/form"},next:{title:"Flash",permalink:"/zio-http/dsl/flash"}},l={},p=[{value:"Response Cookie",id:"response-cookie",level:2},{value:"Creating a Response Cookie",id:"creating-a-response-cookie",level:3},{value:"Adding Cookie in a Response",id:"adding-cookie-in-a-response",level:3},{value:"Updating a Response Cookie",id:"updating-a-response-cookie",level:3},{value:"Signing a Cookie",id:"signing-a-cookie",level:3},{value:"Request Cookie",id:"request-cookie",level:2},{value:"Creating a Request Cookie",id:"creating-a-request-cookie",level:3},{value:"Updating a Request Cookie",id:"updating-a-request-cookie",level:3},{value:"Getting Cookie from a Request",id:"getting-cookie-from-a-request",level:2},{value:"Getting Cookie from a Header",id:"getting-cookie-from-a-header",level:2},{value:"Examples",id:"examples",level:2},{value:"Server Side Example",id:"server-side-example",level:3},{value:"Signed Cookies",id:"signed-cookies",level:3}],c={toc:p},d="wrapper";function g(e){let{components:n,...o}=e;return(0,t.yg)(d,(0,a.A)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,t.yg)("p",null,"Cookies are small pieces of data that websites store on a user's browser. They are sent between the client (browser) and server in HTTP requests and responses. Cookies serve various purposes, including session management, user authentication, personalization, and tracking."),(0,t.yg)("p",null,"When a user visits a website, the server can send one or more cookies to the browser, which stores them locally. The browser then includes these cookies in subsequent requests to the same website, allowing the server to retrieve and utilize the stored information."),(0,t.yg)("p",null,"In ZIO HTTP, cookies are represented by the ",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie")," data type, which encompasses both request cookies and response cookies:"),(0,t.yg)("p",null,"We can think of a ",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie")," as an immutable and type-safe representation of HTTP cookies that contains the name, content:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"sealed trait Cookie {\n  def name: String\n  def content: String\n}\n\nobject Cookie {\n  case class Request(name: String, content: String) extends Cookie { self =>\n    // Request Cookie methods\n  }\n  case class Response(\n    name: String,\n    content: String,\n    domain: Option[String] = None,\n    path: Option[Path] = None,\n    isSecure: Boolean = false,\n    isHttpOnly: Boolean = false,\n    maxAge: Option[Duration] = None,\n    sameSite: Option[SameSite] = None,\n  ) extends Cookie { self =>\n    // Response Cookie methods   \n  }\n}\n")),(0,t.yg)("p",null,"Request cookies (",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie.Request"),") are sent by the client to the server, while response cookies (",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie.Response"),") are sent by the server to the client."),(0,t.yg)("h2",{id:"response-cookie"},"Response Cookie"),(0,t.yg)("h3",{id:"creating-a-response-cookie"},"Creating a Response Cookie"),(0,t.yg)("p",null,"A Response ",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie")," can be created with params ",(0,t.yg)("inlineCode",{parentName:"p"},"name"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"content"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"expires"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"domain"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"path"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"isSecure"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"isHttpOnly"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"maxAge"),", ",(0,t.yg)("inlineCode",{parentName:"p"},"sameSite")," and ",(0,t.yg)("inlineCode",{parentName:"p"},"secret")," according to HTTP ",(0,t.yg)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie"},"Set-Cookie")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'import zio._\nimport zio.http._\n\nval responseCookie = Cookie.Response("user_id", "user123", maxAge = Some(5.days))\n// responseCookie: Cookie.Response = Response(\n//   name = "user_id",\n//   content = "user123",\n//   domain = None,\n//   path = None,\n//   isSecure = false,\n//   isHttpOnly = false,\n//   maxAge = Some(value = PT120H),\n//   sameSite = None\n// )\n')),(0,t.yg)("h3",{id:"adding-cookie-in-a-response"},"Adding Cookie in a Response"),(0,t.yg)("p",null,"The cookies can be added in ",(0,t.yg)("inlineCode",{parentName:"p"},"Response")," headers:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"val res = Response.ok.addCookie(responseCookie)\n")),(0,t.yg)("p",null,"It updates the response header ",(0,t.yg)("inlineCode",{parentName:"p"},"Set-Cookie")," as ",(0,t.yg)("inlineCode",{parentName:"p"},"Set-Cookie: <cookie-name>=<cookie-value>")),(0,t.yg)("p",null,"By adding the above cookie to a ",(0,t.yg)("inlineCode",{parentName:"p"},"Response"),", it will add a ",(0,t.yg)("inlineCode",{parentName:"p"},"Set-Cookie")," header with the respective cookie name and value and other optional attributes."),(0,t.yg)("p",null,"Let's write a simple example to see how it works:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'import zio.http._\n\nobject ResponseCookieExample extends ZIOAppDefault {\n  val httpApp = Routes(\n    Method.GET / "cookie" -> handler {\n      Response.ok.addCookie(\n        Cookie.Response(name = "user_id", content = "user123", maxAge = Some(5.days))\n      )\n    },\n  ).toHttpApp\n\n  def run = Server.serve(httpApp).provide(Server.default)\n}\n')),(0,t.yg)("p",null,"When we call the ",(0,t.yg)("inlineCode",{parentName:"p"},"/cookie")," endpoint, it will return a response with a ",(0,t.yg)("inlineCode",{parentName:"p"},"Set-Cookie")," header:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre"},"~> curl -X GET http://127.0.0.1:8080/cookie -i\nHTTP/1.1 200 OK\nset-cookie: user_id=user123; Max-Age=432000; Expires=Fri, 08 Mar 2024 10:41:52 GMT\ncontent-length: 0\n")),(0,t.yg)("p",null,"To convert a request cookie to a response cookie, use the ",(0,t.yg)("inlineCode",{parentName:"p"},"toResponse")," method:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'import zio.http._\n\nval requestCookie = Cookie.Request("id", "abc")\nval responseCookie = requestCookie.toResponse\n')),(0,t.yg)("h3",{id:"updating-a-response-cookie"},"Updating a Response Cookie"),(0,t.yg)("p",null,(0,t.yg)("inlineCode",{parentName:"p"},"Cookie.Response")," is a case class, so it can be updated by its ",(0,t.yg)("inlineCode",{parentName:"p"},"copy")," method:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"maxAge")," updates the max-age of the cookie:")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"responseCookie.copy(maxAge = Some(5.days))\n")),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"domain")," updates the host to which the cookie will be sent:")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'responseCookie.copy(domain = Some("example.com"))\n')),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"path")," updates the path of the cookie:")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'responseCookie.copy(path = Some(Root / "cookie"))\n')),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"isSecure")," enables cookie only on https server:")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"responseCookie.copy(isSecure = true)\n")),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"isHttpOnly")," forbids JavaScript from accessing the cookie:")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"responseCookie.copy(isHttpOnly = true)\n")),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},(0,t.yg)("inlineCode",{parentName:"li"},"sameSite")," updates whether or not a cookie is sent with cross-origin requests:")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},"responseCookie.copy(sameSite = Some(Cookie.SameSite.Strict))\n")),(0,t.yg)("h3",{id:"signing-a-cookie"},"Signing a Cookie"),(0,t.yg)("p",null,"Signing a cookie involves appending a cryptographic signature to the cookie data before it is transmitted to the client. This signature is generated using a secret key known only to the server. When the client sends the cookie back to the server in subsequent requests, the server can verify the signature to ensure the integrity and authenticity of the cookie data."),(0,t.yg)("p",null,"The cookies can be signed with a signature:"),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"Using ",(0,t.yg)("inlineCode",{parentName:"li"},"Response#sign"),":")),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'val cookie = Cookie.Response("key", "hello", maxAge = Some(5.days))\nval app = \n  Routes(\n    Method.GET / "cookie" -> handler {\n      Response.ok.addCookie(cookie.sign("secret"))\n    }\n  ).toHttpApp\n')),(0,t.yg)("ul",null,(0,t.yg)("li",{parentName:"ul"},"Using ",(0,t.yg)("inlineCode",{parentName:"li"},"signCookies")," middleware:")),(0,t.yg)("p",null,"To sign all the cookies in your routes, we can use ",(0,t.yg)("inlineCode",{parentName:"p"},"signCookies")," middleware:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'import Middleware.signCookies\n\nval app = Routes(\n  Method.GET / "cookie" -> handler(Response.ok.addCookie(cookie)),\n  Method.GET / "secure-cookie" -> handler(Response.ok.addCookie(cookie.copy(isSecure = true)))\n).toHttpApp\n\n// Run it like any simple app\ndef run(args: List[String]): ZIO[Any, Throwable, Nothing] =\n  Server.serve(app @@ signCookies("secret"))\n        .provide(Server.default)\n')),(0,t.yg)("h2",{id:"request-cookie"},"Request Cookie"),(0,t.yg)("h3",{id:"creating-a-request-cookie"},"Creating a Request Cookie"),(0,t.yg)("p",null,"A request cookie consists of ",(0,t.yg)("inlineCode",{parentName:"p"},"name")," and ",(0,t.yg)("inlineCode",{parentName:"p"},"content")," and can be created with ",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie.Request"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'val cookie: Cookie = Cookie.Request("user_id", "user123")\n// cookie: Cookie = Request(name = "user_id", content = "user123")\n')),(0,t.yg)("h3",{id:"updating-a-request-cookie"},"Updating a Request Cookie"),(0,t.yg)("p",null,"The ",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie#name")," method updates the name of cookie:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'cookie.name("session_id")\n// res8: Cookie = Request(name = "session_id", content = "user123")\n')),(0,t.yg)("p",null,"The ",(0,t.yg)("inlineCode",{parentName:"p"},"Cookie#content")," method updates the content of the cookie:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'cookie.content("abc123xyz789")\n// res9: Cookie = Request(name = "user_id", content = "abc123xyz789")\n')),(0,t.yg)("h2",{id:"getting-cookie-from-a-request"},"Getting Cookie from a Request"),(0,t.yg)("p",null,"From HTTP requests, a single cookie can be retrieved with ",(0,t.yg)("inlineCode",{parentName:"p"},"Request#cookie"),":"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'private val app4 = \n  Routes(\n    Method.GET / "cookie" -> handler { (req: Request) =>\n      val cookieContent = req.cookie("sessionId").map(_.content)\n      Response.text(s"cookie content: $cookieContent")\n    }\n  )\n')),(0,t.yg)("h2",{id:"getting-cookie-from-a-header"},"Getting Cookie from a Header"),(0,t.yg)("p",null,"In HTTP requests, cookies are stored in the ",(0,t.yg)("inlineCode",{parentName:"p"},"Header.cookie")," header:"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala"},'private val app3 = \n  Routes(\n    Method.GET / "cookie" -> handler { (req: Request) =>\n      Response.text(\n        req.header(Header.Cookie)\n          .map(_.value.toChunk)\n          .getOrElse(Chunk.empty)\n          .mkString("")\n      )\n    }\n  )\n')),(0,t.yg)("h2",{id:"examples"},"Examples"),(0,t.yg)("p",null,"Here are some simple examples of using cookies in a ZIO HTTP application."),(0,t.yg)("h3",{id:"server-side-example"},"Server Side Example"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala",metastring:'title="zio-http-example/src/main/scala/example/CookieServerSide.scala" showLineNumbers"',title:'"zio-http-example/src/main/scala/example/CookieServerSide.scala"','showLineNumbers"':!0},'package example\n\nimport zio._\n\nimport zio.http._\n\n/**\n * Example to make app using cookies\n */\nobject CookieServerSide extends ZIOAppDefault {\n\n  // Setting cookies with an expiry of 5 days\n  private val cookie = Cookie.Response("key", "value", maxAge = Some(5 days))\n  val res            = Response.ok.addCookie(cookie)\n\n  private val app = Routes(\n    Method.GET / "cookie"            ->\n      handler(Response.ok.addCookie(cookie.copy(path = Some(Path.root / "cookie"), isHttpOnly = true))),\n    Method.GET / "secure-cookie"     ->\n      handler(Response.ok.addCookie(cookie.copy(isSecure = true, path = Some(Path.root / "secure-cookie")))),\n    Method.GET / "cookie" / "remove" ->\n      handler(res.addCookie(Cookie.clear("key"))),\n  ).toHttpApp\n\n  // Run it like any simple app\n  val run =\n    Server.serve(app).provide(Server.default)\n}\n')),(0,t.yg)("h3",{id:"signed-cookies"},"Signed Cookies"),(0,t.yg)("pre",null,(0,t.yg)("code",{parentName:"pre",className:"language-scala",metastring:'title="zio-http-example/src/main/scala/example/SignCookies.scala" showLineNumbers"',title:'"zio-http-example/src/main/scala/example/SignCookies.scala"','showLineNumbers"':!0},'package example\n\nimport zio._\n\nimport zio.http._\n\n/**\n * Example to make app using signed-cookies\n */\nobject SignCookies extends ZIOAppDefault {\n\n  // Setting cookies with an expiry of 5 days\n  private val cookie = Cookie.Response("key", "hello", maxAge = Some(5 days))\n\n  private val app = Routes(\n    Method.GET / "cookie" ->\n      handler(Response.ok.addCookie(cookie.sign("secret"))),\n  ).toHttpApp\n\n  // Run it like any simple app\n  val run = Server.serve(app).provide(Server.default)\n}\n')))}g.isMDXComponent=!0}}]);