<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-resources/ecosystem/officials/zio-mock">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-rh="true">ZIO Mock | ZIO</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/resources/ecosystem/officials/zio-mock"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ZIO Mock | ZIO"><meta data-rh="true" name="description" content="Installation"><meta data-rh="true" property="og:description" content="Installation"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/resources/ecosystem/officials/zio-mock"><link data-rh="true" rel="alternate" href="https://zio.dev/resources/ecosystem/officials/zio-mock" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/resources/ecosystem/officials/zio-mock" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.97da2182.css">
<link rel="preload" href="/assets/js/runtime~main.4c8d210b.js" as="script">
<link rel="preload" href="/assets/js/main.b0e6b04a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a class="navbar__item navbar__link" href="/references/">References</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/resources/ecosystem/officials/zio-mock">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/resources/">Resources</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/resources/learning/articles">Learning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/resources/ecosystem/officials/">Ecosystem</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/resources/ecosystem/officials/">Official Libraries</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-actors">ZIO Actors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-akka-cluster">ZIO Akka Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-aws">ZIO AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-cache">ZIO Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-config">ZIO Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-ftp">ZIO FTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-json">ZIO JSON</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-kafka">ZIO Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-logging">ZIO Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-metrics">ZIO Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/resources/ecosystem/officials/zio-mock">ZIO Mock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-nio">ZIO NIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-optics">ZIO Optics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-prelude">ZIO Prelude</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-process">ZIO Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-query">ZIO Query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-redis">ZIO Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-rocksdb">ZIO RocksDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-s3">ZIO S3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-schema">ZIO Schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-sqs">ZIO SQS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-telemetry">ZIO Telemetry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/officials/zio-zmx">ZIO ZMX</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/resources/ecosystem/community/">Community Libraries</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/compatible">ZIO Compatible Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/tools">Tools for ZIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/resources/ecosystem/templates">Project Templates</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Ecosystem</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Official Libraries</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ZIO Mock</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZIO Mock</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">​</a></h2><p>In order to use this library, we need to add the following line in our <code>build.sbt</code> file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">libraryDependencies </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token string">&quot;dev.zio&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token operator">%</span><span class="token plain"> </span><span class="token string">&quot;zio-mock&quot;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> </span><span class="token generics punctuation">&lt;</span><span class="token generics">version</span><span class="token generics punctuation">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-problem">The Problem<a class="hash-link" href="#the-problem" title="Direct link to heading">​</a></h2><p>Whenever possible, we should strive to make our functions pure, which makes testing such function easy. So we just need to assert on the return value. However, in larger applications there is a need for intermediate layers that delegate the work to specialized services.</p><p>For example, in an HTTP server, the first layers of indirection are so-called <em>routes</em>, whose job is to match the request and delegate the processing to downstream layers. Below this layer, there is often a second layer of indirection, so-called <em>controllers</em>, which comprises several business logic units grouped by their domain. In a RESTful API, that would be all operations on a certain model. The <em>controller</em> to perform its job might call on further specialized services for communicating with the database, sending email, logging, etc.</p><p>If the job of the <em>capability</em> is to call on another <em>capability</em>, how should we test it?</p><p>Let&#x27;s say we have a <code>Userservice</code> defined as follows:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> register</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> register</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">register</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The live implementation of the <code>UserService</code> has two collaborators, <code>EmailService</code> and <code>UserRepository</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> User</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> UserRepository </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Following is how the live version of <code>UserService</code> is implemented:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> UserServiceLive</span><span class="token punctuation">(</span><span class="token plain">emailService</span><span class="token operator">:</span><span class="token plain"> EmailService</span><span class="token punctuation">,</span><span class="token plain"> userRepository</span><span class="token operator">:</span><span class="token plain"> UserRepository</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> register</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      emailService</span><span class="token punctuation">.</span><span class="token plain">send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;You are not eligible to register!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">username </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;The admin user is already registered!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> userRepository</span><span class="token punctuation">.</span><span class="token plain">save</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> emailService</span><span class="token punctuation">.</span><span class="token plain">send</span><span class="token punctuation">(</span><span class="token plain">email</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Congratulation, you are registered!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> UserServiceLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">EmailService </span><span class="token keyword">with</span><span class="token plain"> UserRepository</span><span class="token punctuation">,</span><span class="token plain"> UserService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">UserServiceLive</span><span class="token punctuation">.</span><span class="token plain">apply _</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A pure function is such a function which operates only on its inputs and produces only its output. Command-like methods, by definition are impure, as their job is to change state of the collaborating object (performing a <em>side effect</em>). For example:</p><p>The signature of <code>register</code> method <code>(String, Int, String) =&gt; IO[String, Unit]</code> hints us we&#x27;re dealing with a command. It returns <code>Unit</code> (well, wrapped in the <code>IO</code>, but it does not matter here). We can&#x27;t do anything useful with <code>Unit</code>, and it does not contain any information. It is the equivalent of returning nothing.</p><p>It is also an unreliable return type, as when Scala expects the return type to be <code>Unit</code> it will discard whatever value it had (for details see <a href="https://scala-lang.org/files/archive/spec/2.13/06-expressions.html#value-conversions" target="_blank" rel="noopener noreferrer">Section 6.26.1</a> of the Scala Language Specification), which may shadow the fact that the final value produced (and discarded) was not the one we expected.</p><p>Inside the <code>IO</code> there may be a description of any side effects. It may open a file, print to the console, or connect to databases. <strong>So the problem is &quot;How is it possible to test a service along with its collaborators&quot;?</strong></p><p>In this example, the <code>register</code> method has a service call to its collaborators, <code>UserRepository</code> and <code>EmailService</code>.  So, how can we test the live version of <code>UserService.register</code> while it has some side effects in communicating with its collaborators?</p><p>Mockists would probably claim that testing how collaborators are called during the test process allows us to test the UserService. Let&#x27;s move on to the next section and see the mockists&#x27; solution in greater detail.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-solution">The Solution<a class="hash-link" href="#the-solution" title="Direct link to heading">​</a></h2><p>In this sort of situations we need mock implementations of our <em>collaborator service</em>. As <em>Martin Fowler</em> puts it in his excellent article <a href="https://martinfowler.com/articles/mocksArentStubs.html" target="_blank" rel="noopener noreferrer">Mocks Aren&#x27;t Stubs</a>:</p><blockquote><p><strong>Mocks</strong> are (...) objects pre-programmed with expectations which form a specification of the calls they are expected to receive.</p></blockquote><p>So to test the <code>register</code> function, we can mock the behavior of its two collaborators. So instead of using production objects, we use pre-programmed mock versions of these two collaborators with some expectations. In this way, in each test case, we expect these collaborators will be called with expected inputs.</p><p>In this example, we can define these three test cases:</p><ol><li>If we register a user with an age of less than 18, we expect that the <code>save</code> method of <code>UserRepository</code> shouldn&#x27;t be called. Additionally, we expect that the <code>send</code> method of <code>EmailService</code> will be called with the following content: &quot;You are not eligible to register.&quot;</li><li>If we register a user with a username of &quot;admin&quot;, we expect that both <code>UserRepository</code> and <code>EmailService</code> should not be called. Instead, we expect that the <code>register</code> call will be failed with a proper failure value: &quot;The admin user is already registered!&quot;</li><li>Otherwise, we expect that the <code>save</code> method of <code>UserRepository</code> will be called with the corresponding <code>User</code> object, and the <code>send</code> method of <code>EmailService</code> will be called with this content: &quot;Congratulation, you are registered!&quot;.</li></ol><p>ZIO Test provides a framework for mocking our modules. In the next section, we are going to test <code>UserService</code> by mocking its collaborators.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mocking-collaborators">Mocking Collaborators<a class="hash-link" href="#mocking-collaborators" title="Direct link to heading">​</a></h2><p>In the previous section, we learned we can test the <code>UserService</code> by mocking its collaborators. Let&#x27;s see how we can mock the <code>EmailService</code> and also the <code>UserRepository</code>.</p><p>We should create a mock object by extending <code>Mock[EmailService]</code> (<code>zio.mock.Mock</code>). Then we need to define the following objects:</p><ol><li><strong>Capability tags</strong> — They are value objects which extend one of the <code>Capability[R, I, E, A]</code> data types, such as <code>Effect</code>, <code>Method</code>, <code>Sink</code>, or <code>Stream</code>. For each of the service capabilities, we need to create an object extending one of these data types. They encode the type of <em>environments</em>, <em>arguments</em> (inputs), the <em>error channel</em>, and also the <em>success channel</em> of each capability of the service.</li></ol><p>For example, to encode the <code>send</code> capability of <code>EmailService</code> we need to extend the <code>Effect</code> capability as bellow:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> Send </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong>Compose layer</strong> — In this step, we need to provide a layer in which used to construct the mocked object. In order to do that, we should obtain the <code>Proxy</code> data type from the environment and then implement the service interface (i.e. <code>EmailService</code>) by wrapping all capability tags with proxy.</li></ol><p>Let&#x27;s see how we can mock the <code>EmailService</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// Test Sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockEmailService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">EmailService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> Send </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> EmailService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> proxy </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> EmailService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> send</span><span class="token punctuation">(</span><span class="token plain">to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> body</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            proxy</span><span class="token punctuation">(</span><span class="token plain">Send</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token punctuation">,</span><span class="token plain"> body</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And, here is the mock version of the <code>UserRepository</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockUserRepository </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">UserRepository</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> Save </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> UserRepository</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> proxy </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> UserRepository </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> save</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            proxy</span><span class="token punctuation">(</span><span class="token plain">Save</span><span class="token punctuation">,</span><span class="token plain"> user</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-service">Testing the Service<a class="hash-link" href="#testing-the-service" title="Direct link to heading">​</a></h2><p>After writing the mock version of collaborators, now we can use their <em>capability tags</em> to convert them to the <code>Expectation</code>, and finally create the mock layer of the service.</p><p>For example, we can create an expectation from the <code>Send</code> capability tag of the <code>MockEmailService</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> sendEmailExpectation</span><span class="token operator">:</span><span class="token plain"> Expectation</span><span class="token punctuation">[</span><span class="token plain">EmailService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  MockEmailService</span><span class="token punctuation">.</span><span class="token plain">Send</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    assertion </span><span class="token operator">=</span><span class="token plain"> Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;john@doe&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;You are not eligible to register!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>sendEmailExpectation</code> is an expectation, which requires a call to <code>send</code> method with <code>(&quot;john@doe&quot;, &quot;You are not eligible to register!&quot;)</code> arguments. If this service will be called, the returned value would be <code>unit</code>.</p><p>There is an extension method called <code>Expectation#toLayer</code> which implicitly converts an expectation to the <code>ZLayer</code> environment:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> mockEmailService</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">EmailService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  MockEmailService</span><span class="token punctuation">.</span><span class="token plain">Send</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    assertion </span><span class="token operator">=</span><span class="token plain"> Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;john@doe&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;You are not eligible to register!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we do not require to convert them to <code>ZLayer</code> explicitly. It will convert them whenever required.</p><ol><li>Now let&#x27;s test the first scenario discussed in the <a href="#the-solution">solution</a> section:</li></ol><blockquote><p>If we register a user with an age of less than 18, we expect that the <code>save</code> method of <code>UserRepository</code> shouldn&#x27;t be called. Additionally, we expect that the <code>send</code> method of <code>EmailService</code> will be called with the following content: &quot;You are not eligible to register.&quot;</p></blockquote><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;non-adult registration&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut              </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">register</span><span class="token punctuation">(</span><span class="token string">&quot;john&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">15</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;john@doe&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> liveUserService  </span><span class="token operator">=</span><span class="token plain"> UserServiceLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockUserRepo     </span><span class="token operator">=</span><span class="token plain"> MockUserRepository</span><span class="token punctuation">.</span><span class="token plain">empty</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEmailService </span><span class="token operator">=</span><span class="token plain"> MockEmailService</span><span class="token punctuation">.</span><span class="token plain">Send</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    assertion </span><span class="token operator">=</span><span class="token plain"> Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;john@doe&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;You are not eligible to register!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">liveUserService</span><span class="token punctuation">,</span><span class="token plain"> mockUserRepo</span><span class="token punctuation">,</span><span class="token plain"> mockEmailService</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We used <code>MockUserRepository.empty</code> since we expect no call to the <code>UserRepository</code> service.</p><ol start="2"><li>The second scenario is:</li></ol><blockquote><p>If we register a user with a username of &quot;admin&quot;, we expect that both <code>UserRepository</code> and <code>EmailService</code> should not be called. Instead, we expect that the <code>register</code> call will be failed with a proper failure value: &quot;The admin user is already registered!&quot;</p></blockquote><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;user cannot register pre-defined admin user&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">register</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;admin@doe&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      UserServiceLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      MockEmailService</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      MockUserRepository</span><span class="token punctuation">.</span><span class="token plain">empty</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Exit</span><span class="token punctuation">.</span><span class="token plain">Failure</span><span class="token punctuation">(</span><span class="token plain">cause</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> cause</span><span class="token punctuation">.</span><span class="token plain">contains</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          Cause</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;The admin user is already registered!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Finally, we have to check the <em>happy path</em> scenario:</li></ol><blockquote><p>We expect that the <code>save</code> method of <code>UserRepository</code> will be called with the corresponding <code>User</code> object, and the <code>send</code> method of <code>EmailService</code> will be called with this content: &quot;Congratulation, you are registered!&quot;.</p></blockquote><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;a valid user can register to the user service&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut              </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">register</span><span class="token punctuation">(</span><span class="token string">&quot;jane&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;jane@doe&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> liveUserService  </span><span class="token operator">=</span><span class="token plain"> UserServiceLive</span><span class="token punctuation">.</span><span class="token plain">layer</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockUserRepo     </span><span class="token operator">=</span><span class="token plain"> MockUserRepository</span><span class="token punctuation">.</span><span class="token plain">Save</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token string">&quot;jane&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">25</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;jane@doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEmailService </span><span class="token operator">=</span><span class="token plain"> MockEmailService</span><span class="token punctuation">.</span><span class="token plain">Send</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    assertion </span><span class="token operator">=</span><span class="token plain"> Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;jane@doe&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Congratulation, you are registered!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    result </span><span class="token operator">=</span><span class="token plain"> Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">liveUserService</span><span class="token punctuation">,</span><span class="token plain"> mockUserRepo</span><span class="token punctuation">,</span><span class="token plain"> mockEmailService</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="built-in-mock-services">Built-in Mock Services<a class="hash-link" href="#built-in-mock-services" title="Direct link to heading">​</a></h2><p>For each built-in ZIO service, we will find their mockable counterparts in <code>zio.mock</code> package:</p><ul><li>[<code>MockClock</code>]<!-- --> for <code>zio.Clock</code></li><li>[<code>MockConsole</code>]<!-- --> for <code>zio.Console</code></li><li>[<code>MockRandom</code>]<!-- --> for <code>zio.Random</code></li><li>[<code>MockSystem</code>]<!-- --> for <code>zio.System</code></li></ul><p>A <code>Mock[R]</code> represents a mockable environment <code>R</code>. It&#x27;s a base abstract class for every service we want to mock.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-mock-service">Creating a Mock Service<a class="hash-link" href="#creating-a-mock-service" title="Direct link to heading">​</a></h2><p>In order to create a mock object, we should define an object which implements the <code>Mock</code> abstract class in the test sources. To implement the <code>Mock</code> need to define <em>capability tags</em> and the <em>compose layer</em>:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-service-capabilities">Encoding Service Capabilities<a class="hash-link" href="#encoding-service-capabilities" title="Direct link to heading">​</a></h2><p>Capabilities are service functionalities that are accessible from the client-side. For example, in the following service the <code>send</code> method is a service capability:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> register</span><span class="token punctuation">(</span><span class="token plain">username</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> email</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A <strong>capability tag</strong> encodes all information needed to mock the target capability. It is just a value that extends the <code>zio.mock.Capability[R, I, E, A]</code> type constructor, where:</p><ul><li><code>R</code> is the type of <em>environment</em> the method belongs to</li><li><code>I</code> is the type of <em>methods input arguments</em></li><li><code>E</code> is the type of <em>error</em> it can fail with</li><li><code>A</code> is the type of <em>return value</em> it can produce</li></ul><p>The <code>Capability</code> type is not publicly available, instead we have to extend <code>Mock</code> dependent types <code>Effect</code>, <code>Method</code>, <code>Sink</code> or <code>Stream</code>.</p><p>We can have 4 types of capabilities inside a service:</p><ol><li><strong><code>Effect</code></strong> — describes an effectful ZIO operation</li><li><strong><code>Method</code></strong> — describes an ordinary scala function</li><li><strong><code>Sink</code></strong> — describes an effectful ZIO Sink</li><li><strong><code>Stream</code></strong> — describes an effectful ZIO Stream</li></ol><p>Let&#x27;s say we have the following service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ExampleService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleEffect</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleMethod</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleSink</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Sink</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleStream</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Stream</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Therefore, the mock service should have the following <em>capability tags</em>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockExampleService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">ExampleService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleEffect </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleMethod </span><span class="token keyword">extends</span><span class="token plain"> Method</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleSink   </span><span class="token keyword">extends</span><span class="token plain"> Sink</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleStream </span><span class="token keyword">extends</span><span class="token plain"> Stream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> ExampleService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, all <code>ExampleEffect</code>, <code>ExampleMethod</code>, <code>ExampleSink</code>, and <code>ExampleStream</code> are capability tags. Each of these capability tags encodes all information needed to mock the target capability.</p><p>For example, the <code>ExampleEffect</code> capability tag encodes the type of <em>environments</em>, <em>arguments</em> (inputs), the <em>error channel</em>, and also the <em>success channel</em> of the <code>exampleEffect(i: Int)</code> method.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We encode service capabilities according to the following scheme:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-zero-argument-capability">Encoding Zero Argument Capability<a class="hash-link" href="#encoding-zero-argument-capability" title="Direct link to heading">​</a></h3><p>For zero arguments the type is <code>Unit</code></p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ZeroParamService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> zeroParams</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So the capability tag of <code>zeroParams</code> should be:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockZeroParamService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">ZeroParamService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ZeroParams </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> compose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-multiple-arguments-capability">Encoding Multiple Arguments Capability<a class="hash-link" href="#encoding-multiple-arguments-capability" title="Direct link to heading">​</a></h3><p>For one or more arguments, regardless of how many parameter lists, the type is a <code>TupleN</code> where <code>N</code> is the size of arguments list</p><blockquote><p><strong>Note:</strong></p><p>We&#x27;re using tuples to represent multiple argument methods, which follows with a limit to max 22 arguments, as is Scala itself limited.</p></blockquote><p>If the capability has more than one argument, we should encode the argument types in the <code>Tuple</code> data type. For example, if we have the following service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ManyParamsService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> manyParams</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> c</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> manyParamLists</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">c</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We should encode that with the following capability tag:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> MockExampleService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">ManyParamsService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ManyParams     </span><span class="token keyword">extends</span><span class="token plain"> Method</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ManyParamLists </span><span class="token keyword">extends</span><span class="token plain"> Method</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> compose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-overloaded-capabilities">Encoding Overloaded Capabilities<a class="hash-link" href="#encoding-overloaded-capabilities" title="Direct link to heading">​</a></h3><p>For overloaded methods, we nest a list of numbered objects, each representing subsequent overloads:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// Main sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain"> ZSink</span><span class="token punctuation">,</span><span class="token plain"> ZStream </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> OverloadedService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> overloaded</span><span class="token punctuation">(</span><span class="token plain">arg1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">                  </span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> overloaded</span><span class="token punctuation">(</span><span class="token plain">arg1</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token plain">                 </span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We encode both overloaded capabilities by using numbered objects inside a nested object:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// Test sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockOervloadedService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">OverloadedService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> Overloaded </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">object</span><span class="token plain"> _0 </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">object</span><span class="token plain"> _1 </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> OverloadedService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-polymorphic-capabilities">Encoding Polymorphic Capabilities<a class="hash-link" href="#encoding-polymorphic-capabilities" title="Direct link to heading">​</a></h3><p>Mocking polymorphic methods is also supported, but the interface must require <code>zio.Tag</code> implicit evidence for each type parameter:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// main sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> PolyService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> polyInput</span><span class="token punctuation">[</span><span class="token plain">I</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> I</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> polyError</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> polyOutput</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> polyAll</span><span class="token punctuation">[</span><span class="token plain">I</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> I</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the test sources we construct partially applied <em>capability tags</em> by extending <code>Method.Poly</code> family. The unknown types must be provided at call site. To produce a final monomorphic <code>Method</code> tag we must use the <code>of</code> combinator and pass the missing types:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// test sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockPolyService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">PolyService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> PolyInput  </span><span class="token keyword">extends</span><span class="token plain"> Poly</span><span class="token punctuation">.</span><span class="token plain">Effect</span><span class="token punctuation">.</span><span class="token plain">Input</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> PolyError  </span><span class="token keyword">extends</span><span class="token plain"> Poly</span><span class="token punctuation">.</span><span class="token plain">Effect</span><span class="token punctuation">.</span><span class="token plain">Error</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> PolyOutput </span><span class="token keyword">extends</span><span class="token plain"> Poly</span><span class="token punctuation">.</span><span class="token plain">Effect</span><span class="token punctuation">.</span><span class="token plain">Output</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> PolyAll    </span><span class="token keyword">extends</span><span class="token plain"> Poly</span><span class="token punctuation">.</span><span class="token plain">Effect</span><span class="token punctuation">.</span><span class="token plain">InputErrorOutput</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// We will learn about the compose layer in the next section</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> PolyService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> proxy </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      withRuntime</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> rts </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> PolyService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">def</span><span class="token plain"> polyInput</span><span class="token punctuation">[</span><span class="token plain">I</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> I</span><span class="token punctuation">)</span><span class="token plain">               </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">PolyInput</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token plain">I</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> input</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">def</span><span class="token plain"> polyError</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">             </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">PolyError</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> input</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">def</span><span class="token plain"> polyOutput</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain">            </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">PolyOutput</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> input</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">def</span><span class="token plain"> polyAll</span><span class="token punctuation">[</span><span class="token plain">I</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token operator">:</span><span class="token plain"> Tag</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> I</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">PolyAll</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token plain">I</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> input</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly, we use the same <code>of</code> combinator to refer to concrete monomorphic call in our test suite when building expectations:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> MockPolyService</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exp06 </span><span class="token operator">=</span><span class="token plain"> PolyInput</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exp07 </span><span class="token operator">=</span><span class="token plain"> PolyInput</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">failure</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exp08 </span><span class="token operator">=</span><span class="token plain"> PolyInput</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token number">42L</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exp09 </span><span class="token operator">=</span><span class="token plain"> PolyAll</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exp10 </span><span class="token operator">=</span><span class="token plain"> PolyAll</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">failure</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-a-layer-for-the-mocked-service">Defining a Layer for the Mocked Service<a class="hash-link" href="#defining-a-layer-for-the-mocked-service" title="Direct link to heading">​</a></h2><p>Finally, we need to define a <em>compose layer</em> that can create our environment from a <code>Proxy</code>. A <code>Proxy</code> holds the mock state and serves predefined responses to calls.</p><p>So again, assume we have the following service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> ExampleService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleEffect</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleMethod</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleSink</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">Sink</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> exampleStream</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">Stream</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this step, we need to provide a layer in which used to construct the mocked object. To do that, we should obtain the <code>Proxy</code> data type from the environment and then implement the service interface by wrapping all capability tags with proxy:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockExampleService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">ExampleService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleEffect </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleMethod </span><span class="token keyword">extends</span><span class="token plain"> Method</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleSink </span><span class="token keyword">extends</span><span class="token plain"> Sink</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ExampleStream </span><span class="token keyword">extends</span><span class="token plain"> Stream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> ExampleService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> proxy </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      withRuntime</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> rts </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> ExampleService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> exampleEffect</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            proxy</span><span class="token punctuation">(</span><span class="token plain">ExampleEffect</span><span class="token punctuation">,</span><span class="token plain"> i</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> exampleMethod</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            rts</span><span class="token punctuation">.</span><span class="token plain">unsafeRunTask</span><span class="token punctuation">(</span><span class="token plain">proxy</span><span class="token punctuation">(</span><span class="token plain">ExampleMethod</span><span class="token punctuation">,</span><span class="token plain"> i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> exampleSink</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">Sink</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            rts</span><span class="token punctuation">.</span><span class="token plain">unsafeRun</span><span class="token punctuation">(</span><span class="token plain">proxy</span><span class="token punctuation">(</span><span class="token plain">ExampleSink</span><span class="token punctuation">,</span><span class="token plain"> a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> exampleStream</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">Stream</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            rts</span><span class="token punctuation">.</span><span class="token plain">unsafeRun</span><span class="token punctuation">(</span><span class="token plain">proxy</span><span class="token punctuation">(</span><span class="token plain">ExampleStream</span><span class="token punctuation">,</span><span class="token plain"> a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>Note:</strong> The <code>withRuntime</code> helper is defined in <code>Mock</code>. It accesses the Runtime via <code>ZIO.runtime</code> and if you&#x27;re on JS platform, it will replace the executor to an unyielding one.</p></blockquote><p>A reference to this layer is passed to <em>capability tags</em>, so it can be used to automatically build environment for composed expectations on multiple services.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-complete-example">The Complete Example<a class="hash-link" href="#the-complete-example" title="Direct link to heading">​</a></h2><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> AccountEvent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// main sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> AccountObserver </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> processEvent</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token operator">:</span><span class="token plain"> AccountEvent</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> runCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> AccountObserver </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> processEvent</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token operator">:</span><span class="token plain"> AccountEvent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">AccountObserver</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">processEvent</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> runCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">AccountObserver</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">runCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AccountObserverLive</span><span class="token punctuation">(</span><span class="token plain">console</span><span class="token operator">:</span><span class="token plain"> Console</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">extends</span><span class="token plain"> AccountObserver </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> processEvent</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token operator">:</span><span class="token plain"> AccountEvent</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _    </span><span class="token keyword">&lt;-</span><span class="token plain"> console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Got </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">event</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">      line </span><span class="token keyword">&lt;-</span><span class="token plain"> console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">      _    </span><span class="token keyword">&lt;-</span><span class="token plain"> console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;You entered: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">line</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> runCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Done!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> AccountObserverLive </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> layer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">AccountObserverLive</span><span class="token punctuation">.</span><span class="token plain">apply _</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><span class="token punctuation">[</span><span class="token plain">AccountObserver</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// test sources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> AccountObserverMock </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">AccountObserver</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> ProcessEvent </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token plain">AccountEvent</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> RunCommand   </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> AccountObserver</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Proxy</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> proxy </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">new</span><span class="token plain"> AccountObserver </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">def</span><span class="token plain"> processEvent</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token operator">:</span><span class="token plain"> AccountEvent</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">ProcessEvent</span><span class="token punctuation">,</span><span class="token plain"> event</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">def</span><span class="token plain"> runCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain">           </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">RunCommand</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-examples">More examples<a class="hash-link" href="#more-examples" title="Direct link to heading">​</a></h2><p>We can find more examples in the <code>examples</code> and <code>test-tests</code> subproject:</p><ul><li><a href="https://github.com/zio/zio/blob/master/examples/shared/src/test/scala/zio/examples/test/MockExampleSpec.scala" target="_blank" rel="noopener noreferrer">MockExampleSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/EmptyMockSpec.scala" target="_blank" rel="noopener noreferrer">EmptyMockSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/ComposedMockSpec.scala" target="_blank" rel="noopener noreferrer">ComposedMockSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/ComposedEmptyMockSpec.scala" target="_blank" rel="noopener noreferrer">ComposedEmptyMockSpec</a></li><li><a href="https://github.com/zio/zio/blob/master/test-tests/shared/src/test/scala/zio/test/mock/PolyMockSpec.scala" target="_blank" rel="noopener noreferrer">PolyMockSpec</a></li></ul><p>An <code>Expectation[R]</code> is an immutable tree structure that represents expectations on environment <code>R</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="defining-expectations">Defining Expectations<a class="hash-link" href="#defining-expectations" title="Direct link to heading">​</a></h2><p>ZIO Test has a variety of expectations, such as <code>value</code>, <code>unit</code>, <code>failure</code>, and <code>never</code>. In this section we are going to learn each of these expectations and their variant, by mocking the <code>UserService</code> service. So let&#x27;s assume we have the following service:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> User</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> insert</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> totalUsers</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> recentUsers</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> removeAll</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> totalUsers</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> insert</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">insert</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> recentUsers</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">recentUsers</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> removeAll</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">removeAll</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can write the mock version of this class as below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MockUserService </span><span class="token keyword">extends</span><span class="token plain"> Mock</span><span class="token punctuation">[</span><span class="token plain">UserService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> Insert      </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> Remove      </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> RecentUsers </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> TotalUsers  </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">object</span><span class="token plain"> RemoveAll   </span><span class="token keyword">extends</span><span class="token plain"> Effect</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> compose</span><span class="token operator">:</span><span class="token plain"> URLayer</span><span class="token punctuation">[</span><span class="token plain">mock</span><span class="token punctuation">.</span><span class="token plain">Proxy</span><span class="token punctuation">,</span><span class="token plain"> UserService</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">mock</span><span class="token punctuation">.</span><span class="token plain">Proxy</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> proxy </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">new</span><span class="token plain"> UserService </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> insert</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token operator">:</span><span class="token plain"> User</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain">  IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">Insert</span><span class="token punctuation">,</span><span class="token plain"> user</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> remove</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain">  IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">Remove</span><span class="token punctuation">,</span><span class="token plain"> id</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> recentUsers</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">RecentUsers</span><span class="token punctuation">,</span><span class="token plain"> n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> totalUsers</span><span class="token operator">:</span><span class="token plain">          IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">        </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">TotalUsers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">override</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> removeAll</span><span class="token operator">:</span><span class="token plain">           IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> proxy</span><span class="token punctuation">(</span><span class="token plain">RemoveAll</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">toLayer</span><br></span><span class="token-line"><span class="token plain">      </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To create expectations we use the previously defined <em>capability tags</em>.</p><ol><li>For methods that take input, the first argument will be an assertion on input, and the second the predefined result.</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> exp01 </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">RecentUsers</span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token comment">// capability to build an expectation for</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// assertion of the expected input argument</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Jane Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> User</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// result, that will be returned</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>For methods that take no input, we only define the expected output:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> exp02 </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>For methods that may return <code>Unit</code>, we may skip the predefined result (it will default to successful value) or use <code>unit</code> helper:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> exp03 </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">Remove</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>For methods that may return <code>Unit</code> and take no input we can skip both:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> exp04 </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">RemoveAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="providing-mocked-environment">Providing Mocked Environment<a class="hash-link" href="#providing-mocked-environment" title="Direct link to heading">​</a></h3><p>Each expectation can be taught of a mocked environment. They can be converted to a <code>ZLayer</code> implicitly. Therefore, we can compose them together and provide them to the environment of the SUT (System Under Test).</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;expecting simple value on call to nextInt&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockRandom</span><span class="token punctuation">.</span><span class="token plain">NextInt</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">total </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mocking-unused-collaborators">Mocking Unused Collaborators<a class="hash-link" href="#mocking-unused-collaborators" title="Direct link to heading">​</a></h3><p>Often the dependency on a collaborator is only in some branches of the code. To test the correct behaviour of branches without dependencies, we still have to provide it to the environment, but we would like to assert it was never called. With the <code>Mock.empty</code> method we can obtain a <code>ZLayer</code> with an empty service (no calls expected):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MaybeConsoleSpec </span><span class="token keyword">extends</span><span class="token plain"> MockSpecDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> spec </span><span class="token operator">=</span><span class="token plain"> suite</span><span class="token punctuation">(</span><span class="token string">&quot;processEvent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    test</span><span class="token punctuation">(</span><span class="token string">&quot;expect no call&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">def</span><span class="token plain"> maybeConsole</span><span class="token punctuation">(</span><span class="token plain">invokeConsole</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">when</span><span class="token punctuation">(</span><span class="token plain">invokeConsole</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">val</span><span class="token plain"> sut1     </span><span class="token operator">=</span><span class="token plain"> maybeConsole</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">val</span><span class="token plain"> mockEnv1 </span><span class="token operator">=</span><span class="token plain"> MockConsole</span><span class="token punctuation">.</span><span class="token plain">empty</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">val</span><span class="token plain"> sut2     </span><span class="token operator">=</span><span class="token plain"> maybeConsole</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">val</span><span class="token plain"> mockEnv2 </span><span class="token operator">=</span><span class="token plain"> MockConsole</span><span class="token punctuation">.</span><span class="token plain">PrintLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut1</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut2</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mocking-multiple-collaborators">Mocking Multiple Collaborators<a class="hash-link" href="#mocking-multiple-collaborators" title="Direct link to heading">​</a></h3><p>In some cases we have more than one collaborating service being called. We can create mocks for rich environments and as you enrich the environment by using <em>capability tags</em> from another service, the underlying mocked layer will be updated.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;mocking multiple collaborators&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;What is your name?&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      name </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">      num </span><span class="token keyword">&lt;-</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">name</span><span class="token string-interpolation string">, your lucky number today is </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">num</span><span class="token string-interpolation string">!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv</span><span class="token operator">:</span><span class="token plain"> ULayer</span><span class="token punctuation">[</span><span class="token plain">Console </span><span class="token keyword">with</span><span class="token plain"> Random</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> MockConsole</span><span class="token punctuation">.</span><span class="token plain">PrintLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;What is your name?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> MockConsole</span><span class="token punctuation">.</span><span class="token plain">ReadLine</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token string">&quot;Mike&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    MockRandom</span><span class="token punctuation">.</span><span class="token plain">NextInt</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    MockConsole</span><span class="token punctuation">.</span><span class="token plain">PrintLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;Mike, your lucky number today is 42!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="expectations">Expectations<a class="hash-link" href="#expectations" title="Direct link to heading">​</a></h2><p>In the most robust example, the result can be either a successful value or a failure. In this section we are going to introduce all these cases, by using the proper expectation from <code>zio.mock.Expectation</code> companion object:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="value"><code>value</code><a class="hash-link" href="#value" title="Direct link to heading">​</a></h3><p>Expecting a simple value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;expecting simple value&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">total </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">14</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="valuef"><code>valueF</code><a class="hash-link" href="#valuef" title="Direct link to heading">​</a></h3><p>Expecting a value based on input arguments:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;an expectation based on input arguments&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">recentUsers</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">RecentUsers</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">isPositive</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">valueF</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token namespace">n</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">=&gt;</span><span class="token plain"> User</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">.</span><span class="token plain">toString</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">toList</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    users </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">users</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> List</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="valuezio"><code>valueZIO</code><a class="hash-link" href="#valuezio" title="Direct link to heading">​</a></h3><p>Expecting a value based on the input arguments and also the result of an effectful operation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;effectful expectation&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">recentUsers</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">RecentUsers</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">isPositive</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">valueZIO</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token namespace">n</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Random</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">nextUUID</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">=&gt;</span><span class="token plain"> User</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">.</span><span class="token plain">toString</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;name-</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toList</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    users </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token string">&quot;name-1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;name-2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;name-3&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> users</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unit"><code>unit</code><a class="hash-link" href="#unit" title="Direct link to heading">​</a></h3><p>Expecting simple unit value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;expecting unit&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">Remove</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">isNonEmptyString</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    res </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    res </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Exit</span><span class="token punctuation">.</span><span class="token plain">Success</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="failure"><code>failure</code><a class="hash-link" href="#failure" title="Direct link to heading">​</a></h3><p>Expecting a failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;failure expectation&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">failure</span><span class="token punctuation">(</span><span class="token string">&quot;connection failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Exit</span><span class="token punctuation">.</span><span class="token plain">Success</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Exit</span><span class="token punctuation">.</span><span class="token plain">Failure</span><span class="token punctuation">(</span><span class="token plain">cause</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        cause</span><span class="token punctuation">.</span><span class="token plain">contains</span><span class="token punctuation">(</span><span class="token plain">Cause</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;connection failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are also <code>failureF</code> and <code>failureZIO</code> variants like what we described for <code>value</code> expectation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="never"><code>never</code><a class="hash-link" href="#never" title="Direct link to heading">​</a></h3><p>This expectation simulates a never-ending loop:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;never ending expectation&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">never</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    r </span><span class="token keyword">&lt;-</span><span class="token plain"> Live</span><span class="token punctuation">.</span><span class="token plain">live</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">500.</span><span class="token plain">millis</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">r</span><span class="token punctuation">.</span><span class="token plain">isEmpty</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="composing-expectations">Composing Expectations<a class="hash-link" href="#composing-expectations" title="Direct link to heading">​</a></h2><p>We can combine our expectation to build complex scenarios using combinators defined in <code>zio.mock.Expectation</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="and"><code>and</code><a class="hash-link" href="#and" title="Direct link to heading">​</a></h3><p>The <code>and</code> (alias <code>&amp;&amp;</code>) operator composes two expectations, producing a new expectation to <strong>satisfy both in any order</strong>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;satisfy both expectations with a logical `and` operator&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">recentUsers</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">and</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    MockUserService</span><span class="token punctuation">.</span><span class="token plain">RecentUsers</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Assertion</span><span class="token punctuation">.</span><span class="token plain">isPositive</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">total </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="or"><code>or</code><a class="hash-link" href="#or" title="Direct link to heading">​</a></h3><p>The <code>or</code> (alias <code>||</code>) operator composes two expectations, producing a new expectation to <strong>satisfy only one of them</strong>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;satisfy one of expectations with a logical `or` operator&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">or</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    MockUserService</span><span class="token punctuation">.</span><span class="token plain">RecentUsers</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Assertion</span><span class="token punctuation">.</span><span class="token plain">isPositive</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">total </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="andthen"><code>andThen</code><a class="hash-link" href="#andthen" title="Direct link to heading">​</a></h3><p>The <code>andThen</code> (alias <code>++</code>) operator composes two expectations, producing a new expectation to <strong>satisfy both sequentially</strong>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;satisfy sequence of two expectations with `andThen` operator&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">recentUsers</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">totalUsers</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">RecentUsers</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">isPositive</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> andThen MockUserService</span><span class="token punctuation">.</span><span class="token plain">TotalUsers</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    total </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">total </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, changing the SUT to <code>UserService.totalUsers *&gt; UserService.remove(1)</code> will fail the test.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exact-repetition">Exact Repetition<a class="hash-link" href="#exact-repetition" title="Direct link to heading">​</a></h3><ol><li><strong><code>exactly</code></strong> — Produces a new expectation to satisfy itself exactly the given number of times:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;satisfying exact repetition of a method call&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">id </span><span class="token keyword">=&gt;</span><span class="token plain"> UserService</span><span class="token punctuation">.</span><span class="token plain">remove</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockUserService</span><span class="token punctuation">.</span><span class="token plain">Remove</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Assertion</span><span class="token punctuation">.</span><span class="token plain">isNonEmptyString</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exactly</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>twice</code></strong> and <strong><code>thrice</code></strong> — Aliases for <code>exactly(2)</code> and <code>exactly(3)</code>.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="range-of-repetitions">Range of Repetitions<a class="hash-link" href="#range-of-repetitions" title="Direct link to heading">​</a></h3><ol><li><strong><code>Expectation#repeats(range: Range)</code></strong> — Repeats this expectation within given bounds, producing a new expectation to <strong>satisfy itself sequentially given number of times</strong>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;expect repeated calls&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> MockRandom</span><span class="token punctuation">.</span><span class="token plain">NextInt</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">repeats</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token plain"> to </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, if we repeat <code>nextInt</code> less than 2 or over 4 times, the test will fail.</p><p>Another note on repetitions is that, if we compose expectations with <code>andThen</code>/<code>++</code>, once another repetition starts executing, it must be completed in order to satisfy the composite expectation. For example <code>(A ++ B).repeats(1, 2)</code> will be satisfied by either <code>A-&gt;B</code> (one repetition) or <code>A-&gt;B-&gt;A-&gt;B</code> (two repetitions), but will fail on <code>A-&gt;B-&gt;A</code> (incomplete second repetition):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;if another repetition starts executing, it must be completed&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> sut     </span><span class="token operator">=</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextBoolean </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> mockEnv </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">MockRandom</span><span class="token punctuation">.</span><span class="token plain">NextInt</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> MockRandom</span><span class="token punctuation">.</span><span class="token plain">NextBoolean</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">repeats</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> sut</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">mockEnv</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> @@ TestAspect</span><span class="token punctuation">.</span><span class="token plain">failing</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>The <strong><code>atLeast(min: Int)</code></strong>, <strong><code>atMost(max: Int)</code></strong>, and <strong><code>optional</code></strong> expectations are other variants for <code>repeats</code> expectation.</li></ol><ul><li>The <code>atLeast</code> operator is a lower-bounded variant of <code>repeated</code>, produces a new expectation to satisfy <strong>itself sequentially at least given number of times</strong>.</li><li>The <code>atMost</code> operator is an upper-bounded variant of <code>repeated</code>, produces a new expectation to satisfy <strong>itself sequentially at most given number of times</strong>.</li><li>The <code>optional</code> operator is an alias for <code>atMost(1)</code>, produces a new expectation to satisfy <strong>itself at most once</strong>.</li></ul><p><code>MockClock</code> is a built-in mock version of the <!-- -->[<code>Clock</code>]<!-- --> service. </p><p>Here is an example of mocking <code>Clock.nanoTime</code> capability:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;calling mocked nanoTime should return expected time&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> app </span><span class="token operator">=</span><span class="token plain"> Clock</span><span class="token punctuation">.</span><span class="token plain">nanoTime</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> env </span><span class="token operator">=</span><span class="token plain"> MockClock</span><span class="token punctuation">.</span><span class="token plain">NanoTime</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> out </span><span class="token operator">=</span><span class="token plain"> app</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain">env</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  out</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">r </span><span class="token keyword">=&gt;</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">r </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1000L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>MockConsole</code> is a built-in mock version of the <!-- -->[<code>Console</code>]<!-- --> service.</p><p>Here is an example of mocking <code>Console.readLine</code> capability:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;calling mocked readline should return expected value&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    line </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      MockConsole</span><span class="token punctuation">.</span><span class="token plain">ReadLine</span><span class="token punctuation">(</span><span class="token plain">Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">line </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>MockRandom</code> is a built-in mock version of the <!-- -->[<code>Random</code>]<!-- --> service. It mocks all the random service capabilities.</p><p>Here&#x27;s how we can mock the <code>MockRandom.nextIntBounded</code> capability:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;expect call with input satisfying assertion and transforming it into output&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    out </span><span class="token keyword">&lt;-</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextIntBounded</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      MockRandom</span><span class="token punctuation">.</span><span class="token plain">NextIntBounded</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Expectation</span><span class="token punctuation">.</span><span class="token plain">valueF</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">41</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">out </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">42</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>MockSystem</code> is a built-in mock version of the <!-- -->[<code>System</code>]<!-- --> service. It mocks all the system service capabilities.</p><p>Here&#x27;s how we can mock the <code>MockSystem.property</code> capability:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">mock</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">test</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">test</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">test</span><span class="token punctuation">(</span><span class="token string">&quot;calling mocked property should return expected property&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    property </span><span class="token keyword">&lt;-</span><span class="token plain"> System</span><span class="token punctuation">.</span><span class="token plain">property</span><span class="token punctuation">(</span><span class="token string">&quot;java.vm.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">provideLayer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      MockSystem</span><span class="token punctuation">.</span><span class="token plain">Property</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Assertion</span><span class="token punctuation">.</span><span class="token plain">equalTo</span><span class="token punctuation">(</span><span class="token string">&quot;java.vm.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Expectation</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token string">&quot;OpenJDK 64-Bit Server VM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> assertTrue</span><span class="token punctuation">(</span><span class="token plain">property</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">.</span><span class="token plain">contains</span><span class="token punctuation">(</span><span class="token string">&quot;OpenJDK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/resources/ecosystem/officials/zio-mock.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/resources/ecosystem/officials/zio-metrics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ZIO Metrics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/resources/ecosystem/officials/zio-nio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ZIO NIO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#the-problem" class="table-of-contents__link toc-highlight">The Problem</a></li><li><a href="#the-solution" class="table-of-contents__link toc-highlight">The Solution</a></li><li><a href="#mocking-collaborators" class="table-of-contents__link toc-highlight">Mocking Collaborators</a></li><li><a href="#testing-the-service" class="table-of-contents__link toc-highlight">Testing the Service</a></li><li><a href="#built-in-mock-services" class="table-of-contents__link toc-highlight">Built-in Mock Services</a></li><li><a href="#creating-a-mock-service" class="table-of-contents__link toc-highlight">Creating a Mock Service</a></li><li><a href="#encoding-service-capabilities" class="table-of-contents__link toc-highlight">Encoding Service Capabilities</a><ul><li><a href="#encoding-zero-argument-capability" class="table-of-contents__link toc-highlight">Encoding Zero Argument Capability</a></li><li><a href="#encoding-multiple-arguments-capability" class="table-of-contents__link toc-highlight">Encoding Multiple Arguments Capability</a></li><li><a href="#encoding-overloaded-capabilities" class="table-of-contents__link toc-highlight">Encoding Overloaded Capabilities</a></li><li><a href="#encoding-polymorphic-capabilities" class="table-of-contents__link toc-highlight">Encoding Polymorphic Capabilities</a></li></ul></li><li><a href="#defining-a-layer-for-the-mocked-service" class="table-of-contents__link toc-highlight">Defining a Layer for the Mocked Service</a></li><li><a href="#the-complete-example" class="table-of-contents__link toc-highlight">The Complete Example</a></li><li><a href="#more-examples" class="table-of-contents__link toc-highlight">More examples</a></li><li><a href="#defining-expectations" class="table-of-contents__link toc-highlight">Defining Expectations</a><ul><li><a href="#providing-mocked-environment" class="table-of-contents__link toc-highlight">Providing Mocked Environment</a></li><li><a href="#mocking-unused-collaborators" class="table-of-contents__link toc-highlight">Mocking Unused Collaborators</a></li><li><a href="#mocking-multiple-collaborators" class="table-of-contents__link toc-highlight">Mocking Multiple Collaborators</a></li></ul></li><li><a href="#expectations" class="table-of-contents__link toc-highlight">Expectations</a><ul><li><a href="#value" class="table-of-contents__link toc-highlight"><code>value</code></a></li><li><a href="#valuef" class="table-of-contents__link toc-highlight"><code>valueF</code></a></li><li><a href="#valuezio" class="table-of-contents__link toc-highlight"><code>valueZIO</code></a></li><li><a href="#unit" class="table-of-contents__link toc-highlight"><code>unit</code></a></li><li><a href="#failure" class="table-of-contents__link toc-highlight"><code>failure</code></a></li><li><a href="#never" class="table-of-contents__link toc-highlight"><code>never</code></a></li></ul></li><li><a href="#composing-expectations" class="table-of-contents__link toc-highlight">Composing Expectations</a><ul><li><a href="#and" class="table-of-contents__link toc-highlight"><code>and</code></a></li><li><a href="#or" class="table-of-contents__link toc-highlight"><code>or</code></a></li><li><a href="#andthen" class="table-of-contents__link toc-highlight"><code>andThen</code></a></li><li><a href="#exact-repetition" class="table-of-contents__link toc-highlight">Exact Repetition</a></li><li><a href="#range-of-repetitions" class="table-of-contents__link toc-highlight">Range of Repetitions</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4c8d210b.js"></script>
<script src="/assets/js/main.b0e6b04a.js"></script>
</body>
</html>