<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/stream/zstream">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-237088290-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0HNKLNRT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0HNKLNRT",{anonymize_ip:!0})</script>


<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-rh="true">ZStream | ZIO</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/reference/stream/zstream"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ZStream | ZIO"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/reference/stream/zstream"><link data-rh="true" rel="alternate" href="https://zio.dev/reference/stream/zstream" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/reference/stream/zstream" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.97da2182.css">
<link rel="preload" href="/assets/js/runtime~main.41fad63a.js" as="script">
<link rel="preload" href="/assets/js/main.f233b8d7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/reference/stream/zstream">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reference/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/reference/core/zio/">Core</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reference/core/zio/">ZIO</a><button aria-label="Toggle the collapsible sidebar category &#x27;ZIO&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/zioapp">ZIOApp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/runtime">Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/exit">Exit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/cause">Cause</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/error-management/">Error Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Error Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/services/">Built-in Services</a><button aria-label="Toggle the collapsible sidebar category &#x27;Built-in Services&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/service-pattern/introduction">Writing ZIO Services</a><button aria-label="Toggle the collapsible sidebar category &#x27;Writing ZIO Services&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/contextual/">Contextual Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contextual Types&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/schedule/">Scheduling</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scheduling&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/state/">State Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;State Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/concurrency/">Concurrency</a><button aria-label="Toggle the collapsible sidebar category &#x27;Concurrency&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/resource/">Resource Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resource Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/reference/stream/">Streaming</a><button aria-label="Toggle the collapsible sidebar category &#x27;Streaming&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/reference/stream/zstream">Main Components</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/reference/stream/zstream">ZStream</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/reference/stream/zstream">ZStream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/stream/stream.md">Stream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/stream/ustream">UStream</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/reference/stream/zpipeline">ZPipeline</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/reference/stream/zsink">ZSink</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/stream/zchannel">ZChannel</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/stream/subscription-ref">SubscriptionRef</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/metrics/">Metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/test/">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/reference/stream/"><span itemprop="name">Streaming</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Main Components</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ZStream</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ZStream</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZStream</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>A <code>ZStream[R, E, O]</code> is a description of a program that, when evaluated, may emit zero or more values of type <code>O</code>, may fail with errors of type <code>E</code>, and uses an environment of type <code>R</code>. </p><p>One way to think of <code>ZStream</code> is as a <code>ZIO</code> program that could emit multiple values. As we know, a <code>ZIO[R, E, A]</code> data type, is a functional effect which is a description of a program that needs an environment of type <code>R</code>, it may end with an error of type <code>E</code>, and in case of success, it returns a value of type <code>A</code>. The important note about <code>ZIO</code> effects is that in the case of success they always end with exactly one value. There is no optionality here, no multiple infinite values, we always get exact value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> failedEffect</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;fail!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> oneIntValue </span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">          </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> oneListValue</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain">    </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> oneOption   </span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token plain"> </span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A functional stream is pretty similar, it is a description of a program that requires an environment of type <code>R</code> and it may signal with errors of type <code>E</code> and it yields <code>O</code>, but the difference is that it will yield zero or more values. </p><p>So a <code>ZStream</code> represents one of the following cases in terms of its elements:</p><ul><li><strong>An Empty Stream</strong> — It might end up empty; which represent an empty stream, e.g. <code>ZStream.empty</code>.</li><li><strong>One Element Stream</strong> — It can represent a stream with just one value, e.g. <code>ZStream.succeed(3)</code>.</li><li><strong>Multiple Finite Element Stream</strong> — It can represent a stream of finite values, e.g. <code>ZStream.range(1, 10)</code></li><li><strong>Multiple Infinite Element Stream</strong> — It can even represent a stream that <em>never ends</em> as an infinite stream, e.g. <code>ZStream.iterate(1)(_ + 1)</code>.</li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">ZStream</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> emptyStream         </span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain">   </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">empty</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> oneIntValueStream   </span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> oneListValueStream  </span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finiteIntStream     </span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> infiniteIntStream   </span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">       </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another example of a stream is when we&#x27;re pulling a Kafka topic or reading from a socket. There is no inherent definition of an end there. Stream elements arrive at some point, or even they might never arrive at any point.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stream-types">Stream Types<a class="hash-link" href="#stream-types" title="Direct link to heading">​</a></h2><p>Based on type parameters of <code>ZStream</code>, there are 4 types of streams:</p><ol><li><code>ZStream[Any, Nothing, O]</code> — A stream that emits <code>O</code> values and cannot fail.</li><li><code>ZStream[Any, Throwable, O]</code> — A stream that emits <code>O</code> values and can fail with <code>Throwable</code>.</li><li><code>ZStream[Any, Nothing, Nothing]</code> — A stream that emits no elements.</li><li><code>ZStream[R, E, O]</code> — A stream that requires access to the <code>R</code> service, can fail with error of type <code>E</code> and emits <code>O</code> values.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chunking">Chunking<a class="hash-link" href="#chunking" title="Direct link to heading">​</a></h2><p>Every time we are working with streams, we are always working with chunks. There are no streams with individual elements, these streams have always chunks in their underlying implementation. So every time we evaluate a stream, when we pull an element out of a stream, we are actually pulling out a chunk of elements.</p><p>So why streams are designed in this way? This is because of the <strong>efficiency and performance</strong> issues. Every I/O operation in the programming world works with batches. We never work with a single element. For example, whenever we are reading or writing from/to a file descriptor, or a socket we are reading or writing multiple elements at a time. This is also true when we are working with an HTTP server or even JDBC drivers. We always read and write multiple bytes to be more performant.</p><p>So let&#x27;s talk a bit about Chunk. Chunk is a ZIOs immutable array-backed collection. It is initially written for ZIO stream, but later it has been evolved into a very attractive general collection type which is also useful for other purposes. It is an immutable array-backed collection. Most importantly it tries to keep primitives unboxed. This is super important for the efficient processing of files and sockets. They are also very useful and efficient for encoding and decoding and writing transducers. To learn more about this data type, we have introduced that at the <a href="/reference/misc/chunk">Chunk</a> section.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-stream">Creating a Stream<a class="hash-link" href="#creating-a-stream" title="Direct link to heading">​</a></h2><p>There are several ways to create ZIO Stream. In this section, we are going to enumerate some of the important ways of creating <code>ZStream</code>. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-constructors">Common Constructors<a class="hash-link" href="#common-constructors" title="Direct link to heading">​</a></h3><p><strong>ZStream.apply</strong> — Creates a pure stream from a variable list of values:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.unit</strong> — A stream that contains a single <code>Unit</code> value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> unit</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.never</strong> — A stream that produces no value or fails with an error:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> never</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">never</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.repeat</strong> — Takes an initial value and applies the given function to the initial value iteratively. The initial value is the first value produced by the stream, followed by f(init), f(f(init)), ...</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> nats</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// 1, 2, 3, ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.range</strong> — A stream from a range of integers <code>[min, max)</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> range</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// 1, 2, 3, 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.service<!-- -->[R]</strong> — Create a stream that extract the requested service from the environment:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> Foo</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fooStream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Foo</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">service</span><span class="token punctuation">[</span><span class="token plain">Foo</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.scoped</strong> — Creates a single-valued stream from a scoped resource:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> scopedStream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> BufferedReader</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">scoped</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fromAutoCloseable</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Files</span><span class="token punctuation">.</span><span class="token plain">newBufferedReader</span><span class="token punctuation">(</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">nio</span><span class="token punctuation">.</span><span class="token plain">file</span><span class="token punctuation">.</span><span class="token plain">Paths</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-success-and-failure">From Success and Failure<a class="hash-link" href="#from-success-and-failure" title="Direct link to heading">​</a></h3><p>Similar to <code>ZIO</code> data type, we can create a <code>ZStream</code> using <code>fail</code> and <code>succeed</code> methods:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain">    </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-chunks">From Chunks<a class="hash-link" href="#from-chunks" title="Direct link to heading">​</a></h3><p>We can create a stream from a <code>Chunk</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromChunk</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// s1: ZStream[Any, Nothing, Int] = zio.stream.ZStream@1ed8f44f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or from multiple <code>Chunks</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromChunks</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Chunk</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// s2: ZStream[Any, Nothing, Int] = zio.stream.ZStream@3250a40</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-zio">From ZIO<a class="hash-link" href="#from-zio" title="Direct link to heading">​</a></h3><p><strong>ZStream.fromZIO</strong> — We can create a stream from a ZIO workflow by using <code>ZStream.fromZIO</code> constructor. For example, the following stream is a stream that reads a line from a user:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> readline</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A stream that produces one random number:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> randomInt</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromZIOOption</strong> — In some cases, depending on the result of the ZIO workflow, we should decide to emit an element or return an empty stream. In these cases, we can use <code>fromZIOOption</code> constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZStream </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> fromZIOOption</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">fa</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see an example of using this constructor. In this example, we read a string from user input, and then decide to emit that or not; If the user enters an <code>EOF</code> string, we emit an empty stream, otherwise we emit the user input:  </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> userInput</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIOOption</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">Option</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;EOF&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> o     </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">o</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-asynchronous-callback">From Asynchronous Callback<a class="hash-link" href="#from-asynchronous-callback" title="Direct link to heading">​</a></h3><p>Assume we have an asynchronous function that is based on callbacks. We would like to register a callbacks on that function and get back a stream of the results emitted by those callbacks. We have <code>ZStream.async</code> which can adapt functions that call their callbacks multiple times and emit the results over a stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// Asynchronous Callback-based API</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> registerCallback</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    onEvent</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    onError</span><span class="token operator">:</span><span class="token plain"> Throwable </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Lifting an Asynchronous API to ZStream</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">async</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> cb </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  registerCallback</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    event </span><span class="token keyword">=&gt;</span><span class="token plain"> cb</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    error </span><span class="token keyword">=&gt;</span><span class="token plain"> cb</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error type of the <code>register</code> function is optional, so by setting the error to the <code>None</code> we can use it to signal the end of the stream.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-iterators">From Iterators<a class="hash-link" href="#from-iterators" title="Direct link to heading">​</a></h3><p>Iterators are data structures that allow us to iterate over a sequence of elements. Similarly, we can think of ZIO Streams as effectual Iterators; every <code>ZStream</code> represents a collection of one or more, but effectful values. </p><p><strong>ZStream.fromIteratorSucceed</strong> — We can convert an iterator that does not throw exception to <code>ZStream</code> by using <code>ZStream.fromIteratorSucceed</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterator</span><span class="token punctuation">(</span><span class="token plain">Iterator</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterator</span><span class="token punctuation">(</span><span class="token plain">Iterator</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterator</span><span class="token punctuation">(</span><span class="token plain">Iterator</span><span class="token punctuation">.</span><span class="token plain">continually</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, there is another constructor called <strong><code>ZStream.fromIterator</code></strong> that creates a stream from an iterator which may throw an exception.</p><p><strong>ZStream.fromIteratorZIO</strong> — If we have an effectful Iterator that may throw Exception, we can use <code>fromIteratorZIO</code> to convert that to the ZIO Stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">Source</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> lines</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIteratorZIO</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">Source</span><span class="token punctuation">.</span><span class="token plain">fromFile</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using this method is not good for resourceful effects like above, so it&#x27;s better to rewrite that using <code>ZStream.fromIteratorScoped</code> function.</p><p><strong>ZStream.fromIteratorScoped</strong> — Using this constructor we can convert a scoped iterator to ZIO Stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> lines</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIteratorScoped</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fromAutoCloseable</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">io</span><span class="token punctuation">.</span><span class="token plain">Source</span><span class="token punctuation">.</span><span class="token plain">fromFile</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromJavaIterator</strong> — It is the Java version of these constructors which create a stream from Java iterator that may throw an exception. We can convert any Java collection to an iterator and then lift them to the ZIO Stream.</p><p>For example, to convert the Java Stream to the ZIO Stream, <code>ZStream</code> has a <code>fromJavaStream</code> constructor which convert the Java Stream to the Java Iterator and then convert that to the ZIO Stream using <code>ZStream.fromJavaIterator</code> constructor:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> fromJavaStream</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">stream</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> java</span><span class="token punctuation">.</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token plain">stream</span><span class="token punctuation">.</span><span class="token plain">Stream</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromJavaIterator</span><span class="token punctuation">(</span><span class="token plain">stream</span><span class="token punctuation">.</span><span class="token plain">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly, <code>ZStream</code> has <code>ZStream.fromJavaIteratorSucceed</code>, <code>ZStream.fromJavaIteratorZIO</code> and <code>ZStream.fromJavaIteratorScoped</code> constructors.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-iterables">From Iterables<a class="hash-link" href="#from-iterables" title="Direct link to heading">​</a></h3><p><strong>ZStream.fromIterable</strong> — We can create a stream from <code>Iterable</code> collection of values:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> list </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromIterableZIO</strong> — If we have an effect producing a value of type <code>Iterable</code> we can use <code>fromIterableZIO</code> constructor to create a stream of that effect.</p><p>Assume we have a database that returns a list of users using <code>Task</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> getUsers</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">List</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Database </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> getUsers</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">serviceWithZIO</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">getUsers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As this operation is effectful, we can use <code>ZStream.fromIterableZIO</code> to convert the result to the <code>ZStream</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> users</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">Database</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> User</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterableZIO</span><span class="token punctuation">(</span><span class="token plain">Database</span><span class="token punctuation">.</span><span class="token plain">getUsers</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-repetition">From Repetition<a class="hash-link" href="#from-repetition" title="Direct link to heading">​</a></h3><p><strong>ZStream.repeat</strong> — Repeats the provided value infinitely:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> repeatZero</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.repeatWith</strong> — This is another variant of <code>repeat</code>, which repeats according to the provided schedule. For example, the following stream produce zero value every second:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Clock</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Duration</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Schedule</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> repeatZeroEverySecond</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">repeatWithSchedule</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.repeatZIO</strong> — Assume we have an effectful API, and we need to call that API and create a stream from the result of that. We can create a stream from that effect that repeats forever.</p><p>Let&#x27;s see an example of creating a stream of random numbers:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> randomInts</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">repeatZIO</span><span class="token punctuation">(</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.repeatZIOOption</strong> — We can repeatedly evaluate the given effect and terminate the stream based on some conditions. </p><p>Let&#x27;s create a stream repeatedly from user inputs until user enter &quot;EOF&quot; string:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> userInputs</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">repeatZIOOption</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">Option</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;EOF&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> o     </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">o</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is another interesting example of using <code>repeatZIOOption</code>; In this example, we are draining an <code>Iterator</code> to create a stream of that iterator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> drainIterator</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">it</span><span class="token operator">:</span><span class="token plain"> Iterator</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">repeatZIOOption </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">it</span><span class="token punctuation">.</span><span class="token plain">hasNext</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> hasNext </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">hasNext</span><span class="token punctuation">)</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">it</span><span class="token punctuation">.</span><span class="token plain">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.tick</strong> —  A stream that emits Unit values spaced by the specified duration:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">tick</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are some other variant of repetition API like <code>repeatZIOWith</code>, <code>repeatZIOOption</code>, <code>repeatZIOChunk</code> and <code>repeatZIOChunkOption</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-unfoldingpagination">From Unfolding/Pagination<a class="hash-link" href="#from-unfoldingpagination" title="Direct link to heading">​</a></h3><p>In functional programming, <code>unfold</code> is dual to <code>fold</code>. </p><p>With <code>fold</code> we can process a data structure and build a return value. For example, we can process a <code>List[Int]</code> and return the sum of all its elements. </p><p>The <code>unfold</code> represents an operation that takes an initial value and generates a recursive data structure, one-piece element at a time by using a given state function. For example, we can create a natural number by using <code>one</code> as the initial element and the <code>inc</code> function as the state function.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unfold">Unfold<a class="hash-link" href="#unfold" title="Direct link to heading">​</a></h4><p><strong>ZStream.unfold</strong> — <code>ZStream</code> has <code>unfold</code> function, which is defined as follows:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZStream </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> unfold</span><span class="token punctuation">[</span><span class="token plain">S</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token operator">:</span><span class="token plain"> S</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>s</strong> — An initial state value</li><li><strong>f</strong> — A state function <code>f</code> that will be applied to the initial state <code>s</code>. If the result of this application is <code>None</code> the stream will end, otherwise the result is <code>Some</code>, so the next element in the stream would be <code>A</code> and the current state of transformation changed to the new <code>S</code>, this new state is the basis of the next unfold process.</li></ul><p>For example, we can a stream of natural numbers using <code>ZStream.unfold</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> nats</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">unfold</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token keyword">=&gt;</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">,</span><span class="token plain"> n </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can write <code>countdown</code> function using <code>unfold</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> countdown</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">unfold</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> None</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> s </span><span class="token keyword">=&gt;</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">,</span><span class="token plain"> s </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running this function with an input value of 3 returns a <code>ZStream</code> which contains 3, 2, 1 values.</p><p><strong>ZStream.unfoldZIO</strong> — <code>unfoldZIO</code> is an effectful version of <code>unfold</code>. It helps us to perform <em>effectful state transformation</em> when doing unfold operation.</p><p>Let&#x27;s write a stream of lines of input from a user until the user enters the <code>exit</code> command:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> inputs</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">unfoldZIO</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;exit&quot;</span><span class="token plain">  </span><span class="token keyword">=&gt;</span><span class="token plain"> None</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> i </span><span class="token keyword">=&gt;</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ZStream.unfoldChunk</code>, and <code>ZStream.unfoldChunkZIO</code> are other variants of <code>unfold</code> operations but for <code>Chunk</code> data type.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pagination">Pagination<a class="hash-link" href="#pagination" title="Direct link to heading">​</a></h4><p><strong>ZStream.paginate</strong> — This is similar to <code>unfold</code>, but allows the emission of values to end one step further. For example the following stream emits <code>0, 1, 2, 3</code> elements:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">paginate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> s </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  s </span><span class="token operator">-&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similar to <code>unfold</code> API, <code>ZStream</code> has various other forms as well as <code>ZStream.paginateZIO</code>, <code>ZStream.paginateChunk</code> and <code>ZStream.paginateChunkZIO</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unfolding-vs-pagination">Unfolding vs. Pagination<a class="hash-link" href="#unfolding-vs-pagination" title="Direct link to heading">​</a></h4><p>One might ask what is the difference between <code>unfold</code> and <code>paginate</code> combinators? When we should prefer one over another? So, let&#x27;s find the answer to this question by doing another example.</p><p>Assume we have a paginated API that returns an enormous amount of data in a paginated fashion. When we call that API, it returns a data type <code>ResultPage</code> which contains the first-page result and, it also contains a flag indicating whether that result is the last one, or we have more data on the next page:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> PageResult</span><span class="token punctuation">(</span><span class="token plain">results</span><span class="token operator">:</span><span class="token plain"> Chunk</span><span class="token punctuation">[</span><span class="token plain">RowData</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> isLast</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> listPaginated</span><span class="token punctuation">(</span><span class="token plain">pageNumber</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> PageResult</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We want to convert this API to a stream of <code>RowData</code> events. For the first attempt, we might think we can do it by using <code>unfold</code> operation as below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> firstAttempt</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> RowData</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">unfoldChunkZIO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> pageNumber </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      page </span><span class="token keyword">&lt;-</span><span class="token plain"> listPaginated</span><span class="token punctuation">(</span><span class="token plain">pageNumber</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">page</span><span class="token punctuation">.</span><span class="token plain">isLast</span><span class="token punctuation">)</span><span class="token plain"> None</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">page</span><span class="token punctuation">.</span><span class="token plain">results</span><span class="token punctuation">,</span><span class="token plain"> pageNumber </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But it doesn&#x27;t work properly; it doesn&#x27;t include the last page result. So let&#x27;s do a trick and to perform another API call to include the last page results:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> secondAttempt</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> RowData</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">unfoldChunkZIO</span><span class="token punctuation">(</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> None </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">none </span><span class="token comment">// We already hit the last page</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">pageNumber</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token comment">// We did not hit the last page yet</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">     </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        page </span><span class="token keyword">&lt;-</span><span class="token plain"> listPaginated</span><span class="token punctuation">(</span><span class="token plain">pageNumber</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">page</span><span class="token punctuation">.</span><span class="token plain">results</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">page</span><span class="token punctuation">.</span><span class="token plain">isLast</span><span class="token punctuation">)</span><span class="token plain"> None </span><span class="token keyword">else</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">pageNumber </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This works and contains all the results of returned pages. It works but as we saw, <code>unfold</code> is not friendliness to retrieve data from paginated APIs. </p><p>We need to do some hacks and extra works to include results from the last page. This is where <code>ZStream.paginate</code> operation comes to play, it helps us to convert a paginated API to ZIO stream in a more ergonomic way. Let&#x27;s rewrite this solution by using <code>paginate</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> finalAttempt</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> RowData</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">paginateChunkZIO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> pageNumber </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      page </span><span class="token keyword">&lt;-</span><span class="token plain"> listPaginated</span><span class="token punctuation">(</span><span class="token plain">pageNumber</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> page</span><span class="token punctuation">.</span><span class="token plain">results </span><span class="token operator">-&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">page</span><span class="token punctuation">.</span><span class="token plain">isLast</span><span class="token punctuation">)</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">pageNumber </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> None</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-wrapped-streams">From Wrapped Streams<a class="hash-link" href="#from-wrapped-streams" title="Direct link to heading">​</a></h3><p>Sometimes we have an effect that contains a <code>ZStream</code>, we can unwrap the embedded stream and produce a stream from those effects. If the stream is wrapped with the <code>ZIO</code> effect, we use <code>unwrap</code>, and if it is wrapped with scoped <code>ZIO</code> we use <code>unwrapScoped</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> wrappedWithZIO</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">unwrap</span><span class="token punctuation">(</span><span class="token plain">wrappedWithZIO</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> wrappedWithZIOScoped </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">unwrapScoped</span><span class="token punctuation">(</span><span class="token plain">wrappedWithZIOScoped</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-java-io">From Java IO<a class="hash-link" href="#from-java-io" title="Direct link to heading">​</a></h3><p><strong>ZStream.fromPath</strong> — Create ZIO Stream from a file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">nio</span><span class="token namespace punctuation">.</span><span class="token namespace">file</span><span class="token namespace punctuation">.</span><span class="token plain">Paths</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> file</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromPath</span><span class="token punctuation">(</span><span class="token plain">Paths</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromInputStream</strong> — Creates a stream from a <code>java.io.InputStream</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the InputStream will not be explicitly closed after it is exhausted. Use <code>ZStream.fromInputStreamZIO</code>, or <code>ZStream.fromInputStreamScoped</code> instead.</p><p><strong>ZStream.fromInputStreamZIO</strong> — Creates a stream from a <code>java.io.InputStream</code>. Ensures that the InputStream is closed after it is exhausted:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromInputStreamZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromInputStreamScoped</strong> — Creates a stream from a scoped <code>java.io.InputStream</code> value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> scoped</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> FileInputStream</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fromAutoCloseable</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> FileInputStream</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromInputStreamScoped</span><span class="token punctuation">(</span><span class="token plain">scoped</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromResource</strong> — Create a stream from resource file:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromResource</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>ZStream.fromReader</strong> — Creates a stream from a <code>java.io.Reader</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Char</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">   ZStream</span><span class="token punctuation">.</span><span class="token plain">fromReader</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> FileReader</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Stream also has <code>ZStream.fromReaderZIO</code> and <code>ZStream.fromReaderScoped</code> variants.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-java-stream">From Java Stream<a class="hash-link" href="#from-java-stream" title="Direct link to heading">​</a></h3><p>We can use <code>ZStream.fromJavaStreamTotal</code> to convert a Java Stream to ZIO Stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromJavaStream</span><span class="token punctuation">(</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token plain">stream</span><span class="token punctuation">.</span><span class="token plain">Stream</span><span class="token punctuation">.</span><span class="token plain">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Stream also has <code>ZStream.fromJavaStream</code>, <code>ZStream.fromJavaStreamZIO</code> and <code>ZStream.fromJavaStreamScoped</code> variants.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-queue-and-hub">From Queue and Hub<a class="hash-link" href="#from-queue-and-hub" title="Direct link to heading">​</a></h3><p><code>Queue</code> and <code>Hub</code> are two asynchronous messaging data types in ZIO that can be converted into the ZIO Stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZStream </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> fromQueue</span><span class="token punctuation">[</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    queue</span><span class="token operator">:</span><span class="token plain"> Dequeue</span><span class="token punctuation">[</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    maxChunkSize</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> DefaultChunkSize</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> fromHub</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    hub</span><span class="token operator">:</span><span class="token plain"> Hub</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If they contain <code>Chunk</code> of elements, we can use <code>ZStream.fromChunk...</code> constructors to create a stream from those elements (e.g. <code>ZStream.fromChunkQueue</code>):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  promise </span><span class="token keyword">&lt;-</span><span class="token plain"> Promise</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  hub     </span><span class="token keyword">&lt;-</span><span class="token plain"> Hub</span><span class="token punctuation">.</span><span class="token plain">unbounded</span><span class="token punctuation">[</span><span class="token plain">Chunk</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  scoped </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromChunkHubScoped</span><span class="token punctuation">(</span><span class="token plain">hub</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> promise</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  stream  </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">unwrapScoped</span><span class="token punctuation">(</span><span class="token plain">scoped</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fiber   </span><span class="token keyword">&lt;-</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">  _       </span><span class="token keyword">&lt;-</span><span class="token plain"> promise</span><span class="token punctuation">.</span><span class="token plain">await</span><br></span><span class="token-line"><span class="token plain">  _       </span><span class="token keyword">&lt;-</span><span class="token plain"> hub</span><span class="token punctuation">.</span><span class="token plain">publish</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _       </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token plain">join</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, If we need to shutdown a <code>Queue</code> or <code>Hub</code>, once the stream is closed, we should use <code>ZStream.from..Shutdown</code> constructors (e.g. <code>ZStream.fromQueueWithShutdown</code>).</p><p>Also, we can lift a <code>TQueue</code> to the ZIO Stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  q </span><span class="token keyword">&lt;-</span><span class="token plain"> STM</span><span class="token punctuation">.</span><span class="token plain">atomically</span><span class="token punctuation">(</span><span class="token plain">TQueue</span><span class="token punctuation">.</span><span class="token plain">unbounded</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromTQueue</span><span class="token punctuation">(</span><span class="token plain">q</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fiber </span><span class="token keyword">&lt;-</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">  _     </span><span class="token keyword">&lt;-</span><span class="token plain"> STM</span><span class="token punctuation">.</span><span class="token plain">atomically</span><span class="token punctuation">(</span><span class="token plain">q</span><span class="token punctuation">.</span><span class="token plain">offer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _     </span><span class="token keyword">&lt;-</span><span class="token plain"> STM</span><span class="token punctuation">.</span><span class="token plain">atomically</span><span class="token punctuation">(</span><span class="token plain">q</span><span class="token punctuation">.</span><span class="token plain">offer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _     </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token plain">join</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-schedule">From Schedule<a class="hash-link" href="#from-schedule" title="Direct link to heading">​</a></h3><p>We can create a stream from a <code>Schedule</code> that does not require any further input. The stream will emit an element for each value output from the schedule, continuing for as long as the schedule continues:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromSchedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;&gt;&gt;</span><span class="token plain"> Schedule</span><span class="token punctuation">.</span><span class="token plain">recurs</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="resourceful-streams">Resourceful Streams<a class="hash-link" href="#resourceful-streams" title="Direct link to heading">​</a></h3><p>Most of the constructors of <code>ZStream</code> have a special variant to lift a scoped resource to a Stream (e.g. <code>ZStream.fromReaderScoped</code>). By using these constructors, we are creating streams that are resource-safe. Before creating a stream, they acquire the resource, and after usage; they close the stream.</p><p>ZIO Stream also has <code>acquireRelease</code> and <code>finalizer</code> constructors which are similar to <code>ZIO.acquireRelease</code>. They allow us to clean up or finalizing before the stream ends:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="acquire-release">Acquire Release<a class="hash-link" href="#acquire-release" title="Direct link to heading">​</a></h4><p>We can provide <code>acquire</code> and <code>release</code> actions to <code>ZStream.acquireReleaseWith</code> to create a resourceful stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZStream </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> acquireReleaseWith</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    acquire</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    release</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see an example of using an acquire release when reading a file. In this example, by providing <code>acquire</code> and <code>release</code> actions to <code>ZStream.acquireReleaseWith</code>, it gives us a scoped stream of <code>BufferedSource</code>. As this stream is scoped, we can convert that <code>BufferedSource</code> to a stream of its lines and then run it, without worrying about resource leakage:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> lines</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">acquireReleaseWith</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">Source</span><span class="token punctuation">.</span><span class="token plain">fromFile</span><span class="token punctuation">(</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string">&quot;The file was opened.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">.</span><span class="token plain">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string">&quot;The file was closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> is </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterator</span><span class="token punctuation">(</span><span class="token plain">is</span><span class="token punctuation">.</span><span class="token plain">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="finalization">Finalization<a class="hash-link" href="#finalization" title="Direct link to heading">​</a></h4><p>We can also create a stream that never fails and define a finalizer for it, so that finalizer will be executed before that stream ends. </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZStream </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> finalizer</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    finalizer</span><span class="token operator">:</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is useful when need to add a finalizer to an existing stream. Assume we need to clean up the temporary directory after our streaming application ends:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> application</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Application Logic.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> deleteDir</span><span class="token punctuation">(</span><span class="token plain">dir</span><span class="token operator">:</span><span class="token plain"> Path</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Deleting file.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  application </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">finalizer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">deleteDir</span><span class="token punctuation">(</span><span class="token plain">Paths</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token string">&quot;tmp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Temporary directory was deleted.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ensuring">Ensuring<a class="hash-link" href="#ensuring" title="Direct link to heading">​</a></h4><p>We might want to run some code after the execution of the stream&#x27;s finalization. To do so, we can use the <code>ZStream#ensuring</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZStream</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">finalizer</span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Finalizing the stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Doing some other works after stream&#x27;s finalization&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Finalizing the stream</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Doing some other works after stream&#x27;s finalization</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="operations">Operations<a class="hash-link" href="#operations" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tapping">Tapping<a class="hash-link" href="#tapping" title="Direct link to heading">​</a></h3><p>Tapping is an operation of running an effect on each emission of the ZIO Stream. We can think of <code>ZStream#tap</code> as an operation that allows us to observe each element of the stream, do some effectful operation and discard the result of this observation. The <code>tap</code> operation does not change elements of the stream, it does not affect the return type of the stream.</p><p>For example, we can print each element of a stream by using the <code>tap</code> operation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;before mapping: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;after mapping: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="taking-elements">Taking Elements<a class="hash-link" href="#taking-elements" title="Direct link to heading">​</a></h3><p>We can take a certain number of elements from a stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 0, 1, 2, 3, 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">takeWhile</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 0, 1, 2, 3, 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3 </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">takeUntil</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 0, 1, 2, 3, 4, 5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s4 </span><span class="token operator">=</span><span class="token plain"> s3</span><span class="token punctuation">.</span><span class="token plain">takeRight</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 3, 4, 5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapping">Mapping<a class="hash-link" href="#mapping" title="Direct link to heading">​</a></h3><p><strong>map</strong> — Applies a given function to all element of this stream to produce another stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> intStream</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token plain"> to </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stringStream</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> intStream</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toString</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If our transformation is effectful, we can use <code>ZStream#mapZIO</code> instead.</p><p><strong>mapZIOPar</strong> —  It is similar to <code>mapZIO</code>, but will evaluate effects in parallel. It will emit the results downstream in the original order. The <code>n</code> argument specifies the number of concurrent running effects.</p><p>Let&#x27;s write a simple page downloader, which download URLs concurrently:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> fetchUrl</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> URL</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> getUrls</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">List</span><span class="token punctuation">[</span><span class="token plain">URL</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> pages </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterableZIO</span><span class="token punctuation">(</span><span class="token plain">getUrls</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mapZIOPar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">fetchUrl</span><span class="token punctuation">)</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>mapChunk</strong> — Each stream is backed by some <code>Chunk</code>s. By using <code>mapChunk</code> we can batch the underlying stream and map every <code>Chunk</code> at once:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> chunked </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fromChunks</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Chunk</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Chunk</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> chunked</span><span class="token punctuation">.</span><span class="token plain">mapChunks</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> x</span><span class="token punctuation">.</span><span class="token plain">tail</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Input:  1, 2, 3, 4, 5, 6, 7, 8, 9</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output:    2, 3,    5,    7, 8, 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If our transformation is effectful we can use <code>mapChunksZIO</code> combinator.</p><p><strong>mapAccum</strong> — It is similar to a <code>map</code>, but it <strong>transforms elements statefully</strong>. <code>mapAccum</code> allows us to <em>map</em> and <em>accumulate</em> in the same operation.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> mapAccum</span><span class="token punctuation">[</span><span class="token plain">S</span><span class="token punctuation">,</span><span class="token plain"> O1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token operator">:</span><span class="token plain"> S</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">S</span><span class="token punctuation">,</span><span class="token plain"> O</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">S</span><span class="token punctuation">,</span><span class="token plain"> O1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> O1</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s write a transformation, which calculate <em>running total</em> of input stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> runningTotal</span><span class="token punctuation">(</span><span class="token plain">stream</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  stream</span><span class="token punctuation">.</span><span class="token plain">mapAccum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">acc</span><span class="token punctuation">,</span><span class="token plain"> next</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">acc </span><span class="token operator">+</span><span class="token plain"> next</span><span class="token punctuation">,</span><span class="token plain"> acc </span><span class="token operator">+</span><span class="token plain"> next</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// input:  0, 1, 2, 3,  4,  5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// output: 0, 1, 3, 6, 10, 15</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>mapConcat</strong> — It is similar to <code>map</code>, but maps each element to zero or more elements with the type of <code>Iterable</code> and then flattens the whole stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> numbers</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;1-2-3&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;4-5&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">mapConcat</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">split</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Input:  &quot;1-2-3&quot;, &quot;4-5&quot;, &quot;6&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 3, 4, 5, 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The effectful version of <code>mapConcat</code> is <code>mapConcatZIO</code>. </p><p><code>ZStream</code> also has chunked versions of that which are <code>mapConcatChunk</code> and <code>mapConcatChunkZIO</code>.</p><p><strong>as</strong> — The <code>ZStream#as</code> method maps the success values of this stream to the specified constant value.</p><p>For example, we can map all element to the unit value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> unitStream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">as</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="filtering">Filtering<a class="hash-link" href="#filtering" title="Direct link to heading">​</a></h3><p>The <code>ZStream#filter</code> allows us to filter emitted elements:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">filter</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 4, 6, 8, 10</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// The `ZStream#withFilter` operator enables us to write filter in for-comprehension style</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  i </span><span class="token keyword">&lt;-</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">take</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> i </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> i</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 4, 6, 8, 10</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">filterNot</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 3, 5, 7, 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scanning">Scanning<a class="hash-link" href="#scanning" title="Direct link to heading">​</a></h3><p>Scans are like folds, but with a history. Like folds, they take a binary operator with an initial value. A fold combines elements of a stream and emits every intermediary result as an output of the stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> scan </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">scan</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 0, 1, 3, 6, 10</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Iterations:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//        =&gt;  0 (initial value)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//  0 + 1 =&gt;  1</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//  1 + 2 =&gt;  3</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//  3 + 3 =&gt;  6</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//  6 + 4 =&gt; 10</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// 10 + 5 =&gt; 15</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> fold </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">runFold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 10 (ZIO effect containing 10)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="draining">Draining<a class="hash-link" href="#draining" title="Direct link to heading">​</a></h3><p>Assume we have an effectful stream, which contains a sequence of effects; sometimes we might want to execute its effect without emitting any element, in these situations to discard the results we should use the <code>ZStream#drain</code> method. It removes all output values from the stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">drain</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Emitted Elements: &lt;empty stream, it doesn&#x27;t emit any element&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">repeatZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        nextInt </span><span class="token keyword">&lt;-</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><br></span><span class="token-line"><span class="token plain">        number </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token plain">abs</span><span class="token punctuation">(</span><span class="token plain">nextInt </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;random number: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">number</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">number</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Emitted Elements: 1, 4, 7</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Result of Stream Effect on the Console:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// random number: 1</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// random number: 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// random number: 7</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> s2</span><span class="token punctuation">.</span><span class="token plain">drain</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Emitted Elements: &lt;empty stream, it doesn&#x27;t emit any element&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Result of Stream Effect on the Console:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// random number: 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// random number: 8</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// random number: 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZStream#drain</code> often used with <code>ZStream#merge</code> to run one side of the merge for its effect while getting outputs from the opposite side of the merge:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> logging </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Starting to merge with the next stream&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> logging</span><span class="token punctuation">.</span><span class="token plain">drain </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Emitted Elements: 1, 2, 3, 4, 5, 6</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Result of Stream Effect on the Console:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Starting to merge with the next stream</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that if we do not drain the <code>logging</code> stream, the emitted elements would be contained unit value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> logging </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Emitted Elements: 1, 2, 3, (), 4, 5, 6</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Result of Stream Effect on the Console:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Starting to merge with the next stream</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="changes">Changes<a class="hash-link" href="#changes" title="Direct link to heading">​</a></h3><p>The <code>ZStream#changes</code> emits elements that are not equal to the previous element:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> changes </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">changes</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 3, 4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZStream#changes</code> operator, uses natural equality to determine whether two elements are equal. If we prefer the specialized equality checking, we can provide a function of type <code>(O, O) =&gt; Boolean</code> to the <code>ZStream#changesWith</code> operator.</p><p>Assume we have a stream of events with a composite key of <em>partition</em> and <em>offset</em> attributes, and we know that the offset is monotonic in each partition. So, we can use the <code>changesWith</code> operator to create a stream of unique elements:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Event</span><span class="token punctuation">(</span><span class="token plain">partition</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">,</span><span class="token plain"> offset</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">,</span><span class="token plain"> metadata</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> events</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Event</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> uniques </span><span class="token operator">=</span><span class="token plain"> events</span><span class="token punctuation">.</span><span class="token plain">changesWith</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">e1</span><span class="token punctuation">,</span><span class="token plain"> e2</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">e1</span><span class="token punctuation">.</span><span class="token plain">partition </span><span class="token operator">==</span><span class="token plain"> e2</span><span class="token punctuation">.</span><span class="token plain">partition </span><span class="token operator">&amp;&amp;</span><span class="token plain"> e1</span><span class="token punctuation">.</span><span class="token plain">offset </span><span class="token operator">==</span><span class="token plain"> e2</span><span class="token punctuation">.</span><span class="token plain">offset</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="collecting">Collecting<a class="hash-link" href="#collecting" title="Direct link to heading">​</a></h3><p>We can perform <code>filter</code> and <code>map</code> operations in a single step using the <code>ZStream#collect</code> operation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> source1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> source1</span><span class="token punctuation">.</span><span class="token plain">collect </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> x </span><span class="token keyword">if</span><span class="token plain"> x </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">6</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> x </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 4, 6, 8, 0, 10</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> source1</span><span class="token punctuation">.</span><span class="token plain">collectWhile </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> x </span><span class="token keyword">if</span><span class="token plain"> x </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> x </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 4, 6, 8</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> source2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token plain">Left</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Left</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3 </span><span class="token operator">=</span><span class="token plain"> source2</span><span class="token punctuation">.</span><span class="token plain">collectLeft</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s4 </span><span class="token operator">=</span><span class="token plain"> source2</span><span class="token punctuation">.</span><span class="token plain">collectWhileLeft</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s5 </span><span class="token operator">=</span><span class="token plain"> source2</span><span class="token punctuation">.</span><span class="token plain">collectRight</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 3, 5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s6 </span><span class="token operator">=</span><span class="token plain"> source2</span><span class="token punctuation">.</span><span class="token plain">drop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">collectWhileRight</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 3</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s7 </span><span class="token operator">=</span><span class="token plain"> source2</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toOption</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">collectSome</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 2, 3, 5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s8 </span><span class="token operator">=</span><span class="token plain"> source2</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toOption</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">collectWhileSome</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: empty stream</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also do effectful collect using <code>ZStream#collectZIO</code> and <code>ZStream#collectWhileZIO</code>.</p><p>ZIO stream has <code>ZStream#collectSuccess</code> which helps us to perform effectful operations and just collect the success values:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> urls </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;dotty.epfl.ch&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;zio.dev&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;zio.github.io/zio-json&quot;</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token string">&quot;zio.github.io/zio-nio/&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> pages </span><span class="token operator">=</span><span class="token plain"> urls</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">mapZIO</span><span class="token punctuation">(</span><span class="token plain">url </span><span class="token keyword">=&gt;</span><span class="token plain"> fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exit</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">collectSuccess</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zipping">Zipping<a class="hash-link" href="#zipping" title="Direct link to heading">​</a></h3><p>We can zip two stream by using <code>ZStream.zip</code> or <code>ZStream#zipWith</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zipWith</span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zip</span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: (1, &quot;a&quot;), (2, &quot;b&quot;), (3, &quot;c&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The new stream will end when one of the streams ends.</p><p>In case of ending one stream before another, we might need to zip with default values; the <code>ZStream#zipAll</code> or <code>ZStream#zipAllWith</code> takes default values of both sides to perform such mechanism for us:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">zipAll</span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zipAllWith</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: (1, a), (2, b), (3, c), (0, d), (0, e)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sometimes we want to zip streams, but do not want to zip two elements one by one. For example, we may have two streams producing elements at different speeds, and do not want to wait for the slower one when zipping elements. When we need to zip elements with the latest element of the slower stream, <code>ZStream#zipWithLatest</code> will do this for us. It zips two streams so that when a value is emitted by either of the two streams, it is combined with the latest value from the other stream to produce a result:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">500.</span><span class="token plain">milliseconds</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">rechunk</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">s1</span><span class="token punctuation">.</span><span class="token plain">zipWithLatest</span><span class="token punctuation">(</span><span class="token plain">s2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: (1, a), (1, b), (1, c), (1, d), (2, d), (3, d)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Stream also has three useful operators for zipping element of a stream with their previous/next elements and also both of them:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain">              </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">zipWithPrevious</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain">              </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">zipWithNext</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">zipWithPreviousAndNext</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By using <code>ZStream#zipWithIndex</code> we can index elements of a stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> indexedStream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;Mary&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;James&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Robert&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Patricia&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zipWithIndex</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: (&quot;Mary&quot;, 0L), (&quot;James&quot;, 1L), (&quot;Robert&quot;, 2L), (&quot;Patricia&quot;, 3L)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cross-product">Cross Product<a class="hash-link" href="#cross-product" title="Direct link to heading">​</a></h3><p>ZIO stream has <code>ZStram#cross</code> and its variants to compute <em>Cartesian Product</em> of two streams:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> first </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> second </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> first cross second</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> first </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> second</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s3 </span><span class="token operator">=</span><span class="token plain"> first</span><span class="token punctuation">.</span><span class="token plain">crossWith</span><span class="token punctuation">(</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: (1,a), (1,b), (2,a), (2,b), (3,a), (3,b)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s4 </span><span class="token operator">=</span><span class="token plain"> first crossLeft second </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s5 </span><span class="token operator">=</span><span class="token plain"> first </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token plain"> second</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Keep only elements from the left stream</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 1, 2, 2, 3, 3 </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s6 </span><span class="token operator">=</span><span class="token plain"> first crossRight second</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s7 </span><span class="token operator">=</span><span class="token plain"> first </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> second</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Keep only elements from the right stream</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: a, b, a, b, a, b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the right-hand side stream would be run multiple times, for every element in the left stream.</p><p>ZIO stream also has <code>ZStream.crossN</code> which takes streams up to four one.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="partitioning">Partitioning<a class="hash-link" href="#partitioning" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="partition">partition<a class="hash-link" href="#partition" title="Direct link to heading">​</a></h4><p><code>ZStream#partition</code> function splits the stream into tuple of streams based on the predicate. The first stream contains all element evaluated to true, and the second one contains all element evaluated to false.</p><p>The faster stream may advance by up to <code>buffer</code> elements further than the slower one. Two streams are wrapped by <code>Scope</code> type. </p><p>In the example below, left stream consists of even numbers only:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> partitionResult</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token plain"> to </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">partition</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> buffer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="partitioneither">partitionEither<a class="hash-link" href="#partitioneither" title="Direct link to heading">​</a></h4><p>If we need to partition a stream using an effectful predicate we can use <code>ZStream.partitionEither</code>.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> partitionEither</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> O2</span><span class="token punctuation">,</span><span class="token plain"> O3</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    p</span><span class="token operator">:</span><span class="token plain"> O </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">O2</span><span class="token punctuation">,</span><span class="token plain"> O3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    buffer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token keyword">with</span><span class="token plain"> Scope</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> O2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> O3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is a simple example of using this function:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> partitioned</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">partitionEither</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> Left</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="groupby">GroupBy<a class="hash-link" href="#groupby" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="groupbykey">groupByKey<a class="hash-link" href="#groupbykey" title="Direct link to heading">​</a></h4><p>To partition the stream by function result we can use <code>groupBy</code> by providing a function of type <code>O =&gt; K</code> which determines by which keys the stream should be partitioned.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> groupByKey</span><span class="token punctuation">[</span><span class="token plain">K</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> O </span><span class="token keyword">=&gt;</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    buffer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">GroupBy</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> O</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example below, exam results are grouped into buckets and counted:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Exam</span><span class="token punctuation">(</span><span class="token plain">person</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> score</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> examResults </span><span class="token operator">=</span><span class="token plain"> Seq</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Exam</span><span class="token punctuation">(</span><span class="token string">&quot;Alex&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Exam</span><span class="token punctuation">(</span><span class="token string">&quot;Michael&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Exam</span><span class="token punctuation">(</span><span class="token string">&quot;Bill&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">77</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Exam</span><span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">78</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Exam</span><span class="token punctuation">(</span><span class="token string">&quot;Bobby&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">71</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> groupByKeyResult</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token plain">examResults</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">groupByKey</span><span class="token punctuation">(</span><span class="token plain">exam </span><span class="token keyword">=&gt;</span><span class="token plain"> exam</span><span class="token punctuation">.</span><span class="token plain">score </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">k</span><span class="token punctuation">,</span><span class="token plain"> s</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">.</span><span class="token plain">runCollect</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">l </span><span class="token keyword">=&gt;</span><span class="token plain"> k </span><span class="token operator">-&gt;</span><span class="token plain"> l</span><span class="token punctuation">.</span><span class="token plain">size</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><code>groupByKey</code> partition the stream by a simple function of type <code>O =&gt; K</code>; It is not an effectful function. In some cases we need to partition the stream by using an <em>effectful function</em> of type <code>O =&gt; ZIO[R1, E1, (K, V)]</code>; So we can use <code>groupBy</code> which is the powerful version of <code>groupByKey</code> function.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="groupby-1">groupBy<a class="hash-link" href="#groupby-1" title="Direct link to heading">​</a></h4><p>It takes an effectful function of type <code>O =&gt; ZIO[R1, E1, (K, V)]</code>; ZIO Stream uses this function to partition the stream and gives us a new data type called <code>ZStream.GroupBy</code> which represent a grouped stream. <code>GroupBy</code> has an <code>apply</code> method, that takes a function of type <code>(K, ZStream[Any, E, V]) =&gt; ZStream[R1, E1, A]</code>; ZIO Runtime runs this function across all groups and then merges them in a non-deterministic fashion as a result.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> groupBy</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    f</span><span class="token operator">:</span><span class="token plain"> O </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    buffer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">16</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">GroupBy</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> K</span><span class="token punctuation">,</span><span class="token plain"> V</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example below, we are going <code>groupBy</code> given names by their first character and then count the number of names in each group:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> counted</span><span class="token operator">:</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Char</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;Mary&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;James&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Robert&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Patricia&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Jennifer&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Rebecca&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Peter&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">groupBy</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">.</span><span class="token plain">head</span><span class="token punctuation">,</span><span class="token plain"> x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">char</span><span class="token punctuation">,</span><span class="token plain"> stream</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">stream</span><span class="token punctuation">.</span><span class="token plain">runCount</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">count </span><span class="token keyword">=&gt;</span><span class="token plain"> char </span><span class="token operator">-&gt;</span><span class="token plain"> count</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Input:  Mary, James, Robert, Patricia, John, Jennifer, Rebecca, Peter</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: (P, 2), (R, 2), (M, 1), (J, 3)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s change the above example a bit into an example of classifying students. The teacher assigns the student to a specific class based on the student&#x27;s talent. Note that the partitioning operation is an effectful:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> classifyStudents</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> Seq</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Please assign each student to one of the A, B, or C classrooms.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;Mary&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;James&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Robert&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Patricia&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Jennifer&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Rebecca&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Peter&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">groupBy</span><span class="token punctuation">(</span><span class="token plain">student </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;What is the classroom of </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">student</span><span class="token string-interpolation string">? &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        readLine</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">classroom </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">classroom</span><span class="token punctuation">,</span><span class="token plain"> student</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">classroom</span><span class="token punctuation">,</span><span class="token plain"> students</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        students</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">runFold</span><span class="token punctuation">(</span><span class="token plain">Seq</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">,</span><span class="token plain"> e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> s </span><span class="token operator">:</span><span class="token operator">+</span><span class="token plain"> e</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">students </span><span class="token keyword">=&gt;</span><span class="token plain"> classroom </span><span class="token operator">-&gt;</span><span class="token plain"> students</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Input: </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Please assign each student to one of the A, B, or C classrooms.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of Mary? A</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of James? B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of Robert? A</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of Patricia? C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of John? B</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of Jennifer? A</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of Rebecca? C</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// What is the classroom of Peter? A</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: </span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// (B,List(James, John))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// (A,List(Mary, Robert, Jennifer, Peter))</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// (C,List(Patricia, Rebecca))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grouping">Grouping<a class="hash-link" href="#grouping" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="grouped">grouped<a class="hash-link" href="#grouped" title="Direct link to heading">​</a></h4><p>To partition the stream results with the specified chunk size, we can use the <code>grouped</code> function.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> groupedResult</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Chunk</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token plain"> to </span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">grouped</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Input:  0, 1, 2, 3, 4, 5, 6, 7, 8</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: Chunk(0, 1, 2), Chunk(3, 4, 5), Chunk(6, 7, 8)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="groupedwithin">groupedWithin<a class="hash-link" href="#groupedwithin" title="Direct link to heading">​</a></h4><p>It allows grouping events by time or chunk size, whichever is satisfied first. In the example below every chunk consists of 30 elements and is produced every 3 seconds.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Duration</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> groupedWithinResult</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Chunk</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token plain"> to </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">groupedWithin</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="concatenation">Concatenation<a class="hash-link" href="#concatenation" title="Direct link to heading">​</a></h3><p>We can concatenate two streams by using <code>ZStream#++</code> or <code>ZStream#concat</code> operator which returns a stream that emits the elements from the left-hand stream and then emits the elements from the right stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> a </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> b </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> c1 </span><span class="token operator">=</span><span class="token plain"> a </span><span class="token operator">++</span><span class="token plain"> b</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> c2 </span><span class="token operator">=</span><span class="token plain"> a concat b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, we can use <code>ZStream.concatAll</code> constructor to concatenate given streams together:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> c3 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">concatAll</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">(</span><span class="token plain">a</span><span class="token punctuation">,</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is also the <code>ZStream#flatMap</code> combinator which create a stream which elements are generated by applying a function of type <code>O =&gt; ZStream[R1, E1, O2]</code> to each output of the source stream and concatenated all of the results:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token plain">x</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">take</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Input:  1, 2, 3</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Assume we have an API that takes an author name and returns all its book:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> getAuthorBooks</span><span class="token punctuation">(</span><span class="token plain">author</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Book</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we have a stream of author&#x27;s names, we can use <code>ZStream#flatMap</code> to concatenate the results of all API calls:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> authors</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;Mary&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;James&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Robert&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Patricia&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;John&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> allBooks</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Book</span><span class="token punctuation">]</span><span class="token plain">  </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  authors</span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">getAuthorBooks _</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we need to do the <code>flatMap</code> concurrently, we can use <code>ZStream#flatMapPar</code>, and also if the order of concatenation is not important for us, we can use the <code>ZStream#flatMapParSwitch</code> operator.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="merging">Merging<a class="hash-link" href="#merging" title="Direct link to heading">​</a></h3><p>Sometimes we need to interleave the emission of two streams and create another stream. In these cases, we can&#x27;t use the <code>ZStream.concat</code> operation because the <code>concat</code> operation waits for the first stream to finish and then consumes the second stream. So we need a non-deterministic way of picking elements from different sources. ZIO Stream&#x27;s <code>merge</code> operations does this for us. Let&#x27;s discuss some variants of this operation:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="merge">merge<a class="hash-link" href="#merge" title="Direct link to heading">​</a></h4><p>The <code>ZSstream#merge</code> picks elements randomly from specified streams:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">rechunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">rechunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> merged </span><span class="token operator">=</span><span class="token plain"> s1 merge s2</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// As the merge operation is not deterministic, it may output the following stream of numbers:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 4, 1, 2, 5, 6, 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Merge operation always try to pull one chunk from each stream, if we chunk our streams equal or over 3 elements in the last example, we encounter a new stream containing one of the <code>1, 2, 3, 4, 5, 6</code> or <code>4, 5, 6, 1, 2, 3</code> elements.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="termination-strategy">Termination Strategy<a class="hash-link" href="#termination-strategy" title="Direct link to heading">​</a></h4><p>When we merge two streams, we should think about the <em>termination strategy</em> of this operation. Each stream has a specific lifetime. One stream may emit all its elements and finish its job, another stream may end after one hour of emission, one another may have a long-running lifetime and never end. So when we merge two streams with different lifetimes, what is the termination strategy of the resulting stream?</p><p>By default, when we merge two streams using <code>ZStream#merge</code> operation, the newly produced stream will terminate when both specified streams terminate. We can also define the <em>termination strategy</em> corresponding to our requirement. ZIO Stream supports four different termination strategies:</p><ul><li><strong>Left</strong> — The resulting stream will terminate when the left-hand side stream terminates.</li><li><strong>Right</strong> — The resulting stream will terminate when the right-hand side stream finishes.</li><li><strong>Both</strong> — The resulting stream will terminate when both streams finish.</li><li><strong>Either</strong> — The resulting stream will terminate when one of the streams finishes.</li></ul><p>Here is an example of specifying termination strategy when merging two streams:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">ZStream</span><span class="token punctuation">.</span><span class="token plain">HaltStrategy</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">rechunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">repeat</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">rechunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> merged </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">merge</span><span class="token punctuation">(</span><span class="token plain">s2</span><span class="token punctuation">,</span><span class="token plain"> HaltStrategy</span><span class="token punctuation">.</span><span class="token plain">Left</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also use <code>ZStream#mergeTerminateLeft</code>, <code>ZStream#mergeTerminateRight</code> or <code>ZStream#mergeTerminateEither</code> operations instead of specifying manually the termination strategy.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mergeall">mergeAll<a class="hash-link" href="#mergeall" title="Direct link to heading">​</a></h4><p>Usually, micro-services or long-running applications are composed of multiple components that need to run infinitely in the background and if something happens to them, or they terminate abruptly we should crash the entire application.</p><p>So our main fiber should perform these three things:</p><ul><li><strong>Launch and wait</strong> — It should launch all of those background components and wait infinitely. It should not exit prematurely, because then our application won&#x27;t be running.</li><li><strong>Interrupt everything</strong> — It should interrupt all those components whenever we receive a termination signal from the operating system.</li><li><strong>Watch all fibers</strong> — It should watch all those fibers (background components), and quickly exit if something goes wrong.</li></ul><p>So how should we do that with our main fiber? Let&#x27;s try to create a long-running application:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> main </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  kafkaConsumer</span><span class="token punctuation">.</span><span class="token plain">runDrain</span><span class="token punctuation">.</span><span class="token plain">fork </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  httpServer</span><span class="token punctuation">.</span><span class="token plain">fork </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  scheduledJobRunner</span><span class="token punctuation">.</span><span class="token plain">fork </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">never</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can launch the Kafka consumer, the HTTP server, and our job runner and fork them, and then wait using <code>ZIO.never</code>. This will indeed wait, but if something happens to any of them and if they crash, nothing happens. So our application just hangs and remains up without anything working in the background. So this approach does not work properly.</p><p>So another idea is to watch background components. The <code>ZIO#forkScoped</code> enables us to race all forked fibers in a <code>Scope</code>. By using <code>ZIO.raceAll</code> as soon as one of those fibers terminates with either success or failure, it will interrupt all the rest components as the part of the release action of <code>Scope</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> scopedApp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  kafka </span><span class="token keyword">&lt;-</span><span class="token plain"> kafkaConsumer</span><span class="token punctuation">.</span><span class="token plain">runDrain</span><span class="token punctuation">.</span><span class="token plain">forkScoped</span><br></span><span class="token-line"><span class="token plain">  http  </span><span class="token keyword">&lt;-</span><span class="token plain"> httpServer</span><span class="token punctuation">.</span><span class="token plain">forkScoped</span><br></span><span class="token-line"><span class="token plain">  jobs  </span><span class="token keyword">&lt;-</span><span class="token plain"> scheduledJobRunner</span><span class="token punctuation">.</span><span class="token plain">forkScoped</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">raceAll</span><span class="token punctuation">(</span><span class="token plain">kafka</span><span class="token punctuation">.</span><span class="token plain">await</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">(</span><span class="token plain">http</span><span class="token punctuation">.</span><span class="token plain">await</span><span class="token punctuation">,</span><span class="token plain"> jobs</span><span class="token punctuation">.</span><span class="token plain">await</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> mainApp </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">scoped</span><span class="token punctuation">(</span><span class="token plain">scopedApp</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exitCode</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This solution is very nice and elegant, but we can do it in a more declarative fashion with ZIO streams:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> scopedApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">//_ &lt;- other resources</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZStream</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">mergeAllUnbounded</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        kafkaConsumer</span><span class="token punctuation">.</span><span class="token plain">drain</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">httpServer</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">scheduledJobRunner</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">runDrain</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">scoped</span><span class="token punctuation">(</span><span class="token plain">scopedApp</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">exitCode</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>ZStream.mergeAll</code> we can combine all these streaming components concurrently into one application.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mergewith">mergeWith<a class="hash-link" href="#mergewith" title="Direct link to heading">​</a></h4><p>Sometimes we need to merge two streams and after that, unify them and convert them to new element types. We can do this by using the <code>ZStream#mergeWith</code> operation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4.1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5.3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6.2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> merged </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">mergeWith</span><span class="token punctuation">(</span><span class="token plain">s2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interleaving">Interleaving<a class="hash-link" href="#interleaving" title="Direct link to heading">​</a></h3><p>When we <code>merge</code> two streams, the ZIO Stream picks elements from two streams randomly. But how to merge two streams deterministically? The answer is the <code>ZStream#interleave</code> operation. </p><p>The <code>ZStream#interleave</code> operator pulls an element from each stream, one by one, and then returns an interleaved stream. When one stream is exhausted, all remaining values in the other stream will be pulled:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> interleaved </span><span class="token operator">=</span><span class="token plain"> s1 interleave s2</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 4, 2, 5, 3, 6, 7, 8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO Stream also has the <code>interleaveWith</code> operator, which is a more powerful version of <code>interleave</code>. By using <code>ZStream#interleaveWith</code>, we can specify the logic of interleaving:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> interleaved </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">interleaveWith</span><span class="token punctuation">(</span><span class="token plain">s2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">forever</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 4, 3, 6, 8, 5, 10, 7, 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ZStream#interleaveWith</code> uses a stream of boolean to decide which stream to choose. If it reaches a true value, it will pick a value from the left-hand side stream, otherwise, it will pick from the right-hand side.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interspersing">Interspersing<a class="hash-link" href="#interspersing" title="Direct link to heading">​</a></h3><p>We can intersperse any stream by using <code>ZStream#intersperse</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">intersperse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 0, 2, 0, 3, 0, 4, 0, 5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">intersperse</span><span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: [, -, a, -, b, -, c, -, d]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="broadcasting">Broadcasting<a class="hash-link" href="#broadcasting" title="Direct link to heading">​</a></h3><p>We can broadcast a stream by using <code>ZStream#broadcast</code>, it returns a scoped list of streams that have the same elements as the source stream. The <code>broadcast</code> operation emits each element to the inputs of returning streams. The upstream stream can emit events as much as <code>maximumLag</code>, then it decreases its speed by the slowest downstream stream.</p><p>In the following example, we are broadcasting stream of random numbers to the two downstream streams. One of them is responsible to compute the maximum number, and the other one does some logging job with additional delay. The upstream stream decreases its speed by the logging stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">scoped </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">20</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">mapZIO</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token plain">abs</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">e </span><span class="token keyword">=&gt;</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Emit </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">e</span><span class="token string-interpolation string"> element before broadcasting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">broadcast</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> streams </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            out1 </span><span class="token keyword">&lt;-</span><span class="token plain"> streams</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">runFold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">acc</span><span class="token punctuation">,</span><span class="token plain"> e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token plain">max</span><span class="token punctuation">(</span><span class="token plain">acc</span><span class="token punctuation">,</span><span class="token plain"> e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                      </span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Maximum: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                      </span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">            out2 </span><span class="token keyword">&lt;-</span><span class="token plain"> streams</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                      </span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Logging to the Console: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                      </span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">            _    </span><span class="token keyword">&lt;-</span><span class="token plain"> out1</span><span class="token punctuation">.</span><span class="token plain">join</span><span class="token punctuation">.</span><span class="token plain">zipPar</span><span class="token punctuation">(</span><span class="token plain">out2</span><span class="token punctuation">.</span><span class="token plain">join</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="distribution">Distribution<a class="hash-link" href="#distribution" title="Direct link to heading">​</a></h3><p>The <code>ZStream#distributedWith</code> operator is a more powerful version of <code>ZStream#broadcast</code>. It takes a <code>decide</code> function, and based on that decide how to distribute incoming elements into the downstream streams:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> distributedWith</span><span class="token punctuation">[</span><span class="token plain">E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    maximumLag</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    decide</span><span class="token operator">:</span><span class="token plain"> O </span><span class="token keyword">=&gt;</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R </span><span class="token keyword">with</span><span class="token plain"> Scope</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Dequeue</span><span class="token punctuation">[</span><span class="token plain">Exit</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token plain">E1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> O</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example below, we are partitioning incoming elements into three streams using <code>ZStream#distributedWith</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> partitioned</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Scope</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> UStream</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">fixed</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">distributedWith</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"> x </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">q </span><span class="token keyword">=&gt;</span><span class="token plain"> x </span><span class="token operator">%</span><span class="token plain"> </span><span class="token number">3</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> q</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> q1 </span><span class="token operator">::</span><span class="token plain"> q2 </span><span class="token operator">::</span><span class="token plain"> q3 </span><span class="token operator">::</span><span class="token plain"> Nil </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZStream</span><span class="token punctuation">.</span><span class="token plain">fromQueue</span><span class="token punctuation">(</span><span class="token plain">q1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flattenExitOption</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZStream</span><span class="token punctuation">.</span><span class="token plain">fromQueue</span><span class="token punctuation">(</span><span class="token plain">q2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flattenExitOption</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          ZStream</span><span class="token punctuation">.</span><span class="token plain">fromQueue</span><span class="token punctuation">(</span><span class="token plain">q3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flattenExitOption</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Impossible!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffering">Buffering<a class="hash-link" href="#buffering" title="Direct link to heading">​</a></h3><p>Since the ZIO streams are pull-based, it means the consumers do not need to message the upstream to slow down. Whenever a downstream stream pulls a new element, the upstream produces a new element. So, the upstream stream is as fast as the slowest downstream stream. Sometimes we need to run producer and consumer independently, in such a situation we can use an asynchronous non-blocking queue for communication between faster producer and slower consumer; the queue can buffer elements between two streams. ZIO stream also has a built-in <code>ZStream#buffer</code> operator which does the same thing for us.</p><p>The <code>ZStream#buffer</code> allows a faster producer to progress independently of a slower consumer by buffering up to <code>capacity</code> chunks in a queue.</p><p>In the following example, we are going to buffer a stream. We print each element to the console as they are emitting before and after the buffering:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZStream</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">rechunk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;before buffering: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">buffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;after buffering: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">5.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain">  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We spaced 5 seconds between each emission to show the lag between producing and consuming messages.</p><p>Based on the type of underlying queue we can use one the buffering operators:</p><ul><li><strong>Bounded Queue</strong> — <code>ZStream#buffer(capacity: Int)</code></li><li><strong>Unbounded Queue</strong> — <code>ZStream#bufferUnbounded</code></li><li><strong>Sliding Queue</strong> — <code>ZStream#bufferSliding(capacity: Int)</code></li><li><strong>Dropping Queue</strong> <code>ZStream#bufferDropping(capacity: Int)</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="debouncing">Debouncing<a class="hash-link" href="#debouncing" title="Direct link to heading">​</a></h3><p>The <code>ZStream#debounce</code> method debounces the stream with a minimum period of <code>d</code> between each element:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">500.</span><span class="token plain">millis</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">10.</span><span class="token plain">millis</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debounce</span><span class="token punctuation">(</span><span class="token number">100.</span><span class="token plain">millis</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// emit only after a pause of at least 100 ms</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 3, 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="aggregation">Aggregation<a class="hash-link" href="#aggregation" title="Direct link to heading">​</a></h3><p>Aggregation is the process of converting one or more elements of type <code>A</code> into elements of type <code>B</code>. This operation takes a transducer as an aggregation unit and returns another stream that is aggregated. We have two types of aggregation:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="synchronous-aggregation">Synchronous Aggregation<a class="hash-link" href="#synchronous-aggregation" title="Direct link to heading">​</a></h4><p>They are synchronous because the upstream emits an element when the <em>transducer</em> emits one. To apply a synchronous aggregation to the stream we can use <code>ZStream#aggregate</code> or <code>ZStream#transduce</code> operations.</p><p>Let&#x27;s see an example of synchronous aggregation:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">6</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> stream</span><span class="token punctuation">.</span><span class="token plain">transduce</span><span class="token punctuation">(</span><span class="token plain">ZSink</span><span class="token punctuation">.</span><span class="token plain">collectAllN</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output Chunk(1,2,3), Chunk(4,5,6), Chunk(7,8,9), Chunk(10)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Sometimes stream processing element by element is not efficient, specially when we are working with files or doing I/O works; so we might need to aggregate them and process them in a batch way:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> source </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">take</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Producing Element </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">x</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">duration</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">jittered</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> sink </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZSink</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token operator">:</span><span class="token plain"> Chunk</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Processing batch of events: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">e</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">duration</span><span class="token punctuation">(</span><span class="token number">3.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">jittered</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  source</span><span class="token punctuation">.</span><span class="token plain">transduce</span><span class="token punctuation">(</span><span class="token plain">ZSink</span><span class="token punctuation">.</span><span class="token plain">collectAllN</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">sink</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see one output of running this program:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">Producing element 1</span><br></span><span class="token-line"><span class="token plain">Producing element 2</span><br></span><span class="token-line"><span class="token plain">Producing element 3</span><br></span><span class="token-line"><span class="token plain">Producing element 4</span><br></span><span class="token-line"><span class="token plain">Producing element 5</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(1,2,3,4,5)</span><br></span><span class="token-line"><span class="token plain">Producing element 6</span><br></span><span class="token-line"><span class="token plain">Producing element 7</span><br></span><span class="token-line"><span class="token plain">Producing element 8</span><br></span><span class="token-line"><span class="token plain">Producing element 9</span><br></span><span class="token-line"><span class="token plain">Producing element 10</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(6,7,8,9,10)</span><br></span><span class="token-line"><span class="token plain">Producing element 11</span><br></span><span class="token-line"><span class="token plain">Producing element 12</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(11,12)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Elements are grouped into Chunks of 5 elements and then processed in a batch way.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-aggregation">Asynchronous Aggregation<a class="hash-link" href="#asynchronous-aggregation" title="Direct link to heading">​</a></h4><p>Asynchronous aggregations, aggregate elements of upstream as long as the downstream operators are busy. To apply an asynchronous aggregation to the stream, we can use <code>ZStream#aggregateAsync</code>, <code>ZStream#aggregateAsyncWithin</code>, and <code>ZStream#aggregateAsyncWithinEither</code> operations.</p><p>For example, consider <code>source.aggregateAsync(ZSink.collectAllN[Nothing, Int](5)).mapZIO(processChunks)</code>. Whenever the downstream (<code>mapZIO(processChunks)</code>) is ready for consumption and pulls the upstream, the transducer <code>(ZTransducer.collectAllN(5))</code> will flush out its buffer, regardless of whether the <code>collectAllN</code> buffered all its 5 elements or not. So the <code>ZStream#aggregateAsync</code> will emit when downstream pulls:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  source</span><span class="token punctuation">.</span><span class="token plain">aggregateAsync</span><span class="token punctuation">(</span><span class="token plain">ZSink</span><span class="token punctuation">.</span><span class="token plain">collectAllN</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">sink</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see one output of running this program:</p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">Producing element 1</span><br></span><span class="token-line"><span class="token plain">Producing element 2</span><br></span><span class="token-line"><span class="token plain">Producing element 3</span><br></span><span class="token-line"><span class="token plain">Producing element 4</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(1,2)</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(3,4)</span><br></span><span class="token-line"><span class="token plain">Producing element 5</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(5)</span><br></span><span class="token-line"><span class="token plain">Producing element 6</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(6)</span><br></span><span class="token-line"><span class="token plain">Producing element 7</span><br></span><span class="token-line"><span class="token plain">Producing element 8</span><br></span><span class="token-line"><span class="token plain">Producing element 9</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(7)</span><br></span><span class="token-line"><span class="token plain">Producing element 10</span><br></span><span class="token-line"><span class="token plain">Producing element 11</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(8,9)</span><br></span><span class="token-line"><span class="token plain">Producing element 12</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(10,11)</span><br></span><span class="token-line"><span class="token plain">Processing batch of events: Chunk(12)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZStream#aggregateAsyncWithin</code> is another aggregator which takes a scheduler. This scheduler will consume all events produced by the given transducer. So the <code>aggregateAsyncWithin</code> will emit when the transducer emits or when the scheduler expires:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">abstract</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">O</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">def</span><span class="token plain"> aggregateAsyncWithin</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    sink</span><span class="token operator">:</span><span class="token plain"> ZSink</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> A1</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    schedule</span><span class="token operator">:</span><span class="token plain"> Schedule</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">B</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span><span class="token plain"> trace</span><span class="token operator">:</span><span class="token plain"> Trace</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E2</span><span class="token punctuation">,</span><span class="token plain"> B</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we are doing I/O, batching is very important. With ZIO streams, we can create user-defined batches. It is pretty easy to do that with the <code>ZStream#aggregateAsyncWithin</code> operator. Let&#x27;s see the below snippet code:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">dataStream</span><span class="token punctuation">.</span><span class="token plain">aggregateAsyncWithin</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   ZSink</span><span class="token punctuation">.</span><span class="token plain">collectAllN</span><span class="token punctuation">[</span><span class="token plain">Record</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">   Schedule</span><span class="token punctuation">.</span><span class="token plain">fixed</span><span class="token punctuation">(</span><span class="token number">30.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"> </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So it will collect elements into a chunk up to 2000 elements and if we have got less than 2000 elements and 30 seconds have passed, it will pass currently collected elements down the stream whether it has collected zero, one, or 2000 elements. So this is a sort of timeout for aggregation operation. This approach aggressively favors <strong>throughput</strong> over <strong>latency</strong>. It will introduce a fixed amount of latency into a stream. We will always wait for up to 30 seconds if we haven&#x27;t reached this sort of boundary value.</p><p>Instead, thanks to <code>Schedule</code> we can create a much smarter <strong>adaptive batching algorithm</strong> that can balance between <strong>throughput</strong> and *<em>latency</em>. So what we are doing here is that we are creating a schedule that operates on chunks of records. What the <code>Schedule</code> does is that it starts off with 30-second timeouts for as long as its input has a size that is lower than 1000, now once we see an input that has a size look higher than 1000, we will switch to a second schedule with some jittery, and we will remain with this schedule for as long as the batch size is over 1000:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> schedule</span><span class="token operator">:</span><span class="token plain"> Schedule</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">Chunk</span><span class="token punctuation">[</span><span class="token plain">Record</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Start off with 30-second timeouts as long as the batch size is &lt; 1000</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Schedule</span><span class="token punctuation">.</span><span class="token plain">fixed</span><span class="token punctuation">(</span><span class="token number">30.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">whileInput</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token plain">Chunk</span><span class="token punctuation">[</span><span class="token plain">Record</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">getOrElse</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">length </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token plain"> andThen</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token comment">// and then, switch to a shorter jittered schedule for as long as batches remain over 1000</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Schedule</span><span class="token punctuation">.</span><span class="token plain">fixed</span><span class="token punctuation">(</span><span class="token number">5.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">jittered</span><span class="token punctuation">.</span><span class="token plain">whileInput</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token plain">Chunk</span><span class="token punctuation">[</span><span class="token plain">Record</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">getOrElse</span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">length </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">dataStream</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">aggregateAsyncWithin</span><span class="token punctuation">(</span><span class="token plain">ZSink</span><span class="token punctuation">.</span><span class="token plain">collectAllN</span><span class="token punctuation">[</span><span class="token plain">Record</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> schedule</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling">Scheduling<a class="hash-link" href="#scheduling" title="Direct link to heading">​</a></h2><p>To schedule the output of a stream we use <code>ZStream#schedule</code> combinator.</p><p>Let&#x27;s space between each emission of the given stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">spaced</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="consuming-a-stream">Consuming a Stream<a class="hash-link" href="#consuming-a-stream" title="Direct link to heading">​</a></h2><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">stream</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromIterable</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token plain"> to </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-a-sink">Using a Sink<a class="hash-link" href="#using-a-sink" title="Direct link to heading">​</a></h3><p>To consume a stream using <code>ZSink</code> we can pass <code>ZSink</code> to the <code>ZStream#run</code> function:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> sum</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">run</span><span class="token punctuation">(</span><span class="token plain">ZSink</span><span class="token punctuation">.</span><span class="token plain">sum</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-fold">Using fold<a class="hash-link" href="#using-fold" title="Direct link to heading">​</a></h3><p>The <code>ZStream#fold</code> method executes the fold operation over the stream of values and returns a <code>ZIO</code> effect containing the result:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">runFold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">runFoldWhile</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> _</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-foreach">Using foreach<a class="hash-link" href="#using-foreach" title="Direct link to heading">​</a></h3><p>Using <code>ZStream#foreach</code> is another way of consuming elements of a stream. It takes a callback of type <code>O =&gt; ZIO[R1, E1, Any]</code> which passes each element of a stream to this callback:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-handling">Error Handling<a class="hash-link" href="#error-handling" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-from-failure">Recovering from Failure<a class="hash-link" href="#recovering-from-failure" title="Direct link to heading">​</a></h3><p>If we have a stream that may fail, we might need to recover from the failure and run another stream, the <code>ZStream#orElse</code> takes another stream, so when the failure occurs it will switch over to the provided stream:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh! Error!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">orElse</span><span class="token punctuation">(</span><span class="token plain">s2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 3, 7, 8, 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another variant of <code>orElse</code> is <code>ZStream#orElseEither</code>, which distinguishes elements of the two streams using the <code>Either</code> data type. Using this operator, the result of the previous example should be <code>Left(1), Left(2), Left(3), Right(6), Right(7), Right(8)</code>.</p><p>ZIO stream has <code>ZStream#catchAll</code> which is powerful version of <code>ZStream#orElse</code>. By using <code>catchAll</code> we can decide what to do based on the type and value of the failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> first </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh Oh!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZStream</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Ouch&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> second </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> third </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">11</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> first</span><span class="token punctuation">.</span><span class="token plain">catchAll </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;Uh Oh!&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> second</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;Ouch&quot;</span><span class="token plain">   </span><span class="token keyword">=&gt;</span><span class="token plain"> third</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 3, 6, 7, 8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-from-defects">Recovering from Defects<a class="hash-link" href="#recovering-from-defects" title="Direct link to heading">​</a></h3><p>If we need to recover from all causes of failures including defects we should use the <code>ZStream#catchAllCause</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Oh! Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">catchAllCause</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> s2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 3, 7, 8, 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recovery-from-some-errors">Recovery from Some Errors<a class="hash-link" href="#recovery-from-some-errors" title="Direct link to heading">​</a></h3><p>If we need to recover from specific failure we should use <code>ZStream#catchSome</code>: </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Oh! Error!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">catchSome </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;Oh! Error!&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> s2</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Output: 1, 2, 3, 7, 8, 9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And, to recover from a specific cause, we should use <code>ZStream#catchSomeCause</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Oh! Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2 </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">8</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">9</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> s1</span><span class="token punctuation">.</span><span class="token plain">catchSomeCause </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> Die</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> s2 </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recovering-to-zio-effect">Recovering to ZIO Effect<a class="hash-link" href="#recovering-to-zio-effect" title="Direct link to heading">​</a></h3><p>If our stream encounters an error, we can provide some cleanup task as ZIO effect to our stream by using the <code>ZStream#onError</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">dieMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Oh! Boom!&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">onError</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Stream application closed! We are doing some cleanup jobs.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retry-a-failing-stream">Retry a Failing Stream<a class="hash-link" href="#retry-a-failing-stream" title="Direct link to heading">​</a></h3><p>When a stream fails, it can be retried according to the given schedule to the <code>ZStream#retry</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> numbers </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Enter a number: &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">x </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          x</span><span class="token punctuation">.</span><span class="token plain">toIntOption </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> Some</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> None        </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;NaN&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">retry</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">exponential</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">second</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fromto-either">From/To Either<a class="hash-link" href="#fromto-either" title="Direct link to heading">​</a></h3><p>Sometimes, we might be working with legacy API which does error handling with the <code>Either</code> data type. We can <em>absolve</em> their error types into the ZStream effect using <code>ZStream.absolve</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> legacyFetchUrlAPI</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> URL</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> fetchUrl</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    url</span><span class="token operator">:</span><span class="token plain"> URL</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain">legacyFetchUrlAPI</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">absolve</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The type of this stream before absolving is <code>ZStream[Any, Throwable, Either[Throwable, String]]</code>, this operation let us submerge the error case of an <code>Either</code> into the <code>ZStream</code> error type.</p><p>We can do the opposite by exposing an error of type <code>ZStream[R, E, A]</code> as a part of the <code>Either</code> by using <code>ZStream#either</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> inputs</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">either</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we are working with streams of <code>Either</code> values, we might want to fail the stream as soon as the emission of the first <code>Left</code> value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token comment">// Stream of Either values that cannot fail</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> eitherStream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">(</span><span class="token plain">Right</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Left</span><span class="token punctuation">(</span><span class="token string">&quot;failed to parse&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// A Fails with the first emission of the left value</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> eitherStream</span><span class="token punctuation">.</span><span class="token plain">rightOrFail</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="refining-errors">Refining Errors<a class="hash-link" href="#refining-errors" title="Direct link to heading">​</a></h3><p>We can keep one or some errors and terminate the fiber with the rest by using <code>ZStream#refineOrDie</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> stream</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZStream</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Throwable</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> res</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IllegalArgumentException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  stream</span><span class="token punctuation">.</span><span class="token plain">refineOrDie </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> e</span><span class="token operator">:</span><span class="token plain"> IllegalArgumentException </span><span class="token keyword">=&gt;</span><span class="token plain"> e </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="timing-out">Timing Out<a class="hash-link" href="#timing-out" title="Direct link to heading">​</a></h3><p>We can timeout a stream if it does not produce a value after some duration using <code>ZStream#timeout</code>, <code>ZStream#timeoutFail</code> and <code>timeoutFailCause</code> operators:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">stream</span><span class="token punctuation">.</span><span class="token plain">timeoutFail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> TimeoutException</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">10.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or we can switch to another stream if the first stream does not produce a value after some duration:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> alternative </span><span class="token operator">=</span><span class="token plain"> ZStream</span><span class="token punctuation">.</span><span class="token plain">fromZIO</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">stream</span><span class="token punctuation">.</span><span class="token plain">timeoutTo</span><span class="token punctuation">(</span><span class="token number">10.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">alternative</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/reference/stream/zstream.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference/stream/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference/stream/stream.md"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Stream</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#stream-types" class="table-of-contents__link toc-highlight">Stream Types</a></li><li><a href="#chunking" class="table-of-contents__link toc-highlight">Chunking</a></li><li><a href="#creating-a-stream" class="table-of-contents__link toc-highlight">Creating a Stream</a><ul><li><a href="#common-constructors" class="table-of-contents__link toc-highlight">Common Constructors</a></li><li><a href="#from-success-and-failure" class="table-of-contents__link toc-highlight">From Success and Failure</a></li><li><a href="#from-chunks" class="table-of-contents__link toc-highlight">From Chunks</a></li><li><a href="#from-zio" class="table-of-contents__link toc-highlight">From ZIO</a></li><li><a href="#from-asynchronous-callback" class="table-of-contents__link toc-highlight">From Asynchronous Callback</a></li><li><a href="#from-iterators" class="table-of-contents__link toc-highlight">From Iterators</a></li><li><a href="#from-iterables" class="table-of-contents__link toc-highlight">From Iterables</a></li><li><a href="#from-repetition" class="table-of-contents__link toc-highlight">From Repetition</a></li><li><a href="#from-unfoldingpagination" class="table-of-contents__link toc-highlight">From Unfolding/Pagination</a></li><li><a href="#from-wrapped-streams" class="table-of-contents__link toc-highlight">From Wrapped Streams</a></li><li><a href="#from-java-io" class="table-of-contents__link toc-highlight">From Java IO</a></li><li><a href="#from-java-stream" class="table-of-contents__link toc-highlight">From Java Stream</a></li><li><a href="#from-queue-and-hub" class="table-of-contents__link toc-highlight">From Queue and Hub</a></li><li><a href="#from-schedule" class="table-of-contents__link toc-highlight">From Schedule</a></li><li><a href="#resourceful-streams" class="table-of-contents__link toc-highlight">Resourceful Streams</a></li></ul></li><li><a href="#operations" class="table-of-contents__link toc-highlight">Operations</a><ul><li><a href="#tapping" class="table-of-contents__link toc-highlight">Tapping</a></li><li><a href="#taking-elements" class="table-of-contents__link toc-highlight">Taking Elements</a></li><li><a href="#mapping" class="table-of-contents__link toc-highlight">Mapping</a></li><li><a href="#filtering" class="table-of-contents__link toc-highlight">Filtering</a></li><li><a href="#scanning" class="table-of-contents__link toc-highlight">Scanning</a></li><li><a href="#draining" class="table-of-contents__link toc-highlight">Draining</a></li><li><a href="#changes" class="table-of-contents__link toc-highlight">Changes</a></li><li><a href="#collecting" class="table-of-contents__link toc-highlight">Collecting</a></li><li><a href="#zipping" class="table-of-contents__link toc-highlight">Zipping</a></li><li><a href="#cross-product" class="table-of-contents__link toc-highlight">Cross Product</a></li><li><a href="#partitioning" class="table-of-contents__link toc-highlight">Partitioning</a></li><li><a href="#groupby" class="table-of-contents__link toc-highlight">GroupBy</a></li><li><a href="#grouping" class="table-of-contents__link toc-highlight">Grouping</a></li><li><a href="#concatenation" class="table-of-contents__link toc-highlight">Concatenation</a></li><li><a href="#merging" class="table-of-contents__link toc-highlight">Merging</a></li><li><a href="#interleaving" class="table-of-contents__link toc-highlight">Interleaving</a></li><li><a href="#interspersing" class="table-of-contents__link toc-highlight">Interspersing</a></li><li><a href="#broadcasting" class="table-of-contents__link toc-highlight">Broadcasting</a></li><li><a href="#distribution" class="table-of-contents__link toc-highlight">Distribution</a></li><li><a href="#buffering" class="table-of-contents__link toc-highlight">Buffering</a></li><li><a href="#debouncing" class="table-of-contents__link toc-highlight">Debouncing</a></li><li><a href="#aggregation" class="table-of-contents__link toc-highlight">Aggregation</a></li></ul></li><li><a href="#scheduling" class="table-of-contents__link toc-highlight">Scheduling</a></li><li><a href="#consuming-a-stream" class="table-of-contents__link toc-highlight">Consuming a Stream</a><ul><li><a href="#using-a-sink" class="table-of-contents__link toc-highlight">Using a Sink</a></li><li><a href="#using-fold" class="table-of-contents__link toc-highlight">Using fold</a></li><li><a href="#using-foreach" class="table-of-contents__link toc-highlight">Using foreach</a></li></ul></li><li><a href="#error-handling" class="table-of-contents__link toc-highlight">Error Handling</a><ul><li><a href="#recovering-from-failure" class="table-of-contents__link toc-highlight">Recovering from Failure</a></li><li><a href="#recovering-from-defects" class="table-of-contents__link toc-highlight">Recovering from Defects</a></li><li><a href="#recovery-from-some-errors" class="table-of-contents__link toc-highlight">Recovery from Some Errors</a></li><li><a href="#recovering-to-zio-effect" class="table-of-contents__link toc-highlight">Recovering to ZIO Effect</a></li><li><a href="#retry-a-failing-stream" class="table-of-contents__link toc-highlight">Retry a Failing Stream</a></li><li><a href="#fromto-either" class="table-of-contents__link toc-highlight">From/To Either</a></li><li><a href="#refining-errors" class="table-of-contents__link toc-highlight">Refining Errors</a></li><li><a href="#timing-out" class="table-of-contents__link toc-highlight">Timing Out</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.41fad63a.js"></script>
<script src="/assets/js/main.f233b8d7.js"></script>
</body>
</html>