<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-reference/core/zio/zio">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-rh="true">ZIO | ZIO</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/reference/core/zio/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ZIO | ZIO"><meta data-rh="true" name="description" content="A ZIO[R, E, A] value is an immutable value that lazily describes a workflow or job. The workflow requires some environment R, and may fail with an error of type E, or succeed with a value of type A."><meta data-rh="true" property="og:description" content="A ZIO[R, E, A] value is an immutable value that lazily describes a workflow or job. The workflow requires some environment R, and may fail with an error of type E, or succeed with a value of type A."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/reference/core/zio/"><link data-rh="true" rel="alternate" href="https://zio.dev/reference/core/zio/" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/reference/core/zio/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.97da2182.css">
<link rel="preload" href="/assets/js/runtime~main.e3e035e3.js" as="script">
<link rel="preload" href="/assets/js/main.5d367137.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/reference/core/zio/">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reference/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/reference/core/zio/">Core</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/reference/core/zio/">ZIO</a><button aria-label="Toggle the collapsible sidebar category &#x27;ZIO&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/reference/core/zio/uio">Type Aliases</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/zioapp">ZIOApp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/runtime">Runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/exit">Exit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/core/cause">Cause</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/error-management/">Error Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Error Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/schedule/">Scheduling</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scheduling&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/contextual/">Contextual Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Contextual Types&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/state/">State Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;State Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/fiber/">Concurrency</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/resource/">Resource Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resource Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/stream/">Streaming</a><button aria-label="Toggle the collapsible sidebar category &#x27;Streaming&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/metrics/">Metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference/test/">Testing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/reference/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ZIO</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZIO</h1></header><p>A <code>ZIO[R, E, A]</code> value is an immutable value that lazily describes a workflow or job. The workflow requires some environment <code>R</code>, and may fail with an error of type <code>E</code>, or succeed with a value of type <code>A</code>.</p><p>A value of type <code>ZIO[R, E, A]</code> is like an effectful version of the following function type:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">R </span><span class="token keyword">=&gt;</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This function, which requires an <code>R</code>, might produce either an <code>E</code>, representing failure, or an <code>A</code>, representing success. ZIO effects are not actually functions, of course, they can model synchronous, asynchronous, concurrent, parallel, and resourceful computations.</p><p>ZIO effects use a fiber-based concurrency model, with built-in support for
scheduling, fine-grained interruption, structured concurrency, and high scalability.</p><p>The <code>ZIO[R, E, A]</code> data type has three type parameters:</p><ul><li><strong><code>R</code> - Environment Type</strong>. The effect requires an environment of type <code>R</code>. If this type parameter is <code>Any</code>, it means the effect has no requirements, because we can run the effect with any value (for example, the unit value <code>()</code>).</li><li><strong><code>E</code> - Failure Type</strong>. The effect may fail with a value of type <code>E</code>. Some applications will use <code>Throwable</code>. If this type parameter is <code>Nothing</code>, it means the effect cannot fail, because there are no values of type <code>Nothing</code>.</li><li><strong><code>A</code> - Success Type</strong>. The effect may succeed with a value of type <code>A</code>. If this type parameter is <code>Unit</code>, it means the effect produces no useful information, while if it is <code>Nothing</code>, it means the effect runs forever (or until failure).</li></ul><p>In the following example, the <code>readLine</code> function does not require any services, it may fail with value of type <code>IOException</code>, or may succeed with a value of type <code>String</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> readLine</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>ZIO</code> values are immutable, and all <code>ZIO</code> functions produce new <code>ZIO</code> values, enabling <code>ZIO</code> to be reasoned about and used like any ordinary Scala immutable data structure.</p><p><code>ZIO</code> values do not actually <em>do</em> anything; they are just values that <em>model</em> or <em>describe</em> effectful interactions.</p><p><code>ZIO</code> can be <em>interpreted</em> by the ZIO runtime system into effectful interactions with the external world. Ideally, this occurs at a single time, in our application&#x27;s <code>main</code> function. The <code>App</code> class provides this functionality automatically.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creation">Creation<a class="hash-link" href="#creation" title="Direct link to heading">​</a></h2><p>In this section we explore some of the common ways to create ZIO effects from values, from common Scala types, and from both synchronous and asynchronous side-effects. Here is the summary list of them:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="success-values">Success Values<a class="hash-link" href="#success-values" title="Direct link to heading">​</a></h3><p>Using the <code>ZIO.succeed</code> method, we can create an effect that succeeds with the specified value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s1 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also use methods in the companion objects of the <code>ZIO</code> type aliases:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> s2</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="failure-values">Failure Values<a class="hash-link" href="#failure-values" title="Direct link to heading">​</a></h3><p>Using the <code>ZIO.fail</code> method, we can create an effect that models failure:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> f1 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For the <code>ZIO</code> data type, there is no restriction on the error type. We may use strings, exceptions, or custom data types appropriate for our application.</p><p>Many applications will model failures with classes that extend <code>Throwable</code> or <code>Exception</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> f2 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Exception</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-values">From Values<a class="hash-link" href="#from-values" title="Direct link to heading">​</a></h3><p>ZIO contains several constructors which help us to convert various data types into <code>ZIO</code> effects.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="option">Option<a class="hash-link" href="#option" title="Direct link to heading">​</a></h4><ol><li><strong><code>ZIO.fromOption</code></strong>— An <code>Option</code> can be converted into a ZIO effect using <code>ZIO.fromOption</code>:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zoption</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fromOption</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error type of the resulting effect is <code>Option[Nothing]</code>, which provides no information on why the value is not there. We can change the <code>Option[Nothing]</code> into a more specific error type using <code>ZIO#mapError</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zoption2</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> zoption</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string">&quot;It wasn&#x27;t there!&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also readily compose it with other operators while preserving the optional nature of the result (similar to an <code>OptionT</code>):</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> maybeId</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">Option</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fromOption</span><span class="token punctuation">(</span><span class="token plain">Some</span><span class="token punctuation">(</span><span class="token string">&quot;abc123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> getUser</span><span class="token punctuation">(</span><span class="token plain">userId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token plain">User</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> getTeam</span><span class="token punctuation">(</span><span class="token plain">teamId</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> Team</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">Throwable</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token plain">User</span><span class="token punctuation">,</span><span class="token plain"> Team</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  id   </span><span class="token keyword">&lt;-</span><span class="token plain"> maybeId</span><br></span><span class="token-line"><span class="token plain">  user </span><span class="token keyword">&lt;-</span><span class="token plain"> getUser</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">some</span><br></span><span class="token-line"><span class="token plain">  team </span><span class="token keyword">&lt;-</span><span class="token plain"> getTeam</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">.</span><span class="token plain">teamId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">asSomeError</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">,</span><span class="token plain"> team</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">unsome</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO.some</code></strong>/<strong><code>ZIO.none</code></strong>— These constructors can be used to directly create ZIO of optional values:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> someInt</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain">     </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">some</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> noneInt</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">none</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li><strong><code>ZIO.getOrFail</code></strong>— We can lift an <code>Option</code> into a <code>ZIO</code> and if the option is not defined we can fail the ZIO with the proper error type:</li></ol><ul><li><code>ZIO.getOrFail</code> fails with <code>Throwable</code> error type.</li><li><code>ZIO.getOrFailUnit</code> fails with <code>Unit</code> error type.</li><li><code>ZIO.getOrFailWith</code> fails with custom error type.</li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">input</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> input</span><span class="token punctuation">.</span><span class="token plain">toIntOption</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is not defined it fails with Throwable error type:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">getOrFail</span><span class="token punctuation">(</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1.2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is not defined it fails with Unit error type:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">getOrFailUnit</span><span class="token punctuation">(</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1.2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is not defined it fail with given error type:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">getOrFailWith</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">(</span><span class="token string">&quot;invalid input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1.2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><strong><code>ZIO.nonOrFail</code></strong>— It lifts an option into a ZIO value. If the option is empty it succeeds with <code>Unit</code> and if the option is defined it fails with a proper error type:</li></ol><ul><li><code>ZIO.nonOrFail</code> fails with the content of the optional value.</li><li><code>ZIO.nonOrFailUnit</code> fails with the <code>Unit</code> error type.</li><li><code>ZIO.nonOrFailWith</code> fails with custom error type.</li></ul><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> optionalValue</span><span class="token operator">:</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is empty it succeeds with Unit</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is defined it will fail with the content of the optional value</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">noneOrFail</span><span class="token punctuation">(</span><span class="token plain">optionalValue</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is empty it succeeds with Unit</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// If the optional value is defined, it will fail by applying the error function to it:</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">noneOrFailWith</span><span class="token punctuation">(</span><span class="token plain">optionalValue</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">e </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> NumberFormatException</span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="either">Either<a class="hash-link" href="#either" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>fromEither</code></td><td><code>Either[E, A]</code></td><td><code>IO[E, A]</code></td></tr><tr><td><code>left</code></td><td><code>A</code></td><td><code>UIO[Either[A, Nothing]]</code></td></tr><tr><td><code>right</code></td><td><code>A</code></td><td><code>UIO[Either[Nothing, A]]</code></td></tr></tbody></table><p>An <code>Either</code> can be converted into a ZIO effect using <code>ZIO.fromEither</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zeither </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fromEither</span><span class="token punctuation">(</span><span class="token plain">Right</span><span class="token punctuation">(</span><span class="token string">&quot;Success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error type of the resulting effect will be whatever type the <code>Left</code> case has, while the success type will be whatever type the <code>Right</code> case has.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="try">Try<a class="hash-link" href="#try" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>fromTry</code></td><td><code>scala.util.Try[A]</code></td><td><code>Task[A]</code></td></tr></tbody></table><p>A <code>Try</code> value can be converted into a ZIO effect using <code>ZIO.fromTry</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">util</span><span class="token namespace punctuation">.</span><span class="token plain">Try</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> ztry </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fromTry</span><span class="token punctuation">(</span><span class="token plain">Try</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error type of the resulting effect will always be <code>Throwable</code>, because <code>Try</code> can only fail with values of type <code>Throwable</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="future">Future<a class="hash-link" href="#future" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>fromFuture</code></td><td><code>ExecutionContext =&gt; scala.concurrent.Future[A]</code></td><td><code>Task[A]</code></td></tr><tr><td><code>fromFutureJava</code></td><td><code>java.util.concurrent.Future[A]</code></td><td><code>RIO[Blocking, A]</code></td></tr><tr><td><code>fromFunctionFuture</code></td><td><code>R =&gt; scala.concurrent.Future[A]</code></td><td><code>RIO[R, A]</code></td></tr><tr><td><code>fromFutureInterrupt</code></td><td><code>ExecutionContext =&gt; scala.concurrent.Future[A]</code></td><td><code>Task[A]</code></td></tr></tbody></table><p>A <code>Future</code> can be converted into a ZIO effect using <code>ZIO.fromFuture</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">concurrent</span><span class="token namespace punctuation">.</span><span class="token plain">Future</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> future </span><span class="token operator">=</span><span class="token plain"> Future</span><span class="token punctuation">.</span><span class="token plain">successful</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zfuture</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fromFuture </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">implicit</span><span class="token plain"> ec </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    future</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string">&quot;Goodbye!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function passed to <code>fromFuture</code> is passed an <code>ExecutionContext</code>, which allows ZIO to manage where the <code>Future</code> runs (of course, we can ignore this <code>ExecutionContext</code>).</p><p>The error type of the resulting effect will always be <code>Throwable</code>, because <code>Future</code> can only fail with values of type <code>Throwable</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="promise">Promise<a class="hash-link" href="#promise" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>fromPromiseScala</code></td><td><code>scala.concurrent.Promise[A]</code></td><td><code>Task[A]</code></td></tr></tbody></table><p>A <code>Promise</code> can be converted into a ZIO effect using <code>ZIO.fromPromiseScala</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">util</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> func</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> s </span><span class="token keyword">=&gt;</span><span class="token plain"> s</span><span class="token punctuation">.</span><span class="token plain">toUpperCase</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  promise </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">concurrent</span><span class="token punctuation">.</span><span class="token plain">Promise</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Try</span><span class="token punctuation">(</span><span class="token plain">func</span><span class="token punctuation">(</span><span class="token string">&quot;hello world from future&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">match</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Success</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> promise</span><span class="token punctuation">.</span><span class="token plain">success</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">case</span><span class="token plain"> Failure</span><span class="token punctuation">(</span><span class="token plain">exception</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> promise</span><span class="token punctuation">.</span><span class="token plain">failure</span><span class="token punctuation">(</span><span class="token plain">exception</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">  value </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fromPromiseScala</span><span class="token punctuation">(</span><span class="token plain">promise</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Hello World in UpperCase: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">value</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fiber">Fiber<a class="hash-link" href="#fiber" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>fromFiber</code></td><td><code>Fiber[E, A]</code></td><td><code>IO[E, A]</code></td></tr><tr><td><code>fromFiberZIO</code></td><td><code>IO[E, Fiber[E, A]]</code></td><td><code>IO[E, A]</code></td></tr></tbody></table><p>A <code>Fiber</code> can be converted into a ZIO effect using <code>ZIO.fromFiber</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> io</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">fromFiber</span><span class="token punctuation">(</span><span class="token plain">Fiber</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from Fiber!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="from-side-effects">From Side-Effects<a class="hash-link" href="#from-side-effects" title="Direct link to heading">​</a></h3><p>ZIO can convert both synchronous and asynchronous side-effects into ZIO effects (pure values).</p><p>These functions can be used to wrap procedural code, allowing us to seamlessly use all features of ZIO with legacy Scala and Java code, as well as third-party libraries.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="synchronous">Synchronous<a class="hash-link" href="#synchronous" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th><th>Note</th></tr></thead><tbody><tr><td><code>succeed</code></td><td><code>A</code></td><td><code>UIO[A]</code></td><td>Imports a total synchronous effect</td></tr><tr><td><code>attempt</code></td><td><code>A</code></td><td>Task<!-- -->[A]</td><td>Imports a (partial) synchronous side-effect</td></tr></tbody></table><p>A synchronous side-effect can be converted into a ZIO effect using <code>ZIO.attempt</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">StdIn</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> getLine</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">StdIn</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error type of the resulting effect will always be <code>Throwable</code>, because side-effects may throw exceptions with any value of type <code>Throwable</code>.</p><p>If a given side-effect is known to not throw any exceptions, then the side-effect can be converted into a ZIO effect using <code>ZIO.succeed</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> printLine</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">println</span><span class="token punctuation">(</span><span class="token plain">line</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> succeedTask</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">java</span><span class="token punctuation">.</span><span class="token plain">lang</span><span class="token punctuation">.</span><span class="token plain">System</span><span class="token punctuation">.</span><span class="token plain">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We should be careful when using <code>ZIO.succeed</code>—when in doubt about whether or not a side-effect is total, prefer <code>ZIO.attempt</code> to convert the effect.</p><p>If this is too broad, the <code>refineOrDie</code> method of <code>ZIO</code> may be used to retain only certain types of exceptions, and to die on any other types of exceptions:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> printLine2</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">scala</span><span class="token punctuation">.</span><span class="token plain">io</span><span class="token punctuation">.</span><span class="token plain">StdIn</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">refineToOrDie</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="blocking-synchronous-side-effects">Blocking Synchronous Side-Effects<a class="hash-link" href="#blocking-synchronous-side-effects" title="Direct link to heading">​</a></h5><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>blocking</code></td><td><code>ZIO[R, E, A]</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>attemptBlocking</code></td><td><code>A</code></td><td><code>RIO[Blocking, A]</code></td></tr><tr><td><code>attemptBlockingCancelable</code></td><td><code>effect: =&gt; A</code>, <code>cancel: UIO[Unit]</code></td><td><code>RIO[Blocking, A]</code></td></tr><tr><td><code>attemptBlockingInterrupt</code></td><td><code>A</code></td><td><code>RIO[Blocking, A]</code></td></tr><tr><td><code>attemptBlockingIO</code></td><td><code>A</code></td><td><code>ZIO[Blocking, IOException, A]</code></td></tr></tbody></table><p>Some side-effects use blocking IO or otherwise put a thread into a waiting state. If not carefully managed, these side-effects can deplete threads from our application&#x27;s main thread pool, resulting in work starvation.</p><p>ZIO provides the <code>zio.blocking</code> package, which can be used to safely convert such blocking side-effects into ZIO effects.</p><p>A blocking side-effect can be converted directly into a ZIO effect blocking with the <code>attemptBlocking</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> sleeping </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain">Thread</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token builtin">Long</span><span class="token punctuation">.</span><span class="token plain">MaxValue</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The resulting effect will be executed on a separate thread pool designed specifically for blocking effects.</p><p>Blocking side-effects can be interrupted by invoking <code>Thread.interrupt</code> using the <code>attemptBlockingInterrupt</code> method.</p><p>Some blocking side-effects can only be interrupted by invoking a cancellation effect. We can convert these side-effects using the <code>attemptBlockingCancelable</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">net</span><span class="token namespace punctuation">.</span><span class="token plain">ServerSocket</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> accept</span><span class="token punctuation">(</span><span class="token plain">l</span><span class="token operator">:</span><span class="token plain"> ServerSocket</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlockingCancelable</span><span class="token punctuation">(</span><span class="token plain">l</span><span class="token punctuation">.</span><span class="token plain">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">l</span><span class="token punctuation">.</span><span class="token plain">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If a side-effect has already been converted into a ZIO effect, then instead of <code>attemptBlocking</code>, the <code>blocking</code> method can be used to ensure the effect will be executed on the blocking thread pool:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain"> Codec</span><span class="token punctuation">,</span><span class="token plain"> Source </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> download</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Source</span><span class="token punctuation">.</span><span class="token plain">fromURL</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">Codec</span><span class="token punctuation">.</span><span class="token plain">UTF8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mkString</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> safeDownload</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">blocking</span><span class="token punctuation">(</span><span class="token plain">download</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous">Asynchronous<a class="hash-link" href="#asynchronous" title="Direct link to heading">​</a></h4><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>async</code></td><td><code>(ZIO[R, E, A] =&gt; Unit) =&gt; Any</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>asyncZIO</code></td><td><code>(ZIO[R, E, A] =&gt; Unit) =&gt; ZIO[R, E, Any]</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>asyncMaybe</code></td><td><code>(ZIO[R, E, A] =&gt; Unit) =&gt; Option[ZIO[R, E, A]]</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>asyncInterrupt</code></td><td><code>(ZIO[R, E, A] =&gt; Unit) =&gt; Either[URIO[R, Any], ZIO[R, E, A]]</code></td><td><code>ZIO[R, E, A]</code></td></tr></tbody></table><p>An asynchronous side-effect with a callback-based API can be converted into a ZIO effect using <code>ZIO.async</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> legacy </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> login</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    onSuccess</span><span class="token operator">:</span><span class="token plain"> User </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    onFailure</span><span class="token operator">:</span><span class="token plain"> AuthError </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> login</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">AuthError</span><span class="token punctuation">,</span><span class="token plain"> User</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">async</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AuthError</span><span class="token punctuation">,</span><span class="token plain"> User</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> callback </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    legacy</span><span class="token punctuation">.</span><span class="token plain">login</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      user </span><span class="token keyword">=&gt;</span><span class="token plain"> callback</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      err  </span><span class="token keyword">=&gt;</span><span class="token plain"> callback</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Asynchronous ZIO effects are much easier to use than callback-based APIs, and they benefit from ZIO features like interruption, resource-safety, and superior error handling.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-suspended-effects">Creating Suspended Effects<a class="hash-link" href="#creating-suspended-effects" title="Direct link to heading">​</a></h3><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>suspend</code></td><td><code>RIO[R, A]</code></td><td><code>RIO[R, A]</code></td></tr><tr><td><code>suspendSucceed</code></td><td><code>ZIO[R, E, A]</code></td><td><code>ZIO[R, E, A]</code></td></tr></tbody></table><p>A <code>RIO[R, A]</code> effect can be suspended using <code>suspend</code> function:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> suspendedEffect</span><span class="token operator">:</span><span class="token plain"> RIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">suspend</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Suspended Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="control-flows">Control Flows<a class="hash-link" href="#control-flows" title="Direct link to heading">​</a></h2><p>Although we have access to built-in scala control flow structures, ZIO has several control flow combinators. In this section, we are going to introduce different ways of controlling flows in ZIO applications.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="if-expressions-and-operators">If Expressions and Operators<a class="hash-link" href="#if-expressions-and-operators" title="Direct link to heading">​</a></h3><p>When working with ZIO values, we can also work with built-in scala if-then-else expressions:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateWeightOption</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">weight </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">some</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">none</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, we can encode invalid inputs using the error channel:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateWeightOrFail</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">weight </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;negative input: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">weight</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even if the input has side effects, we can use <code>ZIO#flatMap</code> to access the raw value and write the if-then-else expression:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateWeightOrFailZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  weight</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> w </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">w </span><span class="token operator">&gt;=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">w</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;negative input: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">w</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also use ZIO&#x27;s combinators that are the moral equivalent to these expressions:</p><ol><li><strong><code>ZIO.when</code>/<code>ZIO#when</code></strong>— Instead of <code>if (p) expression</code> we can use the <code>ZIO.when</code> or <code>ZIO#when</code> operator:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateWeightOption</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">when</span><span class="token punctuation">(</span><span class="token plain">weight </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">weight</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the predicate is effectful, we can use <code>ZIO.whenZIO</code> or <code>ZIO#whenZIO</code> operators.</p><p>For example, the following function creates a random option of int value:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> randomIntOption</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> Option</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Random</span><span class="token punctuation">.</span><span class="token plain">nextInt</span><span class="token punctuation">.</span><span class="token plain">whenZIO</span><span class="token punctuation">(</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">nextBoolean</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Another nice variant of the <code>when</code> operator is <code>ZIO.whenCase</code> and also the <code>ZIO.whenCaseZIO</code>. Using these operators, we can run an effect when our provided effectful <code>PartialFunction</code> matches the given raw or effectful input. The important note regarding this operator is that it is safe, so it will do nothing if the value does not match.</p><p>Let&#x27;s try to write a game, which asks users to choose which game to play:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> minesweeper</span><span class="token punctuation">(</span><span class="token plain">level</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token plain">     </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> ticTacToe                      </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> snake</span><span class="token punctuation">(</span><span class="token plain">rows</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> columns</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">whenCaseZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token string">&quot;Please choose one game (minesweeper, snake, tictactoe)? &quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;minesweeper&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token string">&quot;Please enter the level of the game (easy/hard/medium)?&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">minesweeper</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;snake&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token string">&quot;Please enter the size of the game: &quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">mapAttempt</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flatMap</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token keyword">=&gt;</span><span class="token plain"> snake</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">,</span><span class="token plain"> n</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;tictactoe&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ticTacToe</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p><strong><code>ZIO.unless</code>/<code>ZIO#unless</code></strong>— These operators are like <code>when</code> operators, but they are moral equivalent for the <code>if (!p) expression</code> construct.</p></li><li><p><strong><code>ZIO#ifZIO</code></strong>— This operator takes an <em>effectful predicate</em>, if that predicate is evaluated to true, it will run the <code>onTrue</code> effect, otherwise it will run the <code>onFalse</code> effect.</p></li></ol><p>Let&#x27;s try to write a simple virtual flip function:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> flipTheCoin</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">ifZIO</span><span class="token punctuation">(</span><span class="token plain">Random</span><span class="token punctuation">.</span><span class="token plain">nextBoolean</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    onTrue </span><span class="token operator">=</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Head&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    onFalse </span><span class="token operator">=</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Tail&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loops">Loops<a class="hash-link" href="#loops" title="Direct link to heading">​</a></h3><p>In imperative scala code base, sometime we may use <code>while(condition) { statement }</code> or <code>do { statement } while (condition)</code> structs to perform loops:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> scala</span><span class="token punctuation">.</span><span class="token plain">App </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> printNumbers</span><span class="token punctuation">(</span><span class="token plain">from</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">var</span><span class="token plain"> i </span><span class="token operator">=</span><span class="token plain"> from</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">&lt;=</span><span class="token plain"> to</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      println</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">i</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      i </span><span class="token operator">=</span><span class="token plain"> i </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  printNumbers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But in functional scala, we tend to not use mutable variable. So to have a loop, we would like to use recursions. Let&#x27;s rewrite the previous example, using recursion:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">annotation</span><span class="token namespace punctuation">.</span><span class="token namespace">tailrec</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> scala</span><span class="token punctuation">.</span><span class="token plain">App </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token annotation punctuation">@tailrec</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> printNumbers</span><span class="token punctuation">(</span><span class="token plain">from</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">from </span><span class="token operator">&lt;=</span><span class="token plain"> to</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      println</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">from</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      printNumbers</span><span class="token punctuation">(</span><span class="token plain">from </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  printNumbers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example, we wrote a recursive function that prints numbers from 1 to 3. While the last effort doesn&#x27;t use a mutable variable, it&#x27;s not a pure solution. We have a <code>println</code> statement inside our solution, calling this function is not pure so the whole solution is not pure. We know that we can model effectful functions using the ZIO effect system. So let&#x27;s try rewrite that using ZIO:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> printNumbers</span><span class="token punctuation">(</span><span class="token plain">from</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">from </span><span class="token operator">&lt;=</span><span class="token plain"> to</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">from</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        printNumbers</span><span class="token punctuation">(</span><span class="token plain">from </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">else</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">unit</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> printNumbers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO provides some loop combinators that help us avoid the need to write explicit recursions. This means that we can do almost anything we want to do without using explicit recursions. Let&#x27;s rewrite the last solution using <code>ZIO.loopDiscard</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> printNumbers</span><span class="token punctuation">(</span><span class="token plain">from</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> to</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">loopDiscard</span><span class="token punctuation">(</span><span class="token plain">from</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> to</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token keyword">=&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain">i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> printNumbers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After this very short introduction to writing loops in functional scala, now let us go deep into ZIO specific combinators for writing loops:</p><ol><li><strong><code>ZIO.loop</code>/<code>ZIO.loopDiscard</code></strong>— It takes an initial state, then repeatedly change the state based on the given <code>inc</code> function, until the given <code>cont</code> function is evaluated to true:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> loop</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    initial</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> S</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">cont</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">,</span><span class="token plain"> inc</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> S</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">body</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> loopDiscard</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    initial</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> S</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">cont</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">,</span><span class="token plain"> inc</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> S</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">body</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZIO#loop</code> collects all intermediate states in a list and returns it finally, while the <code>loopDiscard</code> discards all results.</p><p>We can think of <code>ZIO#loop</code> as a moral equivalent of the following while loop:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">var</span><span class="token plain"> s  </span><span class="token operator">=</span><span class="token plain"> initial</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> as </span><span class="token operator">=</span><span class="token plain"> List</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">cont</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  as </span><span class="token operator">=</span><span class="token plain"> body</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">::</span><span class="token plain"> as</span><br></span><span class="token-line"><span class="token plain">  s  </span><span class="token operator">=</span><span class="token plain"> inc</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">as</span><span class="token punctuation">.</span><span class="token plain">reverse</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try some examples:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">loop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// List(1, 2, 3, 4, 5)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">loop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// List(2, 4, 6, 8, 10)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r3</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">loop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> index </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Currently at index </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">index</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 1</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 2</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 3</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// List((), (), (), (), ())</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r4</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">loopDiscard</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> index </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Currently at index </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">index</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 1</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 2</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 3</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 4</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// Currently at index 5</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// ()</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r5</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter three names: &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">loop</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> _ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> n </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string">. &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><strong><code>ZIO.iterate</code></strong>— To iterate with the given effectful operation we can use this combinator. During each iteration, it uses an effectful <code>body</code> operation to change the state, and it will continue the iteration while the <code>cont</code> function evaluates to true:</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> ZIO </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> iterate</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    initial</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> S</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">cont</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">body</span><span class="token operator">:</span><span class="token plain"> S </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> E</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This operator is a moral equivalent of the following while loop:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">var</span><span class="token plain"> s </span><span class="token operator">=</span><span class="token plain"> initial</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">cont</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  s </span><span class="token operator">=</span><span class="token plain"> body</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try some examples:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r1 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// 6</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> r2 </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">s </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here&#x27;s another example. Assume we want to take many names from the user using the terminal. We don&#x27;t know how many names the user is going to enter. We can ask the user to write &quot;exit&quot; when all inputs are finished. To write such an application, we can use recursion like below:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> getNames</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter all names&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot; (enter \&quot;exit\&quot; to indicate end of the list):&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">def</span><span class="token plain"> loop</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          names</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">names</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">length </span><span class="token string-interpolation interpolation expression operator">+</span><span class="token string-interpolation interpolation expression"> </span><span class="token string-interpolation interpolation expression number">1</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">. &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;exit&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">names</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> name   </span><span class="token keyword">=&gt;</span><span class="token plain"> loop</span><span class="token punctuation">(</span><span class="token plain">names</span><span class="token punctuation">.</span><span class="token plain">appended</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      loop</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Instead of manually writing recursions, we can rely on well-tested ZIO combinators. So let&#x27;s rewrite this application using the <code>ZIO.iterate</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> getNames</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter all names&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot; (enter \&quot;exit\&quot; to indicate end of the list):&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">iterate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">_2</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">names</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">names</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">length </span><span class="token string-interpolation interpolation expression operator">+</span><span class="token string-interpolation interpolation expression"> </span><span class="token string-interpolation interpolation expression number">1</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">. &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;exit&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">names</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> name   </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">names</span><span class="token punctuation">.</span><span class="token plain">appended</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">_1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that, in several cases, we can avoid these low-level operators and instead use the high-level ones. For example, let&#x27;s try to rewrite the <code>r5</code> with <code>ZIO.foreach</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Please enter three names:&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">foreach</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> index </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">print</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">index</span><span class="token string-interpolation string">. &quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="trycatchfinally">try/catch/finally<a class="hash-link" href="#trycatchfinally" title="Direct link to heading">​</a></h3><p>When working with resources, just like the scala&#x27;s <code>try</code>/<code>catch</code>/<code>finally</code> construct, in ZIO we have a similar operator called <code>acquireRelease</code> and also <code>ensuring</code>. We discussed them in more detail in the <a href="#resource-management">resource management section</a>. But, for now, we want to focus on their control flow behaviors.</p><p>Let&#x27;s learn about the <code>ZIO.acquireReleaseWith</code> operator. This operator takes three effects:</p><ol><li><strong><code>acquire</code></strong> an effect that describes the resource acquisition</li><li><strong><code>release</code></strong> an effect that describes the release of the resource</li><li><strong><code>use</code></strong> an effect that describes resource usage</li></ol><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">acquireReleaseWith</span><span class="token punctuation">(</span><span class="token plain">acquire </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">release </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">use </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This operator guarantees us that if the <em>resource acquisition (acquire)</em> the <em>release</em> effect will be executed whether the <em>use</em> effect succeeded or not:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">scala</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">Source</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> wordCount</span><span class="token punctuation">(</span><span class="token plain">fileName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> openFile</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> Source</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlockingIO</span><span class="token punctuation">(</span><span class="token plain">Source</span><span class="token punctuation">.</span><span class="token plain">fromFile</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> closeFile</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Source</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeedBlocking</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token punctuation">.</span><span class="token plain">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> wordCount</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Source</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token punctuation">.</span><span class="token plain">getLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">length</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">acquireReleaseWith</span><span class="token punctuation">(</span><span class="token plain">openFile</span><span class="token punctuation">(</span><span class="token plain">fileName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">closeFile</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">wordCount</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s try a simple <code>acquireRelease</code> workflow to see how its control flow works:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">acquireReleaseWith </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;resource&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">r </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">r</span><span class="token string-interpolation string"> acquired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> i </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;</span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">i</span><span class="token string-interpolation string"> released&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> i </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ZIO</span><span class="token punctuation">.</span><span class="token plain">debug</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;start using </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">i</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="blocking-operations">Blocking Operations<a class="hash-link" href="#blocking-operations" title="Direct link to heading">​</a></h2><p>ZIO provides access to a thread pool that can be used for performing blocking operations, such as thread sleeps, synchronous socket/file reads, and so forth.</p><p>By default, ZIO is asynchronous and all effects will be executed on a default primary thread pool which is optimized for asynchronous operations. As ZIO uses a fiber-based concurrency model, if we run <strong>Blocking I/O</strong> or <strong>CPU Work</strong> workloads on a primary thread pool, they are going to monopolize all threads of <strong>primary thread pool</strong>.</p><p>In the following example, we create 20 blocking tasks to run parallel on the primary async thread pool. Assume we have a machine with an 8 CPU core, so the ZIO creates a thread pool of size 16 (2 <!-- -->*<!-- --> 8). If we run this program, all of our threads got stuck, and the remaining 4 blocking tasks (20 - 16) haven&#x27;t any chance to run on our thread pool:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> blockingTask</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;running blocking task number </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">Thread</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    blockingTask</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> program </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">foreachPar</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token plain"> to </span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">toArray</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">blockingTask</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-blocking-effects">Creating Blocking Effects<a class="hash-link" href="#creating-blocking-effects" title="Direct link to heading">​</a></h3><p>ZIO has a separate <strong>blocking thread pool</strong> specially designed for <strong>Blocking I/O</strong> and, also <strong>CPU Work</strong> workloads. We should run blocking workloads on this thread pool to prevent interfering with the primary thread pool.</p><p>The contract is that the thread pool will accept unlimited tasks (up to the available memory) and continuously create new threads as necessary.</p><p>The <code>blocking</code> operator takes a ZIO effect and return another effect that is going to run on a blocking thread pool:</p><p>Also, we can directly import a synchronous effect that does blocking IO into ZIO effect by using <code>attemptBlocking</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> blockingTask</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">do</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    println</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Running blocking task number </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">n</span><span class="token string-interpolation string"> on dedicated blocking thread pool&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Thread</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interruption-of-blocking-operations">Interruption of Blocking Operations<a class="hash-link" href="#interruption-of-blocking-operations" title="Direct link to heading">​</a></h3><p>By default, when we convert a blocking operation into the ZIO effects using <code>attemptBlocking</code>, there is no guarantee that if that effect is interrupted the underlying effect will be interrupted.</p><p>Let&#x27;s create a blocking effect from an endless loop:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Starting a blocking operation&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fiber </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlocking </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Thread</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      println</span><span class="token punctuation">(</span><span class="token string">&quot;Doing some blocking operation&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;End of a blocking operation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Schedule</span><span class="token punctuation">.</span><span class="token plain">delayed</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Schedule</span><span class="token punctuation">.</span><span class="token plain">duration</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When we interrupt this loop after one second, it will still not stop. It will only stop when the entire JVM stops. So the <code>attemptBlocking</code> doesn&#x27;t translate the ZIO interruption into thread interruption (<code>Thread.interrupt</code>).</p><p>Instead, we should use <code>attemptBlockingInterrupt</code> to create interruptible blocking effects:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Starting a blocking operation&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  fiber </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlockingInterrupt </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Thread</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      println</span><span class="token punctuation">(</span><span class="token string">&quot;Doing some blocking operation&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">     Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;End of the blocking operation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span><span class="token-line"><span class="token plain">   </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">  _ </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    Schedule</span><span class="token punctuation">.</span><span class="token plain">delayed</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Schedule</span><span class="token punctuation">.</span><span class="token plain">duration</span><span class="token punctuation">(</span><span class="token number">3.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notes:</p><ol><li><p>If we are converting a blocking I/O to the ZIO effect, it would be better to use <code>attemptBlockingIO</code> which refines the error type to the <code>java.io.IOException</code>.</p></li><li><p>The <code>attemptBlockingInterrupt</code> method adds significant overhead. So for performance-sensitive applications, it is better to handle interruptions manually using <code>attemptBlockingCancelable</code>.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cancellation-of-blocking-operation">Cancellation of Blocking Operation<a class="hash-link" href="#cancellation-of-blocking-operation" title="Direct link to heading">​</a></h3><p>Some blocking operations do not respect <code>Thread#interrupt</code> by swallowing <code>InterruptedException</code>. So, they will not be interrupted via <code>attemptBlockingInterrupt</code>. Instead, they may provide us an API to signal them to <em>cancel</em> their operation.</p><p>The following <code>BlockingService</code> will not be interrupted in case of <code>Thread#interrupt</code> call, but it checks the <code>released</code> flag constantly. If this flag becomes true, the blocking service will finish its job:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">util</span><span class="token namespace punctuation">.</span><span class="token namespace">concurrent</span><span class="token namespace punctuation">.</span><span class="token namespace">atomic</span><span class="token namespace punctuation">.</span><span class="token plain">AtomicReference</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> BlockingService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> released </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> AtomicReference</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">released</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      println</span><span class="token punctuation">(</span><span class="token string">&quot;Doing some blocking operation&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">try</span><span class="token plain"> Thread</span><span class="token punctuation">.</span><span class="token plain">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token keyword">case</span><span class="token plain"> _</span><span class="token operator">:</span><span class="token plain"> InterruptedException </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// Swallowing InterruptedException</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    println</span><span class="token punctuation">(</span><span class="token string">&quot;Blocking operation closed.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    println</span><span class="token punctuation">(</span><span class="token string">&quot;Releasing resources and ready to be closed.&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    released</span><span class="token punctuation">.</span><span class="token plain">getAndSet</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So, to translate ZIO interruption into cancellation of these types of blocking operations we should use <code>attemptBlockingCancelable</code>. This method takes a <code>cancel</code> effect which is responsible to signal the blocking code to close itself when ZIO interruption occurs:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    service </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">BlockingService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    fiber   </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlockingCancelable</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      effect </span><span class="token operator">=</span><span class="token plain"> service</span><span class="token punctuation">.</span><span class="token plain">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      cancel </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">service</span><span class="token punctuation">.</span><span class="token plain">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    _       </span><span class="token keyword">&lt;-</span><span class="token plain"> fiber</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><span class="token punctuation">.</span><span class="token plain">schedule</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      Schedule</span><span class="token punctuation">.</span><span class="token plain">delayed</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Schedule</span><span class="token punctuation">.</span><span class="token plain">duration</span><span class="token punctuation">(</span><span class="token number">3.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is another example of the cancelation of a blocking operation. When we <code>accept</code> a server socket, this blocking operation will never be interrupted until we close that using <code>ServerSocket#close</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">net</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain">Socket</span><span class="token punctuation">,</span><span class="token plain"> ServerSocket</span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> accept</span><span class="token punctuation">(</span><span class="token plain">ss</span><span class="token operator">:</span><span class="token plain"> ServerSocket</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token plain">Socket</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attemptBlockingCancelable</span><span class="token punctuation">(</span><span class="token plain">ss</span><span class="token punctuation">.</span><span class="token plain">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">ss</span><span class="token punctuation">.</span><span class="token plain">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mapping">Mapping<a class="hash-link" href="#mapping" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="map">map<a class="hash-link" href="#map" title="Direct link to heading">​</a></h3><p>We can change an <code>IO[E, A]</code> to an <code>IO[E, B]</code> by calling the <code>map</code> method with a function <code>A =&gt; B</code>. This lets us transform values produced by actions into other values.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> mappedValue</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tapping">Tapping<a class="hash-link" href="#tapping" title="Direct link to heading">​</a></h2><p>Using <code>ZIO.tap</code> we can peek into a success value and perform any effectful operation, without changing the returning value of the original effect:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">trait</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tap</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> A </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> tapSome</span><span class="token punctuation">[</span><span class="token plain">R1 </span><span class="token operator">&lt;</span><span class="token operator">:</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> E1 </span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token plain"> E</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">f</span><span class="token operator">:</span><span class="token plain"> PartialFunction</span><span class="token punctuation">[</span><span class="token plain">A</span><span class="token punctuation">,</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">R1</span><span class="token punctuation">,</span><span class="token plain"> E1</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token plain">IOException</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> MainApp </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> isPrime</span><span class="token punctuation">(</span><span class="token plain">n</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">n </span><span class="token operator">&lt;=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token number">2</span><span class="token plain"> until n</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">forall</span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token keyword">=&gt;</span><span class="token plain"> n </span><span class="token operator">%</span><span class="token plain"> i </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      ref </span><span class="token keyword">&lt;-</span><span class="token plain"> Ref</span><span class="token punctuation">.</span><span class="token plain">make</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">.</span><span class="token plain">empty</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      prime </span><span class="token keyword">&lt;-</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        Random</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">nextIntBetween</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">.</span><span class="token plain">MaxValue</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">tap</span><span class="token punctuation">(</span><span class="token plain">random </span><span class="token keyword">=&gt;</span><span class="token plain"> ref</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">:</span><span class="token operator">+</span><span class="token plain"> random</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">repeatUntil</span><span class="token punctuation">(</span><span class="token plain">isPrime</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;found a prime number: </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">prime</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      tested </span><span class="token keyword">&lt;-</span><span class="token plain"> ref</span><span class="token punctuation">.</span><span class="token plain">get</span><br></span><span class="token-line"><span class="token plain">      _ </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;list of tested numbers: </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">tested</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">mkString</span><span class="token string-interpolation interpolation expression punctuation">(</span><span class="token string-interpolation interpolation expression string">&quot;, &quot;</span><span class="token string-interpolation interpolation expression punctuation">)</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">&quot;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myApp</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chaining">Chaining<a class="hash-link" href="#chaining" title="Direct link to heading">​</a></h2><p>We can execute two actions in sequence with the <code>flatMap</code> method. The second action may depend on the value produced by the first action.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> chainedActionsValue</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">List</span><span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">flatMap </span><span class="token punctuation">{</span><span class="token plain"> list </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">list</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the first effect fails, the callback passed to <code>flatMap</code> will never be invoked, and the composed effect returned by <code>flatMap</code> will also fail.</p><p>In <em>any</em> chain of effects, the first failure will short-circuit the whole chain, just like throwing an exception will prematurely exit a sequence of statements.</p><p>Because the <code>ZIO</code> data type supports both <code>flatMap</code> and <code>map</code>, we can use Scala&#x27;s <em>for comprehensions</em> to build sequential effects:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> program </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _    </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello! What is your name?&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    name </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span><span class="token-line"><span class="token plain">    _    </span><span class="token keyword">&lt;-</span><span class="token plain"> Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Hello, </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">name</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string">, welcome to ZIO!&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>For comprehensions</em> provide a more procedural syntax for composing chains of effects.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zipping">Zipping<a class="hash-link" href="#zipping" title="Direct link to heading">​</a></h2><p>We can combine two effects into a single effect with the <code>zip</code> method. The resulting effect succeeds with a tuple that contains the success values of both effects:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zipped</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zip</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that <code>zip</code> operates sequentially: the effect on the left side is executed before the effect on the right side.</p><p>In any <code>zip</code> operation, if either the left or right-hand sides fail, then the composed effect will fail, because <em>both</em> values are required to construct the tuple.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="zipleft-and-zipright">zipLeft and zipRight<a class="hash-link" href="#zipleft-and-zipright" title="Direct link to heading">​</a></h3><p>Sometimes, when the success value of an effect is not useful (for example, it is <code>Unit</code>), it can be more convenient to use the <code>zipLeft</code> or <code>zipRight</code> functions, which first perform a <code>zip</code>, and then map over the tuple to discard one side or the other:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zipRight1 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;What is your name?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zipRight</span><span class="token punctuation">(</span><span class="token plain">Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>zipRight</code> and <code>zipLeft</code> functions have symbolic aliases, known as <code>*&gt;</code> and <code>&lt;*</code>, respectively. Some developers find these operators easier to read:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> zipRight2 </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">printLine</span><span class="token punctuation">(</span><span class="token string">&quot;What is your name?&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Console</span><span class="token punctuation">.</span><span class="token plain">readLine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="parallelism">Parallelism<a class="hash-link" href="#parallelism" title="Direct link to heading">​</a></h2><p>ZIO provides many operations for performing effects in parallel. These methods are all named with a <code>Par</code> suffix that helps us identify opportunities to parallelize our code.</p><p>For example, the ordinary <code>ZIO#zip</code> method zips two effects together, sequentially. But there is also a <code>ZIO#zipPar</code> method, which zips two effects together in parallel.</p><p>The following table summarizes some of the sequential operations and their corresponding parallel versions:</p><table><thead><tr><th align="right"><strong>Description</strong></th><th align="center"><strong>Sequential</strong></th><th align="center"><strong>Parallel</strong></th></tr></thead><tbody><tr><td align="right">Zip two effects into one</td><td align="center"><code>ZIO#zip</code></td><td align="center"><code>ZIO#zipPar</code></td></tr><tr><td align="right">Zip two effects into one</td><td align="center"><code>ZIO#zipWith</code></td><td align="center"><code>ZIO#zipWithPar</code></td></tr><tr><td align="right">Collect from many effects</td><td align="center"><code>ZIO.collectAll</code></td><td align="center"><code>ZIO.collectAllPar</code></td></tr><tr><td align="right">Effectfully loop over values</td><td align="center"><code>ZIO.foreach</code></td><td align="center"><code>ZIO.foreachPar</code></td></tr><tr><td align="right">Reduce many values</td><td align="center"><code>ZIO.reduceAll</code></td><td align="center"><code>ZIO.reduceAllPar</code></td></tr><tr><td align="right">Merge many values</td><td align="center"><code>ZIO.mergeAll</code></td><td align="center"><code>ZIO.mergeAllPar</code></td></tr></tbody></table><p>For all the parallel operations, if one effect fails, then others will be interrupted, to minimize unnecessary computation.</p><p>If the fail-fast behavior is not desired, potentially failing effects can be first converted into infallible effects using the <code>ZIO#either</code> or <code>ZIO#option</code> methods.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="racing">Racing<a class="hash-link" href="#racing" title="Direct link to heading">​</a></h3><p>ZIO lets us race multiple effects in parallel, returning the first successful result:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  winner </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">race</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;Goodbye&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> winner</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we want the first success or failure, rather than the first success, then we can use <code>left.either race right.either</code>, for any effects <code>left</code> and <code>right</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="timeout">Timeout<a class="hash-link" href="#timeout" title="Direct link to heading">​</a></h2><p>ZIO lets us timeout any effect using the <code>ZIO#timeout</code> method, which returns a new effect that succeeds with an <code>Option</code>. A value of <code>None</code> indicates the timeout elapsed before the effect completed.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">timeout</span><span class="token punctuation">(</span><span class="token number">10.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If an effect times out, then instead of continuing to execute in the background, it will be interrupted so no resources will be wasted.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="error-management">Error Management<a class="hash-link" href="#error-management" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="either-1">Either<a class="hash-link" href="#either-1" title="Direct link to heading">​</a></h3><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>ZIO#either</code></td><td><code>ZIO[R, E, A]</code></td><td><code>URIO[R, Either[E, A]]</code></td></tr><tr><td><code>ZIO.absolve</code></td><td><code>ZIO[R, E, Either[E, A]]</code></td><td><code>ZIO[R, E, A]</code></td></tr></tbody></table><p>We can surface failures with <code>ZIO#either</code>, which takes a <code>ZIO[R, E, A]</code> and produces a <code>ZIO[R, Nothing, Either[E, A]]</code>.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> zeither</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">Either</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Uh oh!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">either</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can submerge failures with <code>ZIO.absolve</code>, which is the opposite of <code>either</code> and turns a <code>ZIO[R, Nothing, Either[E, A]]</code> into a <code>ZIO[R, E, A]</code>:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> sqrt</span><span class="token punctuation">(</span><span class="token plain">io</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">absolve</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    io</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">value </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token plain"> Left</span><span class="token punctuation">(</span><span class="token string">&quot;Value must be &gt;= 0.0&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">else</span><span class="token plain"> Right</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token plain">sqrt</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="catching">Catching<a class="hash-link" href="#catching" title="Direct link to heading">​</a></h3><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>ZIO#catchAll</code></td><td><code>E =&gt; ZIO[R1, E2, A1]</code></td><td><code>ZIO[R1, E2, A1]</code></td></tr><tr><td><code>ZIO#catchAllCause</code></td><td><code>Cause[E] =&gt; ZIO[R1, E2, A1]</code></td><td><code>ZIO[R1, E2, A1]</code></td></tr><tr><td><code>ZIO#catchAllDefect</code></td><td><code>Throwable =&gt; ZIO[R1, E1, A1]</code></td><td><code>ZIO[R1, E1, A1]</code></td></tr><tr><td><code>ZIO#catchAllTrace</code></td><td><code>((E, Option[StackTrace])) =&gt; ZIO[R1, E2, A1]</code></td><td><code>ZIO[R1, E2, A1]</code></td></tr><tr><td><code>ZIO#catchSome</code></td><td><code>PartialFunction[E, ZIO[R1, E1, A1]]</code></td><td><code>ZIO[R1, E1, A1]</code></td></tr><tr><td><code>ZIO#catchSomeCause</code></td><td><code>PartialFunction[Cause[E], ZIO[R1, E1, A1]]</code></td><td><code>ZIO[R1, E1, A1]</code></td></tr><tr><td><code>ZIO#catchSomeDefect</code></td><td><code>PartialFunction[Throwable, ZIO[R1, E1, A1]]</code></td><td><code>ZIO[R1, E1, A1]</code></td></tr><tr><td><code>ZIO#catchSomeTrace</code></td><td><code>PartialFunction[(E, Option[StackTrace]), ZIO[R1, E1, A1]]</code></td><td><code>ZIO[R1, E1, A1]</code></td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-all-errors">Catching All Errors<a class="hash-link" href="#catching-all-errors" title="Direct link to heading">​</a></h4><p>If we want to catch and recover from all types of errors and effectfully attempt recovery, we can use the <code>catchAll</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> z</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    readFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the callback passed to <code>catchAll</code>, we may return an effect with a different error type (or perhaps <code>Nothing</code>), which will be reflected in the type of effect returned by <code>catchAll</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="catching-some-errors">Catching Some Errors<a class="hash-link" href="#catching-some-errors" title="Direct link to heading">​</a></h4><p>If we want to catch and recover from only some types of exceptions and effectfully attempt recovery, we can use the <code>catchSome</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> data</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchSome </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> _ </span><span class="token operator">:</span><span class="token plain"> FileNotFoundException </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      readFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.data&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Unlike <code>catchAll</code>, <code>catchSome</code> cannot reduce or eliminate the error type, although it can widen the error type to a broader class of errors.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fallback">Fallback<a class="hash-link" href="#fallback" title="Direct link to heading">​</a></h3><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>orElse</code></td><td><code>ZIO[R1, E2, A1]</code></td><td><code>ZIO[R1, E2, A1]</code></td></tr><tr><td><code>orElseEither</code></td><td><code>ZIO[R1, E2, B]</code></td><td><code>ZIO[R1, E2, Either[A, B]]</code></td></tr><tr><td><code>orElseFail</code></td><td><code>E1</code></td><td><code>ZIO[R, E1, A]</code></td></tr><tr><td><code>orElseOptional</code></td><td><code>ZIO[R1, Option[E1], A1]</code></td><td><code>ZIO[R1, Option[E1], A1]</code></td></tr><tr><td><code>orElseSucceed</code></td><td><code>A1</code></td><td><code>URIO[R, A1]</code></td></tr></tbody></table><p>We can try one effect, or, if it fails, try another effect, with the <code>orElse</code> combinator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> primaryOrBackupData</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orElse</span><span class="token punctuation">(</span><span class="token plain">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;backup.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="folding">Folding<a class="hash-link" href="#folding" title="Direct link to heading">​</a></h3><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>fold</code></td><td><code>failure: E =&gt; B, success: A =&gt; B</code></td><td><code>URIO[R, B]</code></td></tr><tr><td><code>foldCause</code></td><td><code>failure: Cause[E] =&gt; B, success: A =&gt; B</code></td><td><code>URIO[R, B]</code></td></tr><tr><td><code>foldZIO</code></td><td><code>failure: E =&gt; ZIO[R1, E2, B], success: A =&gt; ZIO[R1, E2, B]</code></td><td><code>ZIO[R1, E2, B]</code></td></tr><tr><td><code>foldCauseZIO</code></td><td><code>failure: Cause[E] =&gt; ZIO[R1, E2, B], success: A =&gt; ZIO[R1, E2, B]</code></td><td><code>ZIO[R1, E2, B]</code></td></tr><tr><td><code>foldTraceZIO</code></td><td><code>failure: ((E, Option[StackTrace])) =&gt; ZIO[R1, E2, B], success: A =&gt; ZIO[R1, E2, B]</code></td><td><code>ZIO[R1, E2, B]</code></td></tr></tbody></table><p>Scala&#x27;s <code>Option</code> and <code>Either</code> data types have <code>fold</code>, which lets us handle both failure and success at the same time. In a similar fashion, <code>ZIO</code> effects also have several methods that allow us to handle both failure and success.</p><p>The first fold method, <code>fold</code>, lets us non-effectfully handle both failure and success by supplying a non-effectful handler for each case:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> DefaultData</span><span class="token operator">:</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> Array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> primaryOrDefaultData</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">fold</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _    </span><span class="token keyword">=&gt;</span><span class="token plain"> DefaultData</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    data </span><span class="token keyword">=&gt;</span><span class="token plain"> data</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The second fold method, <code>foldZIO</code>, lets us effectfully handle both failure and success by supplying an effectful (but still pure) handler for each case:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> primaryOrSecondaryData</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foldZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _    </span><span class="token keyword">=&gt;</span><span class="token plain"> readFile</span><span class="token punctuation">(</span><span class="token string">&quot;secondary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    data </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Nearly all error handling methods are defined in terms of <code>foldZIO</code>, because it is both powerful and fast.</p><p>In the following example, <code>foldZIO</code> is used to handle both failure and success of the <code>readUrls</code> method:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> urls</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token plain">Content</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readUrls</span><span class="token punctuation">(</span><span class="token string">&quot;urls.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">foldZIO</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    error   </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">NoContent</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    success </span><span class="token keyword">=&gt;</span><span class="token plain"> fetchContent</span><span class="token punctuation">(</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrying">Retrying<a class="hash-link" href="#retrying" title="Direct link to heading">​</a></h3><table><thead><tr><th>Function</th><th>Input Type</th><th>Output Type</th></tr></thead><tbody><tr><td><code>retry</code></td><td><code>Schedule[R1, E, S]</code></td><td><code>ZIO[R1, E, A]</code></td></tr><tr><td><code>retryN</code></td><td><code>n: Int</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>retryOrElse</code></td><td><code>policy: Schedule[R1, E, S], orElse: (E, S) =&gt; ZIO[R1, E1, A1]</code></td><td><code>ZIO[R1, E1, A1]</code></td></tr><tr><td><code>retryOrElseEither</code></td><td><code>schedule: Schedule[R1, E, Out], orElse: (E, Out) =&gt; ZIO[R1, E1, B]</code></td><td><code>ZIO[R1, E1, Either[B, A]]</code></td></tr><tr><td><code>retryUntil</code></td><td><code>E =&gt; Boolean</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>retryUntilEquals</code></td><td><code>E1</code></td><td><code>ZIO[R, E1, A]</code></td></tr><tr><td><code>retryUntilZIO</code></td><td><code>E =&gt; URIO[R1, Boolean]</code></td><td><code>ZIO[R1, E, A]</code></td></tr><tr><td><code>retryWhile</code></td><td><code>E =&gt; Boolean</code></td><td><code>ZIO[R, E, A]</code></td></tr><tr><td><code>retryWhileEquals</code></td><td><code>E1</code></td><td><code>ZIO[R, E1, A]</code></td></tr><tr><td><code>retryWhileZIO</code></td><td><code>E =&gt; URIO[R1, Boolean]</code></td><td><code>ZIO[R1, E, A]</code></td></tr></tbody></table><p>When we are building applications we want to be resilient in the face of a transient failure. This is where we need to retry to overcome these failures.</p><p>There are a number of useful methods on the ZIO data type for retrying failed effects.</p><p>The most basic of these is <code>ZIO#retry</code>, which takes a <code>Schedule</code> and returns a new effect that will retry the first effect if it fails according to the specified policy:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> retriedOpenFile</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> IOException</span><span class="token punctuation">,</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">retry</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">recurs</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The next most powerful function is <code>ZIO#retryOrElse</code>, which allows specification of a fallback to use if the effect does not succeed with the specified policy:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;primary.data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">retryOrElse</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Schedule</span><span class="token punctuation">.</span><span class="token plain">recurs</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> _</span><span class="token operator">:</span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">DefaultData</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The final method, <code>ZIO#retryOrElseEither</code>, allows returning a different type for the fallback.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resource-management">Resource Management<a class="hash-link" href="#resource-management" title="Direct link to heading">​</a></h2><p>ZIO&#x27;s resource management features work across synchronous, asynchronous, concurrent, and other effect types, and provide strong guarantees even in the presence of failure, interruption, or defects in the application.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="finalizing">Finalizing<a class="hash-link" href="#finalizing" title="Direct link to heading">​</a></h3><p>Scala has a <code>try</code> / <code>finally</code> construct which helps us to make sure we don&#x27;t leak resources because no matter what happens in the <code>try</code>, the <code>finally</code> block will be executed. So we can open files in the <code>try</code> block, and then we can close them in the <code>finally</code> block, and that gives us the guarantee that we will not leak resources.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-try--finally">Asynchronous Try / Finally<a class="hash-link" href="#asynchronous-try--finally" title="Direct link to heading">​</a></h4><p>The problem with the <code>try</code> / <code>finally</code> construct is that it only applies to synchronous code, meaning it doesn&#x27;t work for asynchronous code. ZIO gives us a method called <code>ensuring</code> that works with either synchronous or asynchronous actions. So we have a functional <code>try</code> / <code>finally</code> even for asynchronous regions of our code.</p><p>Like <code>try</code> / <code>finally</code>, the <code>ensuring</code> operation guarantees that if an effect begins executing and then terminates (for whatever reason), then the finalizer will begin executing:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finalizer </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">println</span><span class="token punctuation">(</span><span class="token string">&quot;Finalizing!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> finalized</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;Failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">finalizer</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The finalizer is not allowed to fail, which means that it must handle any errors internally.</p><p>Like <code>try</code> / <code>finally</code>, finalizers can be nested, and the failure of any inner finalizer will not affect outer finalizers. Nested finalizers will be executed in reverse order, and linearly (not in parallel).</p><p>Unlike <code>try</code> / <code>finally</code>, <code>ensuring</code> works across all types of effects, including asynchronous and concurrent effects.</p><p>Here is another example of ensuring that our clean-up action is called before our effect is done:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Task</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> i</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> action</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> Throwable</span><span class="token punctuation">(</span><span class="token string">&quot;Boom!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> cleanupAction</span><span class="token operator">:</span><span class="token plain"> UIO</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">i </span><span class="token operator">-=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> composite </span><span class="token operator">=</span><span class="token plain"> action</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">cleanupAction</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><em><strong>Note:</strong></em></p><p>Finalizers offer very powerful guarantees, but they are low-level, and should generally not be used for releasing resources. For higher-level logic built on <code>ensuring</code>, see <code>ZIO#acquireReleaseWith</code> in the acquire release section.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="unstoppable-finalizers">Unstoppable Finalizers<a class="hash-link" href="#unstoppable-finalizers" title="Direct link to heading">​</a></h4><p>In Scala when we nest <code>try</code> / <code>finally</code> finalizers, they cannot be stopped. If we have nested finalizers and one of them fails for some sort of catastrophic reason the ones on the outside will still be run and in the correct order.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">finally</span><span class="token plain"> f1</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">finally</span><span class="token plain"> f2</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">finally</span><span class="token plain"> f3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also in ZIO like <code>try</code> / <code>finally</code>, the finalizers are unstoppable. This means if we have a buggy finalizer that is going to leak some resources, we will leak the minimum amount of resources because all other finalizers will still be run in the correct order.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> io </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">io</span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">f1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"> </span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">f2</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"> </span><span class="token punctuation">.</span><span class="token plain">ensuring</span><span class="token punctuation">(</span><span class="token plain">f3</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="acquirerelease">AcquireRelease<a class="hash-link" href="#acquirerelease" title="Direct link to heading">​</a></h3><p>In Scala the <code>try</code> / <code>finally</code> is often used to manage resources. A common use for <code>try</code> / <code>finally</code> is safely acquiring and releasing resources, such as new socket connections or opened files:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> handle </span><span class="token operator">=</span><span class="token plain"> openFile</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  processFile</span><span class="token punctuation">(</span><span class="token plain">handle</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">finally</span><span class="token plain"> closeFile</span><span class="token punctuation">(</span><span class="token plain">handle</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO encapsulates this common pattern with <code>ZIO#acquireRelease</code>, which allows us to specify an <em>acquire</em> effect, which acquires a resource; a <em>release</em> effect, which releases it; and a <em>use</em> effect, which uses the resource. Acquire release lets us open a file and close the file and no matter what happens when we are using that resource.</p><p>The release action is guaranteed to be executed by the runtime system, even if the utilize action throws an exception or the executing fiber is interrupted.</p><p>Acquire release is a built-in primitive that let us safely acquire and release resources. It is used for a similar purpose as <code>try</code> / <code>catch</code> / <code>finally</code>, only acquire release work with synchronous and asynchronous actions, work seamlessly with fiber interruption, and is built on a different error model that ensures no errors are ever swallowed.</p><p>Acquire release consist of an <em>acquire</em> action, a <em>utilize</em> action (which uses the acquired resource), and a <em>release</em> action.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> groupedFileData</span><span class="token operator">:</span><span class="token plain"> IO</span><span class="token punctuation">[</span><span class="token plain">IOException</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">acquireReleaseWith</span><span class="token punctuation">(</span><span class="token plain">openFile</span><span class="token punctuation">(</span><span class="token string">&quot;data.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">closeFile</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> file </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    data    </span><span class="token keyword">&lt;-</span><span class="token plain"> decodeData</span><span class="token punctuation">(</span><span class="token plain">file</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    grouped </span><span class="token keyword">&lt;-</span><span class="token plain"> groupData</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> grouped</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Acquire releases have compositional semantics, so if an acquire release is nested inside another acquire release, and the outer resource is acquired, then the outer release will always be called, even if, for example, the inner release fails.</p><p>Let&#x27;s look at a full working example on using acquire release:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">io</span><span class="token namespace punctuation">.</span><span class="token punctuation">{</span><span class="token plain"> File</span><span class="token punctuation">,</span><span class="token plain"> FileInputStream </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">java</span><span class="token namespace punctuation">.</span><span class="token namespace">nio</span><span class="token namespace punctuation">.</span><span class="token namespace">charset</span><span class="token namespace punctuation">.</span><span class="token plain">StandardCharsets</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">object</span><span class="token plain"> Main </span><span class="token keyword">extends</span><span class="token plain"> ZIOAppDefault </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// run my acquire release</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> run </span><span class="token operator">=</span><span class="token plain"> myAcquireRelease</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> closeStream</span><span class="token punctuation">(</span><span class="token plain">is</span><span class="token operator">:</span><span class="token plain"> FileInputStream</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">is</span><span class="token punctuation">.</span><span class="token plain">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">def</span><span class="token plain"> convertBytes</span><span class="token punctuation">(</span><span class="token plain">is</span><span class="token operator">:</span><span class="token plain"> FileInputStream</span><span class="token punctuation">,</span><span class="token plain"> len</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Long</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token keyword">val</span><span class="token plain"> buffer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> Array</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">len</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      is</span><span class="token punctuation">.</span><span class="token plain">read</span><span class="token punctuation">(</span><span class="token plain">buffer</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      println</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">(</span><span class="token plain">buffer</span><span class="token punctuation">,</span><span class="token plain"> StandardCharsets</span><span class="token punctuation">.</span><span class="token plain">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// myAcquireRelease is just a value. Won&#x27;t execute anything here until interpreted</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> myAcquireRelease</span><span class="token operator">:</span><span class="token plain"> Task</span><span class="token punctuation">[</span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    file   </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> File</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp/hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    len    </span><span class="token operator">=</span><span class="token plain"> file</span><span class="token punctuation">.</span><span class="token plain">length</span><br></span><span class="token-line"><span class="token plain">    string </span><span class="token keyword">&lt;-</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">acquireReleaseWith</span><span class="token punctuation">(</span><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token plain"> FileInputStream</span><span class="token punctuation">(</span><span class="token plain">file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">closeStream</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">convertBytes</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">,</span><span class="token plain"> len</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> string</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zio-aspect">ZIO Aspect<a class="hash-link" href="#zio-aspect" title="Direct link to heading">​</a></h2><p>There are two types of concerns in an application, <em>core concerns</em>, and <em>cross-cutting concerns</em>. Cross-cutting concerns are shared among different parts of our application. We usually find them scattered and duplicated across our application, or they are tangled up with our primary concerns. This reduces the level of modularity of our programs.</p><p>A cross-cutting concern is more about <em>how</em> we do something than <em>what</em> we are doing. For example, when we are downloading a bunch of files, creating a socket to download each one is the core concern because it is a question of <em>what</em> rather than the <em>how</em>, but the following concerns are cross-cutting ones:</p><ul><li>Downloading files <em>sequentially</em> or in <em>parallel</em></li><li><em>Retrying</em> and <em>timing out</em> the download process</li><li><em>Logging</em> and <em>monitoring</em> the download process</li></ul><p>So they don&#x27;t affect the return type of our workflows, but they add some new aspects or change their behavior.</p><p>To increase the modularity of our applications, we can separate cross-cutting concerns from the main logic of our programs. ZIO supports this programming paradigm, which is called <em> aspect-oriented programming</em>.</p><p>The <code>ZIO</code> effect has a data type called <code>ZIOAspect</code>, which allows modifying a <code>ZIO</code> effect and convert it into a specialized <code>ZIO</code> effect. We can add a new aspect to a <code>ZIO</code> effect with <code>@@</code> syntax like this:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> myApp</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZIO</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token plain"> @@ ZIOAspect</span><span class="token punctuation">.</span><span class="token plain">debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As we see, the <code>debug</code> aspect doesn&#x27;t change the return type of our effect, but it adds a new debugging aspect to our effect.</p><p><code>ZIOAspect</code> is like a transformer of the <code>ZIO</code> effect, which takes a <code>ZIO</code> effect and converts it to another <code>ZIO</code> effect. We can think of a <code>ZIOAspect</code> as a function of type <code>ZIO[R, E, A] =&gt; ZIO[R, E, A]</code>.</p><p>To compose multiple aspects, we can use <code>@@</code> operator:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> download</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> Chunk</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO</span><span class="token punctuation">.</span><span class="token plain">foreachPar</span><span class="token punctuation">(</span><span class="token plain">List</span><span class="token punctuation">(</span><span class="token string">&quot;zio.dev&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;google.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> url </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  download</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token plain"> @@</span><br></span><span class="token-line"><span class="token plain">    ZIOAspect</span><span class="token punctuation">.</span><span class="token plain">retry</span><span class="token punctuation">(</span><span class="token plain">Schedule</span><span class="token punctuation">.</span><span class="token plain">fibonacci</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token plain">seconds</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> @@</span><br></span><span class="token-line"><span class="token plain">    ZIOAspect</span><span class="token punctuation">.</span><span class="token plain">loggedWith</span><span class="token punctuation">[</span><span class="token plain">Chunk</span><span class="token punctuation">[</span><span class="token builtin">Byte</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">file </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Downloaded </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">url</span><span class="token string-interpolation string"> file with size of </span><span class="token string-interpolation interpolation punctuation">${</span><span class="token string-interpolation interpolation expression">file</span><span class="token string-interpolation interpolation expression punctuation">.</span><span class="token string-interpolation interpolation expression">length</span><span class="token string-interpolation interpolation punctuation">}</span><span class="token string-interpolation string"> bytes&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The order of aspect composition matters. Therefore, if we change the order, the behavior may change.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/reference/core/zio/zio.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference/core/zio/uio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">UIO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creation" class="table-of-contents__link toc-highlight">Creation</a><ul><li><a href="#success-values" class="table-of-contents__link toc-highlight">Success Values</a></li><li><a href="#failure-values" class="table-of-contents__link toc-highlight">Failure Values</a></li><li><a href="#from-values" class="table-of-contents__link toc-highlight">From Values</a></li><li><a href="#from-side-effects" class="table-of-contents__link toc-highlight">From Side-Effects</a></li><li><a href="#creating-suspended-effects" class="table-of-contents__link toc-highlight">Creating Suspended Effects</a></li></ul></li><li><a href="#control-flows" class="table-of-contents__link toc-highlight">Control Flows</a><ul><li><a href="#if-expressions-and-operators" class="table-of-contents__link toc-highlight">If Expressions and Operators</a></li><li><a href="#loops" class="table-of-contents__link toc-highlight">Loops</a></li><li><a href="#trycatchfinally" class="table-of-contents__link toc-highlight">try/catch/finally</a></li></ul></li><li><a href="#blocking-operations" class="table-of-contents__link toc-highlight">Blocking Operations</a><ul><li><a href="#creating-blocking-effects" class="table-of-contents__link toc-highlight">Creating Blocking Effects</a></li><li><a href="#interruption-of-blocking-operations" class="table-of-contents__link toc-highlight">Interruption of Blocking Operations</a></li><li><a href="#cancellation-of-blocking-operation" class="table-of-contents__link toc-highlight">Cancellation of Blocking Operation</a></li></ul></li><li><a href="#mapping" class="table-of-contents__link toc-highlight">Mapping</a><ul><li><a href="#map" class="table-of-contents__link toc-highlight">map</a></li></ul></li><li><a href="#tapping" class="table-of-contents__link toc-highlight">Tapping</a></li><li><a href="#chaining" class="table-of-contents__link toc-highlight">Chaining</a></li><li><a href="#zipping" class="table-of-contents__link toc-highlight">Zipping</a><ul><li><a href="#zipleft-and-zipright" class="table-of-contents__link toc-highlight">zipLeft and zipRight</a></li></ul></li><li><a href="#parallelism" class="table-of-contents__link toc-highlight">Parallelism</a><ul><li><a href="#racing" class="table-of-contents__link toc-highlight">Racing</a></li></ul></li><li><a href="#timeout" class="table-of-contents__link toc-highlight">Timeout</a></li><li><a href="#error-management" class="table-of-contents__link toc-highlight">Error Management</a><ul><li><a href="#either-1" class="table-of-contents__link toc-highlight">Either</a></li><li><a href="#catching" class="table-of-contents__link toc-highlight">Catching</a></li><li><a href="#fallback" class="table-of-contents__link toc-highlight">Fallback</a></li><li><a href="#folding" class="table-of-contents__link toc-highlight">Folding</a></li><li><a href="#retrying" class="table-of-contents__link toc-highlight">Retrying</a></li></ul></li><li><a href="#resource-management" class="table-of-contents__link toc-highlight">Resource Management</a><ul><li><a href="#finalizing" class="table-of-contents__link toc-highlight">Finalizing</a></li><li><a href="#acquirerelease" class="table-of-contents__link toc-highlight">AcquireRelease</a></li></ul></li><li><a href="#zio-aspect" class="table-of-contents__link toc-highlight">ZIO Aspect</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.e3e035e3.js"></script>
<script src="/assets/js/main.5d367137.js"></script>
</body>
</html>