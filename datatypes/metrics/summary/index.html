<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">Summary | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/datatypes/metrics/summary"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Summary | ZIO"><meta data-react-helmet="true" name="description" content="A Summary represents a sliding window of a time series along with metrics for certain percentiles of the time series, referred to as quantiles."><meta data-react-helmet="true" property="og:description" content="A Summary represents a sliding window of a time series along with metrics for certain percentiles of the time series, referred to as quantiles."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/datatypes/metrics/summary"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/datatypes/metrics/summary" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/datatypes/metrics/summary" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.c1d60d2d.css">
<link rel="preload" href="/assets/js/runtime~main.9ec2f6f2.js" as="script">
<link rel="preload" href="/assets/js/main.aa9aa3fa.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/overview_index">Overview</a><a class="navbar__item navbar__link" href="/datatypes/index">Data Types</a><a class="navbar__item navbar__link" href="/usecases/usecases_index">Use Cases</a><a class="navbar__item navbar__link" href="/howto/index">How to</a><a class="navbar__item navbar__link" href="/resources/index">Resources</a><a class="navbar__item navbar__link" href="/about/index">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/overview/overview_index">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/datatypes/metrics/summary">ZIO 2.x</a></li><li><a class="dropdown__link" href="/1.x/overview/overview_index">ZIO 1.x</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Core Data Types</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contextual Types</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concurrency</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Resource Safety</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Streaming</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Metrics</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/datatypes/metrics/index">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Metric Types</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/datatypes/metrics/counter">Counter</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/datatypes/metrics/gauge">Gauge</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/datatypes/metrics/histogram">Histogram</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/datatypes/metrics/summary">Summary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/datatypes/metrics/setcount">SetCount</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/datatypes/metrics/metriclabel">MetricLabel</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Miscellaneous</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: ZIO 2.x</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Summary</h1></header><p>A <code>Summary</code> represents a sliding window of a time series along with metrics for certain percentiles of the time series, referred to as quantiles.</p><p>Quantiles describe specified percentiles of the sliding window that are of interest. For example, if we were using a summary to track the response time for requests over the last hour then we might be interested in the 50th percentile, 90th percentile, 95th percentile, and 99th percentile for response times.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="internals"></a>Internals<a class="hash-link" href="#internals" title="Direct link to heading">#</a></h2><p>Similar to a <a href="/datatypes/metrics/histogram">histogram</a> a summary also observes <em>Double</em> values. While a histogram directly modifies the bucket counters and does not keep the individual samples, the summary keeps the observed samples in its internal state. To avoid the set of samples grow uncontrolled, the summary needs to be configured with a maximum age <code>t</code> and a maximum size <code>n</code>. To calculate the statistics, maximal <code>n</code> samples will be used, all of which are not older than <code>t</code>.</p><p>Essentially, the set of samples is a <em>sliding window</em> over the last observed samples matching the conditions above.</p><p>A summary is used to calculate a set of quantiles over the current set of samples. A quantile is defined by a <em>Double</em> value <code>q</code> with <code>0 &lt;= q &lt;= 1</code> and resolves to a <code>Double</code> as well.</p><p>The value of a given quantile <code>q</code> is the maximum value <code>v</code> out of the current sample buffer with size <code>n</code> where at most <code>q * n</code> values out of the sample buffer are less or equal to <code>v</code>.</p><p>Typical quantiles for observation are <code>0.5</code> (the median) and the <code>0.95</code>. Quantiles are very good for monitoring <em>Service Level Agreements</em>.</p><p>The ZIO Metrics API also allows summaries to be configured with an error margin <code>e</code>. The error margin is applied to the count of values, so that a quantile <code>q</code> for a set of size <code>s</code> resolves to value <code>v</code> if the number <code>n</code> of values less or equal to <code>v</code> is <code>(1 -e)q * s &lt;= n &lt;= (1+e)q</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="api"></a>API<a class="hash-link" href="#api" title="Direct link to heading">#</a></h2><p><strong><code>observeSummary</code></strong> â€” A metric aspect that adds a value to a summary each time the effect it is applied to succeeds. This aspect can be applied to effects producing a <code>Double</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar"><code class="codeBlockLines_39YC"><span class="token-line"><span class="token plain">def observeSummary(</span></span><span class="token-line"><span class="token plain">  name: String,</span></span><span class="token-line"><span class="token plain">  maxAge: Duration,</span></span><span class="token-line"><span class="token plain">  maxSize: Int,</span></span><span class="token-line"><span class="token plain">  error: Double,</span></span><span class="token-line"><span class="token plain">  quantiles: Chunk[Double],</span></span><span class="token-line"><span class="token plain">  tags: MetricLabel*</span></span><span class="token-line"><span class="token plain">): Summary[Double]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong><code>observeSummaryWith</code></strong> â€” A metric aspect that adds a value to a summary each time the effect it is applied to succeeds, using the specified function to transform the value returned by the effect to the value to add to the summary.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar"><code class="codeBlockLines_39YC"><span class="token-line"><span class="token plain">def observeSummaryWith[A](</span></span><span class="token-line"><span class="token plain">  name: String,</span></span><span class="token-line"><span class="token plain">  maxAge: Duration,</span></span><span class="token-line"><span class="token plain">  maxSize: Int,</span></span><span class="token-line"><span class="token plain">  error: Double,</span></span><span class="token-line"><span class="token plain">  quantiles: Chunk[Double],</span></span><span class="token-line"><span class="token plain">  tags: MetricLabel*</span></span><span class="token-line"><span class="token plain">)(f: A =&gt; Double): Summary[A]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="use-cases"></a>Use Cases<a class="hash-link" href="#use-cases" title="Direct link to heading">#</a></h2><p>Like <a href="/datatypes/metrics/histogram">histograms</a>, summaries are used for <em>monitoring latencies</em>, but they don&#x27;t require us to define buckets. So, summaries are the best choice in these situations:</p><ul><li>When histograms are not proper for us, in terms of accuracy</li><li>When we can&#x27;t use histograms, as we don&#x27;t have a good estimation of the range of values</li><li>When we don&#x27;t need to perform aggregation or averages across multiple instances, as the calculations are done on the application side</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="examples"></a>Examples<a class="hash-link" href="#examples" title="Direct link to heading">#</a></h2><p>Create a summary that can hold <code>100</code> samples, the max age of the samples is <code>1 day</code> and the error margin is <code>3%</code>. The summary should report the <code>10%</code>, <code>50%</code> and <code>90%</code> Quantile. It can be applied to effects yielding an <code>Int</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar"><code class="codeBlockLines_39YC"><span class="token-line"><span class="token plain">import zio._</span></span><span class="token-line"><span class="token plain">val summary =</span></span><span class="token-line"><span class="token plain">  ZIOMetric.observeSummaryWith[Int](</span></span><span class="token-line"><span class="token plain">    name = &quot;mySummary&quot;, </span></span><span class="token-line"><span class="token plain">    maxAge = 1.day,</span></span><span class="token-line"><span class="token plain">    maxSize = 100,</span></span><span class="token-line"><span class="token plain">    error = 0.03d, </span></span><span class="token-line"><span class="token plain">    quantiles = Chunk(0.1, 0.5, 0.9)</span></span><span class="token-line"><span class="token plain">  )(_.toDouble)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now we can apply this aspect to an effect producing an <code>Int</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar"><code class="codeBlockLines_39YC"><span class="token-line"><span class="token plain">Random.nextIntBetween(100, 500) @@ summary</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/datatypes/metrics/histogram"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Histogram</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/datatypes/metrics/setcount"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SetCount Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#internals" class="table-of-contents__link">Internals</a></li><li><a href="#api" class="table-of-contents__link">API</a></li><li><a href="#use-cases" class="table-of-contents__link">Use Cases</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="/api/zio/" target="_blank">Latest Scaladoc of ZIO</a></li><li class="footer__item"><a href="/api-1.x/zio/" target="_blank">Scaladoc of ZIO-1.x</a></li><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc on javadoc.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.9ec2f6f2.js"></script>
<script src="/assets/js/main.aa9aa3fa.js"></script>
</body>
</html>