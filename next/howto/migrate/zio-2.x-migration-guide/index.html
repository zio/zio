<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">ZIO 2.x Migration Guide | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/next/howto/migrate/zio-2.x-migration-guide"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="ZIO 2.x Migration Guide | ZIO"><meta data-react-helmet="true" name="description" content="In this guide we want to introduce the migration process to ZIO 2.x. So if you have a project written in ZIO 1.x and want to migrate that to ZIO 2.x, this article is for you."><meta data-react-helmet="true" property="og:description" content="In this guide we want to introduce the migration process to ZIO 2.x. So if you have a project written in ZIO 1.x and want to migrate that to ZIO 2.x, this article is for you."><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/next/howto/migrate/zio-2.x-migration-guide"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/howto/migrate/zio-2.x-migration-guide" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/howto/migrate/zio-2.x-migration-guide" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.6feee118.css">
<link rel="preload" href="/assets/js/runtime~main.183b2960.js" as="script">
<link rel="preload" href="/assets/js/main.eb82bc51.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/version-1.x/overview/">Overview</a><a class="navbar__item navbar__link" href="/version-1.x/datatypes/">Data Types</a><a class="navbar__item navbar__link" href="/version-1.x/usecases/">Use Cases</a><a class="navbar__item navbar__link" href="/version-1.x/howto/">How to</a><a class="navbar__item navbar__link" href="/version-1.x/resources/">Resources</a><a class="navbar__item navbar__link" href="/version-1.x/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/next/overview/">ZIO 2.x (WIP)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/howto/migrate/zio-2.x-migration-guide">ZIO 2.x (WIP)</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/howto/">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/howto/handle-errors">How to</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/howto/interop/with-cats-effect">Interop</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/next/howto/migrate/from-monix">Migrate</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/howto/migrate/from-monix">How to Migrate from Monix to ZIO?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/howto/migrate/zio-2.x-migration-guide">ZIO 2.x Migration Guide</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->ZIO<!-- --> <b>ZIO 2.x (WIP)</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/version-1.x/overview/">latest version</a></b> (<!-- -->ZIO 1.x<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->ZIO 2.x (WIP)</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZIO 2.x Migration Guide</h1></header><p>In this guide we want to introduce the migration process to ZIO 2.x. So if you have a project written in ZIO 1.x and want to migrate that to ZIO 2.x, this article is for you. </p><p>Before you migrate your own codebase, confirm that all of your ZIO-related dependencies have been migrated to ZIO 2.x with our <a href="https://zio-ecosystem.herokuapp.com/" target="_blank" rel="noopener noreferrer">ZIO Ecosystem Tool</a>.</p><p>ZIO uses the <a href="https://scalacenter.github.io/scalafix/" target="_blank" rel="noopener noreferrer">Scalafix</a> for automatic migration. Scalafix is a code migration tool that takes a rewrite rule and reads the source code, converting deprecated features to newer ones, and then writing the result back to the source code. </p><p>ZIO has a migration rule named <code>Zio2Upgrade</code> which migrates a ZIO 1.x code base to the ZIO 2.x. This migration rule covers most of the changes. Therefore, to migrate a ZIO project to 2.x, we prefer to apply the <code>Zio2Upgrade</code> rule to the existing code. After that, we can go to the source code and fix the remaining compilation issues:</p><ol><li><p>First, we should ensure that all of our direct and transitive dependencies <a href="https://zio-ecosystem.herokuapp.com/" target="_blank" rel="noopener noreferrer">have released their compatible versions with ZIO 2.x</a>. Note that we shouldn&#x27;t update our dependencies to the 2.x compatible versions, before running scalafix.</p></li><li><p>Next, we need to install the <a href="https://github.com/scalacenter/sbt-scalafix" target="_blank" rel="noopener noreferrer">Scalafix SBT Plugin</a>, by adding the following line into <code>project/plugins.sbt</code> file:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">// project/plugins.sbt</span><br></span><span class="token-line"><span class="token plain">addSbtPlugin(&quot;ch.epfl.scala&quot; % &quot;sbt-scalafix&quot; % &quot;&lt;version&gt;&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>We are ready to apply the migration rule:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">sbt </span><span class="token string">&quot;scalafixEnable; scalafixAll github:zio/zio/Zio2Upgrade?sha=series/2.x&quot;</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>After running scalafix, it&#x27;s time to upgrade ZIO dependencies. If we are using one of the following dependencies, we need to bump them into the <code>2.x</code> version:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio&quot;         % &quot;2.0.0&quot;</span><br></span><span class="token-line"><span class="token plain">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-streams&quot; % &quot;2.0.0&quot;</span><br></span><span class="token-line"><span class="token plain">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-test&quot;    % &quot;2.0.0&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Other than ZIO, we should upgrade all other (official or community) ZIO libraries we are using in our <code>build.sbt</code> file.</p></li><li><p>Now, we have performed most of the migration. Finally, we should fix the remaining compilation errors with the help of the remaining sections in this article.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="guidelines-for-library-authors">Guidelines for Library Authors<a class="hash-link" href="#guidelines-for-library-authors" title="Direct link to heading">â€‹</a></h2><p>As a contributor to ZIO ecosystem libraries, we also should cover these guidelines:</p><ol><li>We should add <em>implicit trace parameter</em> to all our codebase, this prevents the guts of our library from messing up the user&#x27;s execution trace. </li></ol><p>Let&#x27;s see an example of that in the ZIO source code:</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">trait ZIO[-R, +E, +A] {</span><br></span><span class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  def map[B](f: A =&gt; B): ZIO[R, E, B] =</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    flatMap(a =&gt; ZIO.succeedNow(f(a)))</span><br></span><span class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  def map[B](f: A =&gt; B)(implicit trace: ZTraceElement): ZIO[R, E, B] = </span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">    flatMap(a =&gt; ZIO.succeedNow(f(a)))</span><br></span><span class="token-line"><span class="token unchanged line"></span><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Assume we have written the <code>FooLibrary</code> as below:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object FooLibrary {</span><br></span><span class="token-line"><span class="token plain">  def foo = bar.flatMap(x =&gt; ZIO.succeed(x * 2))  // line 4</span><br></span><span class="token-line"><span class="token plain">  private def bar = baz.flatMap(x =&gt; ZIO.succeed(x * x))  // line 5</span><br></span><span class="token-line"><span class="token plain">  private def baz = ZIO.fail(&quot;Oh uh!&quot;).as(5)              // line 6</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Without <em>implicit trace parameter</em>, the user of our library will get so many unrelated stack trace messages:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MainApp extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  def run = FooLibrary.foo</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To avoid messing up our user&#x27;s execution trace, we should add implicit trace parameters to our methods:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object FooLibrary {</span><br></span><span class="token-line"><span class="token plain">  def foo(implicit trace: ZTraceElement) = bar.flatMap(x =&gt; ZIO.succeed(x * 2))</span><br></span><span class="token-line"><span class="token plain">  private def bar(implicit trace: ZTraceElement) = baz.flatMap(x =&gt; ZIO.succeed(x * x))</span><br></span><span class="token-line"><span class="token plain">  private def baz(implicit trace: ZTraceElement) = ZIO.fail(&quot;Oh uh!&quot;).as(5)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MainApp extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  def run = FooLibrary.foo // line 10</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="2"><li><p>All parameters to operators returning an effect <a href="#lazy-evaluation-of-parameters">should be by-name</a>. Also, we should be sure to capture any parameters that are referenced more than once as a lazy val in our implementation to prevent <em>double evaluation</em>. </p><p>The overall pattern in implementing such methods will be:</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> def foreachParN[A](n: Int)(a: Iterable[A]) = {</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">   ... // The function body</span><br></span><span class="token-line"><span class="token unchanged line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> }</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> def foreachParN[A](n0: =&gt; Int)(a0: =&gt; Iterable[A]) = </span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   ZIO.suspendSucceed {</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    val n = n0 </span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    val a = a0</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token unchanged prefix unchanged"> </span><span class="token unchanged line">     ... // The function body</span><br></span><span class="token-line"><span class="token unchanged line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As a result, the code will be robust to <em>double evaluation</em> as well as to <em>side-effects embedded within parameters</em>.</p></li><li><p>We should update names to match <a href="#zio-20-naming-conventions">ZIO 2.0 naming conventions</a>.</p></li><li><p>ZIO 2.0 introduced <a href="#compositional-concurrency">new structured concurrently operators</a> which helps us to change the regional parallelism settings of our application. So if applicable, we should use these operators instead of the old parallel operators.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="has">Has<a class="hash-link" href="#has" title="Direct link to heading">â€‹</a></h2><p>The Has data type, which was used for combining services, was removed. Therefore, we no longer need to wrap services in the <code>Has</code> data type.</p><p>For example, in the ZIO 1.x, the following layer denotes this layer requires <code>Logging</code>, <code>Random</code>, <code>Database</code> and produce the <code>UserRepo</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val userRepo: ZLayer[Has[Logging] with Has[Random] with Has[Database], Throwable, Has[UserRepo]] = ???</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 2.x, the <code>Has</code> has been removed and simplified for better ergonomics:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val userRepo: ZLayer[Logging with Random with Database, Throwable, UserRepo] = ???</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Also in ZIO 2.x instead of the <code>Has</code> data type, a type-level map called <code>ZEnvironment</code> backed into the ZIO. Let&#x27;s see how this changes the way we can provide a service to the environment.</p><p>Using the following code snippet, we demonstrate how we used to access and provide instances of <code>Config</code> service to the application environment using ZIO 1.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">// ZIO 1.x</span><br></span><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class Config(url: String, port: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ConfigExample extends zio.App {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val app: ZIO[Has[console.Console.Service] with Has[Config], Nothing, Unit] = for {</span><br></span><span class="token-line"><span class="token plain">    config &lt;- ZIO.service[Config]</span><br></span><span class="token-line"><span class="token plain">    _      &lt;- console.putStrLn(s&quot;application config: $config&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): URIO[zio.ZEnv, ExitCode] = {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">    app.provideSome[Has[console.Console.Service]](_ ++ Has(Config(&quot;localhost&quot;, 8080))).exitCode</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To migrate this snippet to ZIO 2.x, we need to remove all the <code>Has</code> service wrappers, and finally, we will use the <code>ZIO#provideSomeEnvironment</code> method to append the <code>Config</code> instance to the <code>ZEnvironment</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">// ZIO 2.x</span><br></span><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class Config(url: String, port: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ConfigExample extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  val app: ZIO[Config, Nothing, Unit] = for {</span><br></span><span class="token-line"><span class="token plain">    config &lt;- ZIO.service[Config]</span><br></span><span class="token-line"><span class="token plain">    _      &lt;- Console.printLine(s&quot;application config: $config&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">  def run = </span><br></span><span class="token-line"><span class="token plain">    app.provideEnvironment(ZEnvironment(Config(&quot;localhost&quot;, 8080)))</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="zio">ZIO<a class="hash-link" href="#zio" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="removed-methods">Removed Methods<a class="hash-link" href="#removed-methods" title="Direct link to heading">â€‹</a></h3><p><strong>Arrow Combinators</strong> â€” (<code>+++</code>, <code>|||</code>, <code>onSecond</code>, <code>onFirst</code>, <code>second</code>, <code>first</code>, <code>onRight</code>, <code>onLeft</code>, <code>andThen</code>, <code>&gt;&gt;&gt;</code>, <code>compose</code>, <code>&lt;&lt;&lt;</code>, <code>identity</code>, <code>swap</code>, <code>join</code>)</p><p>In ZIO 2.0, all arrow combinators are removed, and we need to use alternatives like doing monadic for-comprehension style <code>flatMap</code> with combinators like <code>provide</code>, <code>zip</code>, and so on.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="zio-20-naming-conventions">ZIO 2.0 Naming Conventions<a class="hash-link" href="#zio-20-naming-conventions" title="Direct link to heading">â€‹</a></h3><p>In ZIO 2.0, the name of constructors and operators becomes more ergonomic and simple. They reflect more about their purpose rather than just using idiomatic jargon of category theory or functional terms in functional programming with Haskell.</p><p>Here are some of the most important changes:</p><ul><li><p><strong>Multiple ways of doing the same thing are removed</strong> â€” For example:</p><ul><li>Both <code>ZIO.succeed</code> and <code>ZIO.effectTotal</code> do the same thing. So in ZIO 2.0 we just have one version of these constructors which is <code>ZIO.succeed</code>.</li><li>The bind operator <code>&gt;&gt;=</code> is removed. So we just have one way to flatMap which is the <code>flatMap</code> method. Therefore, the <code>&gt;&gt;=</code> method doesn&#x27;t surprise the non-Haskellers.</li><li>The <code>ZIO#get</code> method was essentially a more constrained version of <code>ZIO#some</code>. So the <code>get</code> method is deprecated.</li></ul></li><li><p><strong><code>ZIO.attempt</code> instead of <code>ZIO.effect</code></strong> â€” In ZIO 2.0 all ZIO constructors like <code>ZIO.effect*</code> that create a ZIO from a side effect are deprecated and renamed to the <code>ZIO.attempt*</code> version. For example, when we are reading from a file, it&#x27;s more meaning full to say we are attempting to read from a file instead of saying we have an effect of reading from a file.</p></li><li><p><strong><code>ZIO</code> instead of the <code>M</code> suffix</strong> â€” In effectful operations, the <code>M</code> suffix is renamed to the <code>ZIO</code> suffix. In ZIO 1.x, the <code>M</code> suffix in an effectful operation means that the operation works with monad in a monadic context. This naming convention is the legacy of Haskell jargon. In ZIO 2.x, all these suffixes are renamed to the <code>ZIO</code>. For example, the <code>ifM</code> operator is renamed to <code>ifZIO</code>.</p></li><li><p><strong><code>Discard</code> instead of the underscore <code>_</code> suffix</strong> â€” The underscore suffix is another legacy naming convention from Haskell&#x27;s world. In ZIO 1.x, the underscore suffix means we are going to discard the result. The underscore version works exactly like the one without the underscore, but it discards the result and returns <code>Unit</code> in the ZIO context. For example, the <code>collectAll_</code> operator renamed to <code>collectAllDiscard</code>.</p></li><li><p><strong><code>as</code>, <code>to</code>, <code>into</code> prefixes</strong> â€” The <code>ZIO#to</code> is renamed to the <code>ZIO#intoPromise</code>. So now we have three categories of conversion:</p><ol><li><strong>as</strong> â€” The <code>ZIO#as</code> method and its variants like <code>ZIO#asSome</code>, <code>ZIO#asSomeError</code> and <code>ZIO#asService</code> are used when transforming the <code>A</code> inside of a <code>ZIO</code>, generally as shortcuts for <code>map(aToFoo(_))</code>.</li><li><strong>to</strong> â€” The <code>ZIO#to</code> method and its variants like <code>ZIO#toFuture</code> are used when the <code>ZIO</code> is transformed into something else other than the <code>ZIO</code> data-type.</li><li><strong>into</strong> â€” All <code>into*</code> methods, accept secondary data-type, modify it with the result of the current effect (e.g. <code>ZIO#intoPromise</code>, <code>ZStream#intoHub</code>, and <code>ZStream#intoQueue</code>)</li></ol></li></ul><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>ZIO#&gt;&gt;=</code></td><td><code>ZIO#flatMap</code></td></tr><tr><td><code>ZIO#bimap</code></td><td><code>ZIO#mapBoth</code></td></tr><tr><td><code>ZIO#mapEffect</code></td><td><code>ZIO#mapAttempt</code></td></tr><tr><td><code>ZIO#filterOrElse_</code></td><td><code>ZIO#filterOrElse</code></td></tr><tr><td><code>ZIO#foldCauseM</code></td><td><code>ZIO#foldCauseZIO</code></td></tr><tr><td><code>ZIO#foldM</code></td><td><code>ZIO#foldZIO</code></td></tr><tr><td><code>ZIO#foldTraceM</code></td><td><code>ZIO#foldTraceZIO</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO#get</code></td><td><code>ZIO#some</code></td></tr><tr><td><code>ZIO#optional</code></td><td><code>ZIO#unoption</code></td></tr><tr><td><code>ZIO#someOrElseM</code></td><td><code>ZIO#someOrElseZIO</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.forkAll_</code></td><td><code>ZIO.forkAllDiscard</code></td></tr><tr><td><code>ZIO#forkInternal</code></td><td><code>ZIO#fork</code></td></tr><tr><td><code>ZIO#forkOn</code></td><td><code>ZIO#onExecutionContext(ec).fork</code></td></tr><tr><td><code>ZIO.fromFiberM</code></td><td><code>ZIO.fromFiberZIO</code></td></tr><tr><td><code>ZIO.require</code></td><td><code>ZIO.someOrFail</code></td></tr><tr><td><code>ZIO#on</code></td><td><code>ZIO#onExecutionContext</code></td></tr><tr><td><code>ZIO#rejectM</code></td><td><code>ZIO#rejectZIO</code></td></tr><tr><td><code>ZIO#run</code></td><td><code>ZIO#exit</code></td></tr><tr><td><code>ZIO#timeoutHalt</code></td><td><code>ZIO#timeoutFailCause</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO#to</code></td><td><code>ZIO#intoPromise</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.accessM</code></td><td><code>ZIO.environmentWithZIO</code></td></tr><tr><td><code>ZIO.fromFunctionM</code></td><td><code>ZIO.environmentWithZIO</code></td></tr><tr><td><code>ZIO.fromFunction</code></td><td><code>ZIO.access</code></td></tr><tr><td><code>ZIO.services</code></td><td><code>ZIO.service</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.bracket</code></td><td><code>ZIO.acquireReleaseWith</code></td></tr><tr><td><code>ZIO.bracketExit</code></td><td><code>ZIO.acquireReleaseExitWith</code></td></tr><tr><td><code>ZIO.bracketAuto</code></td><td><code>ZIO.acquireReleaseWithAuto</code></td></tr><tr><td><code>ZIO#bracket</code></td><td><code>ZIO#acquireReleaseWith</code></td></tr><tr><td><code>ZIO#bracket_</code></td><td><code>ZIO#acquireRelease</code></td></tr><tr><td><code>ZIO#bracketExit</code></td><td><code>ZIO#acquireReleaseExitWith</code></td></tr><tr><td><code>ZIO#bracketExit</code></td><td><code>ZIO#acquireReleaseExitWith</code></td></tr><tr><td><code>ZIO#bracketOnError</code></td><td><code>ZIO#acquireReleaseOnErrorWith</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.collectAll_</code></td><td><code>ZIO.collectAllDiscard</code></td></tr><tr><td><code>ZIO.collectAllPar_</code></td><td><code>ZIO.collectAllParDiscard</code></td></tr><tr><td><code>ZIO.collectAllParN_</code></td><td><code>ZIO.collectAllParNDiscard</code></td></tr><tr><td><code>ZIO#collectM</code></td><td><code>ZIO#collectZIO</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.effect</code></td><td><code>ZIO.attempt</code></td></tr><tr><td><code>ZIO.effectAsync</code></td><td><code>ZIO.async</code></td></tr><tr><td><code>ZIO.effectAsyncInterrupt</code></td><td><code>ZIO.asyncInterrupt</code></td></tr><tr><td><code>ZIO.effectAsyncM</code></td><td><code>ZIO.asyncZIO</code></td></tr><tr><td><code>ZIO.effectAsyncMaybe</code></td><td><code>ZIO.asyncMaybe</code></td></tr><tr><td><code>ZIO.effectBlocking</code></td><td><code>ZIO.attemptBlocking</code></td></tr><tr><td><code>ZIO.effectBlockingCancelable</code></td><td><code>ZIO.attemptBlockingCancelable</code></td></tr><tr><td><code>ZIO.effectBlockingIO</code></td><td><code>ZIO.attemptBlockingIO</code></td></tr><tr><td><code>ZIO.effectBlockingInterrupt</code></td><td><code>ZIO.attemptBlockingInterrupt</code></td></tr><tr><td><code>ZIO.effectSuspend</code></td><td><code>ZIO.suspend</code></td></tr><tr><td><code>ZIO.effectSuspendTotal</code></td><td><code>ZIO.suspendSucceed</code></td></tr><tr><td><code>ZIO.effectSuspendTotalWith</code></td><td><code>ZIO.suspendSucceedWith</code></td></tr><tr><td><code>ZIO.effectSuspendWith</code></td><td><code>ZIO.suspendWith</code></td></tr><tr><td><code>ZIO.effectTotal</code></td><td><code>ZIO.succeed</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.foreach_</code></td><td><code>ZIO.foreachDiscard</code></td></tr><tr><td><code>ZIO.foreachPar_</code></td><td><code>ZIO.foreachParDiscard</code></td></tr><tr><td><code>ZIO.foreachParN_</code></td><td><code>ZIO.foreachParNDiscard</code></td></tr><tr><td><code>ZIO#replicateM</code></td><td><code>ZIO#replicateZIO</code></td></tr><tr><td><code>ZIO#replicateM_</code></td><td><code>ZIO#replicateZIODiscard</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.halt</code></td><td><code>ZIO.failCause</code></td></tr><tr><td><code>ZIO.haltWith</code></td><td><code>ZIO.failCauseWith</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.ifM</code></td><td><code>ZIO.ifZIO</code></td></tr><tr><td><code>ZIO.loop_</code></td><td><code>ZIO.loopDiscard</code></td></tr><tr><td><code>ZIO.whenCaseM</code></td><td><code>ZIO.whenCaseZIO</code></td></tr><tr><td><code>ZIO.whenM</code></td><td><code>ZIO.whenZIO</code></td></tr><tr><td><code>ZIO.unlessM</code></td><td><code>ZIO.unlessZIO</code></td></tr><tr><td><code>ZIO#unlessM</code></td><td><code>ZIO#unlessZIO</code></td></tr><tr><td><code>ZIO#whenM</code></td><td><code>ZIO#whenZIO</code></td></tr><tr><td><code>ZIO#repeatUntilM</code></td><td><code>ZIO#repeatUntilZIO</code></td></tr><tr><td><code>ZIO#repeatWhileM</code></td><td><code>ZIO#repeatWhileZIO</code></td></tr><tr><td><code>ZIO#retryUntilM</code></td><td><code>ZIO#retryUntilZIO</code></td></tr><tr><td><code>ZIO#retryWhileM</code></td><td><code>ZIO#retryWhileZIO</code></td></tr><tr><td><code>ZIO.replicateM</code></td><td><code>ZIO.replicateZIO</code></td></tr><tr><td><code>ZIO.replicateM_</code></td><td><code>ZIO.replicateZIODiscard</code></td></tr><tr><td></td><td></td></tr><tr><td><code>ZIO.validate_</code></td><td><code>ZIO.validateDiscard</code></td></tr><tr><td><code>ZIO.validatePar_</code></td><td><code>ZIO.validateParDiscard</code></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="lazy-evaluation-of-parameters">Lazy Evaluation of Parameters<a class="hash-link" href="#lazy-evaluation-of-parameters" title="Direct link to heading">â€‹</a></h3><p>In ZIO 2.x, we changed the signature of those functions that return effects to use <em>by-name parameters</em>. And we also encourage library authors to do the same for any functions that return effects.</p><p>Our motivation for this change was a common mistake among new users of ZIO, which they <em>accidentally embed raw effects</em> inside the function they pass to ZIO constructors and operators. This mistake may produce some unwanted behaviors.</p><p>Let&#x27;s see an example of this anti-pattern in ZIO 1.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.bracket({</span><br></span><span class="token-line"><span class="token plain">  val random = scala.util.Random.nextInt()</span><br></span><span class="token-line"><span class="token plain">  ZIO.succeed(random)</span><br></span><span class="token-line"><span class="token plain">})(_ =&gt; ZIO.unit)(x =&gt; console.putStrLn(x.toString)).repeatN(2)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The newbie user expects that this program prints 3 different random numbers, while the output would be something as follows:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">1085597917</span><br></span><span class="token-line"><span class="token plain">1085597917</span><br></span><span class="token-line"><span class="token plain">1085597917</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This is because the user incorrectly introduced a raw effect into the <code>acquire</code> parameter of <code>bracket</code> operation. As the <code>acuqire</code> is <em>by-value parameter</em>, the value passed to the function evaluated <em>eagerly</em>, only once:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def bracket[R, E, A](acquire: ZIO[R, E, A]): ZIO.BracketAcquire[R, E, A]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If we make the <code>acquire</code> to <em>by-name parameter</em>, we can prevent these mistakes:</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> def bracket[R, E, A](acquire: ZIO[R, E, A]): ZIO.BracketAcquire[R, E, A]</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> def bracket[R, E, A](acquire: =&gt; ZIO[R, E, A]): ZIO.BracketAcquire[R, E, A]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>So, in ZIO 2.x if we accidentally introduce an effect to the ZIO parameters, the lazy parameter prevents the program from producing undesired behaviors:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">// Note that in ZIO 2.x, the `bracket` is deprecated and renamed to the `acquireReleaseWith`. In this example to prevent the consistency of our example, we used the `bracket`.</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO.bracket({</span><br></span><span class="token-line"><span class="token plain">  val random = scala.util.Random.nextInt()</span><br></span><span class="token-line"><span class="token plain">  ZIO.succeed(random)</span><br></span><span class="token-line"><span class="token plain">})(_ =&gt; ZIO.unit)(x =&gt; console.putStrLn(x.toString)).repeatN(2)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The output would be something like this:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">355191016</span><br></span><span class="token-line"><span class="token plain">2046799548</span><br></span><span class="token-line"><span class="token plain">333146616</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="composable-zips">Composable Zips<a class="hash-link" href="#composable-zips" title="Direct link to heading">â€‹</a></h3><p>In ZIO 2.x, when we are zipping together different effects:</p><ul><li><code>Tuple</code>s are not nested.</li><li><code>Unit</code>s do not contribute to the output.</li></ul><p>Assume we have these effects</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val x1: UIO[Int]     = ZIO.succeed(???)</span><br></span><span class="token-line"><span class="token plain">val x2: UIO[Unit]    = ZIO.succeed(???)</span><br></span><span class="token-line"><span class="token plain">val x3: UIO[String]  = ZIO.succeed(???)</span><br></span><span class="token-line"><span class="token plain">val x4: UIO[Boolean] = ZIO.succeed(???)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 1.x, the output of zipping together these effects are nested:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val zipped = x1 &lt;*&gt; x2 &lt;*&gt; x3 &lt;*&gt; x4</span><br></span><span class="token-line"><span class="token plain">// zipped: ZIO[Any, Nothing, (((Int, Unit), String), Boolean)] = zio.ZIO$FlatMap@3ed3c202</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>While in ZIO 2.x, we have more ergonomics result type and also the <code>Unit</code> data-type doesn&#x27;t contribute to the output:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val zipped = x1 &lt;*&gt; x2 &lt;*&gt; x3 &lt;*&gt; x4</span><br></span><span class="token-line"><span class="token plain">// zipped: ZIO[Any, Nothing, (Int, String, Boolean)] = &lt;function1&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This change is not only for the <code>ZIO</code> data type but also for all other data types like <code>ZStream</code>, <code>ZSTM</code>, etc.</p><p>As we have compositional zips, we no longer need higher arity zips in ZIO 1.x like <code>mapN</code>, <code>mapParN</code>, <code>Gen#zipN</code>, and <code>Gen#crossN</code>. They are deprecated in ZIO 2.x.</p><p>Here is the list of <code>zip</code> variants that are deprecated:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>ZIO#&amp;&amp;&amp;</code></td><td><code>ZIO#zip</code></td></tr><tr><td><code>ZIO.tupled</code></td><td><code>ZIO.zip</code></td></tr><tr><td><code>ZIO.tupledPar</code></td><td><code>ZIO.zipPar</code></td></tr><tr><td><code>ZIO.mapN</code></td><td><code>ZIO.zip</code></td></tr><tr><td><code>ZIO.mapParN</code></td><td><code>ZIO.zipPar</code></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="compositional-concurrency">Compositional Concurrency<a class="hash-link" href="#compositional-concurrency" title="Direct link to heading">â€‹</a></h3><p>We introduced two operations that modify the parallel factor of a concurrent ZIO effect, <code>ZIO#withParallelism</code> and <code>ZIO#withParallelismUnbounded</code>. This makes the maximum number of fibers for parallel operators as a regional setting. Therefore, all parallelism operators ending in <code>N</code>, such as <code>foreachParN</code> and <code>collectAllParN</code>, have been deprecated:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>foreachParN</code></td><td><code>foreachPar</code></td></tr><tr><td><code>foreachParN_</code></td><td><code>foreachParDiscard</code></td></tr><tr><td><code>collectAllParN</code></td><td><code>collectAllPar</code></td></tr><tr><td><code>collectAllParN_</code></td><td><code>collectAllParDiscard</code></td></tr><tr><td><code>collectAllWithParN</code></td><td><code>collectAllWithPar</code></td></tr><tr><td><code>collectAllSuccessesParN</code></td><td><code>collectAllSuccessesPar</code></td></tr></tbody></table><p>Having separate methods for changing the parallelism factor of a parallel effect deprecates lots of extra operators and makes concurrency more compositional.</p><p>So instead of writing a parallel task like this:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.foreachParN(8)(urls)(download)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We should use the <code>withParallelism</code> method:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.foreachPar(urls)(download).withParallelism(8)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>withParallelismUnbounded</code> method is useful when we want to run a parallel effect with an unbounded maximum number of fibers:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.foreachPar(urls)(download).withParallelismUnbounded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="either-values">Either Values<a class="hash-link" href="#either-values" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, the <code>ZIO#left</code> and <code>ZIO#right</code> operators are lossy, and they don&#x27;t preserve the information on the other side of <code>Either</code> after the transformation.</p><p>For example, assume we have an effect of type <code>ZIO[Any, Throwable, Left[Int, String]]</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val effect         = Task.effect(Left[Int, String](5))</span><br></span><span class="token-line"><span class="token plain">// effect: ZIO[Any, Throwable, Left[Int, String]]</span><br></span><span class="token-line"><span class="token plain">val leftProjection = effect.left</span><br></span><span class="token-line"><span class="token plain">// leftProjection: ZIO[Any, Option[Throwable], Int]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The error channel of <code>leftProjection</code> doesn&#x27;t contain type information of the other side of the <code>Left[Int, String]</code>, which is <code>String</code>. So after projecting to the left, we can not go back to the original effect.</p><p>In ZIO 2.x, the <code>ZIO#left</code> and <code>ZIO#right</code>, contains all type information so then we can <code>unleft</code> or <code>unright</code> to inverse that projection:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val effect         = ZIO.attempt(Left[Int, String](5))</span><br></span><span class="token-line"><span class="token plain">// effect: Task[Left[Int, String]] = zio.ZIO$SucceedWith@489f4abd</span><br></span><span class="token-line"><span class="token plain">val leftProjection = effect.left</span><br></span><span class="token-line"><span class="token plain">// leftProjection: ZIO[Any, Either[Throwable, String], Int] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain">val unlefted       = leftProjection.map(_ * 2).unleft </span><br></span><span class="token-line"><span class="token plain">// unlefted: ZIO[Any, Throwable, Either[Int, String]] = &lt;function1&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>So the error channel of the output of <code>left</code> and <code>right</code> operators is changed from <code>Option</code> to <code>Either</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="descriptive-errors">Descriptive Errors<a class="hash-link" href="#descriptive-errors" title="Direct link to heading">â€‹</a></h3><p>ZIO&#x27;s type system uses implicit evidence to ensure type safety, and some level of correctness at compile time. In ZIO 2.x, the <em>subtype evidence</em>, <code>&lt;:&lt;</code> replaced by these two descriptive implicit evidences:</p><ol><li><p><strong><code>IsSubtypeOfOutput</code></strong> â€” The <code>O1 IsSubtypeOfOutput O2</code> ensures that the output type <code>O1</code> is subtype of <code>O2</code></p></li><li><p><strong><code>IsSubtypeOfError</code></strong> â€” The <code>E1 IsSubtypeOfError E2</code> ensures that the error type <code>E1</code> is a subtype of <code>E2</code></p></li></ol><p>Now we have more descriptive errors at compile time in the vast majority of operators.</p><p>Let&#x27;s just see an example of each one. In ZIO 1.x, the compiler print obscurant error messages:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.fail(&quot;Boom!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">// error: Cannot prove that String &lt;:&lt; Throwable.</span><br></span><span class="token-line"><span class="token plain">// ZIO.fail(&quot;Boom!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">// ^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO.succeed(Set(3,4)).head</span><br></span><span class="token-line"><span class="token plain">// error: Cannot prove that scala.collection.immutable.Set[Int] &lt;:&lt; List[B].</span><br></span><span class="token-line"><span class="token plain">// ZIO.succeed(Set(3, 4)).head</span><br></span><span class="token-line"><span class="token plain">// ^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now in ZIO 2.x we have such informative error messages:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.fail(&quot;Boom!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">// error: This operator requires that the error type be a subtype of Throwable but the actual type was String.</span><br></span><span class="token-line"><span class="token plain">// ZIO.fail(&quot;Boom!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">// ^^^^^^^^^^^^^^^^^^^^^^^</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO.succeed(Set(3, 4, 3)).head</span><br></span><span class="token-line"><span class="token plain">// error: This operator requires that the output type be a subtype of List[B] but the actual type was scala.collection.immutable.Set[Int].</span><br></span><span class="token-line"><span class="token plain">// ZIO.succeed(Set(3, 4, 3)).head</span><br></span><span class="token-line"><span class="token plain">// ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="zio-app">ZIO App<a class="hash-link" href="#zio-app" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="zioapp">ZIOApp<a class="hash-link" href="#zioapp" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, we were used to writing ZIO applications using the <code>zio.App</code> trait:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio.App</span><br></span><span class="token-line"><span class="token plain">import zio.Console._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MyApp extends zio.App {</span><br></span><span class="token-line"><span class="token plain">  def run(args: List[String]) = </span><br></span><span class="token-line"><span class="token plain">    startMyApp(args).exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now in ZIO 2.x, the <code>zio.App</code> trait is deprecated and, we have the <code>zio.ZIOAppDefault</code> trait which is simpler than the former approach (Note that the <code>ZApp</code> is also deprecated, and we should use the <code>ZIOAppDefault</code> instead):</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio.ZIOAppDefault</span><br></span><span class="token-line"><span class="token plain">import zio.Console._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MyApp extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  def run =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      arguments &lt;- getArgs</span><br></span><span class="token-line"><span class="token plain">      _         &lt;- startMyApp(arguments) </span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 1.x, <code>run</code> is the main function of our application, which will be passed the command-line arguments to our application:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def run(args: List[String]): URIO[R, ExitCode]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>While in most cases we don&#x27;t write command-line applications, and we don&#x27;t use it, in ZIO 2.x, we created the <code>ZIOAppArgs</code> service and a helper method called <code>ZIOApp#args</code> which obtains access to the command-line arguments of our application:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">trait ZIOApp { self =&gt;</span><br></span><span class="token-line"><span class="token plain">  final def args: ZIO[ZIOAppArgs, Nothing, Chunk[String]] = ZIO.service[ZIOAppArgs].map(_.args)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="fiber">Fiber<a class="hash-link" href="#fiber" title="Direct link to heading">â€‹</a></h2><p>We deprecated the <code>Fiber.ID</code> and moved it to the <code>zio</code> package and called it the <code>FiberId</code>:</p><table><thead><tr><th>ZIO 1.0</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>zio.Fiber.ID</code></td><td><code>zio.FiberID</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="platform-executor-and-runtime">Platform, Executor, and Runtime<a class="hash-link" href="#platform-executor-and-runtime" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="method-deprecation-and-renaming">Method Deprecation and Renaming<a class="hash-link" href="#method-deprecation-and-renaming" title="Direct link to heading">â€‹</a></h3><p>We renamed the <code>Platform</code> data type to the <code>RuntimeConfig</code>, and moved it from the <code>zio.internal</code> to the <code>zio</code> package with some member deprecation:</p><table><thead><tr><th>ZIO 1.0</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>zio.internal.Platfom</code></td><td><code>zio.RuntimeConfig</code></td></tr><tr><td><code>Platform#withBlockingExecutor</code></td><td><code>RuntimeConfig#copy</code></td></tr><tr><td><code>Platform#withExecutor</code></td><td><code>RuntimeConfig#copy</code></td></tr><tr><td><code>Platform#withFatal</code></td><td><code>RuntimeConfig#copy</code></td></tr><tr><td><code>Platform#withReportFatal</code></td><td><code>RuntimeConfig#copy</code></td></tr><tr><td><code>Platform#withReportFailure</code></td><td><code>RuntimeConfig#copy</code></td></tr><tr><td><code>Platform#withSupervisor</code></td><td><code>RuntimeConfig#copy</code></td></tr><tr><td><code>Platform#withTracing</code></td><td><code>RuntimeConfig#copy</code></td></tr></tbody></table><p>Also, we moved the <code>Executor</code> from <code>zio.internal</code> to the <code>zio</code> package:</p><table><thead><tr><th>ZIO 1.0</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>zio.internal.Executor</code></td><td><code>zio.Executor</code></td></tr></tbody></table><p>In regard to renaming the <code>Platform</code> data-type to the <code>RuntimeConfig</code> we have some similar renaming in other data-types like <code>Runtime</code> and <code>ZIO</code>:</p><table><thead><tr><th>ZIO 1.0</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>Runtime#mapPlatform</code></td><td><code>Runtime#mapRuntimeConfig</code></td></tr><tr><td><code>Runtime#platfom</code></td><td><code>Runtime#runtimeConfig</code></td></tr><tr><td><code>ZIO.platfom</code></td><td><code>ZIO.runtimeConfig</code></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_mojV" id="runtime-config-aspect">Runtime Config Aspect<a class="hash-link" href="#runtime-config-aspect" title="Direct link to heading">â€‹</a></h3><p>ZIO 2.x, introduced a new data-type called <code>RuntimeConfigAspect</code> with the following methods:</p><ul><li><code>addLogger</code></li><li><code>addReportFailure</code></li><li><code>addReportFatal</code></li><li><code>addSupervisor</code></li><li><code>identity</code></li><li><code>setBlockingExecutor</code></li><li><code>setExecutor</code></li><li><code>setTracing</code></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="compositional-runtime-config">Compositional Runtime Config<a class="hash-link" href="#compositional-runtime-config" title="Direct link to heading">â€‹</a></h3><p>ZIO 2.x allows us to run part of an effect on a different <code>RuntimeConfig</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.withRuntimeConfig(newRuntimeConfiguration)(effect)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After running the effect on the specified runtime configuration, it will restore the old runtime configuration.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="zlayer">ZLayer<a class="hash-link" href="#zlayer" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="constructing-layers">Constructing Layers<a class="hash-link" href="#constructing-layers" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, when we want to write a service that depends on other services, we need to use <code>ZLayer.fromService*</code> variants with a lot of boilerplate:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val live: URLayer[Clock with Console, Logging] =</span><br></span><span class="token-line"><span class="token plain">  ZLayer.fromServices[Clock.Service, Console.Service, Logging.Service] {</span><br></span><span class="token-line"><span class="token plain">    (clock: Clock.Service, console: Console.Service) =&gt;</span><br></span><span class="token-line"><span class="token plain">      new Service {</span><br></span><span class="token-line"><span class="token plain">        override def log(line: String): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">          for {</span><br></span><span class="token-line"><span class="token plain">            current &lt;- clock.currentDateTime.orDie</span><br></span><span class="token-line"><span class="token plain">            _ &lt;- console.putStrLn(current.toString + &quot;--&quot; + line).orDie</span><br></span><span class="token-line"><span class="token plain">          } yield ()</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ZIO 2.x deprecates all <code>ZLayer.fromService*</code> functions. Instead, we use a for comprehension:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">case class LoggingLive(console: Console, clock: Clock) extends Logging {</span><br></span><span class="token-line"><span class="token plain">  override def log(line: String): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      current &lt;- clock.currentDateTime.orDie</span><br></span><span class="token-line"><span class="token plain">      _       &lt;- console.putStrLn(current.toString + &quot;--&quot; + line).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object LoggingLive {</span><br></span><span class="token-line"><span class="token plain">  val layer: ZLayer[Clock with Console, Nothing, Logging] =</span><br></span><span class="token-line"><span class="token plain">    ZLayer {</span><br></span><span class="token-line"><span class="token plain">      for {</span><br></span><span class="token-line"><span class="token plain">        console &lt;- ZIO.service[Console]</span><br></span><span class="token-line"><span class="token plain">        clock   &lt;- ZIO.service[Clock]</span><br></span><span class="token-line"><span class="token plain">      } yield LoggingLive(console, clock)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="accessing-a-service-from-the-environment">Accessing a Service from the Environment<a class="hash-link" href="#accessing-a-service-from-the-environment" title="Direct link to heading">â€‹</a></h3><p>Assume we have a service named <code>Logging</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">trait Logging {</span><br></span><span class="token-line"><span class="token plain">  def log(line: String): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 1.x, when we wanted to access a service from the environment, we used the <code>ZIO.access</code> + <code>Has#get</code> combination (<code>ZIO.access(_.get)</code>):</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val logging: URIO[Logging, Logging] = ZIO.access(_.get)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Also, to create accessor methods, we used the following code:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def log(line: String): URIO[Logging, Unit] = ZIO.accessM(_.get.log(line))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ZIO 2.x reduces one level of indirection by using <code>ZIO.service</code> operator:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val logging : URIO[Logging, Logging] = ZIO.service</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And to write the accessor method in ZIO 2.x, we can use <code>ZIO.serviceWithZIO</code> operator:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def log(line: String): URIO[Logging, Unit] = ZIO.serviceWithZIO(_.log(line))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="accessing-multiple-services-in-the-environment">Accessing Multiple Services in the Environment<a class="hash-link" href="#accessing-multiple-services-in-the-environment" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, we could access multiple services using higher arity service accessors like <code>ZIO.services</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">for {</span><br></span><span class="token-line"><span class="token plain">  (console, random) &lt;- ZIO.services[Console, Random]</span><br></span><span class="token-line"><span class="token plain">  randomInt         &lt;- random.nextInt</span><br></span><span class="token-line"><span class="token plain">  _                 &lt;- console.printLine(s&quot;The next random number: $randomInt&quot;)</span><br></span><span class="token-line"><span class="token plain">} yield ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>They were <em>deprecated</em> as we can achieve the same functionality using <code>ZIO.service</code> with for-comprehension syntax, which is more idiomatic and scalable way of accessing multiple services in the environment:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">for {</span><br></span><span class="token-line"><span class="token plain">  console   &lt;- ZIO.service[Console]</span><br></span><span class="token-line"><span class="token plain">  random    &lt;- ZIO.service[Random]</span><br></span><span class="token-line"><span class="token plain">  randomInt &lt;- random.nextInt</span><br></span><span class="token-line"><span class="token plain">  _         &lt;- console.printLine(s&quot;The next random number: $randomInt&quot;)</span><br></span><span class="token-line"><span class="token plain">} yield ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="building-the-dependency-graph">Building the Dependency Graph<a class="hash-link" href="#building-the-dependency-graph" title="Direct link to heading">â€‹</a></h3><p>To create the dependency graph in ZIO 1.x, we should compose the required layer manually. As the ordering of layer compositions matters, and also we should care about composing layers in both vertical and horizontal manner, it would be a cumbersome job to create a dependency graph with a lot of boilerplates.</p><p>Assume we have the following dependency graph with two top-level dependencies:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">           DocRepo                ++          UserRepo</span><br></span><span class="token-line"><span class="token plain">      ____/   |   \____                       /     \</span><br></span><span class="token-line"><span class="token plain">     /        |        \                     /       \</span><br></span><span class="token-line"><span class="token plain"> Logging  Database  BlobStorage          Logging   Database</span><br></span><span class="token-line"><span class="token plain">    |                    |                  |</span><br></span><span class="token-line"><span class="token plain"> Console              Logging            Console</span><br></span><span class="token-line"><span class="token plain">                         |       </span><br></span><span class="token-line"><span class="token plain">                      Console    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 1.x, we had to compose these different layers together to create the whole application dependency graph:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val appLayer: URLayer[Any, DocRepo with UserRepo] =</span><br></span><span class="token-line"><span class="token plain">  (((Console.live &gt;&gt;&gt; Logging.live) ++ Database.live ++ (Console.live &gt;&gt;&gt; Logging.live &gt;&gt;&gt; BlobStorage.live)) &gt;&gt;&gt; DocRepo.live) ++</span><br></span><span class="token-line"><span class="token plain">    (((Console.live &gt;&gt;&gt; Logging.live) ++ Database.live) &gt;&gt;&gt; UserRepo.live)</span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">val res: ZIO[Any, Nothing, Unit] = myApp.provideLayer(appLayer)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As the development of our application progress, the number of layers will grow, and maintaining the dependency graph would be tedious and hard to debug.</p><p>For example, if we miss the <code>Logging.live</code> dependency, the compile-time error would be very messy:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">myApp.provideLayer(</span><br></span><span class="token-line"><span class="token plain">  ((Database.live ++ BlobStorage.live) &gt;&gt;&gt; DocRepo.live) ++</span><br></span><span class="token-line"><span class="token plain">    (Database.live &gt;&gt;&gt; UserRepo.live)</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">type mismatch;</span><br></span><span class="token-line"><span class="token plain"> found   : zio.URLayer[zio.Logging with zio.Database with zio.BlobStorage,zio.DocRepo]</span><br></span><span class="token-line"><span class="token plain">    (which expands to)  zio.ZLayer[zio.Logging with zio.Database with zio.BlobStorage,Nothing,zio.DocRepo]</span><br></span><span class="token-line"><span class="token plain"> required: zio.ZLayer[zio.Database with zio.BlobStorage,?,?]</span><br></span><span class="token-line"><span class="token plain">    ((Database.live ++ BlobStorage.live) &gt;&gt;&gt; DocRepo.live) ++</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 2.x, we can automatically construct dependencies with friendly compile-time hints, using <code>ZIO#provide</code> operator:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val res: ZIO[Any, Nothing, Unit] =</span><br></span><span class="token-line"><span class="token plain">  myApp.provide(</span><br></span><span class="token-line"><span class="token plain">    Console.live,</span><br></span><span class="token-line"><span class="token plain">    Logging.live,</span><br></span><span class="token-line"><span class="token plain">    Database.live,</span><br></span><span class="token-line"><span class="token plain">    BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">    DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">    UserRepo.live</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The order of dependencies doesn&#x27;t matter:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val res: ZIO[Any, Nothing, Unit] =</span><br></span><span class="token-line"><span class="token plain">  myApp.provide(</span><br></span><span class="token-line"><span class="token plain">    DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">    BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">    Logging.live,</span><br></span><span class="token-line"><span class="token plain">    Database.live,</span><br></span><span class="token-line"><span class="token plain">    UserRepo.live,</span><br></span><span class="token-line"><span class="token plain">    Console.live</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If we miss some dependencies, it doesn&#x27;t compile, and the compiler gives us the clue:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val app: ZIO[Any, Nothing, Unit] =</span><br></span><span class="token-line"><span class="token plain">  myApp.provide(</span><br></span><span class="token-line"><span class="token plain">    DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">    BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">//    Logging.live,</span><br></span><span class="token-line"><span class="token plain">    Database.live,</span><br></span><span class="token-line"><span class="token plain">    UserRepo.live,</span><br></span><span class="token-line"><span class="token plain">    Console.live</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">  ZLayer Wiring Error  </span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">â¯ missing Logging</span><br></span><span class="token-line"><span class="token plain">â¯     for DocRepo.live</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">â¯ missing Logging</span><br></span><span class="token-line"><span class="token plain">â¯     for UserRepo.live</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can also directly construct a layer using <code>ZLayer.make</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val layer = ZLayer.make[DocRepo with UserRepo](</span><br></span><span class="token-line"><span class="token plain">  Console.live,</span><br></span><span class="token-line"><span class="token plain">  Logging.live,</span><br></span><span class="token-line"><span class="token plain">  DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">  Database.live,</span><br></span><span class="token-line"><span class="token plain">  BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">  UserRepo.live</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And also the <code>ZLayer.makeSome</code> helps us to construct a layer which requires on some service and produces some other services (<code>URLayer[Int, Out]</code>) using <code>ZLayer.makeSome[In, Out]</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val layer = ZLayer.makeSome[Console, DocRepo with UserRepo](</span><br></span><span class="token-line"><span class="token plain">  Logging.live,</span><br></span><span class="token-line"><span class="token plain">  DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">  Database.live,</span><br></span><span class="token-line"><span class="token plain">  BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">  UserRepo.live</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 1.x, the <code>ZIO#provideSomeLayer</code> provides environment partially:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val app: ZIO[Console, Nothing, Unit] =</span><br></span><span class="token-line"><span class="token plain">  myApp.provideSomeLayer[Console](</span><br></span><span class="token-line"><span class="token plain">    ((Logging.live ++ Database.live ++ (Console.live &gt;&gt;&gt; Logging.live &gt;&gt;&gt; BlobStorage.live)) &gt;&gt;&gt; DocRepo.live) ++</span><br></span><span class="token-line"><span class="token plain">      (((Console.live &gt;&gt;&gt; Logging.live) ++ Database.live) &gt;&gt;&gt; UserRepo.live)</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 2.x, we have a similar functionality but for injection, which is the <code>ZIO#provideSome[Rest](l1, l2, ...)</code> operator:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val app: ZIO[Console, Nothing, Unit] =</span><br></span><span class="token-line"><span class="token plain">  myApp.provideSome[Console](</span><br></span><span class="token-line"><span class="token plain">    Logging.live,</span><br></span><span class="token-line"><span class="token plain">    DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">    Database.live,</span><br></span><span class="token-line"><span class="token plain">    BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">    UserRepo.live</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note:</p><p>In ZIO 2.x, the <code>ZIO#provide</code> methodâ€”and all its variants <code>ZIO#provideSome</code>, <code>ZIO#provideCustom</code>â€”is a default and easier way of injecting dependencies to the environmental effect. We do not require creating the dependency graph manually, it will be automatically generated. In contrast, the <code>ZIO#provideLayer</code>â€”and all its variants <code>ZIO#provideSomeLayer</code>, <code>ZIO#provideCustomLayer</code>â€”is useful for low-level and custom cases like.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="zlayer-debugging">ZLayer Debugging<a class="hash-link" href="#zlayer-debugging" title="Direct link to heading">â€‹</a></h3><p>To debug ZLayer construction, we have two built-in layers, i.e., <code>ZLayer.Debug.tree</code> and <code>ZLayer.Debug.mermaid</code>. For example, by including <code>ZLayer.Debug.mermaid</code> into our layer construction, the compiler generates the following debug information:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val layer = ZLayer.make[DocRepo with UserRepo](</span><br></span><span class="token-line"><span class="token plain">  Console.live,</span><br></span><span class="token-line"><span class="token plain">  Logging.live,</span><br></span><span class="token-line"><span class="token plain">  DocRepo.live,</span><br></span><span class="token-line"><span class="token plain">  Database.live,</span><br></span><span class="token-line"><span class="token plain">  BlobStorage.live,</span><br></span><span class="token-line"><span class="token plain">  UserRepo.live,</span><br></span><span class="token-line"><span class="token plain">  ZLayer.Debug.mermaid</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">[info]   ZLayer Wiring Graph  </span><br></span><span class="token-line"><span class="token plain">[info] </span><br></span><span class="token-line"><span class="token plain">[info] â—‰ DocRepo.live</span><br></span><span class="token-line"><span class="token plain">[info] â”œâ”€â—‘ Logging.live</span><br></span><span class="token-line"><span class="token plain">[info] â”‚ â•°â”€â—‘ Console.live</span><br></span><span class="token-line"><span class="token plain">[info] â”œâ”€â—‘ Database.live</span><br></span><span class="token-line"><span class="token plain">[info] â•°â”€â—‘ BlobStorage.live</span><br></span><span class="token-line"><span class="token plain">[info]   â•°â”€â—‘ Logging.live</span><br></span><span class="token-line"><span class="token plain">[info]     â•°â”€â—‘ Console.live</span><br></span><span class="token-line"><span class="token plain">[info] </span><br></span><span class="token-line"><span class="token plain">[info] â—‰ UserRepo.live</span><br></span><span class="token-line"><span class="token plain">[info] â”œâ”€â—‘ Logging.live</span><br></span><span class="token-line"><span class="token plain">[info] â”‚ â•°â”€â—‘ Console.live</span><br></span><span class="token-line"><span class="token plain">[info] â•°â”€â—‘ Database.live</span><br></span><span class="token-line"><span class="token plain">[info] </span><br></span><span class="token-line"><span class="token plain">[info] Mermaid Live Editor Link</span><br></span><span class="token-line"><span class="token plain">[info] https://mermaid-js.github.io/mermaid-live-editor/edit/#eyJjb2RlIjoiZ3JhcGhcbiAgICBDb25zb2xlLmxpdmVcbiAgICBCbG9iU3RvcmFnZS5saXZlIC0tPiBMb2dnaW5nLmxpdmVcbiAgICBMb2dnaW5nLmxpdmUgLS0+IENvbnNvbGUubGl2ZVxuICAgIFVzZXJSZXBvLmxpdmUgLS0+IExvZ2dpbmcubGl2ZVxuICAgIFVzZXJSZXBvLmxpdmUgLS0+IERhdGFiYXNlLmxpdmVcbiAgICBEb2NSZXBvLmxpdmUgLS0+IERhdGFiYXNlLmxpdmVcbiAgICBEb2NSZXBvLmxpdmUgLS0+IEJsb2JTdG9yYWdlLmxpdmVcbiAgICBEYXRhYmFzZS5saXZlXG4gICAgIiwibWVybWFpZCI6ICJ7XG4gIFwidGhlbWVcIjogXCJkZWZhdWx0XCJcbn0iLCAidXBkYXRlRWRpdG9yIjogdHJ1ZSwgImF1dG9TeW5jIjogdHJ1ZSwgInVwZGF0ZURpYWdyYW0iOiB0cnVlfQ==</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="descriptive-zioapp-environment-compiler-errors">Descriptive ZIOApp Environment Compiler Errors<a class="hash-link" href="#descriptive-zioapp-environment-compiler-errors" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, if we mistakenly forget to provide some requirements, we have some complicated compile errors. Assume we have the following example:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">// ZIO 1.x</span><br></span><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class Config(host: String, port: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">trait Logger {</span><br></span><span class="token-line"><span class="token plain">  def log(line: Any): Task[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MainApp extends App {</span><br></span><span class="token-line"><span class="token plain">  val myApp =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      config &lt;- ZIO.service[Config]</span><br></span><span class="token-line"><span class="token plain">      logger &lt;- ZIO.service[Logger]</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- logger.log(s&quot;Application started with the following config: $config&quot;)</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): URIO[zio.ZEnv, ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    myApp.exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This program needs <code>Config</code> and <code>Logger</code> layers, but we missed them. The compiler prints this mystic error, which is hard to reason about:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">type mismatch;</span><br></span><span class="token-line"><span class="token plain">found   : zio.URIO[zio.Has[Config] with zio.Has[Logger] with zio.console.Console,zio.ExitCode]</span><br></span><span class="token-line"><span class="token plain">(which expands to)  zio.ZIO[zio.Has[Config] with zio.Has[Logger] with zio.Has[zio.console.Console.Service],Nothing,zio.ExitCode]</span><br></span><span class="token-line"><span class="token plain">required: zio.URIO[zio.ZEnv,zio.ExitCode]</span><br></span><span class="token-line"><span class="token plain">(which expands to)  zio.ZIO[zio.Has[zio.clock.Clock.Service] with zio.Has[zio.console.Console.Service] with zio.Has[zio.system.System.Service] with zio.Has[zio.random.Random.Service] with zio.Has[zio.blocking.Blocking.Service],Nothing,zio.ExitCode]</span><br></span><span class="token-line"><span class="token plain">myApp.exitCode</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 2.x, we have descriptive errors. Let&#x27;s try the above example in ZIO 2.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class Config(host: String, port: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">trait Logger {</span><br></span><span class="token-line"><span class="token plain">  def log(line: Any): Task[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MainApp extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  def run =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      config &lt;- ZIO.service[Config]</span><br></span><span class="token-line"><span class="token plain">      logger &lt;- ZIO.service[Logger]</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- logger.log(s&quot;Application started with the following config: $config&quot;)</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will print the following error message:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">[error] â”€â”€â”€â”€ ZIO APP ERROR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]  Your effect requires a service that is not in the environment.</span><br></span><span class="token-line"><span class="token plain">[error]  Please provide a layer for the following type:</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]    1. Logger</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]  Call your effect&#x27;s provide method with the layers you need.</span><br></span><span class="token-line"><span class="token plain">[error]  You can read more about layers and providing services here:</span><br></span><span class="token-line"><span class="token plain">[error]  </span><br></span><span class="token-line"><span class="token plain">[error]    https://zio.dev/version-1.x/datatypes/contextual/index</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]       logger &lt;- ZIO.service[Logger]</span><br></span><span class="token-line"><span class="token plain">[error]              ^</span><br></span><span class="token-line"><span class="token plain">[error] one error found</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It also warns if we provide layers more than needed:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class Config(host: String, port: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">trait Logger {</span><br></span><span class="token-line"><span class="token plain">  def log(line: Any): Task[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class LoggerLive(console: Console) extends Logger {</span><br></span><span class="token-line"><span class="token plain">  override def log(line: Any): Task[Unit] =</span><br></span><span class="token-line"><span class="token plain">    console.printLine(line)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object LoggerLive {</span><br></span><span class="token-line"><span class="token plain">  val layer =</span><br></span><span class="token-line"><span class="token plain">    ZLayer {</span><br></span><span class="token-line"><span class="token plain">      for {</span><br></span><span class="token-line"><span class="token plain">        console &lt;- ZIO.service[Console]</span><br></span><span class="token-line"><span class="token plain">      } yield LoggerLive(console)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MainApp extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  val myApp = for {</span><br></span><span class="token-line"><span class="token plain">    config &lt;- ZIO.service[Config]</span><br></span><span class="token-line"><span class="token plain">    _ &lt;- Console.printLine(s&quot;Application started with the following config: $config&quot;)</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def run =</span><br></span><span class="token-line"><span class="token plain">    myApp.provide(</span><br></span><span class="token-line"><span class="token plain">      Console.live,</span><br></span><span class="token-line"><span class="token plain">      Random.live,</span><br></span><span class="token-line"><span class="token plain">      ZLayer.succeed(Config(&quot;localhost&quot;, 8080)),</span><br></span><span class="token-line"><span class="token plain">      LoggerLive.layer</span><br></span><span class="token-line"><span class="token plain">    )</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It will print the following warning message:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">[error] â”€â”€â”€â”€ ZLAYER WARNING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]  You have provided more than is required.</span><br></span><span class="token-line"><span class="token plain">[error]  You may remove the following 2 layers:</span><br></span><span class="token-line"><span class="token plain">[error]    </span><br></span><span class="token-line"><span class="token plain">[error]    1. Random.live</span><br></span><span class="token-line"><span class="token plain">[error]    2. LoggerLive.layer</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]   </span><br></span><span class="token-line"><span class="token plain">[error] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br></span><span class="token-line"><span class="token plain">[error] </span><br></span><span class="token-line"><span class="token plain">[error]     myApp.provide(</span><br></span><span class="token-line"><span class="token plain">[error]                  ^</span><br></span><span class="token-line"><span class="token plain">[error] one error found</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="eliminators-for-environmental-effects">Eliminators for Environmental Effects<a class="hash-link" href="#eliminators-for-environmental-effects" title="Direct link to heading">â€‹</a></h3><p>In ZIO 2.x, layers become eliminators for environmental effects:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">trait Foo</span><br></span><span class="token-line"><span class="token plain">trait Bar</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val fooLayer   : ZLayer[Any, Nothing, Foo]          = ZLayer.succeed(???)</span><br></span><span class="token-line"><span class="token plain">val fooWithBar : ZIO[Foo with Bar, Throwable, Unit] = ZIO.succeed(???)</span><br></span><span class="token-line"><span class="token plain">val bar        : ZIO[Bar, Any, Unit]                = fooLayer(fooWithBar)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this example, by applying the <code>fooLayer</code> to the <code>fooWithBarWithBaz</code> effect it will eliminate the contextual <code>Foo</code> service from the environment of the effect.</p><p>Furthermore, we can compose multiple layers together and then eliminate services from the environmental effects:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object MainApp extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val needsClockAndRandomAndConsole: UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      uuid &lt;- Random.nextUUID</span><br></span><span class="token-line"><span class="token plain">      date &lt;- Clock.localDateTime</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- Console.printLine(s&quot;$date -- $uuid&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val clockAndRandom: ULayer[Clock with Random] = Clock.live ++ Random.live</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val needsConsole: URIO[Console, Unit] =</span><br></span><span class="token-line"><span class="token plain">    clockAndRandom(needsClockAndRandomAndConsole)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def run = needsConsole</span><br></span><span class="token-line"><span class="token plain">  </span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It helps us to provide contextual environments like the DSL below:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">dbTransaction {</span><br></span><span class="token-line"><span class="token plain">  effect</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>dbTransaction</code> is a <code>ZLayer</code> of type <code>ZLayer[any, Throwable, Connection]</code> which can eliminate the <code>Connection</code> service from the <code>effect</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="service-pattern">Service Pattern<a class="hash-link" href="#service-pattern" title="Direct link to heading">â€‹</a></h3><p>The <em>Service Pattern</em>, formerly called &quot;Module Pattern&quot;, is one of the most important changes in ZIO 2.x. Let&#x27;s take a look at services in ZIO 1.x before discussing changes. Here is a <code>Logging</code> service that uses <em>Service Pattern 1.0</em>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">object logging {</span><br></span><span class="token-line"><span class="token plain">  // Defining the service type by wrapping the service interface with Has[_] data type</span><br></span><span class="token-line"><span class="token plain">  type Logging = Has[Logging.Service]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  // Companion object that holds service interface and its live implementation</span><br></span><span class="token-line"><span class="token plain">  object Logging {</span><br></span><span class="token-line"><span class="token plain">    trait Service {</span><br></span><span class="token-line"><span class="token plain">      def log(line: String): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">    // Live implementation of the Logging service</span><br></span><span class="token-line"><span class="token plain">    val live: ZLayer[Clock with Console, Nothing, Logging] =</span><br></span><span class="token-line"><span class="token plain">      ZLayer.fromServices[Clock.Service, Console.Service, Logging.Service] {</span><br></span><span class="token-line"><span class="token plain">        (clock: Clock.Service, console: Console.Service) =&gt;</span><br></span><span class="token-line"><span class="token plain">          new Logging.Service {</span><br></span><span class="token-line"><span class="token plain">            override def log(line: String): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">              for {</span><br></span><span class="token-line"><span class="token plain">                current &lt;- clock.currentDateTime.orDie</span><br></span><span class="token-line"><span class="token plain">                _       &lt;- console.putStrLn(s&quot;$current--$line&quot;)</span><br></span><span class="token-line"><span class="token plain">              } yield ()</span><br></span><span class="token-line"><span class="token plain">          }</span><br></span><span class="token-line"><span class="token plain">      }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  // Accessor Methods</span><br></span><span class="token-line"><span class="token plain">  def log(line: =&gt; String): URIO[Logging, Unit] =</span><br></span><span class="token-line"><span class="token plain">    ZIO.accessM(_.get.log(line))</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>Logging</code> service is a logger which depends on the <code>Console</code> and <code>Clock</code> services.</p><p>ZIO 2.x introduces the <em>Service Pattern 2.0</em> which is much more concise and has more ergonomics. Let&#x27;s see how the <code>Logging</code> service can be implemented using this new pattern:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">// Defining the Service Interface</span><br></span><span class="token-line"><span class="token plain">trait Logging {</span><br></span><span class="token-line"><span class="token plain">  def log(line: String): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">// Accessor Methods Inside the Companion Object</span><br></span><span class="token-line"><span class="token plain">object Logging {</span><br></span><span class="token-line"><span class="token plain">  def log(line: String): URIO[Logging, Unit] =</span><br></span><span class="token-line"><span class="token plain">    ZIO.serviceWithZIO(_.log(line))</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">// Implementation of the Service Interface</span><br></span><span class="token-line"><span class="token plain">case class LoggingLive(console: Console, clock: Clock) extends Logging {</span><br></span><span class="token-line"><span class="token plain">  override def log(line: String): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      time &lt;- clock.currentDateTime</span><br></span><span class="token-line"><span class="token plain">      _    &lt;- console.printLine(s&quot;$time--$line&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">// Converting the Service Implementation into the ZLayer</span><br></span><span class="token-line"><span class="token plain">object LoggingLive {</span><br></span><span class="token-line"><span class="token plain">  val layer: URLayer[Console with Clock, Logging] =</span><br></span><span class="token-line"><span class="token plain">    ZLayer {</span><br></span><span class="token-line"><span class="token plain">      for {</span><br></span><span class="token-line"><span class="token plain">        console &lt;- ZIO.service[Console]</span><br></span><span class="token-line"><span class="token plain">        clock   &lt;- ZIO.service[Clock]</span><br></span><span class="token-line"><span class="token plain">      } yield LoggingLive(console, clock)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As we see, we have the following changes:</p><ol><li><p><strong>Deprecation of Type Alias for <code>Has</code> Wrappers</strong> â€” In <em>Service Pattern 1.0</em> although the type aliases were to prevent using <code>Has[ServiceName]</code> boilerplate everywhere, they were confusing, and led to doubly nested <code>Has[Has[ServiceName]]</code>. So the <em>Service Pattern 2.0</em> doesn&#x27;t anymore encourage using type aliases. Also, they were removed from all built-in ZIO services. So, the <code>type Console = Has[Console.Service]</code> removed and the <code>Console.Service</code> will just be <code>Console</code>.</p></li><li><p><strong>Introducing Constructor-based Dependency Injection</strong> â€” In <em>Service Pattern 1.0</em> when we wanted to create a layer that depends on other services, we had to use <code>ZLayer.fromService*</code> constructors. The problem with the <code>ZLayer</code> constructors is that there are too many constructors each one is useful for a specific use-case, but people had troubled in spending a lot of time figuring out which one to use. </p><p>In <em>Service Pattern 2.0</em> we don&#x27;t worry about all these different <code>ZLayer</code> constructors. It recommends <strong>providing dependencies as interfaces through the case class constructor</strong>, and then we have direct access to all of these dependencies to implement the service. Finally, to create the <code>ZLayer</code> we use a for comprehension.</p></li><li><p><strong>Separated Interface</strong> â€” In the <em>Service Pattern 2.0</em>, ZIO supports the <em>Separated Interface</em> pattern which encourages keeping the implementation of an interface decoupled from the client and its definition.</p><p> As our application grows, where we define our layers matters more. <em>Separated Interface</em> is a very useful pattern while we are developing a complex application. It helps us to reduce the coupling between application components. </p><p> Following two changes in <em>Service Pattern</em> we can define the service definition in one package but its implementations in other packages:</p><ol><li><p><strong>Flattened Structure</strong> â€” In the new pattern, everything is at the top level in a file. So the developer is not limited to package service definition and service implementation in one package.</p><blockquote><p><strong><em>Note</em></strong>:</p><p>Service Pattern 2.0 supports the idea of <em>Separated Interface</em>, but it doesn&#x27;t enforce us grouping them into different packages and modules. The decision is up to us, based on the complexity and requirements of our application.</p></blockquote></li><li><p><strong>Decoupling Interfaces from Implementation</strong> â€” Assume we have a complex application, and our interface is <code>Logging</code> with different implementations that potentially depend on entirely different modules. Putting layers in the service definition means anyone depending on the service definition needs to depend on all the dependencies of all the implementations, which is not a good practice.</p><p>In Service Pattern 2.0, layers are defined in the implementation&#x27;s companion object, not in the interface&#x27;s companion object. So instead of calling <code>Logging.live</code> to access the live implementation we call <code>LoggingLive.layer</code>.</p></li></ol></li><li><p><strong>Accessor Methods</strong> â€” The new pattern reduced one level of indirection on writing accessor methods. So instead of accessing the environment (<code>ZIO.access/ZIO.accessM</code>) and then retrieving the service from the environment (<code>Has#get</code>) and then calling the service method, the <em>Service Pattern 2.0</em> introduced the <code>ZIO.serviceWith</code> that is a more concise way of writing accessor methods. For example, instead of <code>ZIO.accessM(_.get.log(line))</code> we write <code>ZIO.serviceWithZIO(_.log(line))</code>.</p></li></ol><p>The <em>Service Pattern 1.0</em> was somehow complicated and had some boilerplates. The <em>Service Pattern 2.0</em> is so much familiar to people coming from an object-oriented world. So it is so much easy to learn for newcomers. The new pattern is much simpler.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="other-changes">Other Changes<a class="hash-link" href="#other-changes" title="Direct link to heading">â€‹</a></h3><p>Here is list of other deprecated methods:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>ZLayer.fromEffect</code></td><td><code>ZLayer.fromZIO</code></td></tr><tr><td><code>ZLayer.fromEffectMany</code></td><td><code>ZLayer.fromZIOMany</code></td></tr><tr><td><code>ZLayer.fromFunctionM</code></td><td><code>ZLayer.fromFunctionZIO</code></td></tr><tr><td><code>ZLayer.fromFunctionManyM</code></td><td><code>ZLayer.fromFunctionManyZIO</code></td></tr><tr><td><code>ZLayer.identity</code></td><td><code>ZLayer.environment</code></td></tr><tr><td><code>ZLayer.requires</code></td><td><code>ZLayer.environment</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="scopes">Scopes<a class="hash-link" href="#scopes" title="Direct link to heading">â€‹</a></h2><p>ZIO 2.x introduced a new data type called <code>Scope</code>. Scopes are a huge simplification to resource management in ZIO 2.0 that brings new levels of simplicity, power, and performance. They are a replacement for the old <code>ZManaged</code> data type in ZIO 1.x.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="zmanaged">ZManaged<a class="hash-link" href="#zmanaged" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, we used a data type called <code>ZManaged</code> to provide resource safety. Although inspired by the Managed data type from Haskell, ZIO Managed innovated in a number of ways over both Haskell and Cats Effect Resource:</p><ol><li><p><code>ZManaged</code> supported interruptible acquisition, which is useful for concurrent data structures like semaphores, where it is safe to interrupt acquisition because the cleanup can determine (by inspecting the in-memory state) whether the acquisition succeeded or not.</p></li><li><p><code>ZManaged</code> supported parallel operations, all with the most desirable semantics possible. For example, if we acquired resources in parallel, then they would be released in parallel, and if anything went wrong, of course, the acquisition would be aborted and resources released.</p></li><li><p><code>ZManaged</code> has an API almost identical to <code>ZIO</code>, by design, so our knowledge of <code>ZIO</code> transfers to <code>Managed</code>. The main difference is that in <code>ZManaged</code>, <code>flatMap</code> lets us <em>use and keep open a resource</em>, while <code>use</code> lets us <em>use and release the resource (going back to <code>ZIO</code>)</em>.</p></li><li><p>In addition, <code>ZManaged</code> has new constructors, so we can create them from a pair of acquire/release actions, or from just a finalizer (which would be invoked during finalization).</p></li></ol><p>Despite the innovation and numerous benefits, however, <code>ZManaged</code> presents some serious drawbacks:</p><ul><li><p>First, <code>ZManaged</code> is yet another thing to teach to developers. Many new <code>ZIO</code> developers try to avoid using <code>ZManaged</code>, because they are not sure exactly what it&#x27;s for or how it differs from <code>ZIO</code>. Those who use it, sometimes wonder when to use <code>ZIO</code> versus <code>ZManaged</code>.</p></li><li><p>Second, all the methods on <code>ZIO</code> must be manually and painstakingly re-implemented on <code>ZManaged</code>, but with much more complex implementations due to the complications of handling resource-safety in the presence of concurrency. In practice, <code>ZIO</code> still has more methods than <code>ZManaged</code>.</p></li><li><p>Third, <code>ZManaged</code> is a layer over <code>ZIO</code>, and is slower than <code>ZIO</code> itself, because of the additional complications and wrapping. Unlike other approaches, <code>ZIO</code> uses an executable encoding, so it&#x27;s able to avoid double-interpretation, but it still has measurable overhead over <code>ZIO</code>.</p></li></ul><p>Despite the drawbacks of <code>ZManaged</code>, the benefits of concurrent resource safety are significant, so we documented, supported, and tried to optimize <code>ZManaged</code> over the life of ZIO 1.x, not having a suitable alternative.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="scopes-1">Scopes<a class="hash-link" href="#scopes-1" title="Direct link to heading">â€‹</a></h3><p>The concept of scopes has been implicit in ZIO since before ZIO 1.0, including in <code>ZManaged</code>, <code>FiberRef</code>, interruptibility, and thread pool shifting. In each of these cases we &quot;do something&quot; at the beginning of the scope (e.g. acquire a resource, set a <code>FiberRef</code>, change the interruptibility of the thread pool) and &quot;do something else&quot; (release the resource, restore the <code>FiberRef</code>, restore the interruptibility or thread pool) at the end of the scope.</p><p>However, scopes have not been first-class values, which has required the use of other data types such as <code>ZManaged</code> to represent this concept. With ZIO 2.0, all of this is radically changing for the better! Thanks to other ZIO 2.0 innovations, including the <a href="#has">removal of <code>Has</code></a> (which bakes a compositional environment directly into the ZIO data type), we have found a way to delete <code>ZManaged</code> entirely, while preserving all of its benefits!</p><p>ZIO 2.x addresses this by introducing the concept of a Scope as a first class value:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">trait Scope {</span><br></span><span class="token-line"><span class="token plain">  def addFinalizerExit(finalizer: Exit[Any, Any] =&gt; UIO[Any]): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">  def close(exit: Exit[Any, Any]): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>That is, a <code>Scope</code> is something that we can add finalizers to and eventually close, running all of the finalizers in the scope. Operations that acquire resources add their finalizers directly to the current scope, stored in ZIO Environment. So we found that the ZIO Environment is now powerful enough to provide resource-safety by itself!</p><p>For example, an operation that opens a file might have this type signature:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">def openFile(name: String): ZIO[Scope, IOException, FileInputStream] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.acquireRelease(acquire)(release)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>openFile</code> workflow requires a <code>Scope</code> to be run and its implementation will add a finalizer to the scope that will close the file. So, in combination with the environment, we can use <code>Scope</code> to represent resources.</p><p>This allows us to work with the resource and compose it with other resources, much like we do with <code>ZManaged</code>. Then, when we are ready to close the scope we use <code>ZIO.scoped</code> to provide the scope and eliminate it from the environment, much the same way we do with <code>use</code> on <code>ZManaged</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.scoped {</span><br></span><span class="token-line"><span class="token plain">  openFile(name).flatMap(file =&gt; useFile(file))  // ZIO[Scoped, IOException, Unit]</span><br></span><span class="token-line"><span class="token plain">}                                                // ZIO[Any, IOException, Unit]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>ZIO.scoped</code> eliminates <code>Scope</code> from the environment, leaving the rest of the environment unchanged. It converts the type of enclosed effect from <code>ZIO[Scoped, IOException, Unit]</code> to <code>ZIO[Any, IOException, Unit]</code>. So, we can think of it as an algebraic effect handler that handles the <code>Scope</code> effect by eliminating it from the set of algebraic effects being used. This is another use case of <a href="#eliminators-for-environmental-effects">eliminators for environmental effect</a>.</p><p>This simple, beautiful, and powerful design gives us bulletproof parallel and concurrent operators that may acquire resources with well-defined and optimal semantics in successful and failure scenarios. All the <code>ZManaged</code> semantics arise for free atop <code>ZIO</code>.</p><p>Scopes are simple because they don&#x27;t require us to learn any new data types. Scopes are powerful because ZIO has more operators than <code>ZManaged</code>, and is always <em>up to date</em> with the latest and greatest. Scopes are fast because there are no layers atop ZIO.</p><p>In addition to providing simpler, more powerful, and faster resource management, the replacement of Managed with scopes is going to tremendously simplify the ZIO API: there will not be any more <code>toManaged</code>, <code>mapManaged</code>, etc, variants. Layers will always be constructed with <code>ZIO</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="migration-from-zmanaged-to-scope">Migration from <code>ZManaged</code> to <code>Scope</code><a class="hash-link" href="#migration-from-zmanaged-to-scope" title="Direct link to heading">â€‹</a></h3><p>Migration to <code>Scope</code> is easy and straightforward. As the <code>ZManaged</code> data type is removed from <code>ZIO</code> and all usages in ZIO Core, ZIO Stream, and ZIO Test are reimplemented in terms of <code>Scope</code>. We should follow these steps to migrate the <code>ZManaged</code> codebase to <code>Scope</code>:</p><ol><li>Replace all references to <code>ZManaged[R, E, A]</code> with <code>ZIO[R with Scope, E, A]</code>.</li></ol><p>Example: </p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">object HttpClient {</span><br></span><span class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   def make(): ZManaged[Config, IOException, HttpClient] = ???</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   def make(): ZIO[Config with Scope, IOException, HttpClient] = ???</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="2"><li>Replace all references to <code>resource.use(f)</code> with <code>ZIO.scoped(resource.flatMap(f))</code>:</li></ol><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> resource.use(f)</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZIO.scoped {</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">  resource.flatMap(f) </span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Example:</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> ZManaged</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  .fromAutoCloseable(zio.blocking.effectBlockingIO(scala.io.Source.fromFile(&quot;file.txt&quot;)))</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">  .use(x =&gt; ZIO.succeed(x.getLines().length))</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZIO.scoped {</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   ZIO</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    .fromAutoCloseable(ZIO.attemptBlockingIO(scala.io.Source.fromFile(&quot;file.txt&quot;)))</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">    .flatMap(x =&gt; ZIO.succeed(x.getLines().length))</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="3"><li>Replace all <code>ZManaged</code> constructors with <code>ZIO.acquireRelease</code> or one of its variants:</li></ol><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> ZManaged.make(acquire)(release)</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZIO.acquireRelease(acqurie)(release)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Example: </p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> ZManaged.fromAutoCloseable(</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   zio.blocking.effectBlockingIO(new FileInputStream(&quot;file.txt&quot;)) </span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> )</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZIO.fromAutoCloseable(</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   ZIO.attemptBlockingIO(new FileInputStream(&quot;file.txt&quot;)) </span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="4"><li>Replace all usages of <code>ZLayer(resource)</code> or <code>resource.toLayer</code> with <code>ZLayer.scoped(resource)</code>, all references to <code>ZStream.managed(resource)</code> with <code>ZStream.scoped(resource)</code>, and so on for similar constructors:</li></ol><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> ZLayer {</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line">   resource // with type of ZManaged[R, E, A]</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> }</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZLayer.scoped {</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line">   resource // with type of ZIO[R with Scope, E, A]</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> }</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> resource.toLayer</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZLayer.scoped(resource)</span><br></span><span class="token-line"><span class="token inserted-sign inserted line"></span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> ZStream.managed(resource)</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> ZStream.scoped(resource)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="5"><li>Delete all uses of <code>toManaged_</code>:</li></ol><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> effect.toManaged_</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> effect </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol start="6"><li>Replace all uses of <code>toManaged(finalizer)</code> with <code>withFinalizer(finalizer)</code>:</li></ol><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> effect.toManaged(finalizer)</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> effect.withFinalizer(finalizer)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Example:</p><div class="codeBlockContainer_I0IT language-diff theme-code-block"><div class="codeBlockContent_wNvx diff"><pre tabindex="0" class="prism-code language-diff codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val effect: ZIO[Any, IOException, FileInputStream] = ???</span><br></span><span class="token-line"><span class="token plain"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> effect.toManaged(is =&gt; ZIO.succeed(is.close))</span><br></span><span class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> effect.withFinalizer(is =&gt; ZIO.succeed(is.close()))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Finally, let&#x27;s try a full example of converting a ZManaged codebase to the Scoped one. Assume we have written the following <code>transfer</code> function in ZIO 1.x using <code>ZManaged</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.blocking._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import java.io._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def close(resource: Closeable): URIO[Blocking, Unit] =</span><br></span><span class="token-line"><span class="token plain">  effectBlockingIO(resource.close()).orDie</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def is(file: String): ZManaged[Blocking, IOException, FileInputStream] =</span><br></span><span class="token-line"><span class="token plain">  ZManaged.make(effectBlockingIO(new FileInputStream(file)))(close)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def os(file: String): ZManaged[Blocking, IOException, FileOutputStream] =</span><br></span><span class="token-line"><span class="token plain">  ZManaged.make(effectBlockingIO(new FileOutputStream(file)))(close)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def copy(</span><br></span><span class="token-line"><span class="token plain">    from: FileInputStream,</span><br></span><span class="token-line"><span class="token plain">    to: FileOutputStream</span><br></span><span class="token-line"><span class="token plain">): ZIO[Blocking, IOException, Unit] =</span><br></span><span class="token-line"><span class="token plain">  effectBlockingIO {</span><br></span><span class="token-line"><span class="token plain">    val buf = new Array[Byte](1024)</span><br></span><span class="token-line"><span class="token plain">    var length = 0</span><br></span><span class="token-line"><span class="token plain">    length = from.read(buf)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">    while (length &gt; 0) {</span><br></span><span class="token-line"><span class="token plain">      to.write(buf, 0, length)</span><br></span><span class="token-line"><span class="token plain">      length = from.read(buf)</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def transfer(from: String, to: String): ZIO[Blocking, IOException, Unit] = {</span><br></span><span class="token-line"><span class="token plain">  val resource = for {</span><br></span><span class="token-line"><span class="token plain">    from &lt;- is(from)</span><br></span><span class="token-line"><span class="token plain">    to   &lt;- os(to)</span><br></span><span class="token-line"><span class="token plain">    _    &lt;- copy(from, to).toManaged_</span><br></span><span class="token-line"><span class="token plain">  } yield ()</span><br></span><span class="token-line"><span class="token plain">  resource.useNow</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As of ZIO 2.x, we should rewrite it as follows:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">import java.io._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def close(resource: Closeable): UIO[Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.attempt(resource.close()).orDie</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def is(file: String): ZIO[Scope, IOException, FileInputStream] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.acquireRelease(ZIO.attemptBlockingIO(new FileInputStream(file)))(close)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def os(file: String): ZIO[Scope, IOException, FileOutputStream] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.acquireRelease(ZIO.attemptBlockingIO(new FileOutputStream(file)))(close)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def copy(</span><br></span><span class="token-line"><span class="token plain">    from: FileInputStream,</span><br></span><span class="token-line"><span class="token plain">    to: FileOutputStream</span><br></span><span class="token-line"><span class="token plain">): IO[IOException, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.attemptBlockingIO(???)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def transfer(from: String, to: String): IO[Throwable, Unit] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.scoped {</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      from &lt;- is(from)</span><br></span><span class="token-line"><span class="token plain">      to   &lt;- os(to)</span><br></span><span class="token-line"><span class="token plain">      _    &lt;- copy(from, to)</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As we can see, the migration is quite straightforward, and it doesn&#x27;t require much extra work.</p><p>For reasons of backward compatibility, <code>ZManaged</code> won&#x27;t actually be deleted, but rather, moved to a separate library called <code>zio-managed</code> that our ZIO 2.0 application can depend on. However, ZIO Core, including ZIO Streams and ZIO Test, will no longer use <code>ZManaged</code>.</p><p>So, if we have a lot of code that used <code>ZManaged</code> and we are not ready to deal with it right now we can still use the <code>ZManaged</code> data type and compile our code. We can add the <code>zio-managed</code> dependency into the <code>build.sbt</code> file:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">libraryDependencies += &quot;dev.zio&quot; %% &quot;zio-managed&quot; % &quot;&lt;2.x version&gt;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>And then by importing <code>zio.managed._</code> we can access all <code>ZManaged</code> capabilities including extension methods on ZIO data types. This helps us to compile the ZIO 1.x code base which uses the <code>ZManaged</code> data type. Then we can smoothly refactor it to use the <code>Scope</code> data type instead.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="ref">Ref<a class="hash-link" href="#ref" title="Direct link to heading">â€‹</a></h2><p>ZIO 2.x unifies <code>Ref</code> and <code>RefM</code>. <code>RefM</code> becomes a subtype of <code>Ref</code> that has additional capabilities (i.e. the ability to perform effects within the operations) at some cost to performance:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>RefM</code></td><td><code>Ref.Synchronized</code></td></tr></tbody></table><p>As the <code>RefM</code> is renamed to <code>Ref.Synchronized</code>; now the <code>Synchronized</code> is a subtype of <code>Ref</code>. This change allows a <code>Ref.Synchronized</code> to be used anywhere a <code>Ref</code> is currently being used.</p><p>To perform the migration, after renaming these types to the newer ones (e.g. <code>RefM</code> renamed to <code>Ref.Synchronized</code>) we should perform the following method renames:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>RefM#dequeueRef</code></td><td><code>Ref.Synchronized#SubscriptionRef</code></td></tr><tr><td><code>RefM#getAndUpdate</code></td><td><code>Ref.Synchronized#getAndUpdateZIO</code></td></tr><tr><td><code>RefM#getAndUpdateSome</code></td><td><code>Ref.Synchronized#getAndUpdateSomeZIO</code></td></tr><tr><td><code>RefM#modify</code></td><td><code>Ref.Synchronized#modifyZIO</code></td></tr><tr><td><code>RefM#modifySome</code></td><td><code>Ref.Synchronized#modifySomeZIO</code></td></tr><tr><td><code>RefM#update</code></td><td><code>Ref.Synchronized#updateZIO</code></td></tr><tr><td><code>RefM#updateAndGet</code></td><td><code>Ref.Synchronized#updateAndGetZIO</code></td></tr><tr><td><code>RefM#updateSome</code></td><td><code>Ref.Synchronized#updateSomeZIO</code></td></tr><tr><td><code>RefM#updateSomeAndGet</code></td><td><code>Ref.Synchronized#updateSomeAndGetZIO</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="semaphore-and-tsemaphore">Semaphore and TSemaphore<a class="hash-link" href="#semaphore-and-tsemaphore" title="Direct link to heading">â€‹</a></h2><p>There is a slight change on <code>TSemaphore#withPermit</code> method. In ZIO 2.x, instead of accepting <code>STM</code> values, it accepts only <code>ZIO</code> values and returns the <code>ZIO</code> value.</p><table><thead><tr><th><code>withPermit</code></th><th>Input</th><th>Output</th></tr></thead><tbody><tr><td>ZIO 1.x</td><td><code>STM[E, B]</code></td><td><code>STM[E, B]</code></td></tr><tr><td>ZIO 2.x</td><td><code>ZIO[R, E, A]</code></td><td><code>ZIO[R, E, A]</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="queue">Queue<a class="hash-link" href="#queue" title="Direct link to heading">â€‹</a></h2><p>In ZIO 2.x, the <code>Queue</code> uses <code>Chunk</code> consistently with other ZIO APIs like ZIO Streams. This will avoid unnecessary conversions between collection types, particularly for streaming applications where streams use <code>Chunk</code> internally, but bulk take operations previously returned a <code>List</code> on <code>Queue</code>.</p><p>Here is a list of affected APIs: <code>takeAll</code>, <code>takeUpTo</code>, <code>takeBetween</code>, <code>takeN</code>, <code>unsafePollAll</code>, <code>unsafePollN</code>, and <code>unsafeOfferAll</code>. Let&#x27;s see an example:</p><p>ZIO 1.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val taken: UIO[List[Int]] = for {</span><br></span><span class="token-line"><span class="token plain">  queue &lt;- Queue.bounded[Int](100)</span><br></span><span class="token-line"><span class="token plain">  _     &lt;- queue.offer(10)</span><br></span><span class="token-line"><span class="token plain">  _     &lt;- queue.offer(20)</span><br></span><span class="token-line"><span class="token plain">  list  &lt;- queue.takeUpTo(5)</span><br></span><span class="token-line"><span class="token plain">} yield list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ZIO 2.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val taken: UIO[Chunk[Int]] = for {</span><br></span><span class="token-line"><span class="token plain">  queue &lt;- Queue.bounded[Int](100)</span><br></span><span class="token-line"><span class="token plain">  _     &lt;- queue.offer(10)</span><br></span><span class="token-line"><span class="token plain">  _     &lt;- queue.offer(20)</span><br></span><span class="token-line"><span class="token plain">  chunk &lt;- queue.takeUpTo(5)</span><br></span><span class="token-line"><span class="token plain">} yield chunk</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="zio-test">ZIO Test<a class="hash-link" href="#zio-test" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="composable-test-apps">Composable Test Apps<a class="hash-link" href="#composable-test-apps" title="Direct link to heading">â€‹</a></h3><p>In ZIO 2.x, the <code>DefaultRunnableSpec</code> deprecated, so in order to write tests, we should extend the <code>ZIOSpecDefault</code> abstract class. Due to this change, executable tests can be composed, similar to <code>ZIOAppDefault</code>:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio.ZIOApp</span><br></span><span class="token-line"><span class="token plain">import zio.test._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ExampleSpec1 extends ZIOSpecDefault {</span><br></span><span class="token-line"><span class="token plain">  def spec = suite(&quot;suite 1&quot;)(</span><br></span><span class="token-line"><span class="token plain">    test(&quot;passing test 1&quot;)(assertTrue(true)),</span><br></span><span class="token-line"><span class="token plain">    test(&quot;failing test 2&quot;)(assertTrue(false))</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ExampleSpec2 extends ZIOSpecDefault {</span><br></span><span class="token-line"><span class="token plain">  def spec = suite(&quot;suite 2&quot;)(</span><br></span><span class="token-line"><span class="token plain">    test(&quot;passing test&quot;)(assertTrue(true))</span><br></span><span class="token-line"><span class="token plain">  )</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object AllSpecs extends ZIOApp.Proxy(ExampleSpec1 &lt;&gt; ExampleSpec2)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To run <code>AllSpecs</code> with sbt:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">sbt Test/runMain AllSpecs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="smart-constructors">Smart Constructors<a class="hash-link" href="#smart-constructors" title="Direct link to heading">â€‹</a></h3><p>By introducing smart constructors, we do not longer have the <code>testM</code> function to create effectful test suits. Instead, we should use the <code>test</code> function:</p><p>ZIO 1.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">suite(&quot;Ref&quot;) {</span><br></span><span class="token-line"><span class="token plain">  testM(&quot;updateAndGet&quot;) {</span><br></span><span class="token-line"><span class="token plain">    val result = Ref.make(0).flatMap(_.updateAndGet(_ + 1))</span><br></span><span class="token-line"><span class="token plain">    assertM(result)(Assertion.equalTo(1))</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ZIO 2.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">suite(&quot;Ref&quot;) {</span><br></span><span class="token-line"><span class="token plain">  test(&quot;updateAndGet&quot;) {</span><br></span><span class="token-line"><span class="token plain">    val result = Ref.make(0).flatMap(_.updateAndGet(_ + 1))</span><br></span><span class="token-line"><span class="token plain">    assertM(result)(Assertion.equalTo(1))</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 2.x, to create a test suite, it&#x27;s not important that whether we are testing pure or effectful tests. The syntax is the same, and the <code>test</code>, and <code>testM</code> are unified. So the <code>testM</code> was removed.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="smart-assertion">Smart Assertion<a class="hash-link" href="#smart-assertion" title="Direct link to heading">â€‹</a></h3><p>ZIO 2.x, introduced a new test method, named <code>assertTrue</code> which allows us to assert an expected behavior using ordinary Scala expressions that return <code>Boolean</code> values instead of specialized assertion operators.</p><p>So instead of writing following test assertions:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val list   = List(1, 2, 3, 4, 5)</span><br></span><span class="token-line"><span class="token plain">val number = 3</span><br></span><span class="token-line"><span class="token plain">val option = Option.empty[Int]</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">suite(&quot;ZIO 1.x Test Assertions&quot;)(</span><br></span><span class="token-line"><span class="token plain">  test(&quot;contains&quot;)(assert(list)(Assertion.contains(5))),</span><br></span><span class="token-line"><span class="token plain">  test(&quot;forall&quot;)(assert(list)(Assertion.forall(Assertion.assertion(&quot;even&quot;)()(actual =&gt; actual % 2 == 0)))),</span><br></span><span class="token-line"><span class="token plain">  test(&quot;less than&quot;)(assert(number)(Assertion.isLessThan(0))),</span><br></span><span class="token-line"><span class="token plain">  test(&quot;isSome&quot;)(assert(option)(Assertion.equalTo(Some(3))))</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can write them like this:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">suite(&quot;ZIO 2.x SmartAssertions&quot;)(</span><br></span><span class="token-line"><span class="token plain">  test(&quot;contains&quot;)(assertTrue(list.contains(5))),</span><br></span><span class="token-line"><span class="token plain">  test(&quot;forall&quot;)(assertTrue(list.forall(_ % 2 == 0))),</span><br></span><span class="token-line"><span class="token plain">  test(&quot;less than&quot;)(assertTrue(number &lt; 0)),</span><br></span><span class="token-line"><span class="token plain">  test(&quot;isSome&quot;)(assertTrue(option.get == 3))</span><br></span><span class="token-line"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Smart Assertions are extremely expressive, so when a test fails:</p><ul><li>They highlight the exact section of the syntax with the path leading up to the left-hand side of the assertion that causes the failure.</li><li>They have the strong and nice diffing capability which shows where our expectation varies.</li><li>When using partial functions in test cases there is no problem with the happy path, but if something goes wrong, it is a little annoying to find what went wrong. But smart assertions are descriptive, e.g., when we call <code>Option#get</code> to an optional value that is <code>None</code> the test fails with a related error message: <code>Option was None</code></li><li>They have lots of domains specific errors that talk to us in a language that we understand.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="compositional-specs">Compositional Specs<a class="hash-link" href="#compositional-specs" title="Direct link to heading">â€‹</a></h3><p>In ZIO 1.x, we cannot compose specs directly, although if we can combine all children&#x27;s specs via the suite itself:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val fooSuite = suite(&quot;Foo&quot;)(fooSpec)</span><br></span><span class="token-line"><span class="token plain">val barSuite = suite(&quot;Bar&quot;)(barSpec)</span><br></span><span class="token-line"><span class="token plain">val bazSuite = suite(&quot;Baz&quot;)(bazSpec)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val bigSuite = suite(&quot;big suite&quot;)(fooSuite, barSuite, bazSuite)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Now in ZIO 2.x, we can compose two suites using <em>binary composition operator</em> without having to unnecessarily nest them inside another suite just for purpose of composition:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val bigSuite = fooSuite + barSuite + bazSuite</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="zio-streams">ZIO Streams<a class="hash-link" href="#zio-streams" title="Direct link to heading">â€‹</a></h2><p>ZIO Streams 2.x, does not include any significant API changes. Almost the same code we have for ZIO Stream 1.x, this will continue working and doesn&#x27;t break our code. So we don&#x27;t need to relearn any APIs. So we have maintained a quite good source compatibility, but have to forget some API elements.</p><p>So far, before ZIO 2.0, the ZIO Stream has included three main abstractions:</p><ol><li><strong><code>ZStream</code></strong> â€” represents the source of elements</li><li><strong><code>ZSink</code></strong> â€” represents consumers of elements that can be composed together to create composite consumers</li><li><strong><code>ZTransducer</code></strong> â€” represents generalized stateful and effectful stream processing</li></ol><p><img alt="ZIO Streams 1.x" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gR2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCBWaXNpbywgU1ZHIEV4cG9ydCB6aW8tc3RyZWFtcy0xLnN2ZyBQYWdlLTEgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZXY9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEveG1sLWV2ZW50cyIKCQl4bWxuczp2PSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3Zpc2lvLzIwMDMvU1ZHRXh0ZW5zaW9ucy8iIHdpZHRoPSI1Ljc2NzM2aW4iIGhlaWdodD0iMS41MTczNmluIgoJCXZpZXdCb3g9IjAgMCA0MTUuMjUgMTA5LjI1IiB4bWw6c3BhY2U9InByZXNlcnZlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiIGNsYXNzPSJzdDYiPgoJPHY6ZG9jdW1lbnRQcm9wZXJ0aWVzIHY6bGFuZ0lEPSIxMDMzIiB2OnZpZXdNYXJrdXA9ImZhbHNlIj4KCQk8djp1c2VyRGVmcz4KCQkJPHY6dWQgdjpuYW1lVT0ibXN2Tm9BdXRvQ29ubmVjdCIgdjp2YWw9IlZUMCgxKToyNiIvPgoJCTwvdjp1c2VyRGVmcz4KCTwvdjpkb2N1bWVudFByb3BlcnRpZXM+CgoJPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCTwhW0NEQVRBWwoJCS5zdDEge2ZpbGw6dXJsKCNncmFkMC00KTtzdHJva2U6IzAwMDAwMDtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLXdpZHRoOjEuMjV9CgkJLnN0MiB7ZmlsbDojMDAwMDAwO2ZvbnQtZmFtaWx5OkNhbGlicmk7Zm9udC1zaXplOjEuNWVtfQoJCS5zdDMge21hcmtlci1lbmQ6dXJsKCNtcmtyNC0yMCk7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS13aWR0aDoxfQoJCS5zdDQge2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS13aWR0aDowLjI4NDA5MDkwOTA5MDkxfQoJCS5zdDUge2ZpbGw6bm9uZTtzdHJva2U6bm9uZTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLXdpZHRoOjAuNzV9CgkJLnN0NiB7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO2ZvbnQtc2l6ZToxMnB4O292ZXJmbG93OnZpc2libGU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1taXRlcmxpbWl0OjN9CgldXT4KCTwvc3R5bGU+CgoJPGRlZnMgaWQ9IlBhdHRlcm5zX0FuZF9HcmFkaWVudHMiPgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDAtNCIgeDE9IjAiIHkxPSIwIiB4Mj0iMSIgeTI9IjAiIGdyYWRpZW50VHJhbnNmb3JtPSJyb3RhdGUoOTAgMC41IDAuNSkiPgoJCQk8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmZmZmZmYiIHN0b3Atb3BhY2l0eT0iMSIvPgoJCQk8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNkOGQ4ZDgiIHN0b3Atb3BhY2l0eT0iMSIvPgoJCTwvbGluZWFyR3JhZGllbnQ+Cgk8L2RlZnM+Cgk8ZGVmcyBpZD0iTWFya2VycyI+CgkJPGcgaWQ9ImxlbmQ0Ij4KCQkJPHBhdGggZD0iTSAyIDEgTCAwIDAgTCAyIC0xIEwgMiAxICIgc3R5bGU9InN0cm9rZTpub25lIi8+CgkJPC9nPgoJCTxtYXJrZXIgaWQ9Im1ya3I0LTIwIiBjbGFzcz0ic3Q0IiB2OmFycm93VHlwZT0iNCIgdjphcnJvd1NpemU9IjIiIHY6c2V0YmFjaz0iNy4wNCIgcmVmWD0iLTcuMDQiIG9yaWVudD0iYXV0byIKCQkJCW1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgb3ZlcmZsb3c9InZpc2libGUiPgoJCQk8dXNlIHhsaW5rOmhyZWY9IiNsZW5kNCIgdHJhbnNmb3JtPSJzY2FsZSgtMy41MiwtMy41MikgIi8+CgkJPC9tYXJrZXI+Cgk8L2RlZnM+Cgk8ZyB2Om1JRD0iMCIgdjppbmRleD0iMSIgdjpncm91cENvbnRleHQ9ImZvcmVncm91bmRQYWdlIj4KCQk8dGl0bGU+UGFnZS0xPC90aXRsZT4KCQk8djpwYWdlUHJvcGVydGllcyB2OmRyYXdpbmdTY2FsZT0iMSIgdjpwYWdlU2NhbGU9IjEiIHY6ZHJhd2luZ1VuaXRzPSIxOSIgdjpzaGFkb3dPZmZzZXRYPSI5IiB2OnNoYWRvd09mZnNldFk9Ii05Ii8+CgkJPHY6bGF5ZXIgdjpuYW1lPSJDb21tb24gSWNvbnMiIHY6aW5kZXg9IjAiLz4KCQk8djpsYXllciB2Om5hbWU9IkNvbm5lY3RvciIgdjppbmRleD0iMSIvPgoJCTx2OmxheWVyIHY6bmFtZT0iQ29udGFpbmVyIiB2OmluZGV4PSIyIi8+CgkJPGcgaWQ9InNoYXBlMS0xIiB2Om1JRD0iMSIgdjpncm91cENvbnRleHQ9InNoYXBlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOC42MjUsLTE4LjYyNSkiPgoJCQk8dGl0bGU+U2hlZXQuMTwvdGl0bGU+CgkJCTxkZXNjPlpTdHJlYW08L2Rlc2M+CgkJCTx2OnRleHRCbG9jayB2Om1hcmdpbnM9InJlY3QoNCw0LDQsNCkiLz4KCQkJPHY6dGV4dFJlY3QgY3g9IjU0IiBjeT0iNzMuMjUiIHdpZHRoPSIxMDguMDEiIGhlaWdodD0iNzIiLz4KCQkJPHJlY3QgeD0iMCIgeT0iMzcuMjUiIHdpZHRoPSIxMDgiIGhlaWdodD0iNzIiIHJ4PSI5IiByeT0iOSIgY2xhc3M9InN0MSIvPgoJCQk8dGV4dCB4PSIyMy41MiIgeT0iNzguNjUiIGNsYXNzPSJzdDIiIHY6bGFuZ0lEPSIxMDMzIj48djpwYXJhZ3JhcGggdjpob3JpekFsaWduPSIxIi8+PHY6dGFiTGlzdC8+WlN0cmVhbTwvdGV4dD4JCTwvZz4KCQk8ZyBpZD0ic2hhcGUyLTYiIHY6bUlEPSIyIiB2Omdyb3VwQ29udGV4dD0ic2hhcGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1My42MjUsLTE4LjYyNSkiPgoJCQk8dGl0bGU+U2hlZXQuMjwvdGl0bGU+CgkJCTxkZXNjPlpUcmFuc2R1Y2VyPC9kZXNjPgoJCQk8djp0ZXh0QmxvY2sgdjptYXJnaW5zPSJyZWN0KDQsNCw0LDQpIi8+CgkJCTx2OnRleHRSZWN0IGN4PSI1NCIgY3k9IjczLjI1IiB3aWR0aD0iMTA4LjAxIiBoZWlnaHQ9IjcyIi8+CgkJCTxyZWN0IHg9IjAiIHk9IjM3LjI1IiB3aWR0aD0iMTA4IiBoZWlnaHQ9IjcyIiByeD0iOSIgcnk9IjkiIGNsYXNzPSJzdDEiLz4KCQkJPHRleHQgeD0iOC44MiIgeT0iNzguNjUiIGNsYXNzPSJzdDIiIHY6bGFuZ0lEPSIxMDMzIj48djpwYXJhZ3JhcGggdjpob3JpekFsaWduPSIxIi8+PHY6dGFiTGlzdC8+WlRyYW5zZHVjZXI8L3RleHQ+CQk8L2c+CgkJPGcgaWQ9InNoYXBlNS0xMCIgdjptSUQ9IjUiIHY6Z3JvdXBDb250ZXh0PSJzaGFwZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjg4LjYyNSwtMTguNjI1KSI+CgkJCTx0aXRsZT5TaGVldC41PC90aXRsZT4KCQkJPGRlc2M+WlNpbms8L2Rlc2M+CgkJCTx2OnRleHRCbG9jayB2Om1hcmdpbnM9InJlY3QoNCw0LDQsNCkiLz4KCQkJPHY6dGV4dFJlY3QgY3g9IjU0IiBjeT0iNzMuMjUiIHdpZHRoPSIxMDguMDEiIGhlaWdodD0iNzIiLz4KCQkJPHJlY3QgeD0iMCIgeT0iMzcuMjUiIHdpZHRoPSIxMDgiIGhlaWdodD0iNzIiIHJ4PSI5IiByeT0iOSIgY2xhc3M9InN0MSIvPgoJCQk8dGV4dCB4PSIzNC43NyIgeT0iNzguNjUiIGNsYXNzPSJzdDIiIHY6bGFuZ0lEPSIxMDMzIj48djpwYXJhZ3JhcGggdjpob3JpekFsaWduPSIxIi8+PHY6dGFiTGlzdC8+WlNpbms8L3RleHQ+CQk8L2c+CgkJPGcgaWQ9Imdyb3VwMTgtMTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2MS42MjUsLTQ1LjYyNSkiIHY6bUlEPSIxOCIgdjpncm91cENvbnRleHQ9Imdyb3VwIj4KCQkJPHRpdGxlPlNoZWV0LjE4PC90aXRsZT4KCQkJPGcgaWQ9InNoYXBlMTctMTUiIHY6bUlEPSIxNyIgdjpncm91cENvbnRleHQ9InNoYXBlIiB2OmxheWVyTWVtYmVyPSIxIj4KCQkJCTx0aXRsZT5EeW5hbWljIGNvbm5lY3RvcjwvdGl0bGU+CgkJCQk8cGF0aCBkPSJNMCAxMDAuMjUgTDE5Ljk2IDEwMC4yNSIgY2xhc3M9InN0MyIvPgoJCQk8L2c+CgkJPC9nPgoJCTxnIGlkPSJncm91cDE5LTIxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjcuMDc1LC00Ny40MjUpIiB2Om1JRD0iMTkiIHY6Z3JvdXBDb250ZXh0PSJncm91cCI+CgkJCTx0aXRsZT5TaGVldC4xOTwvdGl0bGU+CgkJCTxnIGlkPSJzaGFwZTIwLTIyIiB2Om1JRD0iMjAiIHY6Z3JvdXBDb250ZXh0PSJzaGFwZSIgdjpsYXllck1lbWJlcj0iMSI+CgkJCQk8dGl0bGU+RHluYW1pYyBjb25uZWN0b3I8L3RpdGxlPgoJCQkJPHBhdGggZD0iTTAgMTAwLjI1IEwxOS45NiAxMDAuMjUiIGNsYXNzPSJzdDMiLz4KCQkJPC9nPgoJCTwvZz4KCQk8ZyBpZD0ic2hhcGUyMS0yNyIgdjptSUQ9IjIxIiB2Omdyb3VwQ29udGV4dD0ic2hhcGUiPgoJCQk8dGl0bGU+U2hlZXQuMjE8L3RpdGxlPgoJCQk8cmVjdCB4PSIwIiB5PSIxLjI0OTk5IiB3aWR0aD0iNDE0IiBoZWlnaHQ9IjEwOCIgY2xhc3M9InN0NSIvPgoJCTwvZz4KCTwvZz4KPC9zdmc+Cg==" width="554" height="146"></p><p>In ZIO 2.0, we added an underlying abstraction called <code>Channel</code>. Channels are underlying both the <code>Stream</code> and <code>Sink</code>. So streams and sinks are just channels. So the <code>Channel</code> is an abstraction that unifies everything in ZIO Streams.</p><p><img alt="ZChannel" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gR2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCBWaXNpbywgU1ZHIEV4cG9ydCB6aW8tc3RyZWFtcy16Y2hhbm5lbC5zdmcgUGFnZS0xIC0tPgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbG5zOmV2PSJodHRwOi8vd3d3LnczLm9yZy8yMDAxL3htbC1ldmVudHMiCgkJeG1sbnM6dj0iaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS92aXNpby8yMDAzL1NWR0V4dGVuc2lvbnMvIiB3aWR0aD0iNi4yNjA0MmluIiBoZWlnaHQ9IjIuMDEwNDJpbiIKCQl2aWV3Qm94PSIwIDAgNDUwLjc1IDE0NC43NSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIiBjbGFzcz0ic3Q1Ij4KCTx2OmRvY3VtZW50UHJvcGVydGllcyB2OmxhbmdJRD0iMTAzMyIgdjp2aWV3TWFya3VwPSJmYWxzZSI+CgkJPHY6dXNlckRlZnM+CgkJCTx2OnVkIHY6bmFtZVU9Im1zdk5vQXV0b0Nvbm5lY3QiIHY6dmFsPSJWVDAoMSk6MjYiLz4KCQk8L3Y6dXNlckRlZnM+Cgk8L3Y6ZG9jdW1lbnRQcm9wZXJ0aWVzPgoKCTxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgk8IVtDREFUQVsKCQkuc3QxIHtmaWxsOm5vbmU7c3Ryb2tlOm5vbmU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS13aWR0aDowLjc1fQoJCS5zdDIge2ZpbGw6I2ZjZWJkZDtzdHJva2U6IzAwMDAwMDtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLXdpZHRoOjEuMjV9CgkJLnN0MyB7ZmlsbDojMDAwMDAwO2ZvbnQtZmFtaWx5OkNhbGlicmk7Zm9udC1zaXplOjEuNWVtfQoJCS5zdDQge2ZpbGw6dXJsKCNncmFkMC0xMSk7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS13aWR0aDoxLjI1fQoJCS5zdDUge2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtmb250LXNpemU6MTJweDtvdmVyZmxvdzp2aXNpYmxlO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbWl0ZXJsaW1pdDozfQoJXV0+Cgk8L3N0eWxlPgoKCTxkZWZzIGlkPSJQYXR0ZXJuc19BbmRfR3JhZGllbnRzIj4KCQk8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQwLTExIiB4MT0iMCIgeTE9IjAiIHgyPSIxIiB5Mj0iMCIgZ3JhZGllbnRUcmFuc2Zvcm09InJvdGF0ZSg5MCAwLjUgMC41KSI+CgkJCTxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CgkJCTxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI2Q4ZDhkOCIgc3RvcC1vcGFjaXR5PSIxIi8+CgkJPC9saW5lYXJHcmFkaWVudD4KCTwvZGVmcz4KCTxnIHY6bUlEPSIwIiB2OmluZGV4PSIxIiB2Omdyb3VwQ29udGV4dD0iZm9yZWdyb3VuZFBhZ2UiPgoJCTx0aXRsZT5QYWdlLTE8L3RpdGxlPgoJCTx2OnBhZ2VQcm9wZXJ0aWVzIHY6ZHJhd2luZ1NjYWxlPSIxIiB2OnBhZ2VTY2FsZT0iMSIgdjpkcmF3aW5nVW5pdHM9IjE5IiB2OnNoYWRvd09mZnNldFg9IjkiIHY6c2hhZG93T2Zmc2V0WT0iLTkiLz4KCQk8djpsYXllciB2Om5hbWU9IkNvbm5lY3RvciIgdjppbmRleD0iMCIvPgoJCTxnIGlkPSJncm91cDQtMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjgwLC02NCkiIHY6bUlEPSI0IiB2Omdyb3VwQ29udGV4dD0iZ3JvdXAiPgoJCQk8dGl0bGU+U2hlZXQuNDwvdGl0bGU+CgkJPC9nPgoJCTxnIGlkPSJncm91cDYtMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQ1LjQ1LC02NS44KSIgdjptSUQ9IjYiIHY6Z3JvdXBDb250ZXh0PSJncm91cCI+CgkJCTx0aXRsZT5TaGVldC42PC90aXRsZT4KCQk8L2c+CgkJPGcgaWQ9InNoYXBlOC0zIiB2Om1JRD0iOCIgdjpncm91cENvbnRleHQ9InNoYXBlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOC4zNzUsLTE4LjM3NSkiPgoJCQk8dGl0bGU+U2hlZXQuODwvdGl0bGU+CgkJCTxyZWN0IHg9IjAiIHk9IjM2Ljc1IiB3aWR0aD0iNDE0IiBoZWlnaHQ9IjEwOCIgY2xhc3M9InN0MSIvPgoJCTwvZz4KCQk8ZyBpZD0ic2hhcGU5LTUiIHY6bUlEPSI5IiB2Omdyb3VwQ29udGV4dD0ic2hhcGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4LjE4NzUsLTE4KSI+CgkJCTx0aXRsZT5TaGVldC45PC90aXRsZT4KCQkJPGRlc2M+WkNoYW5uZWw8L2Rlc2M+CgkJCTx2OnRleHRCbG9jayB2Om1hcmdpbnM9InJlY3QoNCw0LDQsNCkiLz4KCQkJPHY6dGV4dFJlY3QgY3g9IjIwNy4yODEiIGN5PSI5MS4wMzEyIiB3aWR0aD0iNDE0LjU3IiBoZWlnaHQ9IjEwNy40MzgiLz4KCQkJPHJlY3QgeD0iMCIgeT0iMzcuMzEyNSIgd2lkdGg9IjQxNC41NjIiIGhlaWdodD0iMTA3LjQzOCIgcng9IjkiIHJ5PSI5IiBjbGFzcz0ic3QyIi8+CgkJCTx0ZXh0IHg9IjE3My4yMyIgeT0iOTYuNDMiIGNsYXNzPSJzdDMiIHY6bGFuZ0lEPSIxMDMzIj48djpwYXJhZ3JhcGggdjpob3JpekFsaWduPSIxIi8+PHY6dGFiTGlzdC8+WkNoYW5uZWw8L3RleHQ+CQk8L2c+CgkJPGcgaWQ9InNoYXBlMy04IiB2Om1JRD0iMyIgdjpncm91cENvbnRleHQ9InNoYXBlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMDcsLTM3KSI+CgkJCTx0aXRsZT5TaGVldC4zPC90aXRsZT4KCQkJPGRlc2M+WlNpbms8L2Rlc2M+CgkJCTx2OnRleHRCbG9jayB2Om1hcmdpbnM9InJlY3QoNCw0LDQsNCkiLz4KCQkJPHY6dGV4dFJlY3QgY3g9IjU0IiBjeT0iMTA4Ljc1IiB3aWR0aD0iMTA4LjAxIiBoZWlnaHQ9IjcyIi8+CgkJCTxyZWN0IHg9IjAiIHk9IjcyLjc1IiB3aWR0aD0iMTA4IiBoZWlnaHQ9IjcyIiByeD0iOSIgcnk9IjkiIGNsYXNzPSJzdDQiLz4KCQkJPHRleHQgeD0iMzQuNzciIHk9IjExNC4xNSIgY2xhc3M9InN0MyIgdjpsYW5nSUQ9IjEwMzMiPjx2OnBhcmFncmFwaCB2Omhvcml6QWxpZ249IjEiLz48djp0YWJMaXN0Lz5aU2luazwvdGV4dD4JCTwvZz4KCQk8ZyBpZD0ic2hhcGUxLTEzIiB2Om1JRD0iMSIgdjpncm91cENvbnRleHQ9InNoYXBlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzNywtMzcpIj4KCQkJPHRpdGxlPlNoZWV0LjE8L3RpdGxlPgoJCQk8ZGVzYz5aU3RyZWFtPC9kZXNjPgoJCQk8djp0ZXh0QmxvY2sgdjptYXJnaW5zPSJyZWN0KDQsNCw0LDQpIi8+CgkJCTx2OnRleHRSZWN0IGN4PSI1NCIgY3k9IjEwOC43NSIgd2lkdGg9IjEwOC4wMSIgaGVpZ2h0PSI3MiIvPgoJCQk8cmVjdCB4PSIwIiB5PSI3Mi43NSIgd2lkdGg9IjEwOCIgaGVpZ2h0PSI3MiIgcng9IjkiIHJ5PSI5IiBjbGFzcz0ic3Q0Ii8+CgkJCTx0ZXh0IHg9IjIzLjUyIiB5PSIxMTQuMTUiIGNsYXNzPSJzdDMiIHY6bGFuZ0lEPSIxMDMzIj48djpwYXJhZ3JhcGggdjpob3JpekFsaWduPSIxIi8+PHY6dGFiTGlzdC8+WlN0cmVhbTwvdGV4dD4JCTwvZz4KCTwvZz4KPC9zdmc+Cg==" width="601" height="193"></p><p>Channels are nexuses of I/O operations, which support both reading and writing:</p><ul><li><p>A <code>Channel</code> can write some elements to the <em>output</em>, and it can terminate with some sort of <em>done</em> value. The <code>Channel</code> uses this <em>done</em> value to notify the downstream <code>Channel</code> that its emission of elements finished. In ZIO 2.x, the <code>ZStream</code> is encoded as an output side of the <code>Channel</code>.</p></li><li><p>A <code>Channel</code> can read from its input, and it can also terminate with some sort of <em>done</em> value, which is an upstream result. So a <code>Channel</code> has the <em>input type</em>, and the <em>input done type</em>. The <code>Channel</code> uses this <em>done</em> value to determine when the upstream <code>Channel</code> finishes its emission. In ZIO 2.x, the <code>ZSink</code> is encoded as an input side of the <code>Channel</code>.</p></li></ul><p>So we can say that streams are the output side and sinks are the input side of a <code>Channel</code>. What about the middle part? In ZIO 1.x, this used to be known as the<code>ZTransducer</code>. Transducers were great for writing high-performance codecs (e.g. compression). They were really just a specialization of sinks. We have added transducers because things were not sufficiently efficient using sinks. If we were to write streaming codecs using sinks, they could be quite slow.</p><p>In ZIO 2.x, we removed the transducers, and they were deprecated. Instead, we realized we need something else for the middle part, and now it&#x27;s called a <code>Pipeline</code> in ZIO 2.x. Pipelines accept a stream as input and return the transformed stream as output.</p><p><img alt="ZIO Streams 2.x" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gR2VuZXJhdGVkIGJ5IE1pY3Jvc29mdCBWaXNpbywgU1ZHIEV4cG9ydCB6aW8tc3RyZWFtcy0yLnguc3ZnIFBhZ2UtMSAtLT4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpldj0iaHR0cDovL3d3dy53My5vcmcvMjAwMS94bWwtZXZlbnRzIgoJCXhtbG5zOnY9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vdmlzaW8vMjAwMy9TVkdFeHRlbnNpb25zLyIgd2lkdGg9IjUuNzY3MzZpbiIgaGVpZ2h0PSIxLjUxNzM2aW4iCgkJdmlld0JveD0iMCAwIDQxNS4yNSAxMDkuMjUiIHhtbDpzcGFjZT0icHJlc2VydmUiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIgY2xhc3M9InN0NSI+Cgk8djpkb2N1bWVudFByb3BlcnRpZXMgdjpsYW5nSUQ9IjEwMzMiIHY6dmlld01hcmt1cD0iZmFsc2UiPgoJCTx2OnVzZXJEZWZzPgoJCQk8djp1ZCB2Om5hbWVVPSJtc3ZOb0F1dG9Db25uZWN0IiB2OnZhbD0iVlQwKDEpOjI2Ii8+CgkJPC92OnVzZXJEZWZzPgoJPC92OmRvY3VtZW50UHJvcGVydGllcz4KCgk8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJPCFbQ0RBVEFbCgkJLnN0MSB7ZmlsbDp1cmwoI2dyYWQwLTUpO3N0cm9rZTojMDAwMDAwO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MS4yNX0KCQkuc3QyIHtmaWxsOiMwMDAwMDA7Zm9udC1mYW1pbHk6Q2FsaWJyaTtmb250LXNpemU6MS41ZW19CgkJLnN0MyB7bWFya2VyLWVuZDp1cmwoI21ya3I0LTIxKTtzdHJva2U6IzAwMDAwMDtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLXdpZHRoOjF9CgkJLnN0NCB7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS1vcGFjaXR5OjE7c3Ryb2tlLXdpZHRoOjAuMjg0MDkwOTA5MDkwOTF9CgkJLnN0NSB7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO2ZvbnQtc2l6ZToxMnB4O292ZXJmbG93OnZpc2libGU7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlO3N0cm9rZS1taXRlcmxpbWl0OjN9CgldXT4KCTwvc3R5bGU+CgoJPGRlZnMgaWQ9IlBhdHRlcm5zX0FuZF9HcmFkaWVudHMiPgoJCTxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDAtNSIgeDE9IjAiIHkxPSIwIiB4Mj0iMSIgeTI9IjAiIGdyYWRpZW50VHJhbnNmb3JtPSJyb3RhdGUoOTAgMC41IDAuNSkiPgoJCQk8c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmZmZmZmYiIHN0b3Atb3BhY2l0eT0iMSIvPgoJCQk8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNkOGQ4ZDgiIHN0b3Atb3BhY2l0eT0iMSIvPgoJCTwvbGluZWFyR3JhZGllbnQ+Cgk8L2RlZnM+Cgk8ZGVmcyBpZD0iTWFya2VycyI+CgkJPGcgaWQ9ImxlbmQ0Ij4KCQkJPHBhdGggZD0iTSAyIDEgTCAwIDAgTCAyIC0xIEwgMiAxICIgc3R5bGU9InN0cm9rZTpub25lIi8+CgkJPC9nPgoJCTxtYXJrZXIgaWQ9Im1ya3I0LTIxIiBjbGFzcz0ic3Q0IiB2OmFycm93VHlwZT0iNCIgdjphcnJvd1NpemU9IjIiIHY6c2V0YmFjaz0iNy4wNCIgcmVmWD0iLTcuMDQiIG9yaWVudD0iYXV0byIKCQkJCW1hcmtlclVuaXRzPSJzdHJva2VXaWR0aCIgb3ZlcmZsb3c9InZpc2libGUiPgoJCQk8dXNlIHhsaW5rOmhyZWY9IiNsZW5kNCIgdHJhbnNmb3JtPSJzY2FsZSgtMy41MiwtMy41MikgIi8+CgkJPC9tYXJrZXI+Cgk8L2RlZnM+Cgk8ZyB2Om1JRD0iMCIgdjppbmRleD0iMSIgdjpncm91cENvbnRleHQ9ImZvcmVncm91bmRQYWdlIj4KCQk8dGl0bGU+UGFnZS0xPC90aXRsZT4KCQk8djpwYWdlUHJvcGVydGllcyB2OmRyYXdpbmdTY2FsZT0iMSIgdjpwYWdlU2NhbGU9IjEiIHY6ZHJhd2luZ1VuaXRzPSIxOSIgdjpzaGFkb3dPZmZzZXRYPSI5IiB2OnNoYWRvd09mZnNldFk9Ii05Ii8+CgkJPHY6bGF5ZXIgdjpuYW1lPSJDb25uZWN0b3IiIHY6aW5kZXg9IjAiLz4KCQk8ZyBpZD0iZ3JvdXAxLTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4LjYyNSwtMTguNjI1KSIgdjptSUQ9IjEiIHY6Z3JvdXBDb250ZXh0PSJncm91cCI+CgkJCTx0aXRsZT5TaGVldC4xPC90aXRsZT4KCQkJPGcgaWQ9InNoYXBlMi0yIiB2Om1JRD0iMiIgdjpncm91cENvbnRleHQ9InNoYXBlIj4KCQkJCTx0aXRsZT5TaGVldC4yPC90aXRsZT4KCQkJCTxkZXNjPlpTdHJlYW08L2Rlc2M+CgkJCQk8djp0ZXh0QmxvY2sgdjptYXJnaW5zPSJyZWN0KDQsNCw0LDQpIi8+CgkJCQk8djp0ZXh0UmVjdCBjeD0iNTQiIGN5PSI3My4yNSIgd2lkdGg9IjEwOC4wMSIgaGVpZ2h0PSI3MiIvPgoJCQkJPHJlY3QgeD0iMCIgeT0iMzcuMjUiIHdpZHRoPSIxMDgiIGhlaWdodD0iNzIiIHJ4PSI5IiByeT0iOSIgY2xhc3M9InN0MSIvPgoJCQkJPHRleHQgeD0iMjMuNTIiIHk9Ijc4LjY1IiBjbGFzcz0ic3QyIiB2OmxhbmdJRD0iMTAzMyI+PHY6cGFyYWdyYXBoIHY6aG9yaXpBbGlnbj0iMSIvPjx2OnRhYkxpc3QvPlpTdHJlYW08L3RleHQ+CQkJPC9nPgoJCQk8ZyBpZD0ic2hhcGUzLTciIHY6bUlEPSIzIiB2Omdyb3VwQ29udGV4dD0ic2hhcGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEzNSwwKSI+CgkJCQk8dGl0bGU+U2hlZXQuMzwvdGl0bGU+CgkJCQk8ZGVzYz5aUGlwZWxpbmU8L2Rlc2M+CgkJCQk8djp0ZXh0QmxvY2sgdjptYXJnaW5zPSJyZWN0KDQsNCw0LDQpIi8+CgkJCQk8djp0ZXh0UmVjdCBjeD0iNTQiIGN5PSI3My4yNSIgd2lkdGg9IjEwOC4wMSIgaGVpZ2h0PSI3MiIvPgoJCQkJPHJlY3QgeD0iMCIgeT0iMzcuMjUiIHdpZHRoPSIxMDgiIGhlaWdodD0iNzIiIHJ4PSI5IiByeT0iOSIgY2xhc3M9InN0MSIvPgoJCQkJPHRleHQgeD0iMjAuNTMiIHk9Ijc4LjY1IiBjbGFzcz0ic3QyIiB2OmxhbmdJRD0iMTAzMyI+PHY6cGFyYWdyYXBoIHY6aG9yaXpBbGlnbj0iMSIvPjx2OnRhYkxpc3QvPlpQaXBlbGluZTwvdGV4dD4JCQk8L2c+CgkJCTxnIGlkPSJzaGFwZTQtMTEiIHY6bUlEPSI0IiB2Omdyb3VwQ29udGV4dD0ic2hhcGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI3MCwwKSI+CgkJCQk8dGl0bGU+U2hlZXQuNDwvdGl0bGU+CgkJCQk8ZGVzYz5aU2luazwvZGVzYz4KCQkJCTx2OnRleHRCbG9jayB2Om1hcmdpbnM9InJlY3QoNCw0LDQsNCkiLz4KCQkJCTx2OnRleHRSZWN0IGN4PSI1NCIgY3k9IjczLjI1IiB3aWR0aD0iMTA4LjAxIiBoZWlnaHQ9IjcyIi8+CgkJCQk8cmVjdCB4PSIwIiB5PSIzNy4yNSIgd2lkdGg9IjEwOCIgaGVpZ2h0PSI3MiIgcng9IjkiIHJ5PSI5IiBjbGFzcz0ic3QxIi8+CgkJCQk8dGV4dCB4PSIzNC43NyIgeT0iNzguNjUiIGNsYXNzPSJzdDIiIHY6bGFuZ0lEPSIxMDMzIj48djpwYXJhZ3JhcGggdjpob3JpekFsaWduPSIxIi8+PHY6dGFiTGlzdC8+WlNpbms8L3RleHQ+CQkJPC9nPgoJCQk8ZyBpZD0iZ3JvdXA1LTE1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDMsLTI3KSIgdjptSUQ9IjUiIHY6Z3JvdXBDb250ZXh0PSJncm91cCI+CgkJCQk8dGl0bGU+U2hlZXQuNTwvdGl0bGU+CgkJCQk8ZyBpZD0ic2hhcGU2LTE2IiB2Om1JRD0iNiIgdjpncm91cENvbnRleHQ9InNoYXBlIiB2OmxheWVyTWVtYmVyPSIwIj4KCQkJCQk8dGl0bGU+RHluYW1pYyBjb25uZWN0b3I8L3RpdGxlPgoJCQkJCTxwYXRoIGQ9Ik0wIDEwMC4yNSBMMTkuOTYgMTAwLjI1IiBjbGFzcz0ic3QzIi8+CgkJCQk8L2c+CgkJCTwvZz4KCQkJPGcgaWQ9Imdyb3VwNy0yMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTA4LjQ1LC0yOC44KSIgdjptSUQ9IjciIHY6Z3JvdXBDb250ZXh0PSJncm91cCI+CgkJCQk8dGl0bGU+U2hlZXQuNzwvdGl0bGU+CgkJCQk8ZyBpZD0ic2hhcGU4LTIzIiB2Om1JRD0iOCIgdjpncm91cENvbnRleHQ9InNoYXBlIiB2OmxheWVyTWVtYmVyPSIwIj4KCQkJCQk8dGl0bGU+RHluYW1pYyBjb25uZWN0b3I8L3RpdGxlPgoJCQkJCTxwYXRoIGQ9Ik0wIDEwMC4yNSBMMTkuOTYgMTAwLjI1IiBjbGFzcz0ic3QzIi8+CgkJCQk8L2c+CgkJCTwvZz4KCQk8L2c+Cgk8L2c+Cjwvc3ZnPgo=" width="554" height="146"></p><p>Pipelines are basically an abstraction for composing a bunch of operations together that can be later applied to a stream. For example, we can create a pipeline that reads bytes, decodes them to the UTF-8 and splits the lines, and then splits on commas. So this is a very simple CSV parsing pipeline which we can later use with another stream to pipe into. </p><table><thead><tr><th>ZIO Streams 1.x</th><th>ZIO Streams 2.x</th></tr></thead><tbody><tr><td></td><td><code>ZChannel</code></td></tr><tr><td><code>ZStream</code></td><td><code>ZStream</code> (backed by <code>ZChannel</code>)</td></tr><tr><td><code>ZSink</code></td><td><code>ZSink</code> (backed by <code>ZChannel</code>)</td></tr><tr><td><code>ZTransducer</code></td><td><code>ZPipeline</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="zio-schedules">ZIO Schedules<a class="hash-link" href="#zio-schedules" title="Direct link to heading">â€‹</a></h2><p><code>Schedule.jittered</code> in ZIO 1 is equivalent to <code>Schedule.jittered(0.0, 1.0)</code>. In ZIO this changed to <code>Schedule.jittered(0.8, 1.2)</code>.</p><p>In ZIO 1 the average throughput of the updated schedule was twice the original schedule. In ZIO 2 the average thoughput of the updated schedule is the same as the orginal schedule.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="zio-services">ZIO Services<a class="hash-link" href="#zio-services" title="Direct link to heading">â€‹</a></h2><p>There are two significant changes in ZIO Services:</p><ol><li><p>All ZIO services moved to the <code>zio</code> package:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>zio.blocking.Blocking</code></td><td><a href="#blocking-service">Removed</a></td></tr><tr><td><code>zio.clock.Clock</code></td><td><code>zio.Clock</code></td></tr><tr><td><code>zio.console.Console</code></td><td><code>zio.Console</code></td></tr><tr><td><code>zio.random.Random</code></td><td><code>zio.Random</code></td></tr><tr><td><code>zio.system.System</code></td><td><code>zio.System</code></td></tr></tbody></table><p>And their live implementations renamed and moved to a new path:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>zio.Clock.Service.live</code></td><td><code>zio.Clock.ClockLive</code></td></tr><tr><td><code>zio.Console.Service.live</code></td><td><code>zio.Console.ConsoleLive</code></td></tr><tr><td><code>zio.System.Service.live</code></td><td><code>zio.System.SystemLive</code></td></tr><tr><td><code>zio.Random.Service.live</code></td><td><code>zio.Random.RandomLive</code></td></tr></tbody></table></li></ol><ol start="2"><li>In ZIO 2.0 all type aliases like <code>type Logging = Has[Logging.Service]</code> removed.</li></ol><p>So when accessing services instead of <code>ZIO.service[Console.Service]</code> we now do <code>ZIO.service[Console]</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="blocking-service">Blocking Service<a class="hash-link" href="#blocking-service" title="Direct link to heading">â€‹</a></h3><p>Since there is rarely a need to use a separate blocking thread pool, ZIO 2.0 created <em>one global blocking pool</em>, and removed the Blocking service from <code>ZEnv</code> and the built-in services.</p><p>All blocking operations were moved to the <code>ZIO</code> data type:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>zio.blocking.Blocking.*</code></td><td><code>ZIO.*</code></td></tr></tbody></table><p>With some renaming stuffs:</p><table><thead><tr><th>ZIO 1.x (<code>zio.blocking.Blocking.*</code>)</th><th>ZIO 2.x (<code>ZIO.*</code>)</th></tr></thead><tbody><tr><td><code>effectBlocking</code></td><td><code>ZIO.attemptBlocking</code></td></tr><tr><td><code>effectBlockingCancelable</code></td><td><code>ZIO.attemptBlockingCancelable</code></td></tr><tr><td><code>effectBlockingIO</code></td><td><code>ZIO.attemptBlockingIO</code></td></tr><tr><td><code>effectBlockingInterrupt</code></td><td><code>ZIO.attemptBlockingInterrupt</code></td></tr></tbody></table><p>Now we have all the blocking operations under the <code>ZIO</code> data type as below:</p><ul><li><code>ZIO.attemptBlocking</code></li><li><code>ZIO.attemptBlockingCancelable</code></li><li><code>ZIO.attemptBlockingIO</code></li><li><code>ZIO.attemptBlockingInterrupt</code></li><li><code>ZIO.blocking</code></li><li><code>ZIO.blockingExecutor</code></li></ul><p>We can also provide a user-defined blocking executor in ZIO 2.x with the <code>Runtime#withBlockingExecutor</code> operator that constructs a new <code>Runtime</code> with the specified blocking executor.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="clock-service">Clock Service<a class="hash-link" href="#clock-service" title="Direct link to heading">â€‹</a></h3><p>There is a slight change in the Clock service; the return value of the <code>currentDateTime</code>, and <code>localDateTime</code> methods changed from <code>IO</code> to <code>UIO</code>, so they do not longer throw <code>DateTimeException</code>:</p><table><thead><tr><th>Method Name</th><th>Return Type (ZIO 1.x)</th><th>Return Type (ZIO 2.x)</th></tr></thead><tbody><tr><td><code>currentDateTime</code></td><td><code>IO[OffsetDateTime]</code></td><td><code>UIO[OffsetDateTime]</code></td></tr><tr><td><code>localDateTime</code></td><td><code>IO[LocalDateTime]</code></td><td><code>UIO[LocalDateTime]</code></td></tr></tbody></table><p>In ZIO 2.0, without changing any API, the <em>retrying</em>, <em>repetition</em>, and <em>scheduling</em> logic moved into the <code>Clock</code> service.</p><p>Working with these three time-related APIs, always made us require <code>Clock</code> as our environment. So by moving these primitives into the <code>Clock</code> service, now we can directly call them via the <code>Clock</code> service. This change solves a common anti-pattern in ZIO 1.0, whereby a middleware that uses <code>Clock</code> via this retrying, repetition, or scheduling logic must provide the <code>Clock</code> layer on every method invocation:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">trait Journal {</span><br></span><span class="token-line"><span class="token plain">  def append(log: String): ZIO[Any, Throwable, Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">trait Logger {</span><br></span><span class="token-line"><span class="token plain">  def log(line: String): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">case class JournalLoggerLive(clock: Clock, journal: Journal) extends Logger {</span><br></span><span class="token-line"><span class="token plain">  override def log(line: String): UIO[Unit] = {</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      current &lt;- clock.currentDateTime</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- journal.append(s&quot;$current--$line&quot;)</span><br></span><span class="token-line"><span class="token plain">        .retry(Schedule.exponential(2.seconds))</span><br></span><span class="token-line"><span class="token plain">        .provideEnvironment(ZEnvironment(clock))</span><br></span><span class="token-line"><span class="token plain">        .orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In ZIO 2.0, we can implement the logger service with a better ergonomic:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">case class JournalLoggerLive(clock: Clock, journal: Journal) extends Logger {</span><br></span><span class="token-line"><span class="token plain">  override def log(line: String): UIO[Unit] = {</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      current &lt;- clock.currentDateTime</span><br></span><span class="token-line"><span class="token plain">      _       &lt;- journal.append(s&quot;$current--$line&quot;).retry(Schedule.exponential(2.seconds)).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Note that the ZIO API didn&#x27;t change, but the <code>Clock</code> trait became a bigger one, having more clock-related methods.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="console-service">Console Service<a class="hash-link" href="#console-service" title="Direct link to heading">â€‹</a></h3><p>Method names in the <em>Console</em> service were renamed to the more readable names:</p><table><thead><tr><th>ZIO 1.x</th><th>ZIO 2.x</th></tr></thead><tbody><tr><td><code>putStr</code></td><td><code>print</code></td></tr><tr><td><code>putStrErr</code></td><td><code>printError</code></td></tr><tr><td><code>putStrLn</code></td><td><code>printLine</code></td></tr><tr><td><code>putStrLnErr</code></td><td><code>printLineError</code></td></tr><tr><td><code>getStrLn</code></td><td><code>readLine</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="other-new-features">Other New Features<a class="hash-link" href="#other-new-features" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="smart-constructors-1">Smart Constructors<a class="hash-link" href="#smart-constructors-1" title="Direct link to heading">â€‹</a></h3><p>Every data type in ZIO (<code>ZIO</code>, <code>ZStream</code>, etc.) has a variety of constructor functions that are designed to <em>up convert</em> some weaker type into the target type. Typically, these converter functions are named <code>fromXYZ</code>, e.g. <code>ZIO.fromEither</code>, <code>ZStream.fromZIO</code>, etc.</p><p>While these are precise, ZIO 2.0 provides the <code>ZIO.from</code> constructor which can intelligently choose the most likely constructor based on the input type. So instead of writing <code>ZIO.fromEither(Right(3))</code> we can easily write <code>ZIO.from(Right(3))</code>. Let&#x27;s try some of them:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.fromOption(Some(&quot;Ok!&quot;))</span><br></span><span class="token-line"><span class="token plain">// res24: IO[Option[Nothing], String] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain">ZIO.from(Some(&quot;Ok!&quot;))</span><br></span><span class="token-line"><span class="token plain">// res25: ZIO[Any, Option[Nothing], String] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO.fromEither(Right(3))</span><br></span><span class="token-line"><span class="token plain">// res26: IO[Nothing, Int] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain">ZIO.from(Right(3))</span><br></span><span class="token-line"><span class="token plain">// res27: ZIO[Any, Nothing, Int] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZIO.fromFiber(Fiber.succeed(&quot;Ok!&quot;))</span><br></span><span class="token-line"><span class="token plain">// res28: IO[Nothing, String] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain">ZIO.from(Fiber.succeed(&quot;Ok!&quot;))</span><br></span><span class="token-line"><span class="token plain">// res29: ZIO[Any, Nothing, String] = &lt;function1&gt;</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZStream.fromIterable(List(1,2,3)) </span><br></span><span class="token-line"><span class="token plain">// res30: ZStream[Any, Nothing, Int] = zio.stream.ZStream@15be8990 </span><br></span><span class="token-line"><span class="token plain">ZStream.from(List(1,1,3))</span><br></span><span class="token-line"><span class="token plain">// res31: ZStream[Any, Nothing, Int] = zio.stream.ZStream@344da52</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZStream.fromChunk(Chunk(1,2,3))</span><br></span><span class="token-line"><span class="token plain">// res32: ZStream[Any, Nothing, Int] = zio.stream.ZStream@31a6438b</span><br></span><span class="token-line"><span class="token plain">ZStream.from(Chunk(1,2,3))</span><br></span><span class="token-line"><span class="token plain">// res33: ZStream[Any, Nothing, Int] = zio.stream.ZStream@3de3da0</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">ZStream.fromIterableZIO(ZIO.succeed(List(1,2,3)))</span><br></span><span class="token-line"><span class="token plain">// res34: ZStream[Any, Nothing, Int] = zio.stream.ZStream@62cdc642</span><br></span><span class="token-line"><span class="token plain">ZStream.from(ZIO.succeed(List(1,2,3)))</span><br></span><span class="token-line"><span class="token plain">// res35: ZStream[Any, Nothing, Int] = zio.stream.ZStream@47fe0603</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="zstate">ZState<a class="hash-link" href="#zstate" title="Direct link to heading">â€‹</a></h3><p><code>ZState</code> is a new data type that the ZIO 2.0 introduced:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">sealed trait ZState[S] {</span><br></span><span class="token-line"><span class="token plain">  def get: UIO[S]</span><br></span><span class="token-line"><span class="token plain">  def set(s: S): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">  def update(f: S =&gt; S): UIO[Unit]</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>We can <code>set</code>, <code>get</code>, and <code>update</code> the state which is part of the ZIO environment using <code>ZIO.setState</code>, <code>ZIO.getState</code>, and <code>ZIO.updateState</code> operations:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object ZStateExample extends zio.ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain">  final case class MyState(counter: Int)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  val app = for {</span><br></span><span class="token-line"><span class="token plain">    _     &lt;- ZIO.updateState[MyState](state =&gt; state.copy(counter = state.counter + 1))</span><br></span><span class="token-line"><span class="token plain">    count &lt;- ZIO.getStateWith[MyState](_.counter)</span><br></span><span class="token-line"><span class="token plain">    _     &lt;- Console.printLine(count)</span><br></span><span class="token-line"><span class="token plain">  } yield count</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def run = app.provide(ZState.initial(MyState(0)))</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="hub">Hub<a class="hash-link" href="#hub" title="Direct link to heading">â€‹</a></h3><p><code>Hub</code> is a new concurrent data structure like <code>Queue</code>. While <code>Queue</code> solves the problem of <em>distributing</em> messages to multiple consumers, the <code>Hub</code> solves the problem of <em>broadcasting</em> the same message to multiple consumers.</p><p><img alt="Hub" src="/assets/images/hub-e82fffbd91cd37dc4a3aac858d6744e4.svg" width="925" height="364"></p><p>Here is an example of broadcasting messages to multiple subscribers:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">for {</span><br></span><span class="token-line"><span class="token plain">  hub &lt;- Hub.bounded[String](requestedCapacity = 2)</span><br></span><span class="token-line"><span class="token plain">  s1 = hub.subscribe</span><br></span><span class="token-line"><span class="token plain">  s2 = hub.subscribe</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- ZIO.scoped {</span><br></span><span class="token-line"><span class="token plain">    s1.zip(s2).flatMap { case (left, right) =&gt;</span><br></span><span class="token-line"><span class="token plain">      for {</span><br></span><span class="token-line"><span class="token plain">        _ &lt;- hub.publish(&quot;Hello from a hub!&quot;)</span><br></span><span class="token-line"><span class="token plain">        _ &lt;- left.take.flatMap(Console.printLine(_))</span><br></span><span class="token-line"><span class="token plain">        _ &lt;- right.take.flatMap(Console.printLine(_))</span><br></span><span class="token-line"><span class="token plain">      } yield ()</span><br></span><span class="token-line"><span class="token plain">    }</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">} yield ()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Visit the <a href="/next/datatypes/concurrency/hub">Hub</a> page to learn more about it.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="zio-aspects">ZIO Aspects<a class="hash-link" href="#zio-aspects" title="Direct link to heading">â€‹</a></h3><p>We introduced the<code>ZIOAspect</code> which enables us to modify the existing <code>ZIO</code> effect with some additional aspects like debugging, tracing, retrying, and logging:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val myApp: ZIO[Random, Nothing, String] =</span><br></span><span class="token-line"><span class="token plain">  ZIO.ifZIO(</span><br></span><span class="token-line"><span class="token plain">    Random.nextIntBounded(10) @@ ZIOAspect.debug map (_ % 2 == 0)</span><br></span><span class="token-line"><span class="token plain">  )(onTrue = ZIO.succeed(&quot;Hello!&quot;), onFalse = ZIO.succeed(&quot;Good Bye!&quot;)) @@</span><br></span><span class="token-line"><span class="token plain">    ZIOAspect.debug @@ ZIOAspect.logged(&quot;result&quot;)</span><br></span><span class="token-line"><span class="token plain">    </span><br></span><span class="token-line"><span class="token plain">// Sample Output:     </span><br></span><span class="token-line"><span class="token plain">// 2</span><br></span><span class="token-line"><span class="token plain">// Hello!</span><br></span><span class="token-line"><span class="token plain">// timestamp=2021-09-05T15:32:56.705901Z level=INFO thread=#2 message=&quot;result: Hello!&quot; file=ZIOAspect.scala line=74 class=zio.ZIOAspect$$anon$4 method=apply</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="debugging">Debugging<a class="hash-link" href="#debugging" title="Direct link to heading">â€‹</a></h3><p>ZIO 2.x introduces the <code>debug</code> that is useful when we want to print something to the console for debugging purposes without introducing additional environmental requirements or error types:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">val myApp: ZIO[Random, Nothing, String] =</span><br></span><span class="token-line"><span class="token plain">  ZIO</span><br></span><span class="token-line"><span class="token plain">    .ifZIO(</span><br></span><span class="token-line"><span class="token plain">      Random.nextIntBounded(10) debug(&quot;random&quot;) map (_ % 2 == 0)</span><br></span><span class="token-line"><span class="token plain">    )(</span><br></span><span class="token-line"><span class="token plain">      onTrue = ZIO.succeed(&quot;Hello!&quot;),</span><br></span><span class="token-line"><span class="token plain">      onFalse = ZIO.succeed(&quot;Good Bye!&quot;)</span><br></span><span class="token-line"><span class="token plain">    )</span><br></span><span class="token-line"><span class="token plain">    .debug(&quot;result&quot;)</span><br></span><span class="token-line"><span class="token plain">// Sample Output</span><br></span><span class="token-line"><span class="token plain">// random: 2</span><br></span><span class="token-line"><span class="token plain">// result: Hello!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="logging">Logging<a class="hash-link" href="#logging" title="Direct link to heading">â€‹</a></h3><p>ZIO 2.x supports a lightweight built-in logging facade that standardized the interface to logging functionality. So it doesn&#x27;t replace existing logging libraries, but also we can plug it into one of the existing logging backends.</p><p>We can easily log using the <code>ZIO.log</code> function:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.log(&quot;Application started!&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To log with a specific log-level, we can use the <code>ZIO.logLevel</code> combinator:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.logLevel(LogLevel.Warning) {</span><br></span><span class="token-line"><span class="token plain">  ZIO.log(&quot;The response time exceeded its threshold!&quot;)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or we can use the following functions directly:</p><ul><li><code>ZIO.logDebug</code></li><li><code>ZIO.logError</code></li><li><code>ZIO.logFatal</code></li><li><code>ZIO.logInfo</code></li><li><code>ZIO.logWarning</code></li></ul><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.logError(&quot;File does not exist: ~/var/www/favicon.ico&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It also supports logging spans:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">ZIO.logSpan(&quot;myspan&quot;) {</span><br></span><span class="token-line"><span class="token plain">  ZIO.sleep(1.second) *&gt; ZIO.log(&quot;The job is finished!&quot;)</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>ZIO Logging calculates the running duration of that span and includes that in the logging data corresponding to its span label.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="compile-time-execution-tracing">Compile-time Execution Tracing<a class="hash-link" href="#compile-time-execution-tracing" title="Direct link to heading">â€‹</a></h3><p>ZIO 1.x&#x27;s execution trace is not as useful as it could be because it contains tracing information for internal ZIO operators that it not helpful to the user is understanding where in their code an error occurred.</p><p>Let&#x27;s say we have the following application, in ZIO 1.x:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.console.Console</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object TracingExample extends zio.App {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def doSomething(input: Int): ZIO[Console, String, Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- console.putStrLn(s&quot;Do something $input&quot;).orDie // line number 8</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- ZIO.fail(&quot;Boom!&quot;)</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- console.putStrLn(&quot;Finished my job&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def myApp: ZIO[Console, String, Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- console.putStrLn(&quot;Hello!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- doSomething(5)</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- console.putStrLn(&quot;Bye Bye!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  override def run(args: List[String]): URIO[zio.ZEnv, ExitCode] =</span><br></span><span class="token-line"><span class="token plain">    myApp.exitCode</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The output would be something like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">Hello!</span><br></span><span class="token-line"><span class="token plain">Do something 5</span><br></span><span class="token-line"><span class="token plain">Fiber failed.</span><br></span><span class="token-line"><span class="token plain">A checked error was not handled.</span><br></span><span class="token-line"><span class="token plain">Boom!</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Fiber:Id(1634884059941,1) was supposed to continue to:</span><br></span><span class="token-line"><span class="token plain">  a future continuation at TracingExample$.myApp(TracingExample.scala:16)</span><br></span><span class="token-line"><span class="token plain">  a future continuation at zio.ZIO.exitCode(ZIO.scala:606)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Fiber:Id(1634884059941,1) execution trace:</span><br></span><span class="token-line"><span class="token plain">  at TracingExample$.doSomething(TracingExample.scala:8)</span><br></span><span class="token-line"><span class="token plain">  at zio.ZIO.orDieWith(ZIO.scala:1118)</span><br></span><span class="token-line"><span class="token plain">  at zio.ZIO.refineOrDieWith(ZIO.scala:1497)</span><br></span><span class="token-line"><span class="token plain">  at zio.console.package$Console$Service$.putStrLn(package.scala:44)</span><br></span><span class="token-line"><span class="token plain">  at zio.console.package$.putStrLn(package.scala:88)</span><br></span><span class="token-line"><span class="token plain">  at TracingExample$.myApp(TracingExample.scala:15)</span><br></span><span class="token-line"><span class="token plain">  at zio.ZIO.orDieWith(ZIO.scala:1118)</span><br></span><span class="token-line"><span class="token plain">  at zio.ZIO.refineOrDieWith(ZIO.scala:1497)</span><br></span><span class="token-line"><span class="token plain">  at zio.console.package$Console$Service$.putStrLn(package.scala:44)</span><br></span><span class="token-line"><span class="token plain">  at zio.console.package$.putStrLn(package.scala:88)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Fiber:Id(1634884059941,1) was spawned by:</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Fiber:Id(1634884059516,0) was supposed to continue to:</span><br></span><span class="token-line"><span class="token plain">  a future continuation at zio.App.main(App.scala:59)</span><br></span><span class="token-line"><span class="token plain">  a future continuation at zio.App.main(App.scala:58)</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Fiber:Id(1634884059516,0) ZIO Execution trace: &lt;empty trace&gt;</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">Fiber:Id(1634884059516,0) was spawned by: &lt;empty trace&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The execution trace, is somehow at a good degree informative, but it doesn&#x27;t lead us to the exact point where the failure happened. It&#x27;s a little hard to see what is going here. </p><p>Let&#x27;s rewrite the previous example in ZIO 2.0:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">object TracingExample extends ZIOAppDefault {</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def doSomething(input: Int): ZIO[Any, String, Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- Console.printLine(s&quot;Do something $input&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- ZIO.fail(&quot;Boom!&quot;) // line number 8</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- Console.printLine(&quot;Finished my job&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def myApp: ZIO[Any, String, Unit] =</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- Console.printLine(&quot;Hello!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- doSomething(5)   // line number 15</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- Console.printLine(&quot;Bye Bye!&quot;).orDie</span><br></span><span class="token-line"><span class="token plain">    } yield ()</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  def run = myApp</span><br></span><span class="token-line"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The output is more descriptive than the ZIO 1.x. It is similar to the Java stacktrace:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">Hello!</span><br></span><span class="token-line"><span class="token plain">Do something 5</span><br></span><span class="token-line"><span class="token plain">timestamp=2021-12-19T08:25:09.372926403Z level=ERROR thread=#zio-fiber-1639902309 message=&quot;Exception in thread &quot;zio-fiber-1639902309&quot; java.lang.String: Boom!</span><br></span><span class="token-line"><span class="token plain">    at zio.examples.TracingExample.doSomething(TracingExample.scala:8)</span><br></span><span class="token-line"><span class="token plain">    at zio.examples.TracingExample.myApp(TracingExample.scala:15)&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>As we see, the first line of execution trace, point to the exact location on the source code which causes the failure (<code>ZIO.fail(&quot;Boom!&quot;)</code>), which is line number 8.</p><p>In ZIO 2.x, the tracing is not optional, and unlike the ZIO 1.x, it is impossible to disable async tracing, either globally, or for specific effects. ZIO now always generates async stack traces, and it is impossible to turn this feature off, either at the global level or at the level of individual effects. Since nearly all users were running ZIO with tracing turned on, this change should have minimal impact on ZIO applications.</p><p>Another improvement about ZIO tracing is its performance. Tracing in ZIO 1.x slows down the application performance by two times. In ZIO 1.x, we wrap and unwrap every combinator at runtime to be able to trace the execution. While it is happening on the runtime, it takes a lot of allocations which all need to be garbage collected afterward. So it adds a huge amount of complexity at the runtime.</p><p>Some users often turn off the tracing when they need more speed, so they lose this ability to trace their application when something breaks.</p><p>In ZIO 2.x, we moved execution tracing from the run-time to the compile-time. This is done by capturing tracing information from source code at compile time using macros. So most tracing information is pre-allocated at startup and never needs garbage collected. As a result, we end up with much better performance in execution tracing.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/howto/migrate/migration-guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/next/howto/migrate/from-monix"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How to Migrate from Monix to ZIO?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#guidelines-for-library-authors" class="table-of-contents__link toc-highlight">Guidelines for Library Authors</a></li><li><a href="#has" class="table-of-contents__link toc-highlight">Has</a></li><li><a href="#zio" class="table-of-contents__link toc-highlight">ZIO</a><ul><li><a href="#removed-methods" class="table-of-contents__link toc-highlight">Removed Methods</a></li><li><a href="#zio-20-naming-conventions" class="table-of-contents__link toc-highlight">ZIO 2.0 Naming Conventions</a></li><li><a href="#lazy-evaluation-of-parameters" class="table-of-contents__link toc-highlight">Lazy Evaluation of Parameters</a></li><li><a href="#composable-zips" class="table-of-contents__link toc-highlight">Composable Zips</a></li><li><a href="#compositional-concurrency" class="table-of-contents__link toc-highlight">Compositional Concurrency</a></li><li><a href="#either-values" class="table-of-contents__link toc-highlight">Either Values</a></li><li><a href="#descriptive-errors" class="table-of-contents__link toc-highlight">Descriptive Errors</a></li></ul></li><li><a href="#zio-app" class="table-of-contents__link toc-highlight">ZIO App</a><ul><li><a href="#zioapp" class="table-of-contents__link toc-highlight">ZIOApp</a></li></ul></li><li><a href="#fiber" class="table-of-contents__link toc-highlight">Fiber</a></li><li><a href="#platform-executor-and-runtime" class="table-of-contents__link toc-highlight">Platform, Executor, and Runtime</a><ul><li><a href="#method-deprecation-and-renaming" class="table-of-contents__link toc-highlight">Method Deprecation and Renaming</a></li><li><a href="#runtime-config-aspect" class="table-of-contents__link toc-highlight">Runtime Config Aspect</a></li><li><a href="#compositional-runtime-config" class="table-of-contents__link toc-highlight">Compositional Runtime Config</a></li></ul></li><li><a href="#zlayer" class="table-of-contents__link toc-highlight">ZLayer</a><ul><li><a href="#constructing-layers" class="table-of-contents__link toc-highlight">Constructing Layers</a></li><li><a href="#accessing-a-service-from-the-environment" class="table-of-contents__link toc-highlight">Accessing a Service from the Environment</a></li><li><a href="#accessing-multiple-services-in-the-environment" class="table-of-contents__link toc-highlight">Accessing Multiple Services in the Environment</a></li><li><a href="#building-the-dependency-graph" class="table-of-contents__link toc-highlight">Building the Dependency Graph</a></li><li><a href="#zlayer-debugging" class="table-of-contents__link toc-highlight">ZLayer Debugging</a></li><li><a href="#descriptive-zioapp-environment-compiler-errors" class="table-of-contents__link toc-highlight">Descriptive ZIOApp Environment Compiler Errors</a></li><li><a href="#eliminators-for-environmental-effects" class="table-of-contents__link toc-highlight">Eliminators for Environmental Effects</a></li><li><a href="#service-pattern" class="table-of-contents__link toc-highlight">Service Pattern</a></li><li><a href="#other-changes" class="table-of-contents__link toc-highlight">Other Changes</a></li></ul></li><li><a href="#scopes" class="table-of-contents__link toc-highlight">Scopes</a><ul><li><a href="#zmanaged" class="table-of-contents__link toc-highlight">ZManaged</a></li><li><a href="#scopes-1" class="table-of-contents__link toc-highlight">Scopes</a></li><li><a href="#migration-from-zmanaged-to-scope" class="table-of-contents__link toc-highlight">Migration from <code>ZManaged</code> to <code>Scope</code></a></li></ul></li><li><a href="#ref" class="table-of-contents__link toc-highlight">Ref</a></li><li><a href="#semaphore-and-tsemaphore" class="table-of-contents__link toc-highlight">Semaphore and TSemaphore</a></li><li><a href="#queue" class="table-of-contents__link toc-highlight">Queue</a></li><li><a href="#zio-test" class="table-of-contents__link toc-highlight">ZIO Test</a><ul><li><a href="#composable-test-apps" class="table-of-contents__link toc-highlight">Composable Test Apps</a></li><li><a href="#smart-constructors" class="table-of-contents__link toc-highlight">Smart Constructors</a></li><li><a href="#smart-assertion" class="table-of-contents__link toc-highlight">Smart Assertion</a></li><li><a href="#compositional-specs" class="table-of-contents__link toc-highlight">Compositional Specs</a></li></ul></li><li><a href="#zio-streams" class="table-of-contents__link toc-highlight">ZIO Streams</a></li><li><a href="#zio-schedules" class="table-of-contents__link toc-highlight">ZIO Schedules</a></li><li><a href="#zio-services" class="table-of-contents__link toc-highlight">ZIO Services</a><ul><li><a href="#blocking-service" class="table-of-contents__link toc-highlight">Blocking Service</a></li><li><a href="#clock-service" class="table-of-contents__link toc-highlight">Clock Service</a></li><li><a href="#console-service" class="table-of-contents__link toc-highlight">Console Service</a></li></ul></li><li><a href="#other-new-features" class="table-of-contents__link toc-highlight">Other New Features</a><ul><li><a href="#smart-constructors-1" class="table-of-contents__link toc-highlight">Smart Constructors</a></li><li><a href="#zstate" class="table-of-contents__link toc-highlight">ZState</a></li><li><a href="#hub" class="table-of-contents__link toc-highlight">Hub</a></li><li><a href="#zio-aspects" class="table-of-contents__link toc-highlight">ZIO Aspects</a></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#compile-time-execution-tracing" class="table-of-contents__link toc-highlight">Compile-time Execution Tracing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.183b2960.js"></script>
<script src="/assets/js/main.eb82bc51.js"></script>
</body>
</html>