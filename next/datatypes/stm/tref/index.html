<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><title data-react-helmet="true">TRef | ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zio.dev/next/datatypes/stm/tref"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="TRef | ZIO"><meta data-react-helmet="true" name="description" content="A TRef[A] is a mutable reference to an immutable value, which can participate in transactions in STM. The mutable reference can be retrieved and set from within transactions, with strong guarantees for atomicity, consistency, and isolation from other transactions."><meta data-react-helmet="true" property="og:description" content="A TRef[A] is a mutable reference to an immutable value, which can participate in transactions in STM. The mutable reference can be retrieved and set from within transactions, with strong guarantees for atomicity, consistency, and isolation from other transactions."><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://zio.dev/next/datatypes/stm/tref"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/datatypes/stm/tref" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zio.dev/next/datatypes/stm/tref" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.eb47feb5.css">
<link rel="preload" href="/assets/js/runtime~main.e0bb0b29.js" as="script">
<link rel="preload" href="/assets/js/main.3950424f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/version-1.x/overview/">Overview</a><a class="navbar__item navbar__link" href="/version-1.x/datatypes/">Data Types</a><a class="navbar__item navbar__link" href="/version-1.x/usecases/">Use Cases</a><a class="navbar__item navbar__link" href="/version-1.x/howto/">How to</a><a class="navbar__item navbar__link" href="/version-1.x/resources/">Resources</a><a class="navbar__item navbar__link" href="/version-1.x/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/next/overview/">ZIO 2.x (WIP)</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/datatypes/stm/tref">ZIO 2.x (WIP)</a></li><li><a class="dropdown__link" href="/version-1.x/datatypes/stm/tref">ZIO 1.x</a></li></ul></div><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/core/zio/">Core Data Types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/contextual/">Contextual Types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/next/datatypes/fiber/">Concurrency</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/next/datatypes/fiber/">ZIO Fibers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" tabindex="0" href="/next/datatypes/concurrency/">Concurrency Primitives</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" tabindex="0" href="/next/datatypes/stm/">STM</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/stm.md">STM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tarray">TArray</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/trandom">TRandom</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tset">TSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tmap">TMap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/datatypes/stm/tref">TRef</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tpriorityqueue">TPriorityQueue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tpromise">TPromise</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tqueue">TQueue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/treentrantlock">TReentrantLock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/tsemaphore">TSemaphore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/datatypes/stm/thub">THub</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/resource/">Resource Management</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/stream/">Streaming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/metrics/">Metrics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/test/">ZIO Test</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/next/datatypes/misc/chunk">Miscellaneous</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->ZIO<!-- --> <b>ZIO 2.x (WIP)</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/version-1.x/datatypes/stm/tref">latest version</a></b> (<!-- -->ZIO 1.x<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->ZIO 2.x (WIP)</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>TRef</h1></header><p>A <code>TRef[A]</code> is a mutable reference to an immutable value, which can participate in transactions in STM. The mutable reference can be retrieved and set from within transactions, with strong guarantees for atomicity, consistency, and isolation from other transactions.</p><p><code>TRef</code> provides the low-level machinery to create transactions from modifications of STM memory.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="create-a-tref">Create a TRef<a class="hash-link" href="#create-a-tref" title="Direct link to heading">â€‹</a></h2><p>Creating a <code>TRef</code> inside a transaction:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val createTRef: STM[Nothing, TRef[Int]] = TRef.make(10)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or creating a <code>TRef</code> inside a transaction, and immediately committing the transaction, which allows you to store and pass along the reference.</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val commitTRef: UIO[TRef[Int]] = TRef.makeCommit(10)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="retrieve-the-value-out-of-a-tref">Retrieve the value out of a TRef<a class="hash-link" href="#retrieve-the-value-out-of-a-tref" title="Direct link to heading">â€‹</a></h2><p>Retrieving the value in a single transaction: </p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val retrieveSingle: UIO[Int] = (for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.make(10)</span><br></span><span class="token-line"><span class="token plain">  value &lt;- tRef.get</span><br></span><span class="token-line"><span class="token plain">} yield value).commit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or on multiple transactional statements:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val retrieveMultiple: UIO[Int] = for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.makeCommit(10)</span><br></span><span class="token-line"><span class="token plain">  value &lt;- tRef.get.commit</span><br></span><span class="token-line"><span class="token plain">} yield value</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="set-a-value-to-a-tref">Set a value to a TRef<a class="hash-link" href="#set-a-value-to-a-tref" title="Direct link to heading">â€‹</a></h2><p>Setting the value overwrites the existing content of a reference.</p><p>Setting the value in a single transaction:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val setSingle: UIO[Int] = (for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.make(10)</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- tRef.set(20)</span><br></span><span class="token-line"><span class="token plain">  nValue &lt;- tRef.get</span><br></span><span class="token-line"><span class="token plain">} yield nValue).commit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or on multiple transactions:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val setMultiple: UIO[Int] = for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.makeCommit(10)</span><br></span><span class="token-line"><span class="token plain">  nValue &lt;- tRef.set(20).flatMap(_ =&gt; tRef.get).commit</span><br></span><span class="token-line"><span class="token plain">} yield nValue</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="update-the-value-of-the-tref">Update the value of the TRef<a class="hash-link" href="#update-the-value-of-the-tref" title="Direct link to heading">â€‹</a></h2><p>The update function <code>A =&gt; A</code> allows computing a new value for the <code>TRef</code> using the old value.</p><p>Updating the value in a single transaction:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val updateSingle: UIO[Int] = (for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.make(10)</span><br></span><span class="token-line"><span class="token plain">  nValue &lt;- tRef.updateAndGet(_ + 20)</span><br></span><span class="token-line"><span class="token plain">} yield nValue).commit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or on multiple transactions:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val updateMultiple: UIO[Int] = for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.makeCommit(10)</span><br></span><span class="token-line"><span class="token plain">  nValue &lt;- tRef.updateAndGet(_ + 20).commit</span><br></span><span class="token-line"><span class="token plain">} yield nValue</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="modify-the-value-of-the-tref">Modify the value of the TRef<a class="hash-link" href="#modify-the-value-of-the-tref" title="Direct link to heading">â€‹</a></h2><p>The modify function <code>A =&gt; (B, A): B</code> works similar to <code>update</code>, but allows extracting some information (the <code>B</code>) out of the update operation. </p><p>Modify the value in a single transaction:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val modifySingle: UIO[(String, Int)] = (for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.make(10)</span><br></span><span class="token-line"><span class="token plain">  mValue &lt;- tRef.modify(v =&gt; (&quot;Zee-Oh&quot;, v + 10))</span><br></span><span class="token-line"><span class="token plain">  nValue &lt;- tRef.get</span><br></span><span class="token-line"><span class="token plain">} yield (mValue, nValue)).commit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Or on multiple transactions:</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val modifyMultiple: UIO[(String, Int)] = for {</span><br></span><span class="token-line"><span class="token plain">  tRef &lt;- TRef.makeCommit(10)</span><br></span><span class="token-line"><span class="token plain">  tuple2 &lt;- tRef.modify(v =&gt; (&quot;Zee-Oh&quot;, v + 10)).zip(tRef.get).commit</span><br></span><span class="token-line"><span class="token plain">} yield tuple2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="example-usage">Example usage<a class="hash-link" href="#example-usage" title="Direct link to heading">â€‹</a></h2><p>Here is a scenario where we use a <code>TRef</code> to hand-off a value between two <code>Fiber</code>s</p><div class="codeBlockContainer_I0IT language-scala theme-code-block"><div class="codeBlockContent_wNvx scala"><pre tabindex="0" class="prism-code language-scala codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line"><span class="token plain">import zio._</span><br></span><span class="token-line"><span class="token plain">import zio.stm._</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">def transfer(tSender: TRef[Int],</span><br></span><span class="token-line"><span class="token plain">             tReceiver: TRef[Int],</span><br></span><span class="token-line"><span class="token plain">             amount: Int): UIO[Int] = {</span><br></span><span class="token-line"><span class="token plain">  STM.atomically {</span><br></span><span class="token-line"><span class="token plain">    for {</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- tSender.get.retryUntil(_ &gt;= amount)</span><br></span><span class="token-line"><span class="token plain">      _ &lt;- tSender.update(_ - amount)</span><br></span><span class="token-line"><span class="token plain">      nAmount &lt;- tReceiver.updateAndGet(_ + amount)</span><br></span><span class="token-line"><span class="token plain">    } yield nAmount</span><br></span><span class="token-line"><span class="token plain">  }</span><br></span><span class="token-line"><span class="token plain">}</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">val transferredMoney: UIO[String] = for {</span><br></span><span class="token-line"><span class="token plain">  tSender &lt;- TRef.makeCommit(50)</span><br></span><span class="token-line"><span class="token plain">  tReceiver &lt;- TRef.makeCommit(100)</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- transfer(tSender, tReceiver, 50).fork</span><br></span><span class="token-line"><span class="token plain">  _ &lt;- tSender.get.retryUntil(_ == 0).commit</span><br></span><span class="token-line"><span class="token plain">  tuple2 &lt;- tSender.get.zip(tReceiver.get).commit</span><br></span><span class="token-line"><span class="token plain">  (senderBalance, receiverBalance) = tuple2</span><br></span><span class="token-line"><span class="token plain">} yield s&quot;sender: $senderBalance &amp; receiver: $receiverBalance&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In this example, we create and commit two transactional references for the sender and receiver to be able to extract their value.
On the following step, we create an atomic transactional that updates both accounts only when there is sufficient balance available in the sender account. In the end, we fork to run asynchronously.
On the running fiber, we suspend until the sender balance suffers changes, in this case, to reach <code>zero</code>. Finally, we extract the new values out of the accounts and combine them in one result.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zio/zio/edit/series/2.x/docs/datatypes/stm/tref.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/next/datatypes/stm/tmap"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TMap</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/next/datatypes/stm/tpriorityqueue"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">TPriorityQueue</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-tref" class="table-of-contents__link toc-highlight">Create a TRef</a></li><li><a href="#retrieve-the-value-out-of-a-tref" class="table-of-contents__link toc-highlight">Retrieve the value out of a TRef</a></li><li><a href="#set-a-value-to-a-tref" class="table-of-contents__link toc-highlight">Set a value to a TRef</a></li><li><a href="#update-the-value-of-the-tref" class="table-of-contents__link toc-highlight">Update the value of the TRef</a></li><li><a href="#modify-the-value-of-the-tref" class="table-of-contents__link toc-highlight">Modify the value of the TRef</a></li><li><a href="#example-usage" class="table-of-contents__link toc-highlight">Example usage</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.e0bb0b29.js"></script>
<script src="/assets/js/main.3950424f.js"></script>
</body>
</html>