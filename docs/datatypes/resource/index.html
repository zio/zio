<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Introduction · ZIO</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="When we are writing a long-lived application, resource management is very important. Proper resource management is vital to any large-scale application. We need to make sure that our application is resource-safe, and it doesn&#x27;t leak any resource."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Introduction · ZIO"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zio.dev/"/><meta property="og:description" content="When we are writing a long-lived application, resource management is very important. Proper resource management is vital to any large-scale application. We need to make sure that our application is resource-safe, and it doesn&#x27;t leak any resource."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"cornerOffset":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/navbar_brand.png" alt="ZIO"/><h2 class="headerTitleWithLogo">ZIO</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/overview/overview_index" target="_self">Overview</a></li><li class="siteNavGroupActive"><a href="/docs/datatypes/" target="_self">Data Types</a></li><li class=""><a href="/docs/services/" target="_self">Services</a></li><li class=""><a href="/docs/usecases/usecases_index" target="_self">Use Cases</a></li><li class=""><a href="/docs/howto/" target="_self">How to</a></li><li class=""><a href="/docs/resources/" target="_self">Resources</a></li><li class=""><a href="/docs/about/about_index" target="_self">About</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Resource Safety</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/">Introduction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Core Data Types<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/">Summary</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/zio">ZIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/uio">UIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/urio">URIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/task">Task</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/rio">RIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/io">IO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/exit">Exit</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/cause">Cause</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/runtime">Runtime</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Contextual Types<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/has">Has</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/zlayer">ZLayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/rlayer">RLayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/ulayer">ULayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/layer">Layer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/urlayer">URLayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/tasklayer">TaskLayer</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Fiber Primitives<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/">Summary</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiber">Fiber</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiberref">FiberRef</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiberid">Fiber.Id</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiberstatus">Fiber.Status</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Concurrency Primitives<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/zref">ZRef</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/ref">Ref</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/zrefm">ZRefM</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/refm">RefM</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/promise">Promise</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/queue">Queue</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/hub">Hub</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/semaphore">Semaphore</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">STM<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/stm">STM</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tarray">TArray</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tset">TSet</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tmap">TMap</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tref">TRef</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tpriorityqueue">TPriorityQueue</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tpromise">TPromise</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tqueue">TQueue</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/treentrantlock">TReentrantLock</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tsemaphore">TSemaphore</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Resource Safety<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem navListItemActive"><a class="navItem" href="/docs/datatypes/resource/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/zmanaged">ZManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/managed">Managed</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/task-managed">TaskManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/rmanaged">RManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/umanaged">UManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/urmanaged">URManaged</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Streaming<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/">Summary</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/stream">Stream</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/sink">Sink</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/subscription-ref">SubscriptionRef</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Miscellaneous<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/">Summary</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/chunk">Chunk</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/schedule">Schedule</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/supervisor">Supervisor</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/zio/zio/edit/master/docs/datatypes/resource/index.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Introduction</h1></header><article><div><span><p>When we are writing a long-lived application, resource management is very important. Proper resource management is vital to any large-scale application. We need to make sure that our application is resource-safe, and it doesn't leak any resource.</p>
<p>Leaking socket connections, database connections or file descriptors is not acceptable in a web application. ZIO provides some good construct to make sure about this concern.</p>
<p>To write a resource-safe application, we need to make sure whenever we are opening a resource, we have a mechanism to close that resource whether we use that resource completely or not, for example, an exception occurred during resource usage.</p>
<h2><a class="anchor" aria-hidden="true" id="try--finally"></a><a href="#try--finally" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Try / Finally</h2>
<p>Before we dive into the ZIO solution, it's better to review the <code>try</code> / <code>finally</code> which is the standard approach in the Scala language to manage resources.</p>
<p>Scala has a <code>try</code> / <code>finally</code> construct which helps us to make sure we don't leak resources because no matter what happens in the try, the <code>finally</code> block will be executed. So we can open files in the try block, and then we can close them in the <code>finally</code> block, and that gives us the guarantee that we will not leak resources.</p>
<p>Assume we want to read a file and return the number of its lines:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lines</span></span>(file: <span class="hljs-type">String</span>): <span class="hljs-type">Task</span>[<span class="hljs-type">Long</span>] = <span class="hljs-type">Task</span>.effect {
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">countLines</span></span>(br: <span class="hljs-type">BufferedReader</span>): <span class="hljs-type">Long</span> = br.lines().count()
  <span class="hljs-keyword">val</span> bufferedReader = <span class="hljs-keyword">new</span> <span class="hljs-type">BufferedReader</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-type">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>)),
    <span class="hljs-number">2048</span>
  )
  <span class="hljs-keyword">val</span> count = countLines(bufferedReader)
  bufferedReader.close()
  count
}
</code></pre>
<p>What happens if after opening the file and before closing the file, an exception occurs? So, the <code>bufferedReader.close()</code> line, doesn't have a chance to close the resource. This creates a resource leakage. The Scala language has <code>try...finally</code> construct, which helps up to prevent these situations.</p>
<p>Let's rewrite the above example with <code>try..finally</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lines</span></span>(file: <span class="hljs-type">String</span>): <span class="hljs-type">Task</span>[<span class="hljs-type">Long</span>] = <span class="hljs-type">Task</span>.effect {
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">countLines</span></span>(br: <span class="hljs-type">BufferedReader</span>): <span class="hljs-type">Long</span> = br.lines().count()
  <span class="hljs-keyword">val</span> bufferedReader = <span class="hljs-keyword">new</span> <span class="hljs-type">BufferedReader</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-type">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>)),
    <span class="hljs-number">2048</span>
  )
  <span class="hljs-keyword">try</span> countLines(bufferedReader)
  <span class="hljs-keyword">finally</span> bufferedReader.close()
}
</code></pre>
<p>Now, we are sure that if our program is interrupted during the process of a file, the <code>finally</code> block will be executed.</p>
<p>The <code>try</code> / <code>finally</code> solve simple problems, but it has some drawbacks:</p>
<ol>
<li><p>It's not composable; We can't compose multiple resources together.</p></li>
<li><p>When we have multiple resources, we end up with messy and ugly code, hard to reason about, and refactoring.</p></li>
<li><p>We don't have any control over the order of resource clean-up</p></li>
<li><p>It only helps us to handle resources sequentially. It can't compose multiple resources, concurrently.</p></li>
<li><p>It doesn't support asynchronous workflows.</p></li>
<li><p>It's a manual way of resource management, not automatic. To have a resource-safe application we need to manually check that all resources are managed correctly. This way of resource management is error-prone in case of forgetting to manage resources, correctly.</p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="zio-solution"></a><a href="#zio-solution" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ZIO Solution</h2>
<p>ZIO's resource management features work across synchronous, asynchronous, concurrent, and other effect types, and provide strong guarantees even in the presence of failure, interruption, or defects in the application.</p>
<p>ZIO has two major mechanisms to manage resources.</p>
<h3><a class="anchor" aria-hidden="true" id="bracket"></a><a href="#bracket" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bracket</h3>
<p>ZIO generalized the pattern of <code>try</code> / <code>finally</code> and encoded it in <code>ZIO.bracket</code> or <code>ZIO#bracket</code> operations.</p>
<p>Every bracket requires three actions:</p>
<ol>
<li><strong>Acquiring Resource</strong>— An effect describing the acquisition of resource. For example, opening a file.</li>
<li><strong>Using Resource</strong>— An effect describing the actual process to produce a result. For example, counting the number of lines in a file.</li>
<li><strong>Releasing Resource</strong>— An effect describing the final step of releasing or cleaning up the resource. For example, closing a file.</li>
</ol>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">use</span></span>(resource: <span class="hljs-type">Resource</span>): <span class="hljs-type">Task</span>[<span class="hljs-type">Any</span>] = <span class="hljs-type">Task</span>.effect(???)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">release</span></span>(resource: <span class="hljs-type">Resource</span>): <span class="hljs-type">UIO</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-type">Task</span>.effectTotal(???)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">acquire</span></span>: <span class="hljs-type">Task</span>[<span class="hljs-type">Resource</span>]                = <span class="hljs-type">Task</span>.effect(???)

<span class="hljs-keyword">val</span> result1: <span class="hljs-type">Task</span>[<span class="hljs-type">Any</span>] = acquire.bracket(release, use)
<span class="hljs-keyword">val</span> result2: <span class="hljs-type">Task</span>[<span class="hljs-type">Any</span>] = acquire.bracket(release)(use) <span class="hljs-comment">// More ergonomic API</span>

<span class="hljs-keyword">val</span> result3: <span class="hljs-type">Task</span>[<span class="hljs-type">Any</span>] = <span class="hljs-type">Task</span>.bracket(acquire, release, use)
<span class="hljs-keyword">val</span> result4: <span class="hljs-type">Task</span>[<span class="hljs-type">Any</span>] = <span class="hljs-type">Task</span>.bracket(acquire)(release)(use) <span class="hljs-comment">// More ergonomic API</span>
</code></pre>
<p>The bracket guarantees us that the <code>acquiring</code> and <code>releasing</code> of a resource will not be interrupted. These two guarantees ensure us that the resource will always be released.</p>
<p>Let's try a real example. We are going to write a function which count line number of given file. As we are working with file resource, we should separate our logic into three part. At the first part, we create a <code>BufferedReader</code>. At the second, we count the file lines with given <code>BufferedReader</code> resource, and at the end we close that resource:</p>
<pre><code class="hljs css language-scala:mdoc:silent">def lines(file: String): Task<span class="hljs-literal">[L<span class="hljs-identifier">ong</span>]</span> = {
  def count<span class="hljs-constructor">Lines(<span class="hljs-params">reader</span>: BufferedReader)</span>: Task<span class="hljs-literal">[L<span class="hljs-identifier">ong</span>]</span>    = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Task</span>.</span></span>effect(reader.lines<span class="hljs-literal">()</span>.count<span class="hljs-literal">()</span>)
  def release<span class="hljs-constructor">Reader(<span class="hljs-params">reader</span>: BufferedReader)</span>: UIO<span class="hljs-literal">[U<span class="hljs-identifier">nit</span>]</span>  = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Task</span>.</span></span>effect<span class="hljs-constructor">Total(<span class="hljs-params">reader</span>.<span class="hljs-params">close</span>()</span>)
  def acquire<span class="hljs-constructor">Reader(<span class="hljs-params">file</span>: String)</span>: Task<span class="hljs-literal">[B<span class="hljs-identifier">ufferedReader</span>]</span> = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Task</span>.</span></span>effect(<span class="hljs-keyword">new</span> <span class="hljs-constructor">BufferedReader(<span class="hljs-params">new</span> FileReader(<span class="hljs-params">file</span>)</span>, <span class="hljs-number">2048</span>))

  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Task</span>.</span></span>bracket(acquire<span class="hljs-constructor">Reader(<span class="hljs-params">file</span>)</span>, releaseReader, countLines)
}
</code></pre>
<p>Let's write another function which copy a file from source to destination file. We can do that by nesting two brackets one for the <code>FileInputStream</code> and the other for <code>FileOutputStream</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is</span></span>(file: <span class="hljs-type">String</span>): <span class="hljs-type">Task</span>[<span class="hljs-type">FileInputStream</span>]  = <span class="hljs-type">Task</span>.effect(???)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">os</span></span>(file: <span class="hljs-type">String</span>): <span class="hljs-type">Task</span>[<span class="hljs-type">FileOutputStream</span>] = <span class="hljs-type">Task</span>.effect(???)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close</span></span>(resource: <span class="hljs-type">Closeable</span>): <span class="hljs-type">UIO</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-type">Task</span>.effectTotal(???)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">copy</span></span>(from: <span class="hljs-type">FileInputStream</span>, to: <span class="hljs-type">FileOutputStream</span>): <span class="hljs-type">Task</span>[<span class="hljs-type">Unit</span>] = ???

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transfer</span></span>(src: <span class="hljs-type">String</span>, dst: <span class="hljs-type">String</span>): <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] = {
  <span class="hljs-type">Task</span>.bracket(is(src))(close) { in =&gt;
    <span class="hljs-type">Task</span>.bracket(os(dst))(close) { out =&gt;
      copy(in, out)
    }
  }
}
</code></pre>
<p>As there isn't any dependency between our two resources (<code>is</code> and <code>os</code>), it doesn't make sense to use nested brackets, so let's <code>zip</code> these two acquisition into one effect, and the use one bracket on them:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transfer</span></span>(src: <span class="hljs-type">String</span>, dst: <span class="hljs-type">String</span>): <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] = {
  is(src)
    .zipPar(os(dst))
    .bracket { <span class="hljs-keyword">case</span> (in, out) =&gt;
      <span class="hljs-type">Task</span>
        .effectTotal(in.close())
        .zipPar(<span class="hljs-type">Task</span>.effectTotal(out.close()))
    } { <span class="hljs-keyword">case</span> (in, out) =&gt;
      copy(in, out)
    }
}
</code></pre>
<p>While using bracket is a nice and simple way of managing resources, but there are some cases where a bracket is not the best choice:</p>
<ol>
<li><p>Bracket is not composable— When we have multiple resources, composing them with a bracket is not straightforward.</p></li>
<li><p>Messy nested brackets— In the case of multiple resources, nested brackets remind us of callback hell awkwardness. The bracket is designed with nested resource acquisition. In the case of multiple resources, we encounter inefficient nested bracket calls, and it causes refactoring a complicated process.</p></li>
</ol>
<p>Using brackets is simple and straightforward, but in the case of multiple resources, it isn't a good player. This is where we need another abstraction to cover these issues.</p>
<h3><a class="anchor" aria-hidden="true" id="zmanaged"></a><a href="#zmanaged" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ZManaged</h3>
<p><code>ZManage</code> is a composable data type for resource management, which wraps the acquisition and release action of a resource. We can think of <code>ZManage</code> as a handle with build-in acquisition and release logic.</p>
<p>To create a managed resource, we need to provide <code>acquire</code> and <code>release</code> action of that resource to the <code>make</code> constructor:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> managed = <span class="hljs-type">ZManaged</span>.make(acquire)(release)
</code></pre>
<p>We can use managed resources by calling <code>use</code> on that. A managed resource is meant to be used only inside of the <code>use</code> block. So that resource is not available outside of the <code>use</code> block.</p>
<p>The <code>ZManaged</code> is a separate world like <code>ZIO</code>; In this world, we have a lot of combinators to combine <code>ZManaged</code> and create another <code>ZManaged</code>. At the end of the day, when our composed <code>ZManaged</code> prepared, we can run any effect on this resource and convert that into a <code>ZIO</code> world.</p>
<p>Let's try to rewrite a <code>transfer</code> example with <code>ZManaged</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transfer</span></span>(from: <span class="hljs-type">String</span>, to: <span class="hljs-type">String</span>): <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] = {
  <span class="hljs-keyword">val</span> resource = <span class="hljs-keyword">for</span> {
    from &lt;- <span class="hljs-type">ZManaged</span>.make(is(from))(close)
    to   &lt;- <span class="hljs-type">ZManaged</span>.make(os(to))(close)
  } <span class="hljs-keyword">yield</span> (from, to)

  resource.use { <span class="hljs-keyword">case</span> (in, out) =&gt;
    copy(in, out)
  }
}
</code></pre>
<p>Also, we can get rid of this ceremony and treat the <code>Managed</code> like a <code>ZIO</code> effect:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transfer</span></span>(from: <span class="hljs-type">String</span>, to: <span class="hljs-type">String</span>): <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] = {
  <span class="hljs-keyword">val</span> resource: <span class="hljs-type">ZManaged</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] = <span class="hljs-keyword">for</span> {
    from &lt;- <span class="hljs-type">ZManaged</span>.make(is(from))(close)
    to   &lt;- <span class="hljs-type">ZManaged</span>.make(os(to))(close)
    _    &lt;- copy(from, to).toManaged_
  } <span class="hljs-keyword">yield</span> ()
  resource.useNow
}
</code></pre>
<p>This is where the <code>ZManaged</code> provides us a composable and flexible way of allocating resources.  They can be composed with any <code>ZIO</code> effect by converting them using the <code>ZIO#toManaged_</code> operator.</p>
<p><code>ZManaged</code> has several type aliases, each of which is useful for a specific workflow:</p>
<ul>
<li><strong><a href="/docs/datatypes/resource/managed">Managed</a></strong>— <code>Managed[E, A]</code> is a type alias for <code>Managed[Any, E, A]</code>.</li>
<li><strong><a href="/docs/datatypes/resource/task-managed">TaskManaged</a></strong>— <code>TaskManaged[A]</code> is a type alias for <code>ZManaged[Any, Throwable, A]</code>.</li>
<li><strong><a href="/docs/datatypes/resource/rmanaged">RManaged</a></strong>— <code>RManaged[R, A]</code> is a type alias for <code>ZManaged[R, Throwable, A]</code>.</li>
<li><strong><a href="/docs/datatypes/resource/umanaged">UManaged</a></strong>— <code>UManaged[A]</code> is a type alias for <code>ZManaged[Any, Nothing, A]</code>.</li>
<li><strong><a href="/docs/datatypes/resource/urmanaged">URManaged</a></strong>— <code>URManaged[R, A]</code> is a type alias for <code>ZManaged[R, Nothing, A]</code>.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/datatypes/stm/tsemaphore"><span class="arrow-prev">← </span><span>TSemaphore</span></a><a class="docs-next button" href="/docs/datatypes/resource/zmanaged"><span>ZManaged</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#try--finally">Try / Finally</a></li><li><a href="#zio-solution">ZIO Solution</a><ul class="toc-headings"><li><a href="#bracket">bracket</a></li><li><a href="#zmanaged">ZManaged</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/navbar_brand.png" alt="ZIO"/></a><div><h5>GitHub</h5><a href="https://github.com/zio/zio"><img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github"/></a></div><div><h5>Chat with us on Discord</h5><a href="https://discord.gg/2ccFBr4"><img src="https://img.shields.io/discord/629491597070827530?logo=discord&amp;style=social" alt="discord"/></a></div><div><h5>Follow us on Twitter</h5><a href="https://twitter.com/zioscala"><img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&amp;style=social" alt="twitter"/></a></div><div><h5>Additional resources</h5><a href="https://javadoc.io/doc/dev.zio/zio_2.12/">Scaladoc of zio</a></div><div><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"/></a></div></section><section class="copyright">Copyright © 2021 ZIO Maintainers</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0c94b59071da7001757d08ab43d9e033',
                indexName: 'zio',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>