<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-zio-metrics-connectors docs-doc-id-metrics/prometheus-client">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Prometheus Client | ZIO</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/zio-metrics-connectors/metrics/prometheus-client"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-zio-metrics-connectors-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-zio-metrics-connectors-current"><meta data-rh="true" property="og:title" content="Prometheus Client | ZIO"><meta data-rh="true" name="description" content="In a normal prometheus setup we will find prometheus agents which query configured endpoints"><meta data-rh="true" property="og:description" content="In a normal prometheus setup we will find prometheus agents which query configured endpoints"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/zio-metrics-connectors/metrics/prometheus-client"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-metrics-connectors/metrics/prometheus-client" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-metrics-connectors/metrics/prometheus-client" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IAX8GRSWEQ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-237088290-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0HNKLNRT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0HNKLNRT",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">










































<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><link rel="stylesheet" href="/assets/css/styles.3ac761dc.css">
<link rel="preload" href="/assets/js/runtime~main.b8164a70.js" as="script">
<link rel="preload" href="/assets/js/main.abe4d353.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a class="navbar__item navbar__link" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/ecosystem/">Ecosystem</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/overview/">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-metrics-connectors/">Introduction to ZIO ZMX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-metrics-connectors/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/zio-metrics-connectors/metrics/">Metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-metrics-connectors/metrics/zmx-metric-reference">ZMX Metric Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-metrics-connectors/metrics/statsd-client">StatsD Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zio-metrics-connectors/metrics/prometheus-client">Prometheus Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-metrics-connectors/metrics/instrumentation-examples">Instrumentation Examples</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zio-metrics-connectors/metrics/"><span itemprop="name">Metrics</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Prometheus Client</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Prometheus Client</h1></header><p>In a normal prometheus setup we will find prometheus agents which query configured endpoints
at regular intervals. The endpoints are HTTP endpoints serving the current metric state in
an encoding defined by <a href="https://prometheus.io/docs/instrumenting/exposition_formats/#text-based-format" target="_blank" rel="noopener noreferrer">prometheus</a>.</p><p>ZMX provides the Prometheus encoding for the captured metrics out of the box. To avoid enforcing
a particular HTTP implementation, an instrumented application needs to expose the encoded format
as an endpoint with the HTTP server of it´s choice. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zmx-metrics-in-prometheus">ZMX Metrics in Prometheus<a class="hash-link" href="#zmx-metrics-in-prometheus" title="Direct link to heading">​</a></h2><p>Most of the ZMX metrics have a direct representation in the Prometheus encoding. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="counter">Counter<a class="hash-link" href="#counter" title="Direct link to heading">​</a></h3><p>A counter is represented as a prometheus counter. </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"># TYPE countAll counter</span><br></span><span class="token-line"><span class="token plain"># HELP countAll </span><br></span><span class="token-line"><span class="token plain">countAll 460.0 1623586224730</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gauge">Gauge<a class="hash-link" href="#gauge" title="Direct link to heading">​</a></h3><p>A gauge is represented as a prometheus gauge. </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"># TYPE adjustGauge gauge</span><br></span><span class="token-line"><span class="token plain"># HELP adjustGauge </span><br></span><span class="token-line"><span class="token plain">adjustGauge -1.2485836762095701 1623586224730</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="histogram">Histogram<a class="hash-link" href="#histogram" title="Direct link to heading">​</a></h3><p>A histogram is represented as a prometheus histogram. </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"># TYPE zmxHistogram histogram</span><br></span><span class="token-line"><span class="token plain"># HELP zmxHistogram </span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;0.0&quot;} 0.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;10.0&quot;} 8.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;20.0&quot;} 18.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;30.0&quot;} 30.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;40.0&quot;} 44.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;50.0&quot;} 51.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;60.0&quot;} 59.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;70.0&quot;} 65.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;80.0&quot;} 76.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;90.0&quot;} 88.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;100.0&quot;} 95.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram{le=&quot;+Inf&quot;} 115.0 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram_sum 6828.578655207023 1623586224730</span><br></span><span class="token-line"><span class="token plain">zmxHistogram_count 115.0 1623586224730</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h3><p>A histogram is represented as a prometheus summary. </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"># TYPE mySummary summary</span><br></span><span class="token-line"><span class="token plain"># HELP mySummary </span><br></span><span class="token-line"><span class="token plain">mySummary{quantile=&quot;0.1&quot;,error=&quot;0.03&quot;} 147.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySummary{quantile=&quot;0.5&quot;,error=&quot;0.03&quot;} 286.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySummary{quantile=&quot;0.9&quot;,error=&quot;0.03&quot;} 470.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySummary_sum 42582.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySummary_count 139.0 1623589839194</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="set">Set<a class="hash-link" href="#set" title="Direct link to heading">​</a></h3><p>A set is represented by a set of prometheus counters, distinguished from each other with an
extra label as configured in the aspect. </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"># TYPE mySet counter</span><br></span><span class="token-line"><span class="token plain"># HELP mySet </span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-17&quot;} 7.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-18&quot;} 9.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-19&quot;} 12.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-13&quot;} 6.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-14&quot;} 4.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-15&quot;} 6.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-16&quot;} 5.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-10&quot;} 10.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-11&quot;} 1.0 1623589839194</span><br></span><span class="token-line"><span class="token plain">mySet{token=&quot;myKey-12&quot;} 10.0 1623589839194</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="serving-prometheus-metrics">Serving Prometheus metrics<a class="hash-link" href="#serving-prometheus-metrics" title="Direct link to heading">​</a></h2><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zhttp</span><span class="token namespace punctuation">.</span><span class="token namespace">http</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zhttp</span><span class="token namespace punctuation">.</span><span class="token namespace">service</span><span class="token namespace punctuation">.</span><span class="token plain">Server</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">console</span><span class="token namespace punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">zmx</span><span class="token namespace punctuation">.</span><span class="token plain">MetricSnapshot</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token plain"> Json</span><span class="token punctuation">,</span><span class="token plain"> Prometheus </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">zmx</span><span class="token namespace punctuation">.</span><span class="token namespace">prometheus</span><span class="token namespace punctuation">.</span><span class="token plain">PrometheusClient</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zhttp</span><span class="token namespace punctuation">.</span><span class="token namespace">service</span><span class="token namespace punctuation">.</span><span class="token namespace">server</span><span class="token namespace punctuation">.</span><span class="token plain">ServerChannelFactory</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zhttp</span><span class="token namespace punctuation">.</span><span class="token namespace">service</span><span class="token namespace punctuation">.</span><span class="token plain">EventLoopGroup</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">zmx</span><span class="token namespace punctuation">.</span><span class="token namespace">example</span><span class="token namespace punctuation">.</span><span class="token plain">InstrumentedSample</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> instrumentedSample </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> InstrumentedSample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZMX provides a prometheus client that can be used to produce the prometheus encoded metric state
upon request. The state is encoded in the <code>Prometheus</code> case class and the single attribute of
type <code>String</code> holds the prometheus encoded metric state. </p><p>So, to retrieve the prometheus encoded state, the application can simply use </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> encoded </span><span class="token operator">=</span><span class="token plain"> PrometheusClient</span><span class="token punctuation">.</span><span class="token plain">snapshot</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> content </span><span class="token operator">=</span><span class="token plain"> encoded</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In our example application we use <a href="https://github.com/dream11/zio-http" target="_blank" rel="noopener noreferrer">zio-http</a> to serve the metrics. Other application might choose another HTTP server framework if required.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> indexPage </span><span class="token operator">=</span><span class="token plain"> HttpData</span><span class="token punctuation">.</span><span class="token plain">CompleteData</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Chunk</span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token plain">fromArray</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">&quot;&quot;&quot;&lt;html&gt;</span><br></span><span class="token-line"><span class="token triple-quoted-string string">                  |&lt;title&gt;Simple Server&lt;/title&gt;</span><br></span><span class="token-line"><span class="token triple-quoted-string string">                  |&lt;body&gt;</span><br></span><span class="token-line"><span class="token triple-quoted-string string">                  |&lt;p&gt;&lt;a href=&quot;/metrics&quot;&gt;Metrics&lt;/a&gt;&lt;/p&gt;</span><br></span><span class="token-line"><span class="token triple-quoted-string string">                  |&lt;p&gt;&lt;a href=&quot;/json&quot;&gt;Json&lt;/a&gt;&lt;/p&gt;</span><br></span><span class="token-line"><span class="token triple-quoted-string string">                  |&lt;/body</span><br></span><span class="token-line"><span class="token triple-quoted-string string">                  |&lt;/html&gt;&quot;&quot;&quot;</span><span class="token punctuation">.</span><span class="token plain">stripMargin</span><span class="token punctuation">.</span><span class="token plain">getBytes</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> static     </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  Http</span><span class="token punctuation">.</span><span class="token plain">collect</span><span class="token punctuation">[</span><span class="token plain">Request</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> Method</span><span class="token punctuation">.</span><span class="token plain">GET </span><span class="token operator">-&gt;</span><span class="token plain"> Root </span><span class="token keyword">=&gt;</span><span class="token plain"> Response</span><span class="token punctuation">.</span><span class="token plain">http</span><span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">content </span><span class="token operator">=</span><span class="token plain"> indexPage</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> httpEffect </span><span class="token operator">=</span><span class="token plain"> Http</span><span class="token punctuation">.</span><span class="token plain">collectM</span><span class="token punctuation">[</span><span class="token plain">Request</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">case</span><span class="token plain"> Method</span><span class="token punctuation">.</span><span class="token plain">GET </span><span class="token operator">-&gt;</span><span class="token plain"> Root </span><span class="token operator">/</span><span class="token plain"> </span><span class="token string">&quot;metrics&quot;</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    PrometheusClient</span><span class="token punctuation">.</span><span class="token plain">snapshot</span><span class="token punctuation">.</span><span class="token plain">map </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> Prometheus</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> Response</span><span class="token punctuation">.</span><span class="token plain">text</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, using the HTTP server and the <a href="/zio-metrics-connectors/metrics/instrumentation-examples">instrumentation examples</a> we can create an effect
that simply runs the sample effects with their instrumentation until the user presses any key. </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">private</span><span class="token plain"> </span><span class="token keyword">lazy</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> execute </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    s </span><span class="token keyword">&lt;-</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">Server</span><span class="token punctuation">.</span><span class="token plain">port</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> Server</span><span class="token punctuation">.</span><span class="token plain">app</span><span class="token punctuation">(</span><span class="token plain">static </span><span class="token operator">++</span><span class="token operator">+</span><span class="token plain"> httpEffect</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">start </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZIO</span><span class="token punctuation">.</span><span class="token plain">never</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">forkDaemon</span><br></span><span class="token-line"><span class="token plain">    p </span><span class="token keyword">&lt;-</span><span class="token plain"> instrumentedSample</span><span class="token punctuation">.</span><span class="token plain">program</span><span class="token punctuation">.</span><span class="token plain">fork</span><br></span><span class="token-line"><span class="token plain">    _ </span><span class="token keyword">&lt;-</span><span class="token plain"> putStrLn</span><span class="token punctuation">(</span><span class="token string">&quot;Press Any Key to stop the demo server&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> getStrLn</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">            ZIO</span><span class="token punctuation">.</span><span class="token plain">none</span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> p</span><span class="token punctuation">.</span><span class="token plain">interrupt </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> s</span><span class="token punctuation">.</span><span class="token plain">interrupt</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> ExitCode</span><span class="token punctuation">.</span><span class="token plain">success</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">orDie</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, within a <code>ZIO.App</code> we can override the run method, which is now simply the execute
method with a Prometheus client provided in it´s environment:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> run</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> URIO</span><span class="token punctuation">[</span><span class="token plain">ZEnv</span><span class="token punctuation">,</span><span class="token plain"> ExitCode</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  execute</span><span class="token punctuation">.</span><span class="token plain">provideCustomLayer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    PrometheusClient</span><span class="token punctuation">.</span><span class="token plain">live </span><span class="token operator">++</span><span class="token plain"> ServerChannelFactory</span><span class="token punctuation">.</span><span class="token plain">auto </span><span class="token operator">++</span><span class="token plain"> EventLoopGroup</span><span class="token punctuation">.</span><span class="token plain">auto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-prometheus-example">Running the prometheus example<a class="hash-link" href="#running-the-prometheus-example" title="Direct link to heading">​</a></h2><p>Any of the examples can be run from a command line within the ZMX checkout directory with </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">sbt examples/run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Out of the choices, select the option corresponding to <code>zio.zmx.PrometheusInstrumentedApp</code>.</p><p>If everything works, we should be able to use a web browser to go to <code>http://localhost:8080/metrics</code> and should see something like </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"># TYPE myCounter counter</span><br></span><span class="token-line"><span class="token plain"># HELP myCounter</span><br></span><span class="token-line"><span class="token plain">myCounter{effect=&quot;count2&quot;} 46.0 1608982756235</span><br></span><span class="token-line"><span class="token plain"># TYPE setGauge gauge</span><br></span><span class="token-line"><span class="token plain"># HELP setGauge</span><br></span><span class="token-line"><span class="token plain">setGauge 8.66004641453435 1608982756235</span><br></span><span class="token-line"><span class="token plain"># TYPE changeGauge gauge</span><br></span><span class="token-line"><span class="token plain"># HELP changeGauge</span><br></span><span class="token-line"><span class="token plain">changeGauge 90.7178906485008 1608982756235</span><br></span><span class="token-line"><span class="token plain"># TYPE myCounter counter</span><br></span><span class="token-line"><span class="token plain"># HELP myCounter</span><br></span><span class="token-line"><span class="token plain">myCounter{effect=&quot;count1&quot;} 92.0 1608982756235</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once we see the metrics being served from our example, we can set up Prometheus and Grafana to create a simple dashboard displaying
our metrics. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-prometheus-setup">Simple Prometheus setup<a class="hash-link" href="#simple-prometheus-setup" title="Direct link to heading">​</a></h2><p>The following steps have been tested on Ubuntu 18.04 running inside the Windows Subsystem for Linux.
Essentially, you need to download the prometheus binaries for your environment and start the server
with our sample configuration located at </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">${PROJECT_HOME}/examples/prometheus/promcfg.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will just configure a prometheus job that regular polls <code>http://localhost:8080/metrics</code> for prometheus
encoded metrics.</p><p>In addition, you need to download the Grafana binaries for your installation, start the Grafana server and configure
prometheus as a single data source. </p><p>Finally, you can import our example dashboard at <code>examples/prometheus/ZmxDashboard.json</code> and enjoy the results.</p><blockquote><p>These steps are not intended to replace the Prometheus or Grafana documentation. Please refer to their web sites
for guidelines towards a more sophisticated setup or an installation on different platforms. </p></blockquote><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-and-configure-prometheus">Download and configure Prometheus<a class="hash-link" href="#download-and-configure-prometheus" title="Direct link to heading">​</a></h3><p>In the steps below the ZMX checkout directory will be referred to as <code>$ZMXDIR</code>.</p><ol><li><a href="https://github.com/prometheus/prometheus/releases/download/v2.23.0/prometheus-2.23.0.linux-amd64.tar.gz" target="_blank" rel="noopener noreferrer">Download</a> prometheus</li><li>Extract the downloaded archive to a directory of your choice, this will be referred to as <code>$PROMDIR</code>. </li><li>Within <code>$PROMDIR</code> execute <div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">./prometheus --config.file $ZMXDIR/examples/prometheus/promcfg.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>This will start the prometheus server which regularly polls the HTTP endpoint of the example above for its metrics.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="download-and-configure-grafana">Download and configure Grafana<a class="hash-link" href="#download-and-configure-grafana" title="Direct link to heading">​</a></h3><ol><li><p><a href="https://dl.grafana.com/oss/release/grafana-7.3.6.linux-amd64.tar.gz" target="_blank" rel="noopener noreferrer">Download</a> grafana</p></li><li><p>Extract the downloaded archive to a directory of your choice, this will be referred to as <code>$GRAFANADIR</code>.</p></li><li><p>Within <code>$GRAFANADIR</code> execute </p><div class="codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">./bin/grafana-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will start a the Grafana server.</p></li><li><p>Now you should be able to login to Grafana at <code>http://localhost:3000&#x27; with the default user </code>admin<code>with the default 
password</code>admin`. </p><p>Upon the first login you will be asked to change the default password. </p></li><li><p>Within the Grafana menu on the left hand side you will find <code>Manage Dashboards</code> within that page, select <code>Import</code>. </p></li><li><p>You can now either install a dashboard from grafana.com or use a text field to paste JSON. </p></li><li><p>Paste the content of <code>$ZMXDIR/examples/prometheus/ZmxDashboard.json</code> into the text field and select <code>Load</code>.</p><p>This will import our dashboard example. </p></li><li><p>Now, under <code>Manage Dashboards</code> the just imported ZIO dashboard should be visible. </p></li><li><p>Navigate to the dashboard. </p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grafana-dashboard">Grafana dashboard<a class="hash-link" href="#grafana-dashboard" title="Direct link to heading">​</a></h3><p>Here is a screenshot of the Grafana dashboard produced with the setup above. </p><p><img loading="lazy" alt="A simple Grafana Dashboard" src="/assets/images/ZIOZmx-Grafana-55da5b2aabcb63450c69108506e0f584.png" width="2804" height="1987" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zio-metrics-connectors/metrics/statsd-client"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">StatsD Client</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zio-metrics-connectors/metrics/instrumentation-examples"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Instrumentation Examples</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#zmx-metrics-in-prometheus" class="table-of-contents__link toc-highlight">ZMX Metrics in Prometheus</a><ul><li><a href="#counter" class="table-of-contents__link toc-highlight">Counter</a></li><li><a href="#gauge" class="table-of-contents__link toc-highlight">Gauge</a></li><li><a href="#histogram" class="table-of-contents__link toc-highlight">Histogram</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#set" class="table-of-contents__link toc-highlight">Set</a></li></ul></li><li><a href="#serving-prometheus-metrics" class="table-of-contents__link toc-highlight">Serving Prometheus metrics</a></li><li><a href="#running-the-prometheus-example" class="table-of-contents__link toc-highlight">Running the prometheus example</a></li><li><a href="#simple-prometheus-setup" class="table-of-contents__link toc-highlight">Simple Prometheus setup</a><ul><li><a href="#download-and-configure-prometheus" class="table-of-contents__link toc-highlight">Download and configure Prometheus</a></li><li><a href="#download-and-configure-grafana" class="table-of-contents__link toc-highlight">Download and configure Grafana</a></li><li><a href="#grafana-dashboard" class="table-of-contents__link toc-highlight">Grafana dashboard</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b8164a70.js"></script>
<script src="/assets/js/main.abe4d353.js"></script>
</body>
</html>