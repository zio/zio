<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-zio-prelude docs-doc-id-zpure/index">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">ZPure | ZIO</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/zio-prelude/zpure/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-zio-prelude-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-zio-prelude-current"><meta data-rh="true" property="og:title" content="ZPure | ZIO"><meta data-rh="true" name="description" content="A ZPure[W, S1, S2, R, E, A] is a description of a computation that requires an environment R and an initial state S1 and either fails with an error of type E or succeeds with an updated state of type S2 and a value of type A, in either case also producing a log of type W."><meta data-rh="true" property="og:description" content="A ZPure[W, S1, S2, R, E, A] is a description of a computation that requires an environment R and an initial state S1 and either fails with an error of type E or succeeds with an updated state of type S2 and a value of type A, in either case also producing a log of type W."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/zio-prelude/zpure/"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-prelude/zpure/" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-prelude/zpure/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IAX8GRSWEQ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-237088290-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0HNKLNRT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0HNKLNRT",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
















































<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><link rel="stylesheet" href="/assets/css/styles.3ac761dc.css">
<link rel="preload" href="/assets/js/runtime~main.0bd4e8b1.js" as="script">
<link rel="preload" href="/assets/js/main.b377fcc3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a class="navbar__item navbar__link" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/ecosystem/">Ecosystem</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/overview/">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-prelude/">ZIO Prelude</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-prelude/abstraction-diagrams">Abstraction Diagrams</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/zio-prelude/functionalabstractions/">Functional Abstractions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Functional Abstractions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/">Concrete Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Concrete Types&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/associative">Associative</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/commutative">Commutative</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/debug">Debug</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/equal">Equal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/hash">Hash</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/identity">Identity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/inverse">Inverse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/concretetypes/ord">Ord</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/">Parameterized Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Parameterized Types&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/associativeboth">AssociativeBoth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/associativeeither">AssociativeEither</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/associativeflatten">AssociativeFlatten</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/commutativeboth">CommutativeBoth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/commutativeeither">CommutativeEither</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/contravariant">Contravariant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/covariant">Covariant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/foreach">ForEach</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/identityboth">IdentityBoth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/identityeither">IdentityEither</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/identityflatten">IdentityFlatten</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/invariant">Invariant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionalabstractions/parameterizedtypes/nonemptyforeach">NonEmptyForEach</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/zio-prelude/functionaldatatypes/">Functional Data Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Functional Data Types&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionaldatatypes/equivalence">Equivalence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionaldatatypes/nonemptylist">NonEmptyList</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionaldatatypes/these">These</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionaldatatypes/validation">Validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionaldatatypes/zset">ZSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zio-prelude/functionaldatatypes/zvalidation">ZValidation</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-prelude/newtypes/">New Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zio-prelude/zpure/">ZPure</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ZPure</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ZPure</h1></header><p>A <code>ZPure[W, S1, S2, R, E, A]</code> is a description of a computation that requires an environment <code>R</code> and an initial state <code>S1</code> and either fails with an error of type <code>E</code> or succeeds with an updated state of type <code>S2</code> and a value of type <code>A</code>, in either case also producing a log of type <code>W</code>.</p><p>Conceptually, we can think of <code>ZPure</code> as just a function, though <code>ZPure</code> is not actually implemented this way for reasons of efficiency and stack safety.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Chunk</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token plain">W</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">S1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">S2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">run</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> S1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">Chunk</span><span class="token punctuation">[</span><span class="token plain">W</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">E</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">S2</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ZPure</code> data type models four &quot;capabilities&quot; that a computation can have in addition to just producing a value of type <code>A</code>:</p><ul><li><strong>Errors</strong> - A <code>ZPure</code> computation can fail with an error of type <code>E</code> similar to an <code>Either</code>.</li><li><strong>Context</strong> - A <code>ZPure</code> computation can require some environment of type <code>R</code> similar to a <code>Reader</code> data type.</li><li><strong>State</strong> - A <code>ZPure</code> computation can update a state <code>S1</code> to a new state <code>S2</code> similar to a <code>State</code> data type.</li><li><strong>Logging</strong> - A <code>ZPure</code> computation can maintain a log of type <code>W</code> similar to a <code>Writer</code> data type.</li></ul><p>Previously, each of these capabilities required a separate data type, such as <code>Either</code> for modeling errors.</p><p>This was fine when we just needed one of these capabilities but it broke down when we wanted to describe computations that used more than one capability. How were we supposed to describe, for example, a computation that updated state and could also fail?</p><p>The answer was to use other data types called <em>monad transformers</em> which &quot;stacked&quot; these capabilities on top of existing data types. So to get state and errors we would stack an <code>EitherT</code> monad transformer on top of a <code>StateT</code> monad transformer.</p><p>This approach has a number of problems.</p><p>First, it has terrible performance. Each of these monad transformers is its own data type so evaluating a single step in a monad transformer stack requires digging into multiple layers of data structures just to access a single value, doing something with it, and then rebuilding all the layers of that nested data structure all over again.</p><p>Second, monad transformers have very poor ergonomics. They are generally invariant so they have bad type inference and working with these nested structures creates many opportunities for errors, such as constructing the &quot;stack&quot; in the wrong order, that reduce developer productivity and make it harder to onboard new developers.</p><p>Third, monad transformer stacks are actually not powerful enough to model what they are trying to describe. Each part of the &quot;stack&quot; only knows about itself and not the other parts of the stack so it is impossible to implement operators that require multiple capabilities.</p><p><code>ZPure</code> addresses this problem by including all of these capabilities in one data type using the same technique of &quot;effect rotation&quot; pioneered in ZIO. This results in dramatically higher performance, improved ergonomics, and a much more powerful API.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-operations">Basic Operations<a class="hash-link" href="#basic-operations" title="Direct link to heading">​</a></h2><p>The <code>ZPure</code> data type exposes a very similar API to the <code>ZIO</code> data type, excluding operators that deal directly with IO or concurrency. So if you know how to use <code>ZIO</code> you should be very comfortable working with <code>ZPure</code> as well.</p><p>Just like <code>ZIO</code>, <code>ZPure</code> is a description of a computation so the computation will not actually be executed until we run it.</p><p>If we are not embedding side effecting code in <code>ZPure</code> this laziness will not be observable in the result of a <code>ZPure</code> computation but it can be important to keep in mind for performance. For example, if we are doing some expensive but not side effecting computation in the context of <code>ZPure</code> and using the result multiple times we want to only run the <code>ZPure</code> computation once instead of multiple times.</p><p>The operators that execute a <code>ZPure</code> computation are all variants of <code>run</code> to emphasize that when we call them we are actually running the computation described by the <code>ZPure</code> value.</p><p>Also like <code>ZIO</code>, <code>ZPure</code> is stack safe, so we can write recursive programs in terms of <code>ZPure</code> without worrying about stack overflow errors.</p><p>The main difference between <code>ZIO</code> and <code>ZPure</code> is that we do not want to embed arbitrary side effecting code in <code>ZPure</code>. <code>ZPure</code> supports a specific set of capabilities but if we have arbitrary effects we are better off using <code>ZIO</code>, which has the power to manage these effects and also more clearly signals our intent.</p><p>We can create a computation that succeeds with an existing value using the <code>succeed</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">prelude</span><span class="token namespace punctuation">.</span><span class="token namespace">fx</span><span class="token namespace punctuation">.</span><span class="token plain">ZPure</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> one</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// one: ZPure[Nothing, Unit, Unit, Any, Nothing, Int] = Succeed(value = 1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the log type <code>W</code> here is nothing, indicating that we are not logging anything right now. The <code>S1</code>and <code>S2</code> types are <code>Unit</code> because we are not using <code>State</code> in this computation.</p><p>The environment type is <code>Any</code>, indicating that this computation does not require any environment to be run. And the error type is <code>Nothing</code> because this computation cannot fail.</p><p>If we find ourselves using the same type parameters over and over it can be helpful to define a type alias to avoid repeating ourselves. There are also several useful type aliases for <code>ZPure</code> defined directly in ZIO Prelude.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">type</span><span class="token plain"> State</span><span class="token punctuation">[</span><span class="token plain">S</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> zio</span><span class="token punctuation">.</span><span class="token plain">prelude</span><span class="token punctuation">.</span><span class="token plain">fx</span><span class="token punctuation">.</span><span class="token plain">ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">,</span><span class="token plain"> S</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> Reader</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token plain">R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> zio</span><span class="token punctuation">.</span><span class="token plain">prelude</span><span class="token punctuation">.</span><span class="token plain">fx</span><span class="token punctuation">.</span><span class="token plain">ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> R</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">type</span><span class="token plain"> Writer</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token plain">W</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain">A</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> zio</span><span class="token punctuation">.</span><span class="token plain">prelude</span><span class="token punctuation">.</span><span class="token plain">fx</span><span class="token punctuation">.</span><span class="token plain">ZPure</span><span class="token punctuation">[</span><span class="token plain">W</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> A</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>State</code> type alias specializes the environment type to <code>Any</code> and the error and log types to <code>Nothing</code> and just has a single state type &#x27;A&#x27;. It is analogous to a function <code>S =&gt; (S, A)</code>.</p><p>The <code>Reader</code> type alias has an environment type but specializes the log and error types to <code>Nothing</code> and the state types to <code>Unit</code>. It is analogous to a function <code>R =&gt; A</code>.</p><p>The <code>Writer</code> type alias has a log type but specializes the environment type to <code>Any</code>, the error type to <code>Nothing</code>, and the state types to <code>Unit</code>. It is analogous to a function <code>() =&gt; (W, A)</code>.</p><p>There are also versions of each of these type aliases that support failure, <code>EState</code>, <code>EReader</code>, and <code>EWriter</code>. Using these type aliases can simplify your type signatures and lead to better type inference in some cases. So if you are really only working with one or two of the capabilities of <code>ZPure</code> it is definitely worth using these type aliases.</p><p>However, for now we will continue to use the full <code>ZPure</code> type signature.</p><p>We can transform the successful value of a computation using the <code>map</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> two</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  one</span><span class="token punctuation">.</span><span class="token plain">map</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// two: ZPure[Nothing, Unit, Unit, Any, Nothing, Int] = FlatMap(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = Succeed(value = 1),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   continue = zio.prelude.fx.ZPure$$Lambda$11744/0x0000000102de5840@50210d21</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can combine the values of two computations with the <code>zipWith</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> three</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  one</span><span class="token punctuation">.</span><span class="token plain">zipWith</span><span class="token punctuation">(</span><span class="token plain">two</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token operator">+</span><span class="token plain"> _</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// three: ZPure[Nothing, Unit, Unit, Any, Nothing, Int] = FlatMap(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = Succeed(value = 1),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   continue = zio.prelude.fx.ZPure$$Lambda$11752/0x0000000102df3840@29992e05</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also chain computations using the <code>flatMap</code> operator and Scala&#x27;s for comprehension syntax.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> six</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    x </span><span class="token keyword">&lt;-</span><span class="token plain"> one</span><br></span><span class="token-line"><span class="token plain">    y </span><span class="token keyword">&lt;-</span><span class="token plain"> two</span><br></span><span class="token-line"><span class="token plain">    z </span><span class="token keyword">&lt;-</span><span class="token plain"> three</span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> x </span><span class="token operator">+</span><span class="token plain"> y </span><span class="token operator">+</span><span class="token plain"> z</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// six: ZPure[Nothing, Unit, Unit, Any, Nothing, Int] = FlatMap(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = Succeed(value = 1),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   continue = &lt;function1&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The easiest way to run a computation is to use the <code>run</code> method. It requires us to have already provided any required environment and initial state and handled our errors and just produces the final value.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  three</span><span class="token punctuation">.</span><span class="token plain">run</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// value: Int = 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-errors">Working With Errors<a class="hash-link" href="#working-with-errors" title="Direct link to heading">​</a></h2><p>Since <code>ZIO</code> also has an error type the operators for working with errors are quite similar to the ones on <code>ZIO</code>.</p><p>We can create a computation that fails with an error using the <code>fail</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> fail</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;fail&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// fail: ZPure[Nothing, Unit, Unit, Any, String, Nothing] = Fail(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   error = Single(value = &quot;fail&quot;)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice how now the error type is <code>String</code>, indicating that this computation can fail with a <code>String</code> error. In this case the success type is <code>Nothing</code> since we actually know that this computation can never succeed.</p><p>If we are working with code that can throw exceptions we can use the <code>attempt</code> operator of <code>ZPure</code> to safely import that code into our computation, catching any non-fatal exceptions and translating them into failure values.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> parseIntThrowable</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Throwable</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">attempt</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">.</span><span class="token plain">toInt</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can use the <code>mapError</code> operator to transform the error type of a computation, for example to map it to a common error type we are using in other parts of our computation.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> parseInt</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  parseIntThrowable</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">mapError</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">getMessage</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can recover from errors by using the <code>catchAll</code> operator, which allows us to recover from the failure using a new computation.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> parseIntOrDefault</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  parseInt</span><span class="token punctuation">(</span><span class="token plain">s</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">catchAll</span><span class="token punctuation">(</span><span class="token plain">_ </span><span class="token keyword">=&gt;</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now the error type is <code>Nothing</code>, indicating that we have handled all our errors.</p><p>There are many other error handling operators defined on <code>ZPure</code>. The <code>catchSome</code> operator allows us to only recover from certain errors.</p><p>The <code>fold</code> and <code>foldM</code> operators allow us to handle both the failure and success cases at the same time. And the <code>orElse</code> operator allows us to specify a fallback computation that will be run if the original computation fails.</p><p>One other concept from <code>ZIO</code> that carries over to <code>ZPure</code> is the ability to accumulate multiple errors.</p><p>Normally when we use operators like <code>zip</code> or <code>flatMap</code> if an error occurs we will not go on to evaluate further parts of the computation until we get to an error handler that can potentially recover from it. This is typically what we want because if we have already failed there is no point in doing more work.</p><p>However, <code>ZPure</code> also allows us to accumulate errors when we use the <code>zipWithPar</code> operator . This operator does not do actual parallelism, but is &quot;parallel&quot; in the sense that it will run both computations even if the first one fails and return any failures that occurred.</p><p>You can use this to obtain behavior similar to the <code>Validation</code> data type in ZIO Prelude. All of the errors will be captured in a <code>Cause</code> data structure similar to the one from <code>ZIO</code>.</p><p>For example, we could model validating some data using <code>ZPure</code> like this.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Person</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateName</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">.</span><span class="token plain">isEmpty</span><span class="token punctuation">)</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string">&quot;name was empty&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validateAge</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">age </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">)</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Age </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">age</span><span class="token string-interpolation string"> was less than zero&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">else</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validatePerson</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> Person</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validateName</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">zipWithPar</span><span class="token punctuation">(</span><span class="token plain">validateAge</span><span class="token punctuation">(</span><span class="token plain">age</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain">Person</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To expose the full cause of failure we can use the <code>sandbox</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">prelude</span><span class="token namespace punctuation">.</span><span class="token namespace">fx</span><span class="token namespace punctuation">.</span><span class="token plain">Cause</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> validatePersonCause</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> Cause</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> Person</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  validatePerson</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">sandbox</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can now see all the failures that occurred and handle them using our normal error handling operators. If we want to submerge the full cause again and just see the error type we can undo this with the <code>unsandbox</code> operator.</p><p>Once again, a variety of other operators for dealing with the full cause of failure are available on <code>ZPure</code> analogous to the ones on <code>ZIO</code> but we will not cover them all here. With <code>sandbox</code> and <code>unsandbox</code> you should be able to handle any problems involving working with the full cause of failure and you can always look up more specialized operators later.</p><p>Of course, if all we want to do is validate data the <code>Validation</code> type is more specialized than this and is what we should use. But it is very nice to be able to accumulate errors when you need to when we are already working in the context of a <code>ZPure</code> computation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-context">Working With Context<a class="hash-link" href="#working-with-context" title="Direct link to heading">​</a></h2><p>The environment type <code>R</code> is also analogous to the environment type of ZIO.</p><p>The main difference is that we tend to use <code>ZPure</code> to describe a particular computation in our application rather than as the basis for our entire application architecture. As a result, services tend to be less commonly used in the environment and often the environment just consists of some data.</p><p>We also do not use layers to construct the environment. Layers are inherently effectual and we do not want to perform arbitrary effects as part of a <code>ZPure</code> computation.</p><p>As an example of how we might use the environment type in a <code>ZPure</code> computation, we can imagine that our computation describes some logic for working with customer accounts. To perform its logic our computation needs access to various values such as the interest rate to use.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AccountEnvironment</span><span class="token punctuation">(</span><span class="token plain">interestRate</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can work with the environment using the same operators we use for <code>ZIO</code>, with the caveat described above that we use the more generic environment operators instead of the ones specialized for the module pattern.</p><p>We access the environment using the <code>environment</code> operator, so if we wanted to access the environment we could do it like this:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> accountEnvironment</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> AccountEnvironment</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AccountEnvironment</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">environment</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// accountEnvironment: ZPure[Nothing, Unit, Unit, AccountEnvironment, Nothing, AccountEnvironment] = Access(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   access = zio.prelude.fx.ZPure$AccessPartiallyApplied$$$Lambda$11819/0x0000000102e40040@5fcd406d</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This computation does not use logging or state and cannot fail, but it now depends on an <code>AccountEnvironment</code> and just returns the <code>AccountEnvironment</code>. Since this computation now succeeds with an <code>AccountEnvironment</code> we can use all of our normal operators for transforming success values like <code>map</code> and <code>flatMap</code> to work with it.</p><p>If we just want to do one thing with the environment like get the interest rate we can do this slightly more concisely with the <code>access</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> interestRate</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> AccountEnvironment</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">access</span><span class="token punctuation">(</span><span class="token plain">_</span><span class="token punctuation">.</span><span class="token plain">interestRate</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// interestRate: ZPure[Nothing, Unit, Unit, AccountEnvironment, Nothing, Double] = Access(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   access = zio.prelude.fx.ZPure$AccessPartiallyApplied$$$Lambda$11819/0x0000000102e40040@2f81583a</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is also an <code>accessM</code> variant for when we want to perform another computation based on the value from the environment.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> computeSimpleInterest</span><span class="token punctuation">(</span><span class="token plain">balance</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">,</span><span class="token plain"> days</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> interestRate</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">succeed</span><span class="token punctuation">(</span><span class="token plain">balance </span><span class="token operator">*</span><span class="token plain"> days </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number">365</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> interestRate</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">def</span><span class="token plain"> accruedInterest</span><span class="token punctuation">(</span><span class="token plain">balance</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">,</span><span class="token plain"> days</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> AccountEnvironment</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">accessM</span><span class="token punctuation">(</span><span class="token plain">r </span><span class="token keyword">=&gt;</span><span class="token plain"> computeSimpleInterest</span><span class="token punctuation">(</span><span class="token plain">balance</span><span class="token punctuation">,</span><span class="token plain"> days</span><span class="token punctuation">,</span><span class="token plain"> r</span><span class="token punctuation">.</span><span class="token plain">interestRate</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To run a computation we need to provide it with its required environment, which we can do with the <code>provide</code> operator.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> interestComputation</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  accruedInterest</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">provide</span><span class="token punctuation">(</span><span class="token plain">AccountEnvironment</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// interestComputation: ZPure[Nothing, Unit, Unit, Any, Nothing, Double] = Provide(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   r = AccountEnvironment(interestRate = 0.05),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   continue = Access(access = &lt;function1&gt;)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once we have provided our application with our required environment we are ready ro run it.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> interestDue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Double</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  interestComputation</span><span class="token punctuation">.</span><span class="token plain">run</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// interestDue: Double = 410.958904109589</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-state">Working With State<a class="hash-link" href="#working-with-state" title="Direct link to heading">​</a></h2><p>The state type described by <code>S1</code> and <code>S2</code> is the first capability provided by <code>ZPure</code> that is not directly analogous to <code>ZIO</code>.</p><p>In <code>ZIO</code> we manage state using the <code>Ref</code> and <code>FiberRef</code> data types so we do not need these additional type parameters. In contrast, in <code>ZPure</code> we want to avoid arbitrary side effects so we instead model state as a function that takes the old state and returns the new state using the <code>S1</code> and <code>S2</code> type parameters.</p><p>In practice in most cases <code>S1</code> and <code>S2</code> will be the same and we will be describing a computation that takes some state and just returns an updated value of the same state type. However, in some cases it can be useful to model the initial and updated state separately, for example to describe a transition from a <code>Closed</code> to <code>Open</code> state in a type safe way.</p><p>To motivate our example here let&#x27;s define an <code>AccountState</code> type.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> AccountState</span><span class="token punctuation">(</span><span class="token plain">balance</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">open</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We will also define a domain specific error type which we will use.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">sealed</span><span class="token plain"> </span><span class="token keyword">trait</span><span class="token plain"> AccountError</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">object</span><span class="token plain"> InsufficientFunds </span><span class="token keyword">extends</span><span class="token plain"> AccountError</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The most basic operators for working with state are <code>get</code> and <code>set</code>. The <code>get</code> operator retrieves the initial state and the <code>set</code> operator sets the updated state to the specified value.</p><p>Let&#x27;s use these operators to describe a computation that withdraws funds from the account.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> withdraw</span><span class="token punctuation">(</span><span class="token plain">amount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AccountError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    state </span><span class="token keyword">&lt;-</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">[</span><span class="token plain">AccountState</span><span class="token punctuation">]</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    _     </span><span class="token keyword">&lt;-</span><span class="token plain"> </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">amount </span><span class="token operator">&gt;</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token plain">balance</span><span class="token punctuation">)</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">fail</span><span class="token punctuation">(</span><span class="token plain">InsufficientFunds</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">             </span><span class="token keyword">else</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">set</span><span class="token punctuation">(</span><span class="token plain">AccountState</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">balance </span><span class="token operator">-</span><span class="token plain"> amount</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">yield</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This example combines a couple of the features we have talked about so far.</p><p>First, we are using a for comprehension to chain together multiple computations</p><p>Second, we are using both the error type and the state type here. If the customer has insufficient funds we fail immediately, otherwise we update the state.</p><p>One important thing to note here is that since <code>ZPure</code> computations are never concurrent we don&#x27;t need to worry about conflicting modifications to the state.</p><p>For example, in the context of <code>ZIO</code> code analogous to the above would not be safe because the <code>get</code> and <code>set</code> would not be performed atomically so we would need to do the entire transaction in a single <code>modify</code> operation, returning a value indicating whether there were sufficient funds. In <code>ZPure</code> we don&#x27;t have to do any of that so our code can be simpler.</p><p>There are also <code>update</code> and <code>modify</code> operators on <code>ZPure</code>. So for example we could factor out the logic of updating the account balance in the <code>withdraw</code> method like this:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> decrementBalance</span><span class="token punctuation">(</span><span class="token plain">amount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">update</span><span class="token punctuation">(</span><span class="token plain">state </span><span class="token keyword">=&gt;</span><span class="token plain"> AccountState</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">balance </span><span class="token operator">-</span><span class="token plain"> amount</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we are working with state then to actually run our computation we need to provide it with an initial state. The easiest way to do this is with the <code>provideState</code> operator, analogous to how we provide the environment.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> withdrawalComputation</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">Nothing</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AccountError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  withdraw</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">provideState</span><span class="token punctuation">(</span><span class="token plain">AccountState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// withdrawalComputation: ZPure[Nothing, Any, AccountState, Any, AccountError, Unit] = FlatMap(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = Modify(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     run0 = zio.prelude.fx.ZPure$$$Lambda$11828/0x0000000102e41840@771110ee</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   ),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   continue = zio.prelude.fx.ZPure$$Lambda$11752/0x0000000102df3840@1718e10f</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We will use the <code>runEither</code> operator, which is a variant of <code>run</code> that allows the computation to fail and just converts the failure to the left side of an <code>Either</code>. The <code>run</code> and <code>runEither</code> operators just return the final value, so let&#x27;s use the <code>get</code> operator to get the final state before we run our computation since we only care about the final state.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> updatedAccountState</span><span class="token operator">:</span><span class="token plain"> Either</span><span class="token punctuation">[</span><span class="token plain">AccountError</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token plain">withdrawalComputation </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">get</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">runEither</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-logging">Working With Logging<a class="hash-link" href="#working-with-logging" title="Direct link to heading">​</a></h2><p>The final capability provided by <code>ZPure</code> is logging.</p><p>We can add to the log with the <code>log</code> operator on the <code>ZPure</code> companion object.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> withdrawLog</span><span class="token punctuation">(</span><span class="token plain">amount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AccountError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  ZPure</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string">&quot;Attempting to withdraw&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token plain"> withdraw</span><span class="token punctuation">(</span><span class="token plain">amount</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token operator">*</span><span class="token plain"> ZPure</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Withdrew </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">amount</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also use the <code>log</code> operator on the <code>ZPure</code> trait to log something immediately after a computation has successfully completed.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">def</span><span class="token plain"> withdrawLog</span><span class="token punctuation">(</span><span class="token plain">amount</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AccountError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  withdraw</span><span class="token punctuation">(</span><span class="token plain">amount</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">log</span><span class="token punctuation">(</span><span class="token string-interpolation id function">s</span><span class="token string-interpolation string">&quot;Withdrew </span><span class="token string-interpolation interpolation punctuation">$</span><span class="token string-interpolation interpolation expression">amount</span><span class="token string-interpolation string">&quot;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The log is maintained until our computation is done.</p><p>This time we will use the <code>runAll</code> operator to run our computation. <code>runAll</code> is the most general way of running a <code>ZPure</code> computation and returns the log as well as either the failure or the success.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token plain">Chunk</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> withdrawalComputationLog</span><span class="token operator">:</span><span class="token plain"> ZPure</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> AccountState</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Any</span><span class="token punctuation">,</span><span class="token plain"> AccountError</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  withdrawLog</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// withdrawalComputationLog: ZPure[String, AccountState, AccountState, Any, AccountError, Unit] = FlatMap(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   value = FlatMap(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     value = Modify(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//       run0 = zio.prelude.fx.ZPure$$$Lambda$11827/0x0000000102e42840@226305a9</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     ),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//     continue = &lt;function1&gt;</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   ),</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">//   continue = zio.prelude.fx.ZPure$$Lambda$11829/0x0000000102e41040@706d957</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// )</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> log</span><span class="token operator">:</span><span class="token plain"> Chunk</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  withdrawalComputationLog</span><span class="token punctuation">.</span><span class="token plain">runAll</span><span class="token punctuation">(</span><span class="token plain">AccountState</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">_1</span><br></span><span class="token-line"><span class="token plain"></span><span class="token comment">// log: Chunk[String] = IndexedSeq(&quot;Withdrew 10&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zio-prelude/newtypes/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">New Types</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-operations" class="table-of-contents__link toc-highlight">Basic Operations</a></li><li><a href="#working-with-errors" class="table-of-contents__link toc-highlight">Working With Errors</a></li><li><a href="#working-with-context" class="table-of-contents__link toc-highlight">Working With Context</a></li><li><a href="#working-with-state" class="table-of-contents__link toc-highlight">Working With State</a></li><li><a href="#working-with-logging" class="table-of-contents__link toc-highlight">Working With Logging</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.0bd4e8b1.js"></script>
<script src="/assets/js/main.b377fcc3.js"></script>
</body>
</html>