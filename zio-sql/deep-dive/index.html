<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-zio-sql docs-doc-id-deep-dive">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Deep dive | ZIO</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zio.dev/zio-sql/deep-dive"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-zio-sql-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-zio-sql-current"><meta data-rh="true" property="og:title" content="Deep dive | ZIO"><meta data-rh="true" name="description" content="Inserts in depth"><meta data-rh="true" property="og:description" content="Inserts in depth"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://zio.dev/zio-sql/deep-dive"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-sql/deep-dive" hreflang="en"><link data-rh="true" rel="alternate" href="https://zio.dev/zio-sql/deep-dive" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://IAX8GRSWEQ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-237088290-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SH0HNKLNRT"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SH0HNKLNRT",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ZIO" href="/opensearch.xml">
















































<link rel="stylesheet" href="/css/prism/prism-material-dark.css"><link rel="stylesheet" href="/assets/css/styles.3ac761dc.css">
<link rel="preload" href="/assets/js/runtime~main.64c25a3d.js" as="script">
<link rel="preload" href="/assets/js/main.078878fa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/navbar_brand.png" alt="ZIO" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/overview/">Overview</a><a class="navbar__item navbar__link" href="/reference/">Reference</a><a class="navbar__item navbar__link" href="/guides/">Guides</a><a class="navbar__item navbar__link" href="/ecosystem/">Ecosystem</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/about/">About</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/overview/">ZIO 2.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/overview/">ZIO 2.x</a></li><li><a class="dropdown__link" href="/version-1.x/overview/">ZIO 1.x</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zio-sql/">ZIO SQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zio-sql/deep-dive">Deep dive</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deep dive</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deep dive</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inserts-in-depth">Inserts in depth<a class="hash-link" href="#inserts-in-depth" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="table-description">Table description<a class="hash-link" href="#table-description" title="Direct link to heading">​</a></h3><p>As usual, in order to use the DSL, first thing we need to do is to create meta-model of our table. Let’s imagine we have a <em>customers</em> table in postgres (in case of a different database just extend the appropriate module)</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">sql</span><span class="token namespace punctuation">.</span><span class="token namespace">postgresql</span><span class="token namespace punctuation">.</span><span class="token plain">PostgresModule</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">trait</span><span class="token plain"> TableModel </span><span class="token keyword">extends</span><span class="token plain"> PostgresModule </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">import</span><span class="token plain"> ColumnSet</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> customers </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> localDate</span><span class="token punctuation">(</span><span class="token plain">“date_of_birth”</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> string</span><span class="token punctuation">(</span><span class="token string">&quot;first_name&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> string</span><span class="token punctuation">(</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> boolean</span><span class="token punctuation">(</span><span class="token string">&quot;verified_customer&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> zonedDateTime</span><span class="token punctuation">(</span><span class="token string">&quot;created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">val</span><span class="token plain"> customerId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> dob </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> fName </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> lName </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> verified </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> created </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, to use zio-sql ’s inserts, just mix in <code>TableModel</code> trait from above, to your repository. </p><p>In case you’re wondering what those extracted columns are (customerId, dob etc), they are of a type called <em>Expr</em>.
<code>Expr[F, A, B]</code> is fundamental abstraction in zio-sql which basically represents description of any SQL expression of type <code>B</code>, having a source of type <code>A</code> and a phantom type <code>F</code>.
To give specific example, type of <code>fName</code> is </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">Expr</span><span class="token punctuation">[</span><span class="token plain">Features</span><span class="token punctuation">.</span><span class="token plain">Source</span><span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">(</span><span class="token plain">“first_name”</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">TableType</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This gives DSL huge power to remember table from which the column comes from, type of the columns and what kind of Expr we are dealing with. Don’t worry, you don’t need to remember any of this, but from now on we will use those Expr instances in our inserts.</p><p>In general, DSL is giving us two options how to approach inserts. We can insert either tuple values or used defined case class - which requires zio-schema instance (more on that later).
Also your custom data type or tuple need to consist only of the types for which there is a <code>TypeTag</code> instance defined. Each sql module has a finite set of such types - those are the types that particular module can work with. In other words, types inside your tuples or case class need to correspond with the types of the extracted Exprs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insert-tuples">Insert tuples<a class="hash-link" href="#insert-tuples" title="Direct link to heading">​</a></h3><p>Let’s say we want to build the query like the following one:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">insert</span><span class="token plain"> </span><span class="token keyword">into</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">  customers</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain"> date_of_birth</span><span class="token punctuation">,</span><span class="token plain"> first_name</span><span class="token punctuation">,</span><span class="token plain"> last_name</span><span class="token punctuation">,</span><span class="token plain"> verified_customer</span><span class="token punctuation">,</span><span class="token plain"> created</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">values</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">(</span><span class="token string">&#x27;60b01fc9-c902-4468-8d49-3c0f989def37&#x27;</span><span class="token punctuation">,</span><span class="token plain"> ‘</span><span class="token number">1983</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">05</span><span class="token plain">’</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Ronald&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;Russell&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;2020-11-21 19:10:25+00&#x27;</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>zio-sql gives us nice typesafe DSL that feels similar to writing SQL:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain">insertInto</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">(</span><span class="token plain">customerId</span><span class="token punctuation">,</span><span class="token plain"> dob</span><span class="token punctuation">,</span><span class="token plain"> fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> verified</span><span class="token punctuation">,</span><span class="token plain"> created</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token plain">values</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1990</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russell&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Compiler verifies your inserts and your query fails with compile-time error at any of the following situations:</p><ul><li>you mess up the order of values - e.g. you put Boolean where String is expected</li><li>you don’t specify all the not null columns of the table</li><li>you try to insert to columns from another table</li></ul><p>Some  details about syntax: <code>insertInto</code> method takes two value parameters. One is our table <code>customers</code> that we created before in <em>Table description</em> section. The other is an <em>HList like</em> collection of Expr’s, called <code>Selection</code>. You create it by appending Exprs with “++” operator.
<code>values</code> method takes a Tuple6 of type (UUID, LocalDate, String, String, Boolean, ZonedDateTime). The required tuple is dependent on combination of Exprs. Just like with normal sql insert, you could swap <code>fName</code> with <code>dob</code> Expr and corresponding values and your query will work just fine. Compiler will only let you build such queries that won’t explode in runtime (in case you described your table correctly of course ! )</p><p>If we need to insert multiple values at once, all we need to do is to create any <code>Seq</code> of tuples and stick it into the overloaded <code>values</code> method. </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> data </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        List</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1990</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russel1&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain">  ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1980</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russel2&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain">  ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1970</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald3&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russel3&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain">  ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> insertInto</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        customerId</span><span class="token punctuation">,</span><span class="token plain"> dob</span><span class="token punctuation">,</span><span class="token plain"> fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> verified</span><span class="token punctuation">,</span><span class="token plain"> createdString</span><span class="token punctuation">,</span><span class="token plain"> createdTimestamp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">values</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, data is of type <code>List[(UUID, LocalDate, String, String, Boolean, ZonedDateTime)]</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insert-custom-case-class">Insert custom case class<a class="hash-link" href="#insert-custom-case-class" title="Direct link to heading">​</a></h3><p>ZIO SQL lets you insert also your own case classes.
Let’s define a <em>customer</em> case class:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">final</span><span class="token plain"> </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Customer</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        id</span><span class="token operator">:</span><span class="token plain"> UUID</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        dateOfBirth</span><span class="token operator">:</span><span class="token plain"> LocalDate</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        firstName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        lastName</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        verified</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">Boolean</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        createdTimestamp</span><span class="token operator">:</span><span class="token plain"> ZonedDateTime</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, the name of the fields makes no difference. Similarly to writing sql, the order of the fields is important.</p><p>zio-sql also needs an implicit instance of zio-schema for your data type. You can define it easily:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token namespace">zio</span><span class="token namespace punctuation">.</span><span class="token namespace">schema</span><span class="token namespace punctuation">.</span><span class="token plain">DeriveSchema</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">implicit</span><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> customerSchema </span><span class="token operator">=</span><span class="token plain"> DeriveSchema</span><span class="token punctuation">.</span><span class="token plain">gen</span><span class="token punctuation">[</span><span class="token plain">Customer</span><span class="token punctuation">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then your insert looks almost the same as before:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> data</span><span class="token operator">:</span><span class="token plain"> Customer </span><span class="token operator">=</span><span class="token plain"> Customer</span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1990</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russel&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> insertInto</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        customerId</span><span class="token punctuation">,</span><span class="token plain"> dob</span><span class="token punctuation">,</span><span class="token plain"> fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> verified</span><span class="token punctuation">,</span><span class="token plain"> createdString</span><span class="token punctuation">,</span><span class="token plain"> createdTimestamp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">values</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or you can insert multiple rows at once. Just define data as a <code>List</code> or any collection of your choice.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> data </span><span class="token operator">:</span><span class="token plain"> List</span><span class="token punctuation">[</span><span class="token plain">Customer</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="show-generated-sql-query">Show generated SQL query<a class="hash-link" href="#show-generated-sql-query" title="Direct link to heading">​</a></h3><p>In case you want to see the exact query that zio-sql generated, you can use <code>renderInsert</code> method inside repo that has PostgresModule (or TableModel from above example) mixed in.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> insertInto</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        customerId</span><span class="token punctuation">,</span><span class="token plain"> dob</span><span class="token punctuation">,</span><span class="token plain"> fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> verified</span><span class="token punctuation">,</span><span class="token plain"> createdString</span><span class="token punctuation">,</span><span class="token plain"> createdTimestamp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">values</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1990</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russell&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> sqlString</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> renderInsert</span><span class="token punctuation">(</span><span class="token plain">query</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execute-the-query">Execute the query<a class="hash-link" href="#execute-the-query" title="Direct link to heading">​</a></h3><p>In order to execute a query, we use <code>execute</code> method inside repo that has PostgresModule (or TableModel from the above example) mixed in.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> insertInto</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        customerId</span><span class="token punctuation">,</span><span class="token plain"> dob</span><span class="token punctuation">,</span><span class="token plain"> fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> verified</span><span class="token punctuation">,</span><span class="token plain"> createdString</span><span class="token punctuation">,</span><span class="token plain"> createdTimestamp</span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">values</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">UUID</span><span class="token punctuation">.</span><span class="token plain">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> LocalDate</span><span class="token punctuation">.</span><span class="token plain">ofYearDay</span><span class="token punctuation">(</span><span class="token number">1990</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Ronald&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;Russell&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> ZonedDateTime</span><span class="token punctuation">.</span><span class="token plain">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> executed </span><span class="token operator">:</span><span class="token plain"> ZIO</span><span class="token punctuation">[</span><span class="token plain">Has</span><span class="token punctuation">[</span><span class="token plain">SqlDriver</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> Exception</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> execute</span><span class="token punctuation">(</span><span class="token plain">query</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As the type of <code>executed</code> indicates, you need to provide an <code>SqlDriver</code> in order to run this effect. The result <em>Int</em> is the number of rows updated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="more-examples">More examples<a class="hash-link" href="#more-examples" title="Direct link to heading">​</a></h3><p>More examples can be found in zio-sql test suite (<code>PostgresModuleSpec</code>, <code>SqlServerModuleSpec</code>, …) or in zio-sql-example application in resources.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-missing">What is missing<a class="hash-link" href="#what-is-missing" title="Direct link to heading">​</a></h3><p>As of now - Q1 2022 - zio-sql contributors is actively working on:</p><ul><li>returning generated IDs from inserts</li><li>introduce nullable columns - for which user won’t need to input values</li><li>introduce auto generated columns - for which user cannot input values</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="subqueries--correlated-subqueries">Subqueries &amp; Correlated subqueries<a class="hash-link" href="#subqueries--correlated-subqueries" title="Direct link to heading">​</a></h2><p>The goal of ZIO SQL is to give users the ability to describe also queries much more complex than just simple selects or joins. In this section we will introduce a few examples of subqueries and correlated subqueries. In case you will find a query which is not possible to write with zio-sql - or the generated sql query looks differently then expected - please contact us on discord and we will try to add your use case to the next release :) Now let’s explore what is possible today.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subquery">Subquery<a class="hash-link" href="#subquery" title="Direct link to heading">​</a></h3><p>Subquery is a query which is a part of another query. It’s executed first - before outer query - and then its result is used in outer query.</p><p>Now let’s say we want to build following query (this is on MSSQL Server) :</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">select</span><span class="token plain"> order_id</span><span class="token punctuation">,</span><span class="token plain"> product_id</span><span class="token punctuation">,</span><span class="token plain"> unit_price </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> order_details</span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">where</span><span class="token plain"> unit_price </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">AVG</span><span class="token punctuation">(</span><span class="token plain">price</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> product_prices </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We want to match details about orders, but we are interested only in those orders where price is higher than average price of all the products from <code>product_prices</code> table. </p><p>This is the meta model that we are working with:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> productPrices </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;product_id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> offsetDateTime</span><span class="token punctuation">(</span><span class="token string">&quot;effective&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> bigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;product_prices&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> id </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> effective </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> price </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> productPrices</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orderDetails </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;order_id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> uuid</span><span class="token punctuation">(</span><span class="token string">&quot;product_id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> bigDecimal</span><span class="token punctuation">(</span><span class="token string">&quot;unit_price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;order_details&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orderDetailsId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> productId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> unitPrice </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> orderDetails</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can create query very easily. In fact, just type it like a regular sql query and let your IDE auto completion guide you! </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> select</span><span class="token punctuation">(</span><span class="token plain">orderDetailsId</span><span class="token punctuation">,</span><span class="token plain"> productId</span><span class="token punctuation">,</span><span class="token plain"> unitPrice</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">from</span><span class="token punctuation">(</span><span class="token plain">orderDetails</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">where</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          unitPrice </span><span class="token operator">&gt;</span><span class="token plain"> select</span><span class="token punctuation">(</span><span class="token plain">Avg</span><span class="token punctuation">(</span><span class="token plain">price</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">from</span><span class="token punctuation">(</span><span class="token plain">productPrices</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then you can either execute the query to selected types or inspect sql query represented as a String.
You just need a custom data type (Row in our example) to encapsulate results of a selection.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">case</span><span class="token plain"> </span><span class="token keyword">class</span><span class="token plain"> Row</span><span class="token punctuation">(</span><span class="token plain">orderId</span><span class="token operator">:</span><span class="token plain"> UUID</span><span class="token punctuation">,</span><span class="token plain"> productId</span><span class="token operator">:</span><span class="token plain"> UUID</span><span class="token punctuation">,</span><span class="token plain"> unitPrice</span><span class="token operator">:</span><span class="token plain"> BigDecimal</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> result</span><span class="token operator">:</span><span class="token plain"> ZStream</span><span class="token punctuation">[</span><span class="token plain">Has</span><span class="token punctuation">[</span><span class="token plain">SqlDriver</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain">Exception</span><span class="token punctuation">,</span><span class="token plain">Row</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> execute</span><span class="token punctuation">(</span><span class="token plain">query</span><span class="token punctuation">.</span><span class="token plain">to</span><span class="token punctuation">[</span><span class="token plain">UUID</span><span class="token punctuation">,</span><span class="token plain"> UUID</span><span class="token punctuation">,</span><span class="token plain"> BigDecimal</span><span class="token punctuation">,</span><span class="token plain"> Row</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">Row</span><span class="token punctuation">.</span><span class="token plain">apply</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> sqlQuery</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> renderRead</span><span class="token punctuation">(</span><span class="token plain">query</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly you can use subqueries inside <code>select</code> clause.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="correlated-subqueries">Correlated subqueries<a class="hash-link" href="#correlated-subqueries" title="Direct link to heading">​</a></h3><p>Correlated subqueries are the ones that are executed after the outer query. They can be dependent on the result of the outer query and therefore they are executed for each resulting row of the outer query.</p><p>Lets say we want to build the following query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">select</span><span class="token plain"> first_name</span><span class="token punctuation">,</span><span class="token plain"> last_name</span><span class="token punctuation">,</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">(</span><span class="token plain"> </span><span class="token keyword">select</span><span class="token plain"> </span><span class="token function">count</span><span class="token punctuation">(</span><span class="token plain">orders</span><span class="token punctuation">.</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> orders </span><span class="token keyword">where</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> orders</span><span class="token punctuation">.</span><span class="token plain">customer_id </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token string">&quot;count&quot;</span><span class="token plain"> </span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">from</span><span class="token plain"> customers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This would return the count of orders for each customer.</p><p>Description of tables:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> customers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> string</span><span class="token punctuation">(</span><span class="token string">&quot;first_name&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> string</span><span class="token punctuation">(</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> customerId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> fName </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> lName _ </span><span class="token operator">=</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orders </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> uuid</span><span class="token punctuation">(</span><span class="token string">&quot;customer_id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> localDate</span><span class="token punctuation">(</span><span class="token string">&quot;order_date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orderId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> fkCustomerId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> orderDate </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> orders</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ZIO SQL query:</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> subquery </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        customers</span><span class="token punctuation">.</span><span class="token plain">subselect</span><span class="token punctuation">(</span><span class="token plain">Count</span><span class="token punctuation">(</span><span class="token plain">orderId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">from</span><span class="token punctuation">(</span><span class="token plain">orders</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">where</span><span class="token punctuation">(</span><span class="token plain">fkCustomerId </span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"> customerId</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> select</span><span class="token punctuation">(</span><span class="token plain">fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">subquery as </span><span class="token string">&quot;Count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">from</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All of these examples and more can be found and run in zio-sql tests.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="correlated-subquery-in-from-clause--derived-tables">Correlated subquery in from clause &amp; Derived tables<a class="hash-link" href="#correlated-subquery-in-from-clause--derived-tables" title="Direct link to heading">​</a></h3><p>Just one last, a little more complex example before we wrap up this section, for which we would use the same <em>customers</em> and <em>orders</em> tables as before.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">val</span><span class="token plain"> customers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> string</span><span class="token punctuation">(</span><span class="token string">&quot;first_name&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> string</span><span class="token punctuation">(</span><span class="token string">&quot;last_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> customerId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> fName </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> lName _ </span><span class="token operator">=</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orders </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">uuid</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> uuid</span><span class="token punctuation">(</span><span class="token string">&quot;customer_id&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain"> localDate</span><span class="token punctuation">(</span><span class="token string">&quot;order_date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orderId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> fkCustomerId </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> orderDate </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> orders</span><span class="token punctuation">.</span><span class="token plain">columns</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Imagine we want to write a query that selects all customers with the date of their last order. If you approach this problem with JOIN, you end up with one row of a customer with the newest order. In fact, this is a good example of correlated subquery inside <code>from</code> clause, where subquery needs to access <code>customer_id</code> of the outer query. For this type of problems postgres introduced <strong>LATERAL</strong> keyword and MSSQL Server have <strong>CROSS APPLY</strong> and <strong>OUTER APPLY</strong>.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">select</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">first_name</span><span class="token punctuation">,</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">last_name</span><span class="token punctuation">,</span><span class="token plain"> derived</span><span class="token punctuation">.</span><span class="token plain">order_date</span><br></span><span class="token-line"><span class="token plain">                </span><span class="token keyword">from</span><span class="token plain"> customers</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                lateral  </span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">                     </span><span class="token keyword">select</span><span class="token plain"> orders</span><span class="token punctuation">.</span><span class="token plain">order_date</span><br></span><span class="token-line"><span class="token plain">                     </span><span class="token keyword">from</span><span class="token plain"> orders</span><br></span><span class="token-line"><span class="token plain">                     </span><span class="token keyword">where</span><span class="token plain"> customers</span><span class="token punctuation">.</span><span class="token plain">id </span><span class="token operator">=</span><span class="token plain"> orders</span><span class="token punctuation">.</span><span class="token plain">customer_id</span><br></span><span class="token-line"><span class="token plain">                     </span><span class="token keyword">order</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> orders</span><span class="token punctuation">.</span><span class="token plain">order_date </span><span class="token keyword">desc</span><span class="token plain"> </span><span class="token keyword">limit</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">)</span><span class="token plain"> derived </span><span class="token keyword">order</span><span class="token plain"> </span><span class="token keyword">by</span><span class="token plain"> derived</span><span class="token punctuation">.</span><span class="token plain">order_date </span><span class="token keyword">desc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now it’s starting to be a little more complicated. First we need to create a <code>subselect</code> which can access columns from another source table - <code>customers</code> in our case. Then we specify this source as a type parameter to <code>subselect</code>. In order to build the whole query we also need <code>derived.order_date</code> which is coming from <code>derived</code> table, so that we can extract that column. We create <code>derivedTable</code> by calling <code>asTable(tableName: String)</code> method on <code>subselect</code>. </p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token plain"> </span><span class="token keyword">val</span><span class="token plain"> derivedTable  </span><span class="token operator">=</span><span class="token plain"> subselect</span><span class="token punctuation">[</span><span class="token plain">customers</span><span class="token punctuation">.</span><span class="token plain">TableType</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token plain">orderDate</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">from</span><span class="token punctuation">(</span><span class="token plain">orders</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">where</span><span class="token punctuation">(</span><span class="token plain">customerId </span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"> fkCustomerId</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">orderBy</span><span class="token punctuation">(</span><span class="token plain">Ordering</span><span class="token punctuation">.</span><span class="token plain">Desc</span><span class="token punctuation">(</span><span class="token plain">orderDate</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token plain">asTable</span><span class="token punctuation">(</span><span class="token string">&quot;derived&quot;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> orderDateDerived </span><span class="token operator">:</span><span class="token operator">*</span><span class="token operator">:</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> derivedTable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, we have all the ingredients we need to describe our query with zio-sql.</p><div class="language-scala codeBlockContainer_Ckt0 theme-code-block"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line"><span class="token keyword">import</span><span class="token plain"> PostgresSpecific</span><span class="token punctuation">.</span><span class="token plain">PostgresSpecificTable</span><span class="token punctuation">.</span><span class="token plain">_</span><br></span><span class="token-line"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line"><span class="token plain"></span><span class="token keyword">val</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">        select</span><span class="token punctuation">(</span><span class="token plain">customerId</span><span class="token punctuation">,</span><span class="token plain"> fName</span><span class="token punctuation">,</span><span class="token plain"> lName</span><span class="token punctuation">,</span><span class="token plain"> orderDateDerived</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">from</span><span class="token punctuation">(</span><span class="token plain">customers</span><span class="token punctuation">.</span><span class="token plain">lateral</span><span class="token punctuation">(</span><span class="token plain">derivedTable</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line"><span class="token plain">          </span><span class="token punctuation">.</span><span class="token plain">orderBy</span><span class="token punctuation">(</span><span class="token plain">Ordering</span><span class="token punctuation">.</span><span class="token plain">Desc</span><span class="token punctuation">(</span><span class="token plain">orderDateDerived</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="learning-resources">Learning Resources<a class="hash-link" href="#learning-resources" title="Direct link to heading">​</a></h2><ul><li><a href="https://github.com/sviezypan/zio-sql-example" target="_blank" rel="noopener noreferrer">ZIO SQL Example Application</a> by <a href="https://github.com/sviezypan" target="_blank" rel="noopener noreferrer">Jaro Regec</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zio-sql/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ZIO SQL</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#inserts-in-depth" class="table-of-contents__link toc-highlight">Inserts in depth</a><ul><li><a href="#table-description" class="table-of-contents__link toc-highlight">Table description</a></li><li><a href="#insert-tuples" class="table-of-contents__link toc-highlight">Insert tuples</a></li><li><a href="#insert-custom-case-class" class="table-of-contents__link toc-highlight">Insert custom case class</a></li><li><a href="#show-generated-sql-query" class="table-of-contents__link toc-highlight">Show generated SQL query</a></li><li><a href="#execute-the-query" class="table-of-contents__link toc-highlight">Execute the query</a></li><li><a href="#more-examples" class="table-of-contents__link toc-highlight">More examples</a></li><li><a href="#what-is-missing" class="table-of-contents__link toc-highlight">What is missing</a></li></ul></li><li><a href="#subqueries--correlated-subqueries" class="table-of-contents__link toc-highlight">Subqueries &amp; Correlated subqueries</a><ul><li><a href="#subquery" class="table-of-contents__link toc-highlight">Subquery</a></li><li><a href="#correlated-subqueries" class="table-of-contents__link toc-highlight">Correlated subqueries</a></li><li><a href="#correlated-subquery-in-from-clause--derived-tables" class="table-of-contents__link toc-highlight">Correlated subquery in from clause &amp; Derived tables</a></li></ul></li><li><a href="#learning-resources" class="table-of-contents__link toc-highlight">Learning Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                <img src="/img/navbar_brand.png" alt="zio">
            </li></ul></div><div class="col footer__col"><div class="footer__title">Github</div><ul class="footer__items clean-list"><li class="footer__item">
              <a href="https://github.com/zio/zio">
                <img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github">
              </a>
            </li></ul></div><div class="col footer__col"><div class="footer__title">Chat with us on Discord</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://discord.gg/2ccFBr4">
                  <img src="https://img.shields.io/discord/629491597070827530?logo=discord&style=social" alt="discord">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on Twitter</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://twitter.com/zioscala">
                  <img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&style=social" alt="twitter">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">Additional resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://javadoc.io/doc/dev.zio/zio_2.12/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scaladoc of ZIO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 ZIO Maintainers - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.64c25a3d.js"></script>
<script src="/assets/js/main.078878fa.js"></script>
</body>
</html>